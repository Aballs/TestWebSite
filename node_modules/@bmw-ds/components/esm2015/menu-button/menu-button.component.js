import { __decorate } from "tslib";
import { Component, ContentChild, HostBinding, Input, OnInit, ElementRef, AfterContentInit, isDevMode } from '@angular/core';
import { ContextMenuComponent, ContextMenuEventProviderDirective } from '../context-menu/context-menu.module';
let MenuButtonComponent = class MenuButtonComponent {
    constructor(elemRef) {
        this.elemRef = elemRef;
        this.styleVariant = 'default';
        this.sizeVariant = 'normal';
        this.preserveState = false;
    }
    ngOnInit() {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
        // keep the legacy input "closeOnFocusout"
        if (this.closeOnClickOutside === undefined) {
            if (this.closeOnFocusout !== undefined && isDevMode()) {
                console.warn('<bmw-menu-button> `closeOnFocusout` input is deprecated. Please use `closeOnClickOutside` instead');
            }
            this.closeOnClickOutside = this.closeOnFocusout !== undefined ? this.closeOnFocusout : true;
        }
    }
    ngAfterContentInit() {
        var _a;
        (_a = this.eventProvider) === null || _a === void 0 ? void 0 : _a.itemSelected.subscribe((event) => {
            if (event.leafItem) {
                this.toggle(false);
            }
        });
        this.childContextMenu.closeOnClickOutside = this.closeOnClickOutside;
    }
    toggle(state) {
        if (!this.childContextMenu || !this.childContextMenu.toggle)
            return;
        this.childContextMenu.toggle(state);
        if (!this.preserveState && !this.childContextMenu.opened)
            this.childContextMenu.unselectSubs();
        document.removeEventListener('click', this.outsideCallback);
        if (this.opened) {
            this.outsideCallback = this.onClickOutside.bind(this);
            document.addEventListener('click', this.outsideCallback);
        }
    }
    onClickOutside({ target }) {
        if (this.closeOnClickOutside && !this.elemRef.nativeElement.contains(target)) {
            this.toggle(false);
            document.removeEventListener('click', this.outsideCallback);
        }
    }
    get opened() {
        return this.childContextMenu ? this.childContextMenu.opened : false;
    }
    click(event) {
        event.stopPropagation();
        this.toggle();
    }
};
MenuButtonComponent.ctorParameters = () => [
    { type: ElementRef }
];
__decorate([
    ContentChild(ContextMenuComponent)
], MenuButtonComponent.prototype, "childContextMenu", void 0);
__decorate([
    ContentChild(ContextMenuEventProviderDirective)
], MenuButtonComponent.prototype, "eventProvider", void 0);
__decorate([
    Input()
], MenuButtonComponent.prototype, "disabled", void 0);
__decorate([
    Input()
], MenuButtonComponent.prototype, "closeOnFocusout", void 0);
__decorate([
    Input()
], MenuButtonComponent.prototype, "closeOnClickOutside", void 0);
__decorate([
    Input()
], MenuButtonComponent.prototype, "styleVariant", void 0);
__decorate([
    Input()
], MenuButtonComponent.prototype, "sizeVariant", void 0);
__decorate([
    Input()
], MenuButtonComponent.prototype, "preserveState", void 0);
__decorate([
    HostBinding('attr.id'),
    Input()
], MenuButtonComponent.prototype, "id", void 0);
__decorate([
    HostBinding('class.opened')
], MenuButtonComponent.prototype, "opened", null);
MenuButtonComponent = __decorate([
    Component({
        selector: 'bmw-menu-button',
        template: "<div>\n  <button\n    class=\"button\"\n    [ngClass]=\"[\n      styleVariant !== 'default' ? 'button--' + styleVariant : '',\n      sizeVariant !== 'normal' ? 'button--' + sizeVariant : ''\n    ]\"\n    [disabled]=\"disabled\"\n    (click)=\"click($event)\"\n  >\n    <div [ngClass]=\"sizeVariant === 'small' ? 'bmw-component-headline-text-small' : 'bmw-component-headline-text'\">\n      <ng-content select=\"label\"></ng-content>\n    </div>\n  </button>\n  <ng-content select=\"bmw-context-menu\"></ng-content>\n</div>\n",
        styles: ["div button{display:block;padding-right:calc(2 * var(--button__medium__padding) + var(--typography__component-headline-text__line-height) + 1px);box-sizing:border-box}div button div ::ng-deep label{width:100%;display:block;text-align:left;cursor:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div button.button--small{min-width:var(--menu-button__small__min-width)}div button.button--small ::ng-deep label{padding-right:calc(2 * var(--button__small__padding) + var(--typography__component-headline-text__line-height) + 1px);font-size:var(--menu-button__small__font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div button div:after{font-family:iwp;content:'\\e92f';position:absolute;right:var(--button__medium__padding);font-size:var(--typography__component-headline-text__font-size);top:calc(50% - var(--typography__component-headline-text__line-height)/ 2 - 1px)}:host.opened div button{color:var(--toggle-button__secondary__selected__color)!important;background-color:var(--toggle-button__secondary__selected__background-color)!important}:host.opened div button.button--primary{color:var(--toggle-button__primary__color)!important;border:1px solid!important;background-color:var(--toggle-button__primary__selected__background-color)!important}:host.opened div button.button--secondary{color:var(--toggle-button__secondary__selected__color)!important;background-color:var(--toggle-button__secondary__selected__background-color)!important}:host.opened div button div:after{font-family:iwp;content:'\\e932'}:host{display:inline-block;position:relative;max-width:100%}:host ::ng-deep bmw-context-menu div:first-of-type{min-width:100%}", ".button{padding:var(--button__medium__padding);text-transform:uppercase;color:var(--button__default__color);border:solid 1px var(--button__default__border__color);background-color:var(--button__default__background-color);position:relative;max-width:100%;cursor:pointer}.button.icon-left{padding-left:calc(var(--typography__component-headline-text__line-height) + var(--button__medium__padding) + var(--button__default__icon__padding))}.button.icon-right{padding-right:calc(var(--typography__component-headline-text__line-height) + var(--button__medium__padding) + var(--button__default__icon__padding))}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.button{padding-top:calc(var(--button__medium__padding) + 2px);padding-bottom:calc(var(--button__medium__padding) - 2px)}.button.icon-left{padding-left:30px}.button.icon-right{padding-right:30px}}.button i{font-size:var(--typography__component-headline-text__font-size);line-height:var(--typography__component-headline-text__line-height);position:absolute;top:calc(50% - var(--typography__component-headline-text__line-height)/ 2)}.button i.icon-left{left:var(--button__medium__padding)}.button i.icon-right{right:var(--button__medium__padding)}.button:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px;z-index:var(--z-index__content-base)}.button .bmw-component-headline-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.button.button--primary{border:solid 1px var(--button__primary__background-color);background-color:var(--button__primary__background-color);color:var(--button__primary__color)}.button.button--primary .bmw-component-headline-text,.button.button--primary .bmw-component-headline-text-small{color:var(--button__primary__color)}.button.button--primary:focus{outline:solid 1px;outline-color:var(--color-bmw-basic5);outline-offset:-3px}.button.button--secondary{border:solid 1px var(--button__secondary__border__color);background-color:var(--button__secondary__background-color)}.button:active{background-color:var(--button__default__active__background-color);border:solid 1px var(--button__default__active__background-color);color:var(--button__default__active__color)}.button:active .bmw-component-headline-text,.button:active .bmw-component-headline-text-small{color:var(--button__default__active__color)}.button:active.button--primary{background-color:var(--button__primary__active__background-color)}.button:active.button--secondary{background-color:var(--button__secondary__active__background-color)}.button:active,.button:hover{background-color:var(--button__default__hover__background-color);border:solid 1px var(--button__default__hover__border-color);color:var(--button__default__hover__color)}.button:active .bmw-component-headline-text,.button:active .bmw-component-headline-text-small,.button:hover .bmw-component-headline-text,.button:hover .bmw-component-headline-text-small{color:var(--button__default__hover__color)}.button:active.button--primary,.button:hover.button--primary{color:var(--button__primary__color);background-color:var(--button__primary__hover__background-color);border:solid 1px var(--button__primary__hover__background-color)}.button:active.button--primary .bmw-component-headline-text,.button:hover.button--primary .bmw-component-headline-text{color:var(--button__primary__hover__color)}.button:active.button--primary .bmw-component-headline-text-small,.button:hover.button--primary .bmw-component-headline-text-small{color:var(--button__primary__hover__color)}.button:active.button--secondary,.button:hover.button--secondary{color:var(--button__secondary__hover__color);background-color:var(--button__secondary__hover__background-color);border:solid 1px var(--button__secondary__border__color)}.button:active.button--secondary .bmw-component-headline-text,.button:hover.button--secondary .bmw-component-headline-text{color:var(--button__secondary__hover__color)}.button:active.button--secondary .bmw-component-headline-text-small,.button:hover.button--secondary .bmw-component-headline-text-small{color:var(--button__secondary__hover__color)}.button[disabled]{opacity:.7;pointer-events:none}.button.button--small{padding:var(--button__small__padding);padding-top:var(--button__small__padding-top);padding-bottom:var(--button__small__padding-bottom)}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.button.button--small{padding-top:calc(var(--button__small__padding-top) + 2px);padding-bottom:calc(var(--button__small__padding-bottom) - 2px)}}.button.button--small i{font-size:var(--typography__component-headline-text-small__font-size);line-height:var(--typography__component-headline-text-small__line-height);top:calc(50% - (var(--typography__component-headline-text-small__line-height)/ 2))}.button.button--small i.icon-left{left:var(--button__small__padding)}.button.button--small i.icon-right{right:var(--button__small__padding)}.button.button--small.icon-left{padding-left:calc(var(--typography__component-headline-text-small__font-size) + var(--button__small__padding) + var(--button__default__icon__padding))}.button.button--small.icon-right{padding-right:calc(var(--typography__component-headline-text-small__font-size) + var(--button__small__padding) + var(--button__default__icon__padding))}:host{max-width:100%}:host.disabled{cursor:no-drop;display:inline-block}"]
    })
], MenuButtonComponent);
export { MenuButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS1idXR0b24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibWVudS1idXR0b24vbWVudS1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUNMLE1BQU0sRUFDTixVQUFVLEVBQ1YsZ0JBQWdCLEVBQ2hCLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQVE5RyxJQUFhLG1CQUFtQixHQUFoQyxNQUFhLG1CQUFtQjtJQXdCOUIsWUFBb0IsT0FBbUI7UUFBbkIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQVp2QyxpQkFBWSxHQUF3QyxTQUFTLENBQUM7UUFFOUQsZ0JBQVcsR0FBdUIsUUFBUSxDQUFDO1FBRTNDLGtCQUFhLEdBQUcsS0FBSyxDQUFDO0lBUW9CLENBQUM7SUFFM0MsUUFBUTtRQUNOLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ1osSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFO2lCQUNwQixRQUFRLENBQUMsRUFBRSxDQUFDO2lCQUNaLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqQjtRQUVELDBDQUEwQztRQUMxQyxJQUFJLElBQUksQ0FBQyxtQkFBbUIsS0FBSyxTQUFTLEVBQUU7WUFDMUMsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLFNBQVMsSUFBSSxTQUFTLEVBQUUsRUFBRTtnQkFDckQsT0FBTyxDQUFDLElBQUksQ0FDVixtR0FBbUcsQ0FDcEcsQ0FBQzthQUNIO1lBRUQsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxlQUFlLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMs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ZGluZyxcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgRWxlbWVudFJlZixcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgaXNEZXZNb2RlXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udGV4dE1lbnVDb21wb25lbnQsIENvbnRleHRNZW51RXZlbnRQcm92aWRlckRpcmVjdGl2ZSB9IGZyb20gJy4uL2NvbnRleHQtbWVudS9jb250ZXh0LW1lbnUubW9kdWxlJztcbmltcG9ydCB7IFNlbGVjdGVkSXRlbUluZm8gfSBmcm9tICcuLi9jb250ZXh0LW1lbnUvY29udGV4dC1tZW51LWV2ZW50LXByb3ZpZGVyLmRpcmVjdGl2ZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Jtdy1tZW51LWJ1dHRvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9tZW51LWJ1dHRvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL21lbnUtYnV0dG9uLmNvbXBvbmVudC5sZXNzJywgJy4uL2J1dHRvbi9idXR0b24uY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBNZW51QnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0IHtcbiAgQENvbnRlbnRDaGlsZChDb250ZXh0TWVudUNvbXBvbmVudClcbiAgY2hpbGRDb250ZXh0TWVudTogQ29udGV4dE1lbnVDb21wb25lbnQ7XG4gIEBDb250ZW50Q2hpbGQoQ29udGV4dE1lbnVFdmVudFByb3ZpZGVyRGlyZWN0aXZlKVxuICBldmVudFByb3ZpZGVyOiBDb250ZXh0TWVudUV2ZW50UHJvdmlkZXJEaXJlY3RpdmU7XG4gIEBJbnB1dCgpXG4gIGRpc2FibGVkOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBjbG9zZU9uRm9jdXNvdXQ6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIGNsb3NlT25DbGlja091dHNpZGU6IGJvb2xlYW47XG4gIEBJbnB1dCgpXG4gIHN0eWxlVmFyaWFudDogJ2RlZmF1bHQnIHwgJ3ByaW1hcnknIHwgJ3NlY29uZGFyeScgPSAnZGVmYXVsdCc7XG4gIEBJbnB1dCgpXG4gIHNpemVWYXJpYW50OiAnbm9ybWFsJyB8ICdzbWFsbCcgPSAnbm9ybWFsJztcbiAgQElucHV0KClcbiAgcHJlc2VydmVTdGF0ZSA9IGZhbHNlO1xuXG4gIEBIb3N0QmluZGluZygnYXR0ci5pZCcpXG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG5cbiAgb3V0c2lkZUNhbGxiYWNrOiBhbnk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtUmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy5pZCkge1xuICAgICAgdGhpcy5pZCA9IE1hdGgucmFuZG9tKClcbiAgICAgICAgLnRvU3RyaW5nKDM2KVxuICAgICAgICAuc3Vic3RyaW5nKDIpO1xuICAgIH1cblxuICAgIC8vIGtlZXAgdGhlIGxlZ2FjeSBpbnB1dCBcImNsb3NlT25Gb2N1c291dFwiXG4gICAgaWYgKHRoaXMuY2xvc2VPbkNsaWNrT3V0c2lkZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAodGhpcy5jbG9zZU9uRm9jdXNvdXQgIT09IHVuZGVmaW5lZCAmJiBpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJzxibXctbWVudS1idXR0b24+IGBjbG9zZU9uRm9jdXNvdXRgIGlucHV0IGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgYGNsb3NlT25DbGlja091dHNpZGVgIGluc3RlYWQnXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2xvc2VPbkNsaWNrT3V0c2lkZSA9IHRoaXMuY2xvc2VPbkZvY3Vzb3V0ICE9PSB1bmRlZmluZWQgPyB0aGlzLmNsb3NlT25Gb2N1c291dCA6IHRydWU7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuZXZlbnRQcm92aWRlcj8uaXRlbVNlbGVjdGVkLnN1YnNjcmliZSgoZXZlbnQ6IFNlbGVjdGVkSXRlbUluZm8pID0+IHtcbiAgICAgIGlmIChldmVudC5sZWFmSXRlbSkge1xuICAgICAgICB0aGlzLnRvZ2dsZShmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmNoaWxkQ29udGV4dE1lbnUuY2xvc2VPbkNsaWNrT3V0c2lkZSA9IHRoaXMuY2xvc2VPbkNsaWNrT3V0c2lkZTtcbiAgfVxuXG4gIHRvZ2dsZShzdGF0ZT86IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMuY2hpbGRDb250ZXh0TWVudSB8fCAhdGhpcy5jaGlsZENvbnRleHRNZW51LnRvZ2dsZSkgcmV0dXJuO1xuICAgIHRoaXMuY2hpbGRDb250ZXh0TWVudS50b2dnbGUoc3RhdGUpO1xuICAgIGlmICghdGhpcy5wcmVzZXJ2ZVN0YXRlICYmICF0aGlzLmNoaWxkQ29udGV4dE1lbnUub3BlbmVkKSB0aGlzLmNoaWxkQ29udGV4dE1lbnUudW5zZWxlY3RTdWJzKCk7XG5cbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub3V0c2lkZUNhbGxiYWNrKTtcbiAgICBpZiAodGhpcy5vcGVuZWQpIHtcbiAgICAgIHRoaXMub3V0c2lkZUNhbGxiYWNrID0gdGhpcy5vbkNsaWNrT3V0c2lkZS5iaW5kKHRoaXMpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm91dHNpZGVDYWxsYmFjayk7XG4gICAgfVxuICB9XG5cbiAgb25DbGlja091dHNpZGUoeyB0YXJnZXQgfSkge1xuICAgIGlmICh0aGlzLmNsb3NlT25DbGlja091dHNpZGUgJiYgIXRoaXMuZWxlbVJlZi5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKHRhcmdldCkpIHtcbiAgICAgIHRoaXMudG9nZ2xlKGZhbHNlKTtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vdXRzaWRlQ2FsbGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3Mub3BlbmVkJylcbiAgZ2V0IG9wZW5lZCgpIHtcbiAgICByZXR1cm4gdGhpcy5jaGlsZENvbnRleHRNZW51ID8gdGhpcy5jaGlsZENvbnRleHRNZW51Lm9wZW5lZCA6IGZhbHNlO1xuICB9XG5cbiAgcHVibGljIGNsaWNrKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy50b2dnbGUoKTtcbiAgfVxufVxuIl19