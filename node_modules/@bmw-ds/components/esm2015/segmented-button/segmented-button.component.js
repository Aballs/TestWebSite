var SegmentedButtonComponent_1;
import { __decorate } from "tslib";
import { AfterViewInit, Component, ContentChildren, ViewChild, OnInit, QueryList, ViewContainerRef, ChangeDetectorRef, EventEmitter, Output, ElementRef, ViewRef, TemplateRef, HostListener, forwardRef, Input, EmbeddedViewRef, OnDestroy } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subject } from 'rxjs';
import { SegmentedButtonItemComponent } from './segmented-button-item/segmented-button-item.component';
let SegmentedButtonComponent = SegmentedButtonComponent_1 = class SegmentedButtonComponent {
    constructor(cd, elementRef) {
        this.cd = cd;
        this.elementRef = elementRef;
        this.onDestroy$ = new Subject();
        this.uncheckable = true;
        this.updateEvent = new EventEmitter();
        this.isMenuClosed = true;
        this.buttonItemClickSubscriptions = [];
        this.visibleElements = [];
        this.hiddenElements = [];
        this._onChange = () => { };
        this._onTouched = () => { };
    }
    onResize() {
        if (this.previousWidth >= this.elementRef.nativeElement.getBoundingClientRect().width) {
            //shrinking
            this._hideElement();
        }
        else {
            //expanding
            this._showElement();
        }
        this.previousWidth = this.elementRef.nativeElement.getBoundingClientRect().width;
    }
    onKeydown(event) {
        const key = event.code || event.keyCode;
        switch (key) {
            case 'ArrowDown':
            case 40:
                if (!this.isMenuClosed) {
                    this.setNextItemAsFocused();
                }
                event.preventDefault();
                break;
            case 'ArrowUp':
            case 38:
                if (!this.isMenuClosed) {
                    this.setPreviousItemAsFocused();
                }
                event.preventDefault();
                break;
            case 'Enter':
            case 'NumpadEnter':
            case 13:
                if (!this.isMenuClosed) {
                    const focusedItem = this.hiddenElements.find(el => el.item.focused === true);
                    if (!focusedItem.item.disabled) {
                        this.selectButton(focusedItem.item);
                        focusedItem.item.focused = false;
                        this.childItemsComponent
                            .toArray()
                            .find(element => element.value === this.value)
                            .button.focus();
                    }
                }
                event.preventDefault();
                break;
            case 'Space':
            case 32:
                if (event.target === this.elementRef.nativeElement.querySelector('.extension-menu')) {
                    this.toggleMenu();
                    event.preventDefault();
                }
                break;
            case 'Tab':
            case 9:
                if (!this.isMenuClosed) {
                    this.toggleMenu();
                }
                break;
        }
    }
    ngOnInit() {
        if (!this.id)
            this.id = Math.random()
                .toString(36)
                .substring(2);
        if (!this.name)
            this.name = 'segmented-' + this.id;
        this.previousWidth = this.elementRef.nativeElement.getBoundingClientRect().width;
    }
    ngAfterViewInit() {
        if (!this.visibleItemsContainer)
            return;
        this.createView();
        this.childItemsComponent.changes.subscribe((buttonItems) => {
            this.destroyView();
            this.createView();
            if (buttonItems.last.checked) {
                this.clearOtherChildren(buttonItems.last);
                this._onChange(buttonItems.last.value);
                this.updateEvent.emit(this);
            }
        });
    }
    ngOnDestroy() {
        this.onDestroy$.next();
        this.onDestroy$.complete();
    }
    createView() {
        this.visibleElements = this.childItemsComponent.toArray().map((element, index) => {
            element.resetVisibility();
            const view = this.visibleItemsContainer.createEmbeddedView(element.sample);
            this.buttonItemClickSubscriptions.push(element.buttonClicked.subscribe(() => {
                this.selectButton(element);
                if (!this.isMenuClosed) {
                    this.toggleMenu();
                }
            }));
            if (element.checked) {
                this.value = element.value;
            }
            if (this.disabled) {
                element.disabled = this.disabled;
            }
            return {
                view: view,
                order: index,
                item: element
            };
        });
        this.dots = this.visibleItemsContainer.createEmbeddedView(this.dropdownButton);
        this.cd.detectChanges();
        if (this._isOverflow) {
            this.showDots = true;
            this._hideElement();
        }
    }
    destroyView() {
        this.buttonItemClickSubscriptions.forEach(buttonClickSubscription => {
            buttonClickSubscription.unsubscribe();
        });
        this.visibleItemsContainer.clear();
        this.hiddenElements = [];
    }
    resetFocusedItem() {
        this.hiddenElements.forEach(el => (el.item.focused = false));
    }
    setPreviousItemAsFocused() {
        if (!this.isMenuClosed &&
            this.hiddenElements.length > 0 &&
            this.hiddenElements.filter(el => !el.item.disabled).length > 0) {
            let focusedItemIndex = this.hiddenElements.findIndex(el => el.item.focused === true);
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== 0) {
                focusedItemIndex = focusedItemIndex - 1;
            }
            else {
                focusedItemIndex = this.hiddenElements.length - 1;
            }
            this.hiddenElements[focusedItemIndex].item.focused = true;
            if (this.hiddenElements[focusedItemIndex].item.disabled) {
                this.setPreviousItemAsFocused();
            }
        }
    }
    setNextItemAsFocused() {
        if (!this.isMenuClosed &&
            this.hiddenElements.length > 0 &&
            this.hiddenElements.filter(el => !el.item.disabled).length > 0) {
            let focusedItemIndex = this.hiddenElements.findIndex(el => el.item.focused === true);
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== this.hiddenElements.length - 1) {
                focusedItemIndex = focusedItemIndex + 1;
            }
            else {
                focusedItemIndex = 0;
            }
            this.hiddenElements[focusedItemIndex].item.focused = true;
            if (this.hiddenElements[focusedItemIndex].item.disabled) {
                this.setNextItemAsFocused();
            }
        }
    }
    showSelected(value) {
        const checkedEl = this.hiddenElements.find(el => {
            return el.item.value === value;
        });
        if (checkedEl) {
            checkedEl.item.removeFromDropdown();
            checkedEl.item.toggleItemVisibility(this.isMenuClosed);
            this.hiddenElements = this.hiddenElements.filter(el => el.item.value !== this.value);
            this.visibleElements.push(checkedEl);
            this.sortArrays();
            this.positionOverflowedItems();
            this.cd.detectChanges();
            this._hideElement();
        }
    }
    _showElement() {
        if (this.hiddenElements.length) {
            const el = this.hiddenElements[0];
            el.item.removeFromDropdown();
            el.item.toggleItemVisibility(this.isMenuClosed);
            this.hiddenElements.splice(0, 1);
            this.visibleElements.push(el);
            this.sortArrays();
            el.view.detectChanges();
            if (this._isOverflow) {
                this._hideElement();
            }
            else {
                this._showElement();
            }
        }
        else {
            this.showDots = false;
        }
    }
    _hideElement() {
        if (!this._isOverflow || this.visibleElements.length < 2) {
            return;
        }
        let index = this.visibleElements.length - 1;
        if (this.visibleElements[index].item.value === this.value) {
            index = index - 1;
        }
        const el = this.visibleElements[index];
        el.item.moveToDropdown();
        el.item.toggleItemVisibility(this.isMenuClosed);
        this.visibleElements.splice(index, 1);
        this.hiddenElements.unshift(el);
        this.sortArrays();
        this.positionOverflowedItems();
        this.cd.detectChanges();
        this._hideElement();
    }
    sortArrays() {
        this.hiddenElements.sort((a, b) => a.order - b.order);
        this.visibleElements.sort((a, b) => a.order - b.order);
    }
    selectButton(buttonItem) {
        let isValueChanged = false;
        if (this.uncheckable) {
            this.value = !buttonItem.checked ? buttonItem.value : null;
            isValueChanged = true;
        }
        else {
            if (this.value !== buttonItem.value) {
                this.value = buttonItem.value;
                isValueChanged = true;
            }
        }
        if (isValueChanged) {
            this._toggleCheckedChildren(buttonItem);
            this.showSelected(this.value);
            this._onChange(this.value);
        }
        else {
            buttonItem.button.checked = true;
        }
    }
    toggleMenu(state) {
        if (!this.disabled) {
            state !== undefined ? (this.isMenuClosed = state) : (this.isMenuClosed = !this.isMenuClosed);
            this.hiddenElements.forEach(el => {
                el.item.toggleItemVisibility(this.isMenuClosed);
                el.view.detectChanges();
            });
        }
    }
    getMaxElWidthInDropdown() {
        if (this.hiddenElements.length) {
            this.toggleMenu(false);
            this.maxElWidthInDropdown = this.hiddenElements[0].view.rootNodes[0].getBoundingClientRect().width;
            this.hiddenElements.forEach(el => {
                const elWidth = el.view.rootNodes[0].getBoundingClientRect().width;
                if (elWidth > this.maxElWidthInDropdown) {
                    this.maxElWidthInDropdown = elWidth;
                }
            });
            this.toggleMenu(true);
        }
    }
    positionOverflowedItems() {
        this.getMaxElWidthInDropdown();
        this.hiddenElements.forEach((el, index) => {
            el.item.setTop(index + 1);
            el.item.setWidth(this.maxElWidthInDropdown);
        });
        this.cd.detectChanges();
    }
    get _isOverflow() {
        this._segmentButtonHeight = this.segmentButton.nativeElement.getBoundingClientRect().height.toFixed(0);
        this._componentHeight = this.labelWrapper.nativeElement.getBoundingClientRect().height.toFixed(0);
        if (this._segmentButtonHeight !== this._componentHeight) {
            this.showDots = true;
            return true;
        }
        return false;
    }
    _toggleCheckedChildren(item) {
        if (this.childItemsComponent) {
            this.childItemsComponent.toArray().forEach(element => {
                if (element === item) {
                    element.setChecked(this.uncheckable ? !element.checked : true);
                    this.updateEvent.emit(this);
                }
                else {
                    element.setChecked(false);
                }
            });
        }
    }
    clearOtherChildren(item) {
        if (this.childItemsComponent) {
            this.childItemsComponent.toArray().forEach(element => {
                if (element !== item) {
                    element.setChecked(false);
                }
            });
        }
    }
    registerOnChange(fn) {
        this._onChange = fn;
    }
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    writeValue(value) {
        setTimeout(() => {
            const initialItem = this.childItemsComponent.toArray().find(element => element.value === this.value);
            const itemToSelect = this.childItemsComponent.toArray().find(element => element.value === value);
            this.value = value;
            if (initialItem) {
                initialItem.checked = false;
            }
            if (itemToSelect) {
                itemToSelect.checked = true;
            }
        });
    }
    setDisabledState() {
        this.childItemsComponent.forEach(el => {
            el.disabled = true;
        });
    }
};
SegmentedButtonComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ElementRef }
];
__decorate([
    ViewChild('labelWrapper')
], SegmentedButtonComponent.prototype, "labelWrapper", void 0);
__decorate([
    ViewChild('segmentButton')
], SegmentedButtonComponent.prototype, "segmentButton", void 0);
__decorate([
    ViewChild('dropdownButton', { read: TemplateRef })
], SegmentedButtonComponent.prototype, "dropdownButton", void 0);
__decorate([
    ViewChild('visibleItemsContainer', { read: ViewContainerRef })
], SegmentedButtonComponent.prototype, "visibleItemsContainer", void 0);
__decorate([
    ContentChildren(SegmentedButtonItemComponent)
], SegmentedButtonComponent.prototype, "childItemsComponent", void 0);
__decorate([
    Input()
], SegmentedButtonComponent.prototype, "id", void 0);
__decorate([
    Input()
], SegmentedButtonComponent.prototype, "name", void 0);
__decorate([
    Input()
], SegmentedButtonComponent.prototype, "disabled", void 0);
__decorate([
    Input()
], SegmentedButtonComponent.prototype, "uncheckable", void 0);
__decorate([
    Output()
], SegmentedButtonComponent.prototype, "updateEvent", void 0);
__decorate([
    HostListener('window:resize')
], SegmentedButtonComponent.prototype, "onResize", null);
__decorate([
    HostListener('keydown', ['$event'])
], SegmentedButtonComponent.prototype, "onKeydown", null);
SegmentedButtonComponent = SegmentedButtonComponent_1 = __decorate([
    Component({
        selector: 'bmw-segmented-button',
        template: "<div #labelWrapper class=\"label-wrapper\">\n  <div #segmentButton class=\"segmented-button\">\n    <ng-container #visibleItemsContainer> </ng-container>\n  </div>\n</div>\n\n<ng-template #dropdownButton>\n  <div\n    #extensionMenu\n    class=\"extension-menu\"\n    [class.disabled]=\"disabled\"\n    [class.selected]=\"!isMenuClosed\"\n    (click)=\"toggleMenu()\"\n    [class.show]=\"showDots\"\n    tabindex=\"0\"\n  ></div>\n</ng-template>\n",
        providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => SegmentedButtonComponent_1),
                multi: true
            }
        ],
        styles: [".label-wrapper{height:2rem}.show{display:block!important}.segmented-button{display:inline-flex;min-height:2rem;padding-right:var(--segmanted-button__wrapper__padding-right);min-width:var(--segmented-button__item__min-width);flex-wrap:wrap;position:relative}.segmented-button .extension-menu{position:absolute;right:0;display:none;white-space:nowrap;margin-left:-1px;background-color:var(--toggle-button__default__background-color);cursor:pointer;border:solid 1px var(--toggle-button__secondary__border__color)}.segmented-button ::ng-deep bmw-segmented-button-item:nth-child(2):last-child label span span{display:block;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.segmented-button .extension-menu.disabled{opacity:.7;border:solid 1px var(--color-bmw-basic3-shade2);background-color:var(--color-bmw-basic1-shade3)}.segmented-button .extension-menu.disabled:hover{cursor:no-drop;border:solid 1px var(--color-bmw-basic3-shade2);background-color:var(--color-bmw-basic1-shade3)}.segmented-button .extension-menu.selected{border:solid 1px var(--color-bmw-basic3-shade2);background-color:var(--color-bmw-basic1-shade2)}.segmented-button .extension-menu:after{display:inline-block;font-size:var(--segmented-button__dots__font-size);line-height:var(--segmented-button__dots__font-size);padding:var(--segmented-button__dots__padding-vertical) var(--card-tabs__label__icon__padding);font-family:iwp;color:var(--card-tabs__labels__default__color);content:'\\ea22'}.segmented-button .extension-menu:hover{border:solid 1px var(--color-bmw-basic1-shade2);background-color:var(--color-bmw-basic1-shade2)}.segmented-button .extension-menu:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}.segmented-button .extension-menu .dropdown{position:absolute;top:calc(100% + 2px);right:-1px;display:none}.segmented-button .extension-menu .dropdown ::ng-deep bmw-segmented-button-item{z-index:-1;margin-left:0;margin-top:-1px;white-space:nowrap;display:block}@media screen and (max-width:37.49rem){.label-wrapper{height:2.5rem}}"]
    })
], SegmentedButtonComponent);
export { SegmentedButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VnbWVudGVkLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYm13LWRzL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJzZWdtZW50ZWQtYnV0dG9uL3NlZ21lbnRlZC1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUNMLGFBQWEsRUFDYixTQUFTLEVBQ1QsZUFBZSxFQUNmLFNBQVMsRUFDVCxNQUFNLEVBQ04sU0FBUyxFQUNULGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsWUFBWSxFQUNaLE1BQU0sRUFDTixVQUFVLEVBQ1YsT0FBTyxFQUNQLFdBQVcsRUFDWCxZQUFZLEVBQ1osVUFBVSxFQUNWLEtBQUssRUFDTCxlQUFlLEVBQ2YsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBd0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RSxPQUFPLEVBQUUsT0FBTyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQWN2RyxJQUFhLHdCQUF3QixnQ0FBckMsTUFBYSx3QkFBd0I7SUE4R25DLFlBQW9CLEVBQXFCLEVBQVUsVUFBc0I7UUFBckQsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBN0dqRSxlQUFVLEdBQWtCLElBQUksT0FBTyxFQUFFLENBQUM7UUF3QmxELGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBR25CLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQTRCLENBQUM7UUFJM0QsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFNcEIsaUNBQTRCLEdBQW1CLEVBQUUsQ0FBQztRQUVsRCxvQkFBZSxHQUF3RixFQUFFLENBQUM7UUFDMUcsbUJBQWMsR0FBd0YsRUFBRSxDQUFDO1FBQ3pHLGNBQVMsR0FBeUIsR0FBRyxFQUFFLEdBQUUsQ0FBQyxD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QUFDLEdBQUcsRUFBRSxDQUFDLDBCQUF3QixDQUFDO2dCQUN2RCxLQUFLLEVBQUUsSUFBSTthQUNaO1NBQ0Y7O0tBQ0YsQ0FBQztHQUNXLHdCQUF3QixDQTZacEM7U0E3Wlksd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIFZpZXdDaGlsZCxcbiAgT25Jbml0LFxuICBRdWVyeUxpc3QsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIE91dHB1dCxcbiAgRWxlbWVudFJlZixcbiAgVmlld1JlZixcbiAgVGVtcGxhdGVSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgZm9yd2FyZFJlZixcbiAgSW5wdXQsXG4gIEVtYmVkZGVkVmlld1JlZixcbiAgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50IH0gZnJvbSAnLi9zZWdtZW50ZWQtYnV0dG9uLWl0ZW0vc2VnbWVudGVkLWJ1dHRvbi1pdGVtLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Jtdy1zZWdtZW50ZWQtYnV0dG9uJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NlZ21lbnRlZC1idXR0b24uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9zZWdtZW50ZWQtYnV0dG9uLmNvbXBvbmVudC5sZXNzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU2VnbWVudGVkQnV0dG9uQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIFNlZ21lbnRlZEJ1dHRvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIHByaXZhdGUgb25EZXN0cm95JDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgQFZpZXdDaGlsZCgnbGFiZWxXcmFwcGVyJylcbiAgbGFiZWxXcmFwcGVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdzZWdtZW50QnV0dG9uJylcbiAgc2VnbWVudEJ1dHRvbjogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKCdkcm9wZG93bkJ1dHRvbicsIHsgcmVhZDogVGVtcGxhdGVSZWYgfSlcbiAgZHJvcGRvd25CdXR0b246IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgQFZpZXdDaGlsZCgndmlzaWJsZUl0ZW1zQ29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pXG4gIHZpc2libGVJdGVtc0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcblxuICBAQ29udGVudENoaWxkcmVuKFNlZ21lbnRlZEJ1dHRvbkl0ZW1Db21wb25lbnQpXG4gIGNoaWxkSXRlbXNDb21wb25lbnQ6IFF1ZXJ5TGlzdDxTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50PjtcblxuICBASW5wdXQoKVxuICBpZDogc3RyaW5nO1xuICBASW5wdXQoKVxuICBuYW1lOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIGRpc2FibGVkOiBib29sZWFuO1xuXG4gIEBJbnB1dCgpXG4gIHVuY2hlY2thYmxlID0gdHJ1ZTtcblxuICBAT3V0cHV0KClcbiAgdXBkYXRlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPFNlZ21lbnRlZEJ1dHRvbkNvbXBvbmVudD4oKTtcblxuICB2YWx1ZTogc3RyaW5nO1xuICBzaG93RG90czogYm9vbGVhbjtcbiAgaXNNZW51Q2xvc2VkID0gdHJ1ZTtcbiAgcHJldmlvdXNXaWR0aDogbnVtYmVyO1xuICBkb3RzOiBWaWV3UmVmO1xuICBfY29tcG9uZW50SGVpZ2h0OiBudW1iZXI7XG4gIF9zZWdtZW50QnV0dG9uSGVpZ2h0OiBudW1iZXI7XG4gIG1heEVsV2lkdGhJbkRyb3Bkb3duOiBudW1iZXI7XG4gIGJ1dHRvbkl0ZW1DbGlja1N1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbiAgdmlzaWJsZUVsZW1lbnRzOiB7IHZpZXc6IEVtYmVkZGVkVmlld1JlZjxhbnk+OyBvcmRlcjogbnVtYmVyOyBpdGVtOiBTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50IH1bXSA9IFtdO1xuICBoaWRkZW5FbGVtZW50czogeyB2aWV3OiBFbWJlZGRlZFZpZXdSZWY8YW55Pjsgb3JkZXI6IG51bWJlcjsgaXRlbTogU2VnbWVudGVkQnV0dG9uSXRlbUNvbXBvbmVudCB9W10gPSBbXTtcbiAgX29uQ2hhbmdlOiAodmFsdWU6IGFueSkgPT4gdm9pZCA9ICgpID0+IHt9O1xuICBfb25Ub3VjaGVkOiAoKSA9PiBhbnkgPSAoKSA9PiB7fTtcblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJylcbiAgb25SZXNpemUoKSB7XG4gICAgaWYgKHRoaXMucHJldmlvdXNXaWR0aCA+PSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCkge1xuICAgICAgLy9zaHJpbmtpbmdcbiAgICAgIHRoaXMuX2hpZGVFbGVtZW50KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vZXhwYW5kaW5nXG4gICAgICB0aGlzLl9zaG93RWxlbWVudCgpO1xuICAgIH1cbiAgICB0aGlzLnByZXZpb3VzV2lkdGggPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICBvbktleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBjb25zdCBrZXkgPSBldmVudC5jb2RlIHx8IGV2ZW50LmtleUNvZGU7XG4gICAgc3dpdGNoIChrZXkpIHtcbiAgICAgIGNhc2UgJ0Fycm93RG93bic6XG4gICAgICBjYXNlIDQwOlxuICAgICAgICBpZiAoIXRoaXMuaXNNZW51Q2xvc2VkKSB7XG4gICAgICAgICAgdGhpcy5zZXROZXh0SXRlbUFzRm9jdXNlZCgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQXJyb3dVcCc6XG4gICAgICBjYXNlIDM4OlxuICAgICAgICBpZiAoIXRoaXMuaXNNZW51Q2xvc2VkKSB7XG4gICAgICAgICAgdGhpcy5zZXRQcmV2aW91c0l0ZW1Bc0ZvY3VzZWQoKTtcbiAgICAgICAgfVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgIGNhc2UgJ051bXBhZEVudGVyJzpcbiAgICAgIGNhc2UgMTM6XG4gICAgICAgIGlmICghdGhpcy5pc01lbnVDbG9zZWQpIHtcbiAgICAgICAgICBjb25zdCBmb2N1c2VkSXRlbSA9IHRoaXMuaGlkZGVuRWxlbWVudHMuZmluZChlbCA9PiBlbC5pdGVtLmZvY3VzZWQgPT09IHRydWUpO1xuICAgICAgICAgIGlmICghZm9jdXNlZEl0ZW0uaXRlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RCdXR0b24oZm9jdXNlZEl0ZW0uaXRlbSk7XG5cbiAgICAgICAgICAgIGZvY3VzZWRJdGVtLml0ZW0uZm9jdXNlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnRcbiAgICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgICAuZmluZChlbGVtZW50ID0+IGVsZW1lbnQudmFsdWUgPT09IHRoaXMudmFsdWUpXG4gICAgICAgICAgICAgIC5idXR0b24uZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdTcGFjZSc6XG4gICAgICBjYXNlIDMyOlxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZXh0ZW5zaW9uLW1lbnUnKSkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlTWVudSgpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ1RhYic6XG4gICAgICBjYXNlIDk6XG4gICAgICAgIGlmICghdGhpcy5pc01lbnVDbG9zZWQpIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZU1lbnUoKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy5pZClcbiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpXG4gICAgICAgIC50b1N0cmluZygzNilcbiAgICAgICAgLnN1YnN0cmluZygyKTtcblxuICAgIGlmICghdGhpcy5uYW1lKSB0aGlzLm5hbWUgPSAnc2VnbWVudGVkLScgKyB0aGlzLmlkO1xuXG4gICAgdGhpcy5wcmV2aW91c1dpZHRoID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKCF0aGlzLnZpc2libGVJdGVtc0NvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgdGhpcy5jcmVhdGVWaWV3KCk7XG5cbiAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuY2hhbmdlcy5zdWJzY3JpYmUoKGJ1dHRvbkl0ZW1zOiBRdWVyeUxpc3Q8U2VnbWVudGVkQnV0dG9uSXRlbUNvbXBvbmVudD4pID0+IHtcbiAgICAgIHRoaXMuZGVzdHJveVZpZXcoKTtcbiAgICAgIHRoaXMuY3JlYXRlVmlldygpO1xuXG4gICAgICBpZiAoYnV0dG9uSXRlbXMubGFzdC5jaGVja2VkKSB7XG4gICAgICAgIHRoaXMuY2xlYXJPdGhlckNoaWxkcmVuKGJ1dHRvbkl0ZW1zLmxhc3QpO1xuICAgICAgICB0aGlzLl9vbkNoYW5nZShidXR0b25JdGVtcy5sYXN0LnZhbHVlKTtcbiAgICAgICAgdGhpcy51cGRhdGVFdmVudC5lbWl0KHRoaXMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQoKTtcbiAgICB0aGlzLm9uRGVzdHJveSQuY29tcGxldGUoKTtcbiAgfVxuXG4gIGNyZWF0ZVZpZXcoKSB7XG4gICAgdGhpcy52aXNpYmxlRWxlbWVudHMgPSB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQudG9BcnJheSgpLm1hcCgoZWxlbWVudCwgaW5kZXgpID0+IHtcbiAgICAgIGVsZW1lbnQucmVzZXRWaXNpYmlsaXR5KCk7XG4gICAgICBjb25zdCB2aWV3ID0gdGhpcy52aXNpYmxlSXRlbXNDb250YWluZXIuY3JlYXRlRW1iZWRkZWRWaWV3KGVsZW1lbnQuc2FtcGxlKTtcbiAgICAgIHRoaXMuYnV0dG9uSXRlbUNsaWNrU3Vic2NyaXB0aW9ucy5wdXNoKFxuICAgICAgICBlbGVtZW50LmJ1dHRvbkNsaWNrZWQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnNlbGVjdEJ1dHRvbihlbGVtZW50KTtcblxuICAgICAgICAgIGlmICghdGhpcy5pc01lbnVDbG9zZWQpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlTWVudSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIGlmIChlbGVtZW50LmNoZWNrZWQpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IGVsZW1lbnQudmFsdWU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgICBlbGVtZW50LmRpc2FibGVkID0gdGhpcy5kaXNhYmxlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZpZXc6IHZpZXcsXG4gICAgICAgIG9yZGVyOiBpbmRleCxcbiAgICAgICAgaXRlbTogZWxlbWVudFxuICAgICAgfTtcbiAgICB9KTtcbiAgICB0aGlzLmRvdHMgPSB0aGlzLnZpc2libGVJdGVtc0NvbnRhaW5lci5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy5kcm9wZG93bkJ1dHRvbik7XG4gICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgaWYgKHRoaXMuX2lzT3ZlcmZsb3cpIHtcbiAgICAgIHRoaXMuc2hvd0RvdHMgPSB0cnVlO1xuICAgICAgdGhpcy5faGlkZUVsZW1lbnQoKTtcbiAgICB9XG4gIH1cblxuICBkZXN0cm95VmlldygpIHtcbiAgICB0aGlzLmJ1dHRvbkl0ZW1DbGlja1N1YnNjcmlwdGlvbnMuZm9yRWFjaChidXR0b25DbGlja1N1YnNjcmlwdGlvbiA9PiB7XG4gICAgICBidXR0b25DbGlja1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy52aXNpYmxlSXRlbXNDb250YWluZXIuY2xlYXIoKTtcbiAgICB0aGlzLmhpZGRlbkVsZW1lbnRzID0gW107XG4gIH1cblxuICByZXNldEZvY3VzZWRJdGVtKCkge1xuICAgIHRoaXMuaGlkZGVuRWxlbWVudHMuZm9yRWFjaChlbCA9PiAoZWwuaXRlbS5mb2N1c2VkID0gZmFsc2UpKTtcbiAgfVxuXG4gIHNldFByZXZpb3VzSXRlbUFzRm9jdXNlZCgpIHtcbiAgICBpZiAoXG4gICAgICAhdGhpcy5pc01lbnVDbG9zZWQgJiZcbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHMubGVuZ3RoID4gMCAmJlxuICAgICAgdGhpcy5oaWRkZW5FbGVtZW50cy5maWx0ZXIoZWwgPT4gIWVsLml0ZW0uZGlzYWJsZWQpLmxlbmd0aCA+IDBcbiAgICApIHtcbiAgICAgIGxldCBmb2N1c2VkSXRlbUluZGV4OiBudW1iZXIgPSB0aGlzLmhpZGRlbkVsZW1lbnRzLmZpbmRJbmRleChlbCA9PiBlbC5pdGVtLmZvY3VzZWQgPT09IHRydWUpO1xuICAgICAgdGhpcy5yZXNldEZvY3VzZWRJdGVtKCk7XG4gICAgICBpZiAoZm9jdXNlZEl0ZW1JbmRleCAhPT0gLTEgJiYgZm9jdXNlZEl0ZW1JbmRleCAhPT0gMCkge1xuICAgICAgICBmb2N1c2VkSXRlbUluZGV4ID0gZm9jdXNlZEl0ZW1JbmRleCAtIDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb2N1c2VkSXRlbUluZGV4ID0gdGhpcy5oaWRkZW5FbGVtZW50cy5sZW5ndGggLSAxO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzW2ZvY3VzZWRJdGVtSW5kZXhdLml0ZW0uZm9jdXNlZCA9IHRydWU7XG5cbiAgICAgIGlmICh0aGlzLmhpZGRlbkVsZW1lbnRzW2ZvY3VzZWRJdGVtSW5kZXhdLml0ZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5zZXRQcmV2aW91c0l0ZW1Bc0ZvY3VzZWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXROZXh0SXRlbUFzRm9jdXNlZCgpIHtcbiAgICBpZiAoXG4gICAgICAhdGhpcy5pc01lbnVDbG9zZWQgJiZcbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHMubGVuZ3RoID4gMCAmJlxuICAgICAgdGhpcy5oaWRkZW5FbGVtZW50cy5maWx0ZXIoZWwgPT4gIWVsLml0ZW0uZGlzYWJsZWQpLmxlbmd0aCA+IDBcbiAgICApIHtcbiAgICAgIGxldCBmb2N1c2VkSXRlbUluZGV4OiBudW1iZXIgPSB0aGlzLmhpZGRlbkVsZW1lbnRzLmZpbmRJbmRleChlbCA9PiBlbC5pdGVtLmZvY3VzZWQgPT09IHRydWUpO1xuICAgICAgdGhpcy5yZXNldEZvY3VzZWRJdGVtKCk7XG4gICAgICBpZiAoZm9jdXNlZEl0ZW1JbmRleCAhPT0gLTEgJiYgZm9jdXNlZEl0ZW1JbmRleCAhPT0gdGhpcy5oaWRkZW5FbGVtZW50cy5sZW5ndGggLSAxKSB7XG4gICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSBmb2N1c2VkSXRlbUluZGV4ICsgMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSAwO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzW2ZvY3VzZWRJdGVtSW5kZXhdLml0ZW0uZm9jdXNlZCA9IHRydWU7XG5cbiAgICAgIGlmICh0aGlzLmhpZGRlbkVsZW1lbnRzW2ZvY3VzZWRJdGVtSW5kZXhdLml0ZW0uZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5zZXROZXh0SXRlbUFzRm9jdXNlZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNob3dTZWxlY3RlZCh2YWx1ZSkge1xuICAgIGNvbnN0IGNoZWNrZWRFbCA9IHRoaXMuaGlkZGVuRWxlbWVudHMuZmluZChlbCA9PiB7XG4gICAgICByZXR1cm4gZWwuaXRlbS52YWx1ZSA9PT0gdmFsdWU7XG4gICAgfSk7XG4gICAgaWYgKGNoZWNrZWRFbCkge1xuICAgICAgY2hlY2tlZEVsLml0ZW0ucmVtb3ZlRnJvbURyb3Bkb3duKCk7XG4gICAgICBjaGVja2VkRWwuaXRlbS50b2dnbGVJdGVtVmlzaWJpbGl0eSh0aGlzLmlzTWVudUNsb3NlZCk7XG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzID0gdGhpcy5oaWRkZW5FbGVtZW50cy5maWx0ZXIoZWwgPT4gZWwuaXRlbS52YWx1ZSAhPT0gdGhpcy52YWx1ZSk7XG4gICAgICB0aGlzLnZpc2libGVFbGVtZW50cy5wdXNoKGNoZWNrZWRFbCk7XG4gICAgICB0aGlzLnNvcnRBcnJheXMoKTtcbiAgICAgIHRoaXMucG9zaXRpb25PdmVyZmxvd2VkSXRlbXMoKTtcbiAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgdGhpcy5faGlkZUVsZW1lbnQoKTtcbiAgICB9XG4gIH1cblxuICBfc2hvd0VsZW1lbnQoKSB7XG4gICAgaWYgKHRoaXMuaGlkZGVuRWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBlbCA9IHRoaXMuaGlkZGVuRWxlbWVudHNbMF07XG4gICAgICBlbC5pdGVtLnJlbW92ZUZyb21Ecm9wZG93bigpO1xuICAgICAgZWwuaXRlbS50b2dnbGVJdGVtVmlzaWJpbGl0eSh0aGlzLmlzTWVudUNsb3NlZCk7XG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLnNwbGljZSgwLCAxKTtcbiAgICAgIHRoaXMudmlzaWJsZUVsZW1lbnRzLnB1c2goZWwpO1xuICAgICAgdGhpcy5zb3J0QXJyYXlzKCk7XG4gICAgICBlbC52aWV3LmRldGVjdENoYW5nZXMoKTtcbiAgICAgIGlmICh0aGlzLl9pc092ZXJmbG93KSB7XG4gICAgICAgIHRoaXMuX2hpZGVFbGVtZW50KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9zaG93RWxlbWVudCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNob3dEb3RzID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgX2hpZGVFbGVtZW50KCkge1xuICAgIGlmICghdGhpcy5faXNPdmVyZmxvdyB8fCB0aGlzLnZpc2libGVFbGVtZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBpbmRleCA9IHRoaXMudmlzaWJsZUVsZW1lbnRzLmxlbmd0aCAtIDE7XG4gICAgaWYgKHRoaXMudmlzaWJsZUVsZW1lbnRzW2luZGV4XS5pdGVtLnZhbHVlID09PSB0aGlzLnZhbHVlKSB7XG4gICAgICBpbmRleCA9IGluZGV4IC0gMTtcbiAgICB9XG5cbiAgICBjb25zdCBlbCA9IHRoaXMudmlzaWJsZUVsZW1lbnRzW2luZGV4XTtcbiAgICBlbC5pdGVtLm1vdmVUb0Ryb3Bkb3duKCk7XG4gICAgZWwuaXRlbS50b2dnbGVJdGVtVmlzaWJpbGl0eSh0aGlzLmlzTWVudUNsb3NlZCk7XG4gICAgdGhpcy52aXNpYmxlRWxlbWVudHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLnVuc2hpZnQoZWwpO1xuICAgIHRoaXMuc29ydEFycmF5cygpO1xuICAgIHRoaXMucG9zaXRpb25PdmVyZmxvd2VkSXRlbXMoKTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICB0aGlzLl9oaWRlRWxlbWVudCgpO1xuICB9XG5cbiAgc29ydEFycmF5cygpIHtcbiAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcbiAgICB0aGlzLnZpc2libGVFbGVtZW50cy5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7XG4gIH1cblxuICBzZWxlY3RCdXR0b24oYnV0dG9uSXRlbTogU2VnbWVudGVkQnV0dG9uSXRlbUNvbXBvbmVudCkge1xuICAgIGxldCBpc1ZhbHVlQ2hhbmdlZCA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMudW5jaGVja2FibGUpIHtcbiAgICAgIHRoaXMudmFsdWUgPSAhYnV0dG9uSXRlbS5jaGVja2VkID8gYnV0dG9uSXRlbS52YWx1ZSA6IG51bGw7XG4gICAgICBpc1ZhbHVlQ2hhbmdlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLnZhbHVlICE9PSBidXR0b25JdGVtLnZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBidXR0b25JdGVtLnZhbHVlO1xuICAgICAgICBpc1ZhbHVlQ2hhbmdlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpc1ZhbHVlQ2hhbmdlZCkge1xuICAgICAgdGhpcy5fdG9nZ2xlQ2hlY2tlZENoaWxkcmVuKGJ1dHRvbkl0ZW0pO1xuICAgICAgdGhpcy5zaG93U2VsZWN0ZWQodGhpcy52YWx1ZSk7XG4gICAgICB0aGlzLl9vbkNoYW5nZSh0aGlzLnZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnV0dG9uSXRlbS5idXR0b24uY2hlY2tlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlTWVudShzdGF0ZT86IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHN0YXRlICE9PSB1bmRlZmluZWQgPyAodGhpcy5pc01lbnVDbG9zZWQgPSBzdGF0ZSkgOiAodGhpcy5pc01lbnVDbG9zZWQgPSAhdGhpcy5pc01lbnVDbG9zZWQpO1xuICAgICAgdGhpcy5oaWRkZW5FbGVtZW50cy5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgZWwuaXRlbS50b2dnbGVJdGVtVmlzaWJpbGl0eSh0aGlzLmlzTWVudUNsb3NlZCk7XG4gICAgICAgIGVsLnZpZXcuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0TWF4RWxXaWR0aEluRHJvcGRvd24oKSB7XG4gICAgaWYgKHRoaXMuaGlkZGVuRWxlbWVudHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnRvZ2dsZU1lbnUoZmFsc2UpO1xuICAgICAgdGhpcy5tYXhFbFdpZHRoSW5Ecm9wZG93biA9IHRoaXMuaGlkZGVuRWxlbWVudHNbMF0udmlldy5yb290Tm9kZXNbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLmZvckVhY2goZWwgPT4ge1xuICAgICAgICBjb25zdCBlbFdpZHRoOiBudW1iZXIgPSBlbC52aWV3LnJvb3ROb2Rlc1swXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICAgICAgaWYgKGVsV2lkdGggPiB0aGlzLm1heEVsV2lkdGhJbkRyb3Bkb3duKSB7XG4gICAgICAgICAgdGhpcy5tYXhFbFdpZHRoSW5Ecm9wZG93biA9IGVsV2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy50b2dnbGVNZW51KHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIHBvc2l0aW9uT3ZlcmZsb3dlZEl0ZW1zKCkge1xuICAgIHRoaXMuZ2V0TWF4RWxXaWR0aEluRHJvcGRvd24oKTtcbiAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLmZvckVhY2goKGVsLCBpbmRleCkgPT4ge1xuICAgICAgZWwuaXRlbS5zZXRUb3AoaW5kZXggKyAxKTtcbiAgICAgIGVsLml0ZW0uc2V0V2lkdGgodGhpcy5tYXhFbFdpZHRoSW5Ecm9wZG93bik7XG4gICAgfSk7XG4gICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBnZXQgX2lzT3ZlcmZsb3coKTogYm9vbGVhbiB7XG4gICAgdGhpcy5fc2VnbWVudEJ1dHRvbkhlaWdodCA9IHRoaXMuc2VnbWVudEJ1dHRvbi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodC50b0ZpeGVkKDApO1xuICAgIHRoaXMuX2NvbXBvbmVudEhlaWdodCA9IHRoaXMubGFiZWxXcmFwcGVyLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0LnRvRml4ZWQoMCk7XG4gICAgaWYgKHRoaXMuX3NlZ21lbnRCdXR0b25IZWlnaHQgIT09IHRoaXMuX2NvbXBvbmVudEhlaWdodCkge1xuICAgICAgdGhpcy5zaG93RG90cyA9IHRydWU7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgX3RvZ2dsZUNoZWNrZWRDaGlsZHJlbihpdGVtOiBTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50KSB7XG4gICAgaWYgKHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudCkge1xuICAgICAgdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LnRvQXJyYXkoKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICBpZiAoZWxlbWVudCA9PT0gaXRlbSkge1xuICAgICAgICAgIGVsZW1lbnQuc2V0Q2hlY2tlZCh0aGlzLnVuY2hlY2thYmxlID8gIWVsZW1lbnQuY2hlY2tlZCA6IHRydWUpO1xuICAgICAgICAgIHRoaXMudXBkYXRlRXZlbnQuZW1pdCh0aGlzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbGVtZW50LnNldENoZWNrZWQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjbGVhck90aGVyQ2hpbGRyZW4oaXRlbTogU2VnbWVudGVkQnV0dG9uSXRlbUNvbXBvbmVudCkge1xuICAgIGlmICh0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQpIHtcbiAgICAgIHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudC50b0FycmF5KCkuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgaWYgKGVsZW1lbnQgIT09IGl0ZW0pIHtcbiAgICAgICAgICBlbGVtZW50LnNldENoZWNrZWQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAodmFsdWU6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX29uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMuX29uVG91Y2hlZCA9IGZuO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCBpbml0aWFsSXRlbSA9IHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudC50b0FycmF5KCkuZmluZChlbGVtZW50ID0+IGVsZW1lbnQudmFsdWUgPT09IHRoaXMudmFsdWUpO1xuICAgICAgY29uc3QgaXRlbVRvU2VsZWN0ID0gdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LnRvQXJyYXkoKS5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC52YWx1ZSA9PT0gdmFsdWUpO1xuXG4gICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG5cbiAgICAgIGlmIChpbml0aWFsSXRlbSkge1xuICAgICAgICBpbml0aWFsSXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVtVG9TZWxlY3QpIHtcbiAgICAgICAgaXRlbVRvU2VsZWN0LmNoZWNrZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZSgpIHtcbiAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZm9yRWFjaChlbCA9PiB7XG4gICAgICBlbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==