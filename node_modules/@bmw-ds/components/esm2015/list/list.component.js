import { __decorate } from "tslib";
import { Component, Input, ContentChildren, ViewChild, HostBinding, EventEmitter, Output } from '@angular/core';
import { ListItemComponent } from './list-item.component';
import { CheckboxComponent } from '../checkbox/checkbox.component';
let ListComponent = class ListComponent {
    constructor() {
        this._selectedItem = null;
        this.selectedItemChange = new EventEmitter();
        this.selectHeader = null;
        this.updateEvent = new EventEmitter();
    }
    get selectedItem() {
        return this._selectedItem;
    }
    set selectedItem(value) {
        if (value !== this._selectedItem) {
            this._selectedItem = value;
            this.selectOne(value);
            this.selectedItemChange.emit(value);
        }
    }
    ngAfterViewInit() {
        this.childItemsComponent.changes.subscribe({
            next: elements => {
                this.childItemsComponent.forEach((element) => {
                    element.updateEvent.subscribe((event) => {
                        if (!this.multiSelect) {
                            this.selectOne(element);
                            this.updateEvent.emit(element);
                        }
                        else {
                            this.selectMore(element);
                            this.updateEvent.next(this.childItemsComponent.filter(i => i.selected));
                        }
                    });
                    if (this.multiSelect) {
                        //setTimeout used to avoid value changed after check error
                        setTimeout(() => {
                            element.multiSelect = true;
                        });
                    }
                });
            }
        });
        //setTimeout used to avoid value changed after check error
        setTimeout(() => {
            if (!this.id) {
                this.id = Math.random()
                    .toString(36)
                    .substring(2);
            }
        });
        this.childItemsComponent.forEach((element) => {
            element.updateEvent.subscribe((event) => {
                if (!this.multiSelect) {
                    this.selectOne(element);
                    this.updateEvent.emit(element);
                }
                else {
                    this.selectMore(element);
                    this.updateEvent.next(this.childItemsComponent.filter(i => i.selected));
                }
            });
            if (this.multiSelect) {
                //setTimeout used to avoid value changed after check error
                setTimeout(() => {
                    element.multiSelect = true;
                });
            }
        });
        if (this.multiSelect) {
            this.selectMore(null);
        }
    }
    selectOne(selectItem) {
        if (!this.childItemsComponent) {
            return;
        }
        this.childItemsComponent.forEach(element => {
            element.selected = element === selectItem;
            if (element.selected) {
                this.selectedItem = element;
            }
        });
    }
    selectMore(selectedItem) {
        let selectAll = true;
        let unselectAll = true;
        this.childItemsComponent.forEach(element => {
            if (element === selectedItem) {
                element.selected = !element.selected;
            }
            if (element.selected) {
                selectAll = true && selectAll;
                unselectAll = false;
            }
            else {
                selectAll = false;
                unselectAll = true && unselectAll;
            }
        });
        this.selectHeader = selectAll ? "checked" /* checked */ : unselectAll ? null : "indeterminate" /* indeterminate */;
    }
    headerChange(event) {
        this.childItemsComponent.forEach(element => {
            element.selected = event.checked === 'checked';
        });
        this.updateEvent.next(this.childItemsComponent.filter(i => i.selected));
    }
    sort(event) {
        //ignore clicks on checkbox
        if (event.target !== this.header.nativeElement) {
            return;
        }
        if (this.sortingOrder == null) {
            this.sortingOrder = false;
        }
        this.sortingOrder = !this.sortingOrder;
        const sort = (a, b) => {
            const aText = a.label;
            const bText = b.label;
            const pureOrder = aText > bText;
            return pureOrder === this.sortingOrder ? 1 : -1;
        };
        const newArray = this.childItemsComponent.toArray().sort(sort);
        newArray.forEach((item, index) => {
            item.order = index.toString();
        });
    }
    ngOnDestroy() {
        this.childItemsComponent.forEach(element => {
            element.updateEvent.unsubscribe();
        });
    }
};
__decorate([
    ViewChild(CheckboxComponent)
], ListComponent.prototype, "input", void 0);
__decorate([
    ViewChild('items')
], ListComponent.prototype, "items", void 0);
__decorate([
    ViewChild('header')
], ListComponent.prototype, "header", void 0);
__decorate([
    ViewChild('headerCheckbox')
], ListComponent.prototype, "headerCheckbox", void 0);
__decorate([
    HostBinding('attr.id'),
    Input()
], ListComponent.prototype, "id", void 0);
__decorate([
    Input()
], ListComponent.prototype, "disabled", void 0);
__decorate([
    Input()
], ListComponent.prototype, "label", void 0);
__decorate([
    Input()
], ListComponent.prototype, "multiSelect", void 0);
__decorate([
    ContentChildren(ListItemComponent)
], ListComponent.prototype, "childItemsComponent", void 0);
__decorate([
    Input()
], ListComponent.prototype, "selectedItem", null);
__decorate([
    Output()
], ListComponent.prototype, "selectedItemChange", void 0);
__decorate([
    Output()
], ListComponent.prototype, "updateEvent", void 0);
ListComponent = __decorate([
    Component({
        selector: 'bmw-list',
        template: "<div class=\"wrapper\" [class.disabled]=\"disabled\">\n  <div\n    class=\"header bmw-table-headline-text\"\n    [class.selectable]=\"multiSelect\"\n    [class.disabled]=\"disabled\"\n    (click)=\"sort($event)\"\n    [class.descending]=\"sortingOrder\"\n    [class.non-sorted]=\"sortingOrder == null\"\n    *ngIf=\"label\"\n    #header\n  >\n    <div class=\"separator\" *ngIf=\"multiSelect\"></div>\n    <bmw-checkbox\n      *ngIf=\"multiSelect\"\n      (updateEvent)=\"headerChange($event)\"\n      [checked]=\"selectHeader\"\n      #headerCheckbox\n    ></bmw-checkbox>\n    {{ label }}\n  </div>\n  <div class=\"items\" [class.disabled]=\"disabled\" #items>\n    <ng-content select=\"bmw-list-item\"></ng-content>\n  </div>\n</div>\n",
        styles: [":host .wrapper{display:inline-block;min-width:186px;max-width:100%}:host .wrapper .header{padding:var(--list__header__padding);padding-right:calc(2 * var(--list__header__padding) + var(--list__icon__height));position:relative;background-color:var(--list__default__background-color);color:var(--list__default__color);text-overflow:ellipsis;white-space:nowrap;overflow:hidden;cursor:pointer}:host .wrapper .header ::ng-deep label{cursor:inherit}:host .wrapper .header ::ng-deep label div{height:var(--checkbox__default__height)}:host .wrapper .header.selectable{padding-left:var(--list__header__selectable__padding-left)}:host .wrapper .header.selectable ::ng-deep bmw-checkbox{position:absolute;top:calc((var(--list__header__line-height) - var(--checkbox__default__height))/ 2 + var(--list__header__padding));left:var(--list__header__padding)}:host .wrapper .header::after{position:absolute;top:var(--list__header__padding);right:var(--list__header__padding);content:' ';width:var(--list__icon__height);height:var(--list__icon__height);background-color:var(--list__default__color);background:url(\"data:image/svg+xml;utf8,<svg viewBox='0 0 20 18' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><style>polygon.ic_arrow_stepper_up { fill: rgb(68, 68, 68); }</style> <title>Stepper Up</title> <polygon class='ic_arrow_stepper_up' points='10 3 19 17.5 1 17.5'></polygon></svg>\") no-repeat!important}:host .wrapper .header.non-sorted::after{opacity:.5}:host .wrapper .header.descending::after{background:url(\"data:image/svg+xml;utf8,<svg viewBox='0 0 20 18' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><style>polygon.ic_arrow_stepper_down { fill: rgb(68, 68, 68); }</style> <title>Stepper Up</title><polygon class='ic_arrow_stepper_down' points='10 17.5 19 3 1 3'></polygon></svg>\") no-repeat!important}:host .wrapper .header .separator{position:absolute;top:0;left:0;height:100%;width:calc(var(--list__icon__height) + 2 * var(--list__header__padding));border-right:1px solid #a3a3a3}:host .wrapper .header:hover{background-color:var(--list__hover__background-color)}:host .wrapper .header.disabled{opacity:.5;pointer-events:none}:host .wrapper.disabled{cursor:no-drop}:host .wrapper .items{display:flex;flex-flow:column}:host .wrapper .items.small{flex:1 1 auto}:host .wrapper .items.disabled{opacity:.5;pointer-events:none}"]
    })
], ListComponent);
export { ListComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYm13LWRzL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaXN0L2xpc3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFFTCxlQUFlLEVBRWYsU0FBUyxFQUdULFdBQVcsRUFDWCxZQUFZLEVBQ1osTUFBTSxFQUVQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTFELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBT25FLElBQWEsYUFBYSxHQUExQixNQUFhLGFBQWE7SUFBMUI7UUF1Q1Usa0JBQWEsR0FBc0IsSUFBSSxDQUFDO1FBR2hELHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFxQixDQUFDO1FBRTNELGlCQUFZLEdBQWtCLElBQUksQ0FBQztRQUluQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUEyQyxDQUFDO0lBNkg1RSxDQUFDO0lBbEpDLElBQUksWUFBWTtRQUNkLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDO0lBRUQsSUFBSSxZQUFZLENBQUMsS0FBd0I7UUFDdkMsSUFBSSxLQUFLLEtBQUssSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNoQyxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztZQUMzQixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDckM7SUFDSCxDQUFDO0lBYUQsZUFBZTtRQUNiLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1lBQ3pDLElBQUksRUFBRSxRQUFRLENBQUMsRUFBRTtnQkFDZixJQUFJLENBQUMsbUJBQW1CLENBQUMs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QkFBZ0IsQ0FBQztxREFDRDtBQUkzQjtJQUZDLFdBQVcsQ0FBQyxTQUFTLENBQUM7SUFDdEIsS0FBSyxFQUFFO3lDQUNHO0FBR1g7SUFEQyxLQUFLLEVBQUU7K0NBQ1U7QUFHbEI7SUFEQyxLQUFLLEVBQUU7NENBQ007QUFHZDtJQURDLEtBQUssRUFBRTtrREFDYTtBQUdyQjtJQURDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQzswREFDZTtBQUdsRDtJQURDLEtBQUssRUFBRTtpREFHUDtBQWFEO0lBREMsTUFBTSxFQUFFO3lEQUNrRDtBQU0zRDtJQURDLE1BQU0sRUFBRTtrREFDaUU7QUFoRC9ELGFBQWE7SUFMekIsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLFVBQVU7UUFDcEIsOHVCQUFvQzs7S0FFckMsQ0FBQztHQUNXLGFBQWEsQ0E2S3pCO1NBN0tZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBBZnRlclZpZXdJbml0LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBPbkRlc3Ryb3ksXG4gIEhvc3RCaW5kaW5nLFxuICBFdmVudEVtaXR0ZXIsXG4gIE91dHB1dCxcbiAgQ29udGVudENoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTGlzdEl0ZW1Db21wb25lbnQgfSBmcm9tICcuL2xpc3QtaXRlbS5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ2hlY2tib3hTdGF0ZSB9IGZyb20gJy4uL2NoZWNrYm94L2NoZWNrYm94LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDaGVja2JveENvbXBvbmVudCB9IGZyb20gJy4uL2NoZWNrYm94L2NoZWNrYm94LmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Jtdy1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpc3QuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9saXN0LmNvbXBvbmVudC5sZXNzJ11cbn0pXG5leHBvcnQgY2xhc3MgTGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGQoQ2hlY2tib3hDb21wb25lbnQpXG4gIGlucHV0OiBDaGVja2JveENvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgnaXRlbXMnKVxuICBpdGVtczogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnaGVhZGVyJylcbiAgaGVhZGVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdoZWFkZXJDaGVja2JveCcpXG4gIGhlYWRlckNoZWNrYm94OiBFbGVtZW50UmVmO1xuXG4gIEBIb3N0QmluZGluZygnYXR0ci5pZCcpXG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQElucHV0KClcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgbGFiZWw6IHN0cmluZztcblxuICBASW5wdXQoKVxuICBtdWx0aVNlbGVjdDogYm9vbGVhbjtcblxuICBAQ29udGVudENoaWxkcmVuKExpc3RJdGVtQ29tcG9uZW50KVxuICBjaGlsZEl0ZW1zQ29tcG9uZW50OiBRdWVyeUxpc3Q8TGlzdEl0ZW1Db21wb25lbnQ+O1xuXG4gIEBJbnB1dCgpXG4gIGdldCBzZWxlY3RlZEl0ZW0oKTogTGlzdEl0ZW1Db21wb25lbnQge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZEl0ZW07XG4gIH1cblxuICBzZXQgc2VsZWN0ZWRJdGVtKHZhbHVlOiBMaXN0SXRlbUNvbXBvbmVudCkge1xuICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5fc2VsZWN0ZWRJdGVtKSB7XG4gICAgICB0aGlzLl9zZWxlY3RlZEl0ZW0gPSB2YWx1ZTtcbiAgICAgIHRoaXMuc2VsZWN0T25lKHZhbHVlKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtQ2hhbmdlLmVtaXQodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3NlbGVjdGVkSXRlbTogTGlzdEl0ZW1Db21wb25lbnQgPSBudWxsO1xuXG4gIEBPdXRwdXQoKVxuICBzZWxlY3RlZEl0ZW1DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPExpc3RJdGVtQ29tcG9uZW50PigpO1xuXG4gIHNlbGVjdEhlYWRlcjogQ2hlY2tib3hTdGF0ZSA9IG51bGw7XG4gIHNvcnRpbmdPcmRlcjogYm9vbGVhbjtcblxuICBAT3V0cHV0KClcbiAgdXBkYXRlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPExpc3RJdGVtQ29tcG9uZW50W10gfCBMaXN0SXRlbUNvbXBvbmVudD4oKTtcblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LmNoYW5nZXMuc3Vic2NyaWJlKHtcbiAgICAgIG5leHQ6IGVsZW1lbnRzID0+IHtcbiAgICAgICAgdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xuICAgICAgICAgIGVsZW1lbnQudXBkYXRlRXZlbnQuc3Vic2NyaWJlKChldmVudDogYm9vbGVhbikgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm11bHRpU2VsZWN0KSB7XG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0T25lKGVsZW1lbnQpO1xuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50LmVtaXQoZWxlbWVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnNlbGVjdE1vcmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlRXZlbnQubmV4dCh0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZmlsdGVyKGkgPT4gaS5zZWxlY3RlZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcbiAgICAgICAgICAgIC8vc2V0VGltZW91dCB1c2VkIHRvIGF2b2lkIHZhbHVlIGNoYW5nZWQgYWZ0ZXIgY2hlY2sgZXJyb3JcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICBlbGVtZW50Lm11bHRpU2VsZWN0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvL3NldFRpbWVvdXQgdXNlZCB0byBhdm9pZCB2YWx1ZSBjaGFuZ2VkIGFmdGVyIGNoZWNrIGVycm9yXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgICAgdGhpcy5pZCA9IE1hdGgucmFuZG9tKClcbiAgICAgICAgICAudG9TdHJpbmcoMzYpXG4gICAgICAgICAgLnN1YnN0cmluZygyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudC5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcbiAgICAgIGVsZW1lbnQudXBkYXRlRXZlbnQuc3Vic2NyaWJlKChldmVudDogYm9vbGVhbikgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubXVsdGlTZWxlY3QpIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdE9uZShlbGVtZW50KTtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50LmVtaXQoZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3RNb3JlKGVsZW1lbnQpO1xuICAgICAgICAgIHRoaXMudXBkYXRlRXZlbnQubmV4dCh0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZmlsdGVyKGkgPT4gaS5zZWxlY3RlZCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcbiAgICAgICAgLy9zZXRUaW1lb3V0IHVzZWQgdG8gYXZvaWQgdmFsdWUgY2hhbmdlZCBhZnRlciBjaGVjayBlcnJvclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBlbGVtZW50Lm11bHRpU2VsZWN0ID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcbiAgICAgIHRoaXMuc2VsZWN0TW9yZShudWxsKTtcbiAgICB9XG4gIH1cblxuICBzZWxlY3RPbmUoc2VsZWN0SXRlbTogTGlzdEl0ZW1Db21wb25lbnQpIHtcbiAgICBpZiAoIXRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIGVsZW1lbnQuc2VsZWN0ZWQgPSBlbGVtZW50ID09PSBzZWxlY3RJdGVtO1xuICAgICAgaWYgKGVsZW1lbnQuc2VsZWN0ZWQpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBlbGVtZW50O1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2VsZWN0TW9yZShzZWxlY3RlZEl0ZW06IExpc3RJdGVtQ29tcG9uZW50KSB7XG4gICAgbGV0IHNlbGVjdEFsbCA9IHRydWU7XG4gICAgbGV0IHVuc2VsZWN0QWxsID0gdHJ1ZTtcbiAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIGlmIChlbGVtZW50ID09PSBzZWxlY3RlZEl0ZW0pIHtcbiAgICAgICAgZWxlbWVudC5zZWxlY3RlZCA9ICFlbGVtZW50LnNlbGVjdGVkO1xuICAgICAgfVxuICAgICAgaWYgKGVsZW1lbnQuc2VsZWN0ZWQpIHtcbiAgICAgICAgc2VsZWN0QWxsID0gdHJ1ZSAmJiBzZWxlY3RBbGw7XG4gICAgICAgIHVuc2VsZWN0QWxsID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxlY3RBbGwgPSBmYWxzZTtcbiAgICAgICAgdW5zZWxlY3RBbGwgPSB0cnVlICYmIHVuc2VsZWN0QWxsO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZWxlY3RIZWFkZXIgPSBzZWxlY3RBbGwgPyBDaGVja2JveFN0YXRlLmNoZWNrZWQgOiB1bnNlbGVjdEFsbCA/IG51bGwgOiBDaGVja2JveFN0YXRlLmluZGV0ZXJtaW5hdGU7XG4gIH1cblxuICBoZWFkZXJDaGFuZ2UoZXZlbnQ6IENoZWNrYm94Q29tcG9uZW50KSB7XG4gICAgdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICBlbGVtZW50LnNlbGVjdGVkID0gZXZlbnQuY2hlY2tlZCA9PT0gJ2NoZWNrZWQnO1xuICAgIH0pO1xuICAgIHRoaXMudXBkYXRlRXZlbnQubmV4dCh0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZmlsdGVyKGkgPT4gaS5zZWxlY3RlZCkpO1xuICB9XG5cbiAgc29ydChldmVudDogTW91c2VFdmVudCkge1xuICAgIC8vaWdub3JlIGNsaWNrcyBvbiBjaGVja2JveFxuICAgIGlmIChldmVudC50YXJnZXQgIT09IHRoaXMuaGVhZGVyLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zb3J0aW5nT3JkZXIgPT0gbnVsbCkge1xuICAgICAgdGhpcy5zb3J0aW5nT3JkZXIgPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5zb3J0aW5nT3JkZXIgPSAhdGhpcy5zb3J0aW5nT3JkZXI7XG5cbiAgICBjb25zdCBzb3J0ID0gKGE6IExpc3RJdGVtQ29tcG9uZW50LCBiOiBMaXN0SXRlbUNvbXBvbmVudCkgPT4ge1xuICAgICAgY29uc3QgYVRleHQgPSBhLmxhYmVsO1xuICAgICAgY29uc3QgYlRleHQgPSBiLmxhYmVsO1xuICAgICAgY29uc3QgcHVyZU9yZGVyID0gYVRleHQgPiBiVGV4dDtcbiAgICAgIHJldHVybiBwdXJlT3JkZXIgPT09IHRoaXMuc29ydGluZ09yZGVyID8gMSA6IC0xO1xuICAgIH07XG4gICAgY29uc3QgbmV3QXJyYXkgPSB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQudG9BcnJheSgpLnNvcnQoc29ydCk7XG5cbiAgICBuZXdBcnJheS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgaXRlbS5vcmRlciA9IGluZGV4LnRvU3RyaW5nKCk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIGVsZW1lbnQudXBkYXRlRXZlbnQudW5zdWJzY3JpYmUoKTtcbiAgICB9KTtcbiAgfVxufVxuIl19