import { __decorate } from "tslib";
import { Component, ContentChildren, ElementRef, EventEmitter, HostBinding, Input, OnDestroy, OnInit, Output, QueryList, HostListener, ViewChild, AfterViewInit } from '@angular/core';
import { ContentTabContentComponent } from './content-tab-content.component';
import { ContentTabLabelComponent } from './content-tab-label.component';
import { Subject } from 'rxjs';
import { filter, take, takeUntil } from 'rxjs/operators';
let ContentTabComponent = class ContentTabComponent {
    constructor(elementRef) {
        this.elementRef = elementRef;
        // if TRUE, then on tab label click a requestSelectionChange event is emitted
        this.guardSelectionChange = false;
        /**
         * expanding content toggle input (default = false)
         */
        this.expandContent = false;
        this.allowSelectionChange$ = new Subject();
        this.unsubscribe$ = new Subject();
        // the selectionChange event contains the value of the "for" input of the selected label
        this.selectionChange = new EventEmitter();
        this.requestSelectionChange = new EventEmitter();
    }
    onHashChange() {
        const urlFragment = window.location.hash.substr(1);
        const labelArray = this.labels.toArray();
        const targetTabIndex = labelArray.findIndex(label => label.for === urlFragment);
        if (targetTabIndex !== -1) {
            let tabSearch = labelArray[targetTabIndex];
            if (tabSearch.disabled) {
                tabSearch = null;
                let nextIndexToTest = targetTabIndex === 0 ? labelArray.length - 1 : targetTabIndex - 1;
                while (!tabSearch && nextIndexToTest !== targetTabIndex) {
                    const tabToTest = labelArray[nextIndexToTest];
                    if (!tabToTest.disabled) {
                        tabSearch = tabToTest;
                    }
                    nextIndexToTest = nextIndexToTest === 0 ? labelArray.length - 1 : nextIndexToTest - 1;
                }
            }
            if (tabSearch) {
                this.updateLabelSelection(tabSearch.for);
            }
        }
    }
    onKeyDown(event) {
        const key = event.code || event.keyCode;
        switch (key) {
            case 'ArrowDown':
            case 40:
                this.focusMenuTabOption(2 /* Down */);
                event.stopPropagation();
                event.preventDefault();
                break;
            case 'ArrowUp':
            case 38:
                this.focusMenuTabOption(0 /* Up */);
                event.stopPropagation();
                event.preventDefault();
                break;
            case 'ArrowLeft':
            case 37:
                if (event.target.classList.contains('bmw-component-headline-text')) {
                    this.selectNeighbourContentTab(event.target, 3 /* Left */);
                    event.stopPropagation();
                    event.preventDefault();
                }
                break;
            case 'ArrowRight':
            case 39:
                if (event.target.classList.contains('bmw-component-headline-text')) {
                    this.selectNeighbourContentTab(event.target, 1 /* Right */);
                    event.stopPropagation();
                    event.preventDefault();
                }
                break;
            case 'Enter':
            case 'NumpadEnter':
            case 13:
                if (this.hiddenLabels.classList.contains('opened')) {
                    const focusedTabOptionID = this.getFocusedTabOptionID();
                    if (focusedTabOptionID) {
                        if (this.guardSelectionChange) {
                            this.requestLabelSelection(focusedTabOptionID);
                        }
                        else {
                            this.updateLabelSelection(focusedTabOptionID);
                        }
                        this.labels.find(label => label.for === focusedTabOptionID).label.nativeElement.focus();
                        event.stopPropagation();
                        event.preventDefault();
                    }
                }
                break;
            case 'Space':
            case 32:
                if (event.target === this.elementRef.nativeElement.querySelector('.three-dots')) {
                    this.toggleHiddenLabels();
                    event.stopPropagation();
                    event.preventDefault();
                }
                break;
        }
    }
    ngOnInit() {
        if (typeof this.justIcon !== 'undefined') {
            this.justIcon = true;
        }
        if (typeof this.withIcon !== 'undefined' && !this.justIcon) {
            this.withIcon = true;
        }
        this.hiddenLabels = this.elementRef.nativeElement.querySelector('.three-dots');
        this.hiddenLabels.addEventListener('focusout', e => {
            const leavingParent = !this.hiddenLabels.contains(e.relatedTarget);
            if (leavingParent) {
                this.toggleHiddenLabels(false);
            }
        });
        this.setResizeTrigger();
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
    }
    ngAfterViewInit() {
        this.getArticles();
        this.prepareLabels();
        this.labels.changes.subscribe(() => {
            this.selected = null;
            this.prepareLabels();
        });
        this.labels.toArray().forEach(label => {
            label.change.subscribe(() => {
                this.prepareLabels();
            });
        });
        this.hideTabsContentIfAllAreDisabled();
        this.onHashChange();
    }
    ngOnDestroy() {
        this.unsubscribe$.next();
        this.unsubscribe$.complete();
    }
    getArticles() {
        const wrapperChildren = this.contentTabWrapper.nativeElement.children;
        this.articles = [];
        for (const childNode of wrapperChildren) {
            if (childNode.tagName.toLowerCase() === 'bmw-content-tab-content') {
                this.articles.push(childNode);
            }
        }
    }
    prepareLabels() {
        if (!this.labels)
            return;
        let reSelect = false;
        for (let i = 0; i < this.labels.toArray().length; i++) {
            const label = this.labels.toArray()[i];
            label.elementRef.nativeElement.dataset.order = i;
            const id = label.for;
            if (label.selected && !label.disabled) {
                this.setSelected(id);
            }
            if (label.disabled) {
                label.elementRef.nativeElement.classList.add('disabled');
                reSelect = this.selected === label.for;
            }
            else if (label.elementRef.nativeElement.classList.contains('disabled')) {
                label.elementRef.nativeElement.classList.remove('disabled');
            }
            // note that the event will still be handled if it is submitted directly (e.g. $('bmw-content-tab-label.disabled').click())
            label.elementRef.nativeElement.addEventListener('click', (e) => this.onClickLabel(e, id));
            label.elementRef.nativeElement.classList.add(this.justIcon ? 'just-icon' : this.withIcon ? 'with-icon' : 'just-text');
        }
        const firstEnabledLabel = this.labels.toArray().find(label => !label.disabled);
        if (reSelect || (!this.selected && firstEnabledLabel)) {
            this.setSelected(firstEnabledLabel.for);
        }
        setTimeout(() => {
            this.hideLabelsIfNecessary();
        }, 10);
        // run once again after css variables are replaces in IE
        setTimeout(() => {
            this.hideLabelsIfNecessary(true);
        }, 500);
    }
    onClickLabel(event, labelId) {
        if (this.guardSelectionChange) {
            this.requestLabelSelection(labelId);
        }
        else {
            this.updateLabelSelection(labelId);
        }
        event.stopPropagation();
    }
    updateLabelSelection(labelId) {
        if (this.selected !== labelId) {
            this.setSelected(labelId);
            this.selectionChange.emit(labelId);
            this.hideLabelsIfNecessary(true);
            this.toggleHiddenLabels(false);
        }
    }
    requestLabelSelection(labelId) {
        this.allowSelectionChange$
            .pipe(
        // ensures the subscription completes after the first click event
        take(1), filter(allowChange => !!allowChange), takeUntil(this.unsubscribe$))
            .subscribe(() => this.updateLabelSelection(labelId));
        const currentSelectedLabel = this.getSelectedLabel();
        this.requestSelectionChange.emit({
            currentSelection: currentSelectedLabel && currentSelectedLabel.for,
            requestedSelection: labelId,
            allowSelectionChange$: this.allowSelectionChange$
        });
    }
    setResizeTrigger() {
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            const that = this;
            resizeTimer = setTimeout(() => {
                that.hideLabelsIfNecessary(true);
            }, 10);
        });
    }
    setSelected(selected) {
        this.selected = selected;
        const labelsArray = this.labels.toArray();
        for (let i = 0; i < labelsArray.length; i++) {
            const id = labelsArray[i].for;
            if (selected === id) {
                labelsArray[i].elementRef.nativeElement.classList.add('selected');
                setTimeout(() => {
                    labelsArray[i].selected = true;
                }, 0);
            }
            else {
                labelsArray[i].elementRef.nativeElement.classList.remove('selected');
                labelsArray[i].selected = false;
            }
        }
        for (let i = 0; i < this.articles.length; i++) {
            const id = this.articles[i].getAttribute('id');
            if (selected === id) {
                this.articles[i].classList.add('selected');
            }
            else {
                this.articles[i].classList.remove('selected');
            }
        }
    }
    hideLabelsIfNecessary(showAllFirst) {
        const labelsDiv = this.elementRef.nativeElement.querySelector('div.labels');
        if (showAllFirst) {
            this.showAllLabels(labelsDiv);
        }
        const height = labelsDiv.offsetHeight;
        const defaultHeight = this.elementRef.nativeElement.querySelector('.labels .border').offsetHeight;
        if (height > defaultHeight) {
            this.createHiddenLabelsMenuElement();
            const hasMoreNonActiveLabels = this.hideLastNonActiveLabel(labelsDiv);
            if (hasMoreNonActiveLabels) {
                this.hideLabelsIfNecessary();
            }
        }
    }
    hideTabsContentIfAllAreDisabled() {
        if (!this.labels.toArray().find(label => !label.disabled)) {
            this.tabContents.toArray().forEach(tabContent => (tabContent.hide = true));
        }
    }
    showAllLabels(parentElement) {
        if (!this.hiddenLabelsMenu)
            return;
        const length = this.hiddenLabelsMenu.children.length;
        for (let i = 0; i < length; i++) {
            parentElement.prepend(this.hiddenLabelsMenu.children[0]);
        }
        this.hiddenLabels.removeChild(this.hiddenLabelsMenu);
        this.hiddenLabelsMenu = undefined;
        this.sort(parentElement);
    }
    sort(parentElement) {
        let array = parentElement.children;
        array = Array.from(array).sort((a, b) => {
            return a.dataset.order - b.dataset.order;
        });
        for (let i = 0; i < array.length; i++) {
            parentElement.append(array[i]);
        }
    }
    /**
     * Removes the last non-active label from view and adds it to the three-dots menu
     * @returns boolean indicating if there are more non-active labels in view
     */
    hideLastNonActiveLabel(parentElement) {
        let hasMoreNonActiveLabels = true;
        const tabArray = [...parentElement.children].filter(child => !child.classList.contains('border') &&
            !child.classList.contains('three-dots') &&
            !child.classList.contains('selected'));
        this.hiddenLabelsMenu.prepend(tabArray.pop());
        if (tabArray.length === 0) {
            hasMoreNonActiveLabels = false;
        }
        return hasMoreNonActiveLabels;
    }
    createHiddenLabelsMenuElement() {
        if (this.hiddenLabelsMenu)
            return;
        this.hiddenLabelsMenu = document.createElement('div');
        this.hiddenLabelsMenu.classList.add('menu');
        this.hiddenLabels.append(this.hiddenLabelsMenu);
    }
    toggleHiddenLabels(state) {
        if (!this.hiddenLabels)
            return;
        if (this.hiddenLabelsMenu) {
            const rectangle = this.hiddenLabels.getBoundingClientRect();
            const position = rectangle.x + rectangle.width - 2;
            this.hiddenLabelsMenu.style['max-width'] = position + 'px';
        }
        const opened = this.hiddenLabels.classList.contains('opened');
        if (state === true) {
            this.hiddenLabels.classList.add('opened');
        }
        else if (state === false) {
            this.hiddenLabels.classList.remove('opened');
        }
        else if (opened) {
            this.hiddenLabels.classList.remove('opened');
        }
        else {
            this.hiddenLabels.classList.add('opened');
        }
    }
    getSelectedLabel() {
        return this.labels && this.labels.find(label => this.selected === label.for);
    }
    selectNeighbourContentTab(contentTabLabel, direction) {
        const visibleLabelsArray = Array.prototype.slice.call(this.labelsWrapper.nativeElement.querySelectorAll('bmw-content-tab-label > .bmw-component-headline-text'));
        if (contentTabLabel === this.elementRef.nativeElement.querySelector('.three-dots')) {
            switch (direction) {
                case 3 /* Left */:
                    this.selectAndFocusContentTab(visibleLabelsArray.length - 1);
                    break;
                case 1 /* Right */:
                    this.selectAndFocusContentTab(0);
                    break;
                default:
                    break;
            }
        }
        else {
            const targetedTabLabel = visibleLabelsArray.find((tab) => tab === contentTabLabel);
            if (visibleLabelsArray.length > 0) {
                if (targetedTabLabel) {
                    if (this.hiddenLabelsMenu &&
                        ((targetedTabLabel === visibleLabelsArray[0] && direction === 3 /* Left */) ||
                            (targetedTabLabel === visibleLabelsArray[visibleLabelsArray.length - 1] && direction === 1 /* Right */))) {
                        this.elementRef.nativeElement.querySelector('.three-dots').focus();
                    }
                    else {
                        const beforeChangeTabIndex = visibleLabelsArray.findIndex((tabLabel) => tabLabel === targetedTabLabel);
                        const tabToSelectIndex = this.getNeighbourContentTabLabelIndex(beforeChangeTabIndex, direction);
                        if (tabToSelectIndex >= 0) {
                            this.selectAndFocusContentTab(tabToSelectIndex);
                        }
                        else {
                            throw new Error('Could not find a tab to select');
                        }
                    }
                }
                else {
                    throw new Error('The specified target does not correspond to a tabÂ´s label container');
                }
            }
            else {
                throw new Error('There are no content tab labels defined');
            }
        }
    }
    selectAndFocusContentTab(tabToSelectIndex) {
        const visibleContentTabLabelsArray = Array.prototype.slice.call(this.labelsWrapper.nativeElement.querySelectorAll('bmw-content-tab-label'));
        const tabToSelectID = visibleContentTabLabelsArray[tabToSelectIndex].getAttribute('for');
        this.setSelected(tabToSelectID);
        if (this.guardSelectionChange) {
            this.requestLabelSelection(tabToSelectID);
        }
        else {
            this.updateLabelSelection(tabToSelectID);
        }
        visibleContentTabLabelsArray[tabToSelectIndex].querySelector('.bmw-component-headline-text').focus();
    }
    getNeighbourContentTabLabelIndex(contentTabLabelIndex, direction) {
        const visibleContentTabLabelsArray = Array.prototype.slice.call(this.labelsWrapper.nativeElement.querySelectorAll('bmw-content-tab-label'));
        let neighbourContentTabLabelIndex = -1;
        if (visibleContentTabLabelsArray.find(label => !label.classList.contains('disabled'))) {
            switch (direction) {
                case 3 /* Left */:
                    if (contentTabLabelIndex === 0) {
                        neighbourContentTabLabelIndex = visibleContentTabLabelsArray.length - 1;
                    }
                    else {
                        neighbourContentTabLabelIndex = contentTabLabelIndex - 1;
                    }
                    break;
                case 1 /* Right */:
                    if (contentTabLabelIndex === visibleContentTabLabelsArray.length - 1) {
                        neighbourContentTabLabelIndex = 0;
                    }
                    else {
                        neighbourContentTabLabelIndex = contentTabLabelIndex + 1;
                    }
                    break;
                default:
                    break;
            }
            if (visibleContentTabLabelsArray[neighbourContentTabLabelIndex].classList.contains('disabled') ||
                this.isContentTabLabelHidden(visibleContentTabLabelsArray[neighbourContentTabLabelIndex].getAttribute('for'))) {
                neighbourContentTabLabelIndex = this.getNeighbourContentTabLabelIndex(neighbourContentTabLabelIndex, direction);
            }
        }
        else {
            throw new Error('There are no enabled tabs available');
        }
        return neighbourContentTabLabelIndex;
    }
    getFocusedTabOptionID() {
        const focusedTabOption = Array.prototype.slice
            .call(this.hiddenLabelsMenu.querySelectorAll('bmw-content-tab-label'))
            .find((tabOption) => tabOption.classList.contains('focused'));
        return focusedTabOption ? focusedTabOption.attributes.for.nodeValue : '';
    }
    isContentTabLabelHidden(contentTabID) {
        let isTabLabelHidden = false;
        if (this.hiddenLabelsMenu) {
            const hiddenLabelsIDs = Array.prototype.slice
                .call(this.hiddenLabelsMenu.querySelectorAll('bmw-content-tab-label'))
                .map((hiddenLabel) => hiddenLabel.getAttribute('for'));
            isTabLabelHidden = hiddenLabelsIDs.indexOf(contentTabID) > -1;
        }
        return isTabLabelHidden;
    }
    focusMenuTabOption(direction) {
        if (this.hiddenLabels.classList.contains('opened')) {
            if (this.hiddenLabelsMenu) {
                const hiddenTabOptions = Array.prototype.slice.call(this.hiddenLabelsMenu.querySelectorAll('bmw-content-tab-label'));
                if (hiddenTabOptions.length &&
                    hiddenTabOptions.some((tabOption) => !tabOption.classList.contains('disabled'))) {
                    const focusedTabOptionIndex = hiddenTabOptions.findIndex((tabOption) => tabOption.classList.contains('focused'));
                    hiddenTabOptions.forEach((tabOption) => tabOption.classList.remove('focused'));
                    switch (direction) {
                        case 0 /* Up */:
                            this.setPreviousTabOptionAsFocused(focusedTabOptionIndex);
                            break;
                        case 2 /* Down */:
                            this.setNextTabOptionAsFocused(focusedTabOptionIndex);
                            break;
                        default:
                            break;
                    }
                }
            }
            else {
                throw new Error('There are no options in the three-dots container');
            }
        }
    }
    setNextTabOptionAsFocused(tabOptionIndex) {
        const hiddenTabOptions = Array.prototype.slice.call(this.hiddenLabelsMenu.querySelectorAll('bmw-content-tab-label'));
        if (tabOptionIndex !== -1 && tabOptionIndex !== hiddenTabOptions.length - 1) {
            tabOptionIndex = tabOptionIndex + 1;
        }
        else {
            tabOptionIndex = 0;
        }
        if (hiddenTabOptions[tabOptionIndex].classList.contains('disabled')) {
            this.setNextTabOptionAsFocused(tabOptionIndex);
        }
        else {
            hiddenTabOptions[tabOptionIndex].classList.add('focused');
            hiddenTabOptions[tabOptionIndex].querySelector('label').focus();
        }
    }
    setPreviousTabOptionAsFocused(tabOptionIndex) {
        const hiddenTabOptions = Array.prototype.slice.call(this.hiddenLabelsMenu.querySelectorAll('bmw-content-tab-label'));
        if (tabOptionIndex !== -1 && tabOptionIndex !== 0) {
            tabOptionIndex = tabOptionIndex - 1;
        }
        else {
            tabOptionIndex = hiddenTabOptions.length - 1;
        }
        if (hiddenTabOptions[tabOptionIndex].classList.contains('disabled')) {
            this.setPreviousTabOptionAsFocused(tabOptionIndex);
        }
        else {
            hiddenTabOptions[tabOptionIndex].classList.add('focused');
            hiddenTabOptions[tabOptionIndex].querySelector('label').focus();
        }
    }
};
ContentTabComponent.ctorParameters = () => [
    { type: ElementRef }
];
__decorate([
    ContentChildren(ContentTabLabelComponent)
], ContentTabComponent.prototype, "labels", void 0);
__decorate([
    ContentChildren(ContentTabContentComponent)
], ContentTabComponent.prototype, "tabContents", void 0);
__decorate([
    ViewChild('contentTabWrapper')
], ContentTabComponent.prototype, "contentTabWrapper", void 0);
__decorate([
    ViewChild('labelsWrapper')
], ContentTabComponent.prototype, "labelsWrapper", void 0);
__decorate([
    Input()
], ContentTabComponent.prototype, "justIcon", void 0);
__decorate([
    Input()
], ContentTabComponent.prototype, "withIcon", void 0);
__decorate([
    HostBinding('attr.id'),
    Input()
], ContentTabComponent.prototype, "id", void 0);
__decorate([
    Input()
], ContentTabComponent.prototype, "guardSelectionChange", void 0);
__decorate([
    HostBinding('class.expanding'), Input()
], ContentTabComponent.prototype, "expandContent", void 0);
__decorate([
    Output()
], ContentTabComponent.prototype, "selectionChange", void 0);
__decorate([
    Output()
], ContentTabComponent.prototype, "requestSelectionChange", void 0);
__decorate([
    HostListener('window:hashchange')
], ContentTabComponent.prototype, "onHashChange", null);
__decorate([
    HostListener('keydown', ['$event'])
], ContentTabComponent.prototype, "onKeyDown", null);
ContentTabComponent = __decorate([
    Component({
        selector: 'bmw-content-tab',
        template: "<div [ngClass]=\"{ wrapper: true, 'wrapper--expanding': expandContent }\" #contentTabWrapper>\n  <div [ngClass]=\"{ labels: true, 'labels--expanding': expandContent }\" role=\"tablist\" #labelsWrapper>\n    <ng-content select=\"bmw-content-tab-label\"></ng-content>\n    <div class=\"three-dots\" (click)=\"toggleHiddenLabels()\" tabindex=\"-1\"></div>\n    <div class=\"border\"></div>\n  </div>\n  <ng-content select=\"bmw-content-tab-content\"></ng-content>\n</div>\n",
        styles: [":host{min-height:0;flex-direction:column;display:flex}:host.expanding{height:100%}.three-dots{position:absolute;top:0;right:0;display:inline-block;order:2;box-sizing:content-box;height:calc(var(--content-tabs__label__default__height));z-index:2}.three-dots:empty{display:none}.three-dots:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}.three-dots ::ng-deep .menu{display:none;position:absolute;background-color:var(--content-tabs__more-dots__menu__background-color);top:100%;right:0;z-index:var(--content-tabs__z-index-base);border:solid 1px var(--content-tabs__more-dots__menu__border-color)}.three-dots ::ng-deep .menu ::ng-deep bmw-content-tab-label{display:block;max-width:100%}.three-dots ::ng-deep .menu ::ng-deep bmw-content-tab-label.focused{background-color:var(--combo-box__dropdown-item__hover__background-color)}.three-dots.opened ::ng-deep .menu{display:inline-block}.three-dots::after{display:inline-block;line-height:1;font-size:var(--content-tabs__more-dots__menu__font-size);padding:var(--content-tabs__label__icon__padding);padding-bottom:calc(var(--content-tabs__label__icon__padding) - 2px);font-family:iwp;color:var(--content-tabs__labels__default__color);content:'\\ea22';cursor:pointer}.labels{padding-right:var(--content-tabs__label__default__height);position:relative;display:flex;flex:1 0 auto;flex-wrap:wrap}.labels:focus{outline:0}.labels--expanding{flex:0 1 auto}.labels .border{position:absolute;width:100%;left:0;top:0;height:calc(var(--content-tabs__label__default__height) + 2px);box-sizing:border-box;border-bottom:2px solid var(--content-tabs__labels__default__border-color)}.wrapper{min-width:calc(100px + var(--content-tabs__label__default__height));min-height:0;flex-direction:column;display:flex}.wrapper--expanding{flex:1 0 auto;height:100%}"]
    })
], ContentTabComponent);
export { ContentTabComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC10YWIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsiY29udGVudC10YWIvY29udGVudC10YWIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULGVBQWUsRUFDZixVQUFVLEVBQ1YsWUFBWSxFQUNaLFdBQVcsRUFDWCxLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixNQUFNLEVBQ04sU0FBUyxFQUNULFlBQVksRUFDWixTQUFTLEVBQ1QsYUFBYSxFQUNkLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQzdFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFvQnpELElBQWEsbUJBQW1CLEdBQWhDLE1BQWEsbUJBQW1CO0lBNEk5QixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBckgxQyw2RUFBNkU7UUFFN0UseUJBQW9CLEdBQUcsS0FBSyxDQUFDO1FBRTdCOztXQUVHO1FBQ3NDLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBT3ZELDBCQUFxQixHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFDL0MsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBRTNDLHdGQUF3RjtRQUV4RixvQkFBZSxHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO1FBRW5FLDJCQUFzQixHQUF5QyxJQUFJLFlBQVksRUFBMEIsQ0FBQztJQWdHN0QsQ0FBQztJQTdGOUMsWUFBWTtRQUNWLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxR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RUFDaUc7QUFHMUc7SUFEQyxZQUFZLENBQUMsbUJBQW1CLENBQUM7dURBMEJqQztBQUdEO0lBREMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO29EQWdFbkM7QUExSVUsbUJBQW1CO0lBTC9CLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxpQkFBaUI7UUFDM0Isa2VBQTJDOztLQUU1QyxDQUFDO0dBQ1csbUJBQW1CLENBd21CL0I7U0F4bUJZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBIb3N0TGlzdGVuZXIsXG4gIFZpZXdDaGlsZCxcbiAgQWZ0ZXJWaWV3SW5pdFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRlbnRUYWJDb250ZW50Q29tcG9uZW50IH0gZnJvbSAnLi9jb250ZW50LXRhYi1jb250ZW50LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb250ZW50VGFiTGFiZWxDb21wb25lbnQgfSBmcm9tICcuL2NvbnRlbnQtdGFiLWxhYmVsLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIHRha2UsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3Rpb25DaGFuZ2VSZXF1ZXN0IHtcbiAgY3VycmVudFNlbGVjdGlvbj86IHN0cmluZztcbiAgcmVxdWVzdGVkU2VsZWN0aW9uOiBzdHJpbmc7XG4gIGFsbG93U2VsZWN0aW9uQ2hhbmdlJDogU3ViamVjdDxib29sZWFuPjtcbn1cblxuY29uc3QgZW51bSBEaXJlY3Rpb24ge1xuICBVcCxcbiAgUmlnaHQsXG4gIERvd24sXG4gIExlZnRcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LWNvbnRlbnQtdGFiJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbnRlbnQtdGFiLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY29udGVudC10YWIuY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDb250ZW50VGFiQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBAQ29udGVudENoaWxkcmVuKENvbnRlbnRUYWJMYWJlbENvbXBvbmVudClcbiAgbGFiZWxzOiBRdWVyeUxpc3Q8Q29udGVudFRhYkxhYmVsQ29tcG9uZW50PjtcblxuICBAQ29udGVudENoaWxkcmVuKENvbnRlbnRUYWJDb250ZW50Q29tcG9uZW50KVxuICB0YWJDb250ZW50czogUXVlcnlMaXN0PENvbnRlbnRUYWJDb250ZW50Q29tcG9uZW50PjtcblxuICBAVmlld0NoaWxkKCdjb250ZW50VGFiV3JhcHBlcicpXG4gIGNvbnRlbnRUYWJXcmFwcGVyOiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGQoJ2xhYmVsc1dyYXBwZXInKVxuICBsYWJlbHNXcmFwcGVyOiBFbGVtZW50UmVmO1xuXG4gIC8vIGluIGNhc2UganVzdEljb24gaXMgdHJ1ZSwgYW55IGNvbnRlbnQgb24gY2hpbGQgbGFiZWwgY29tcG9uZW50cyB3aWxsIGJlIGlnbm9yZWRcbiAgLy8ganVzdEljb24gYW5kIHdpdGhJY29uIGFyZSBzdXBwb3NlZCB0byBiZSB1c2VkIGV4Y2x1c2l2ZWx5XG4gIEBJbnB1dCgpXG4gIGp1c3RJY29uOiBib29sZWFuO1xuICAvLyBpbiBjYXNlIHdpdEljb24gaXMgZmFsc2UsIGFueSBpY29uIG9uIGNoaWxkIGxhYmVsIGNvbXBvbmVudHMgd2lsbCBiZSBpZ25vcmVkXG4gIEBJbnB1dCgpXG4gIHdpdGhJY29uOiBib29sZWFuO1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICBASW5wdXQoKVxuICBpZDogc3RyaW5nO1xuICAvLyBpZiBUUlVFLCB0aGVuIG9uIHRhYiBsYWJlbCBjbGljayBhIHJlcXVlc3RTZWxlY3Rpb25DaGFuZ2UgZXZlbnQgaXMgZW1pdHRlZFxuICBASW5wdXQoKVxuICBndWFyZFNlbGVjdGlvbkNoYW5nZSA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBleHBhbmRpbmcgY29udGVudCB0b2dnbGUgaW5wdXQgKGRlZmF1bHQgPSBmYWxzZSlcbiAgICovXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZXhwYW5kaW5nJykgQElucHV0KCkgZXhwYW5kQ29udGVudCA9IGZhbHNlO1xuXG4gIGFydGljbGVzOiBhbnlbXTtcbiAgc2VsZWN0ZWQ6IHN0cmluZztcbiAgaGlkZGVuTGFiZWxzOiBhbnk7XG4gIGhpZGRlbkxhYmVsc01lbnU6IEhUTUxFbGVtZW50O1xuXG4gIHByaXZhdGUgYWxsb3dTZWxlY3Rpb25DaGFuZ2UkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgcHJpdmF0ZSB1bnN1YnNjcmliZSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIC8vIHRoZSBzZWxlY3Rpb25DaGFuZ2UgZXZlbnQgY29udGFpbnMgdGhlIHZhbHVlIG9mIHRoZSBcImZvclwiIGlucHV0IG9mIHRoZSBzZWxlY3RlZCBsYWJlbFxuICBAT3V0cHV0KClcbiAgc2VsZWN0aW9uQ2hhbmdlOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICBAT3V0cHV0KClcbiAgcmVxdWVzdFNlbGVjdGlvbkNoYW5nZTogRXZlbnRFbWl0dGVyPFNlbGVjdGlvbkNoYW5nZVJlcXVlc3Q+ID0gbmV3IEV2ZW50RW1pdHRlcjxTZWxlY3Rpb25DaGFuZ2VSZXF1ZXN0PigpO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpoYXNoY2hhbmdlJylcbiAgb25IYXNoQ2hhbmdlKCkge1xuICAgIGNvbnN0IHVybEZyYWdtZW50ID0gd2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDEpO1xuICAgIGNvbnN0IGxhYmVsQXJyYXkgPSB0aGlzLmxhYmVscy50b0FycmF5KCk7XG4gICAgY29uc3QgdGFyZ2V0VGFiSW5kZXggPSBsYWJlbEFycmF5LmZpbmRJbmRleChsYWJlbCA9PiBsYWJlbC5mb3IgPT09IHVybEZyYWdtZW50KTtcblxuICAgIGlmICh0YXJnZXRUYWJJbmRleCAhPT0gLTEpIHtcbiAgICAgIGxldCB0YWJTZWFyY2ggPSBsYWJlbEFycmF5W3RhcmdldFRhYkluZGV4XTtcblxuICAgICAgaWYgKHRhYlNlYXJjaC5kaXNhYmxlZCkge1xuICAgICAgICB0YWJTZWFyY2ggPSBudWxsO1xuICAgICAgICBsZXQgbmV4dEluZGV4VG9UZXN0ID0gdGFyZ2V0VGFiSW5kZXggPT09IDAgPyBsYWJlbEFycmF5Lmxlbmd0aCAtIDEgOiB0YXJnZXRUYWJJbmRleCAtIDE7XG5cbiAgICAgICAgd2hpbGUgKCF0YWJTZWFyY2ggJiYgbmV4dEluZGV4VG9UZXN0ICE9PSB0YXJnZXRUYWJJbmRleCkge1xuICAgICAgICAgIGNvbnN0IHRhYlRvVGVzdCA9IGxhYmVsQXJyYXlbbmV4dEluZGV4VG9UZXN0XTtcbiAgICAgICAgICBpZiAoIXRhYlRvVGVzdC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgdGFiU2VhcmNoID0gdGFiVG9UZXN0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBuZXh0SW5kZXhUb1Rlc3QgPSBuZXh0SW5kZXhUb1Rlc3QgPT09IDAgPyBsYWJlbEFycmF5Lmxlbmd0aCAtIDEgOiBuZXh0SW5kZXhUb1Rlc3QgLSAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0YWJTZWFyY2gpIHtcbiAgICAgICAgdGhpcy51cGRhdGVMYWJlbFNlbGVjdGlvbih0YWJTZWFyY2guZm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgY29uc3Qga2V5ID0gZXZlbnQuY29kZSB8fCBldmVudC5rZXlDb2RlO1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdBcnJvd0Rvd24nOlxuICAgICAgY2FzZSA0MDpcbiAgICAgICAgdGhpcy5mb2N1c01lbnVUYWJPcHRpb24oRGlyZWN0aW9uLkRvd24pO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgIGNhc2UgMzg6XG4gICAgICAgIHRoaXMuZm9jdXNNZW51VGFiT3B0aW9uKERpcmVjdGlvbi5VcCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnQXJyb3dMZWZ0JzpcbiAgICAgIGNhc2UgMzc6XG4gICAgICAgIGlmICgoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5jbGFzc0xpc3QuY29udGFpbnMoJ2Jtdy1jb21wb25lbnQtaGVhZGxpbmUtdGV4dCcpKSB7XG4gICAgICAgICAgdGhpcy5zZWxlY3ROZWlnaGJvdXJDb250ZW50VGFiKGV2ZW50LnRhcmdldCwgRGlyZWN0aW9uLkxlZnQpO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0Fycm93UmlnaHQnOlxuICAgICAgY2FzZSAzOTpcbiAgICAgICAgaWYgKChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTGlzdC5jb250YWlucygnYm13LWNvbXBvbmVudC1oZWFkbGluZS10ZXh0JykpIHtcbiAgICAgICAgICB0aGlzLnNlbGVjdE5laWdoYm91ckNvbnRlbnRUYWIoZXZlbnQudGFyZ2V0LCBEaXJlY3Rpb24uUmlnaHQpO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgIGNhc2UgJ051bXBhZEVudGVyJzpcbiAgICAgIGNhc2UgMTM6XG4gICAgICAgIGlmICh0aGlzLmhpZGRlbkxhYmVscy5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW5lZCcpKSB7XG4gICAgICAgICAgY29uc3QgZm9jdXNlZFRhYk9wdGlvbklEID0gdGhpcy5nZXRGb2N1c2VkVGFiT3B0aW9uSUQoKTtcbiAgICAgICAgICBpZiAoZm9jdXNlZFRhYk9wdGlvbklEKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5ndWFyZFNlbGVjdGlvbkNoYW5nZSkge1xuICAgICAgICAgICAgICB0aGlzLnJlcXVlc3RMYWJlbFNlbGVjdGlvbihmb2N1c2VkVGFiT3B0aW9uSUQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVMYWJlbFNlbGVjdGlvbihmb2N1c2VkVGFiT3B0aW9uSUQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmxhYmVscy5maW5kKGxhYmVsID0+IGxhYmVsLmZvciA9PT0gZm9jdXNlZFRhYk9wdGlvbklEKS5sYWJlbC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG5cbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ1NwYWNlJzpcbiAgICAgIGNhc2UgMzI6XG4gICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aHJlZS1kb3RzJykpIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUhpZGRlbkxhYmVscygpO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0eXBlb2YgdGhpcy5qdXN0SWNvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuanVzdEljb24gPSB0cnVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMud2l0aEljb24gIT09ICd1bmRlZmluZWQnICYmICF0aGlzLmp1c3RJY29uKSB7XG4gICAgICB0aGlzLndpdGhJY29uID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLmhpZGRlbkxhYmVscyA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aHJlZS1kb3RzJyk7XG5cbiAgICB0aGlzLmhpZGRlbkxhYmVscy5hZGRFdmVudExpc3RlbmVyKCdmb2N1c291dCcsIGUgPT4ge1xuICAgICAgY29uc3QgbGVhdmluZ1BhcmVudCA9ICF0aGlzLmhpZGRlbkxhYmVscy5jb250YWlucyhlLnJlbGF0ZWRUYXJnZXQpO1xuICAgICAgaWYgKGxlYXZpbmdQYXJlbnQpIHtcbiAgICAgICAgdGhpcy50b2dnbGVIaWRkZW5MYWJlbHMoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRSZXNpemVUcmlnZ2VyKCk7XG5cbiAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpXG4gICAgICAgIC50b1N0cmluZygzNilcbiAgICAgICAgLnN1YnN0cmluZygyKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5nZXRBcnRpY2xlcygpO1xuICAgIHRoaXMucHJlcGFyZUxhYmVscygpO1xuICAgIHRoaXMubGFiZWxzLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgdGhpcy5wcmVwYXJlTGFiZWxzKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmxhYmVscy50b0FycmF5KCkuZm9yRWFjaChsYWJlbCA9PiB7XG4gICAgICBsYWJlbC5jaGFuZ2Uuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5wcmVwYXJlTGFiZWxzKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRoaXMuaGlkZVRhYnNDb250ZW50SWZBbGxBcmVEaXNhYmxlZCgpO1xuXG4gICAgdGhpcy5vbkhhc2hDaGFuZ2UoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMudW5zdWJzY3JpYmUkLm5leHQoKTtcbiAgICB0aGlzLnVuc3Vic2NyaWJlJC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgZ2V0QXJ0aWNsZXMoKSB7XG4gICAgY29uc3Qgd3JhcHBlckNoaWxkcmVuID0gdGhpcy5jb250ZW50VGFiV3JhcHBlci5uYXRpdmVFbGVtZW50LmNoaWxkcmVuO1xuICAgIHRoaXMuYXJ0aWNsZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGNoaWxkTm9kZSBvZiB3cmFwcGVyQ2hpbGRyZW4pIHtcbiAgICAgIGlmIChjaGlsZE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYm13LWNvbnRlbnQtdGFiLWNvbnRlbnQnKSB7XG4gICAgICAgIHRoaXMuYXJ0aWNsZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByZXBhcmVMYWJlbHMoKSB7XG4gICAgaWYgKCF0aGlzLmxhYmVscykgcmV0dXJuO1xuXG4gICAgbGV0IHJlU2VsZWN0ID0gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGFiZWxzLnRvQXJyYXkoKS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLmxhYmVscy50b0FycmF5KClbaV07XG4gICAgICBsYWJlbC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZGF0YXNldC5vcmRlciA9IGk7XG4gICAgICBjb25zdCBpZCA9IGxhYmVsLmZvcjtcbiAgICAgIGlmIChsYWJlbC5zZWxlY3RlZCAmJiAhbGFiZWwuZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZChpZCk7XG4gICAgICB9XG4gICAgICBpZiAobGFiZWwuZGlzYWJsZWQpIHtcbiAgICAgICAgbGFiZWwuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGVkJyk7XG4gICAgICAgIHJlU2VsZWN0ID0gdGhpcy5zZWxlY3RlZCA9PT0gbGFiZWwuZm9yO1xuICAgICAgfSBlbHNlIGlmIChsYWJlbC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIGxhYmVsLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlZCcpO1xuICAgICAgfVxuICAgICAgLy8gbm90ZSB0aGF0IHRoZSBldmVudCB3aWxsIHN0aWxsIGJlIGhhbmRsZWQgaWYgaXQgaXMgc3VibWl0dGVkIGRpcmVjdGx5IChlLmcuICQoJ2Jtdy1jb250ZW50LXRhYi1sYWJlbC5kaXNhYmxlZCcpLmNsaWNrKCkpXG4gICAgICBsYWJlbC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZTogRXZlbnQpID0+IHRoaXMub25DbGlja0xhYmVsKGUsIGlkKSk7XG4gICAgICBsYWJlbC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcbiAgICAgICAgdGhpcy5qdXN0SWNvbiA/ICdqdXN0LWljb24nIDogdGhpcy53aXRoSWNvbiA/ICd3aXRoLWljb24nIDogJ2p1c3QtdGV4dCdcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgZmlyc3RFbmFibGVkTGFiZWwgPSB0aGlzLmxhYmVscy50b0FycmF5KCkuZmluZChsYWJlbCA9PiAhbGFiZWwuZGlzYWJsZWQpO1xuICAgIGlmIChyZVNlbGVjdCB8fCAoIXRoaXMuc2VsZWN0ZWQgJiYgZmlyc3RFbmFibGVkTGFiZWwpKSB7XG4gICAgICB0aGlzLnNldFNlbGVjdGVkKGZpcnN0RW5hYmxlZExhYmVsLmZvcik7XG4gICAgfVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5oaWRlTGFiZWxzSWZOZWNlc3NhcnkoKTtcbiAgICB9LCAxMCk7XG4gICAgLy8gcnVuIG9uY2UgYWdhaW4gYWZ0ZXIgY3NzIHZhcmlhYmxlcyBhcmUgcmVwbGFjZXMgaW4gSUVcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuaGlkZUxhYmVsc0lmTmVjZXNzYXJ5KHRydWUpO1xuICAgIH0sIDUwMCk7XG4gIH1cblxuICBvbkNsaWNrTGFiZWwoZXZlbnQ6IEV2ZW50LCBsYWJlbElkOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5ndWFyZFNlbGVjdGlvbkNoYW5nZSkge1xuICAgICAgdGhpcy5yZXF1ZXN0TGFiZWxTZWxlY3Rpb24obGFiZWxJZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlTGFiZWxTZWxlY3Rpb24obGFiZWxJZCk7XG4gICAgfVxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgdXBkYXRlTGFiZWxTZWxlY3Rpb24obGFiZWxJZDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuc2VsZWN0ZWQgIT09IGxhYmVsSWQpIHtcbiAgICAgIHRoaXMuc2V0U2VsZWN0ZWQobGFiZWxJZCk7XG4gICAgICB0aGlzLnNlbGVjdGlvbkNoYW5nZS5lbWl0KGxhYmVsSWQpO1xuICAgICAgdGhpcy5oaWRlTGFiZWxzSWZOZWNlc3NhcnkodHJ1ZSk7XG4gICAgICB0aGlzLnRvZ2dsZUhpZGRlbkxhYmVscyhmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgcmVxdWVzdExhYmVsU2VsZWN0aW9uKGxhYmVsSWQ6IHN0cmluZykge1xuICAgIHRoaXMuYWxsb3dTZWxlY3Rpb25DaGFuZ2UkXG4gICAgICAucGlwZShcbiAgICAgICAgLy8gZW5zdXJlcyB0aGUgc3Vic2NyaXB0aW9uIGNvbXBsZXRlcyBhZnRlciB0aGUgZmlyc3QgY2xpY2sgZXZlbnRcbiAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgZmlsdGVyKGFsbG93Q2hhbmdlID0+ICEhYWxsb3dDaGFuZ2UpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy51bnN1YnNjcmliZSQpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMudXBkYXRlTGFiZWxTZWxlY3Rpb24obGFiZWxJZCkpO1xuXG4gICAgY29uc3QgY3VycmVudFNlbGVjdGVkTGFiZWwgPSB0aGlzLmdldFNlbGVjdGVkTGFiZWwoKTtcbiAgICB0aGlzLnJlcXVlc3RTZWxlY3Rpb25DaGFuZ2UuZW1pdCh7XG4gICAgICBjdXJyZW50U2VsZWN0aW9uOiBjdXJyZW50U2VsZWN0ZWRMYWJlbCAmJiBjdXJyZW50U2VsZWN0ZWRMYWJlbC5mb3IsXG4gICAgICByZXF1ZXN0ZWRTZWxlY3Rpb246IGxhYmVsSWQsXG4gICAgICBhbGxvd1NlbGVjdGlvbkNoYW5nZSQ6IHRoaXMuYWxsb3dTZWxlY3Rpb25DaGFuZ2UkXG4gICAgfSk7XG4gIH1cblxuICBzZXRSZXNpemVUcmlnZ2VyKCkge1xuICAgIGxldCByZXNpemVUaW1lcjtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7XG4gICAgICBjbGVhclRpbWVvdXQocmVzaXplVGltZXIpO1xuICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgICByZXNpemVUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGF0LmhpZGVMYWJlbHNJZk5lY2Vzc2FyeSh0cnVlKTtcbiAgICAgIH0sIDEwKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldFNlbGVjdGVkKHNlbGVjdGVkOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XG4gICAgY29uc3QgbGFiZWxzQXJyYXkgPSB0aGlzLmxhYmVscy50b0FycmF5KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsYWJlbHNBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaWQgPSBsYWJlbHNBcnJheVtpXS5mb3I7XG4gICAgICBpZiAoc2VsZWN0ZWQgPT09IGlkKSB7XG4gICAgICAgIGxhYmVsc0FycmF5W2ldLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBsYWJlbHNBcnJheVtpXS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgIH0sIDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGFiZWxzQXJyYXlbaV0uZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgICAgIGxhYmVsc0FycmF5W2ldLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5hcnRpY2xlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaWQgPSB0aGlzLmFydGljbGVzW2ldLmdldEF0dHJpYnV0ZSgnaWQnKTtcbiAgICAgIGlmIChzZWxlY3RlZCA9PT0gaWQpIHtcbiAgICAgICAgdGhpcy5hcnRpY2xlc1tpXS5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hcnRpY2xlc1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGhpZGVMYWJlbHNJZk5lY2Vzc2FyeShzaG93QWxsRmlyc3Q/OiBib29sZWFuKSB7XG4gICAgY29uc3QgbGFiZWxzRGl2ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2LmxhYmVscycpO1xuXG4gICAgaWYgKHNob3dBbGxGaXJzdCkge1xuICAgICAgdGhpcy5zaG93QWxsTGFiZWxzKGxhYmVsc0Rpdik7XG4gICAgfVxuICAgIGNvbnN0IGhlaWdodCA9IGxhYmVsc0Rpdi5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3QgZGVmYXVsdEhlaWdodCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sYWJlbHMgLmJvcmRlcicpLm9mZnNldEhlaWdodDtcbiAgICBpZiAoaGVpZ2h0ID4gZGVmYXVsdEhlaWdodCkge1xuICAgICAgdGhpcy5jcmVhdGVIaWRkZW5MYWJlbHNNZW51RWxlbWVudCgpO1xuICAgICAgY29uc3QgaGFzTW9yZU5vbkFjdGl2ZUxhYmVscyA9IHRoaXMuaGlkZUxhc3ROb25BY3RpdmVMYWJlbChsYWJlbHNEaXYpO1xuICAgICAgaWYgKGhhc01vcmVOb25BY3RpdmVMYWJlbHMpIHtcbiAgICAgICAgdGhpcy5oaWRlTGFiZWxzSWZOZWNlc3NhcnkoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBoaWRlVGFic0NvbnRlbnRJZkFsbEFyZURpc2FibGVkKCkge1xuICAgIGlmICghdGhpcy5sYWJlbHMudG9BcnJheSgpLmZpbmQobGFiZWwgPT4gIWxhYmVsLmRpc2FibGVkKSkge1xuICAgICAgdGhpcy50YWJDb250ZW50cy50b0FycmF5KCkuZm9yRWFjaCh0YWJDb250ZW50ID0+ICh0YWJDb250ZW50LmhpZGUgPSB0cnVlKSk7XG4gICAgfVxuICB9XG5cbiAgc2hvd0FsbExhYmVscyhwYXJlbnRFbGVtZW50KSB7XG4gICAgaWYgKCF0aGlzLmhpZGRlbkxhYmVsc01lbnUpIHJldHVybjtcblxuICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuaGlkZGVuTGFiZWxzTWVudS5jaGlsZHJlbi5sZW5ndGg7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBwYXJlbnRFbGVtZW50LnByZXBlbmQodGhpcy5oaWRkZW5MYWJlbHNNZW51LmNoaWxkcmVuWzBdKTtcbiAgICB9XG5cbiAgICB0aGlzLmhpZGRlbkxhYmVscy5yZW1vdmVDaGlsZCh0aGlzLmhpZGRlbkxhYmVsc01lbnUpO1xuICAgIHRoaXMuaGlkZGVuTGFiZWxzTWVudSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNvcnQocGFyZW50RWxlbWVudCk7XG4gIH1cblxuICBzb3J0KHBhcmVudEVsZW1lbnQpIHtcbiAgICBsZXQgYXJyYXkgPSBwYXJlbnRFbGVtZW50LmNoaWxkcmVuO1xuXG4gICAgYXJyYXkgPSBBcnJheS5mcm9tKGFycmF5KS5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIGEuZGF0YXNldC5vcmRlciAtIGIuZGF0YXNldC5vcmRlcjtcbiAgICB9KTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIHBhcmVudEVsZW1lbnQuYXBwZW5kKGFycmF5W2ldKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyB0aGUgbGFzdCBub24tYWN0aXZlIGxhYmVsIGZyb20gdmlldyBhbmQgYWRkcyBpdCB0byB0aGUgdGhyZWUtZG90cyBtZW51XG4gICAqIEByZXR1cm5zIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGVyZSBhcmUgbW9yZSBub24tYWN0aXZlIGxhYmVscyBpbiB2aWV3XG4gICAqL1xuICBoaWRlTGFzdE5vbkFjdGl2ZUxhYmVsKHBhcmVudEVsZW1lbnQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIGxldCBoYXNNb3JlTm9uQWN0aXZlTGFiZWxzID0gdHJ1ZTtcbiAgICBjb25zdCB0YWJBcnJheSA9IFsuLi5wYXJlbnRFbGVtZW50LmNoaWxkcmVuXS5maWx0ZXIoXG4gICAgICBjaGlsZCA9PlxuICAgICAgICAhY2hpbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCdib3JkZXInKSAmJlxuICAgICAgICAhY2hpbGQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0aHJlZS1kb3RzJykgJiZcbiAgICAgICAgIWNoaWxkLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKVxuICAgICk7XG5cbiAgICB0aGlzLmhpZGRlbkxhYmVsc01lbnUucHJlcGVuZCh0YWJBcnJheS5wb3AoKSk7XG5cbiAgICBpZiAodGFiQXJyYXkubGVuZ3RoID09PSAwKSB7XG4gICAgICBoYXNNb3JlTm9uQWN0aXZlTGFiZWxzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGhhc01vcmVOb25BY3RpdmVMYWJlbHM7XG4gIH1cblxuICBjcmVhdGVIaWRkZW5MYWJlbHNNZW51RWxlbWVudCgpIHtcbiAgICBpZiAodGhpcy5oaWRkZW5MYWJlbHNNZW51KSByZXR1cm47XG5cbiAgICB0aGlzLmhpZGRlbkxhYmVsc01lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLmhpZGRlbkxhYmVsc01lbnUuY2xhc3NMaXN0LmFkZCgnbWVudScpO1xuICAgIHRoaXMuaGlkZGVuTGFiZWxzLmFwcGVuZCh0aGlzLmhpZGRlbkxhYmVsc01lbnUpO1xuICB9XG5cbiAgdG9nZ2xlSGlkZGVuTGFiZWxzKHN0YXRlPzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5oaWRkZW5MYWJlbHMpIHJldHVybjtcblxuICAgIGlmICh0aGlzLmhpZGRlbkxhYmVsc01lbnUpIHtcbiAgICAgIGNvbnN0IHJlY3RhbmdsZSA9IHRoaXMuaGlkZGVuTGFiZWxzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgcG9zaXRpb24gPSByZWN0YW5nbGUueCArIHJlY3RhbmdsZS53aWR0aCAtIDI7XG4gICAgICB0aGlzLmhpZGRlbkxhYmVsc01lbnUuc3R5bGVbJ21heC13aWR0aCddID0gcG9zaXRpb24gKyAncHgnO1xuICAgIH1cblxuICAgIGNvbnN0IG9wZW5lZCA9IHRoaXMuaGlkZGVuTGFiZWxzLmNsYXNzTGlzdC5jb250YWlucygnb3BlbmVkJyk7XG5cbiAgICBpZiAoc3RhdGUgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuaGlkZGVuTGFiZWxzLmNsYXNzTGlzdC5hZGQoJ29wZW5lZCcpO1xuICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLmhpZGRlbkxhYmVscy5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuZWQnKTtcbiAgICB9IGVsc2UgaWYgKG9wZW5lZCkge1xuICAgICAgdGhpcy5oaWRkZW5MYWJlbHMuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbmVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGlkZGVuTGFiZWxzLmNsYXNzTGlzdC5hZGQoJ29wZW5lZCcpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VsZWN0ZWRMYWJlbCgpOiBDb250ZW50VGFiTGFiZWxDb21wb25lbnQgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmxhYmVscyAmJiB0aGlzLmxhYmVscy5maW5kKGxhYmVsID0+IHRoaXMuc2VsZWN0ZWQgPT09IGxhYmVsLmZvcik7XG4gIH1cblxuICBwdWJsaWMgc2VsZWN0TmVpZ2hib3VyQ29udGVudFRhYihjb250ZW50VGFiTGFiZWw6IEV2ZW50VGFyZ2V0LCBkaXJlY3Rpb246IERpcmVjdGlvbikge1xuICAgIGNvbnN0IHZpc2libGVMYWJlbHNBcnJheTogSFRNTEVsZW1lbnRbXSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKFxuICAgICAgdGhpcy5sYWJlbHNXcmFwcGVyLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYm13LWNvbnRlbnQtdGFiLWxhYmVsID4gLmJtdy1jb21wb25lbnQtaGVhZGxpbmUtdGV4dCcpXG4gICAgKTtcblxuICAgIGlmIChjb250ZW50VGFiTGFiZWwgPT09IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aHJlZS1kb3RzJykpIHtcbiAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkxlZnQ6XG4gICAgICAgICAgdGhpcy5zZWxlY3RBbmRGb2N1c0NvbnRlbnRUYWIodmlzaWJsZUxhYmVsc0FycmF5Lmxlbmd0aCAtIDEpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIERpcmVjdGlvbi5SaWdodDpcbiAgICAgICAgICB0aGlzLnNlbGVjdEFuZEZvY3VzQ29udGVudFRhYigwKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdGFyZ2V0ZWRUYWJMYWJlbCA9IHZpc2libGVMYWJlbHNBcnJheS5maW5kKCh0YWI6IEV2ZW50VGFyZ2V0KSA9PiB0YWIgPT09IGNvbnRlbnRUYWJMYWJlbCk7XG5cbiAgICAgIGlmICh2aXNpYmxlTGFiZWxzQXJyYXkubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAodGFyZ2V0ZWRUYWJMYWJlbCkge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMuaGlkZGVuTGFiZWxzTWVudSAmJlxuICAgICAgICAgICAgKCh0YXJnZXRlZFRhYkxhYmVsID09PSB2aXNpYmxlTGFiZWxzQXJyYXlbMF0gJiYgZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uTGVmdCkgfHxcbiAgICAgICAgICAgICAgKHRhcmdldGVkVGFiTGFiZWwgPT09IHZpc2libGVMYWJlbHNBcnJheVt2aXNpYmxlTGFiZWxzQXJyYXkubGVuZ3RoIC0gMV0gJiYgZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uUmlnaHQpKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnRocmVlLWRvdHMnKS5mb2N1cygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBiZWZvcmVDaGFuZ2VUYWJJbmRleCA9IHZpc2libGVMYWJlbHNBcnJheS5maW5kSW5kZXgoXG4gICAgICAgICAgICAgICh0YWJMYWJlbDogSFRNTEVsZW1lbnQpID0+IHRhYkxhYmVsID09PSB0YXJnZXRlZFRhYkxhYmVsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCB0YWJUb1NlbGVjdEluZGV4ID0gdGhpcy5nZXROZWlnaGJvdXJDb250ZW50VGFiTGFiZWxJbmRleChiZWZvcmVDaGFuZ2VUYWJJbmRleCwgZGlyZWN0aW9uKTtcblxuICAgICAgICAgICAgaWYgKHRhYlRvU2VsZWN0SW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICB0aGlzLnNlbGVjdEFuZEZvY3VzQ29udGVudFRhYih0YWJUb1NlbGVjdEluZGV4KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IGZpbmQgYSB0YWIgdG8gc2VsZWN0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwZWNpZmllZCB0YXJnZXQgZG9lcyBub3QgY29ycmVzcG9uZCB0byBhIHRhYsK0cyBsYWJlbCBjb250YWluZXInKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyZSBhcmUgbm8gY29udGVudCB0YWIgbGFiZWxzIGRlZmluZWQnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNlbGVjdEFuZEZvY3VzQ29udGVudFRhYih0YWJUb1NlbGVjdEluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCB2aXNpYmxlQ29udGVudFRhYkxhYmVsc0FycmF5ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoXG4gICAgICB0aGlzLmxhYmVsc1dyYXBwZXIubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdibXctY29udGVudC10YWItbGFiZWwnKVxuICAgICk7XG4gICAgY29uc3QgdGFiVG9TZWxlY3RJRCA9IHZpc2libGVDb250ZW50VGFiTGFiZWxzQXJyYXlbdGFiVG9TZWxlY3RJbmRleF0uZ2V0QXR0cmlidXRlKCdmb3InKTtcblxuICAgIHRoaXMuc2V0U2VsZWN0ZWQodGFiVG9TZWxlY3RJRCk7XG5cbiAgICBpZiAodGhpcy5ndWFyZFNlbGVjdGlvbkNoYW5nZSkge1xuICAgICAgdGhpcy5yZXF1ZXN0TGFiZWxTZWxlY3Rpb24odGFiVG9TZWxlY3RJRCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlTGFiZWxTZWxlY3Rpb24odGFiVG9TZWxlY3RJRCk7XG4gICAgfVxuXG4gICAgdmlzaWJsZUNvbnRlbnRUYWJMYWJlbHNBcnJheVt0YWJUb1NlbGVjdEluZGV4XS5xdWVyeVNlbGVjdG9yKCcuYm13LWNvbXBvbmVudC1oZWFkbGluZS10ZXh0JykuZm9jdXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TmVpZ2hib3VyQ29udGVudFRhYkxhYmVsSW5kZXgoY29udGVudFRhYkxhYmVsSW5kZXg6IG51bWJlciwgZGlyZWN0aW9uOiBEaXJlY3Rpb24pOiBudW1iZXIge1xuICAgIGNvbnN0IHZpc2libGVDb250ZW50VGFiTGFiZWxzQXJyYXk6IEhUTUxFbGVtZW50W10gPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChcbiAgICAgIHRoaXMubGFiZWxzV3JhcHBlci5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Jtdy1jb250ZW50LXRhYi1sYWJlbCcpXG4gICAgKTtcbiAgICBsZXQgbmVpZ2hib3VyQ29udGVudFRhYkxhYmVsSW5kZXggPSAtMTtcblxuICAgIGlmICh2aXNpYmxlQ29udGVudFRhYkxhYmVsc0FycmF5LmZpbmQobGFiZWwgPT4gIWxhYmVsLmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZWQnKSkpIHtcbiAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkxlZnQ6XG4gICAgICAgICAgaWYgKGNvbnRlbnRUYWJMYWJlbEluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICBuZWlnaGJvdXJDb250ZW50VGFiTGFiZWxJbmRleCA9IHZpc2libGVDb250ZW50VGFiTGFiZWxzQXJyYXkubGVuZ3RoIC0gMTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmVpZ2hib3VyQ29udGVudFRhYkxhYmVsSW5kZXggPSBjb250ZW50VGFiTGFiZWxJbmRleCAtIDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLlJpZ2h0OlxuICAgICAgICAgIGlmIChjb250ZW50VGFiTGFiZWxJbmRleCA9PT0gdmlzaWJsZUNvbnRlbnRUYWJMYWJlbHNBcnJheS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBuZWlnaGJvdXJDb250ZW50VGFiTGFiZWxJbmRleCA9IDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5laWdoYm91ckNvbnRlbnRUYWJMYWJlbEluZGV4ID0gY29udGVudFRhYkxhYmVsSW5kZXggKyAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICB2aXNpYmxlQ29udGVudFRhYkxhYmVsc0FycmF5W25laWdoYm91ckNvbnRlbnRUYWJMYWJlbEluZGV4XS5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGVkJykgfHxcbiAgICAgICAgdGhpcy5pc0NvbnRlbnRUYWJMYWJlbEhpZGRlbih2aXNpYmxlQ29udGVudFRhYkxhYmVsc0FycmF5W25laWdoYm91ckNvbnRlbnRUYWJMYWJlbEluZGV4XS5nZXRBdHRyaWJ1dGUoJ2ZvcicpKVxuICAgICAgKSB7XG4gICAgICAgIG5laWdoYm91ckNvbnRlbnRUYWJMYWJlbEluZGV4ID0gdGhpcy5nZXROZWlnaGJvdXJDb250ZW50VGFiTGFiZWxJbmRleChuZWlnaGJvdXJDb250ZW50VGFiTGFiZWxJbmRleCwgZGlyZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyZSBhcmUgbm8gZW5hYmxlZCB0YWJzIGF2YWlsYWJsZScpO1xuICAgIH1cblxuICAgIHJldHVybiBuZWlnaGJvdXJDb250ZW50VGFiTGFiZWxJbmRleDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Rm9jdXNlZFRhYk9wdGlvbklEKCk6IHN0cmluZyB7XG4gICAgY29uc3QgZm9jdXNlZFRhYk9wdGlvbiA9IEFycmF5LnByb3RvdHlwZS5zbGljZVxuICAgICAgLmNhbGwodGhpcy5oaWRkZW5MYWJlbHNNZW51LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Jtdy1jb250ZW50LXRhYi1sYWJlbCcpKVxuICAgICAgLmZpbmQoKHRhYk9wdGlvbjogSFRNTEVsZW1lbnQpID0+IHRhYk9wdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2ZvY3VzZWQnKSk7XG5cbiAgICByZXR1cm4gZm9jdXNlZFRhYk9wdGlvbiA/IGZvY3VzZWRUYWJPcHRpb24uYXR0cmlidXRlcy5mb3Iubm9kZVZhbHVlIDogJyc7XG4gIH1cblxuICBwcml2YXRlIGlzQ29udGVudFRhYkxhYmVsSGlkZGVuKGNvbnRlbnRUYWJJRDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgbGV0IGlzVGFiTGFiZWxIaWRkZW4gPSBmYWxzZTtcbiAgICBpZiAodGhpcy5oaWRkZW5MYWJlbHNNZW51KSB7XG4gICAgICBjb25zdCBoaWRkZW5MYWJlbHNJRHM6IHN0cmluZ1tdID0gQXJyYXkucHJvdG90eXBlLnNsaWNlXG4gICAgICAgIC5jYWxsKHRoaXMuaGlkZGVuTGFiZWxzTWVudS5xdWVyeVNlbGVjdG9yQWxsKCdibXctY29udGVudC10YWItbGFiZWwnKSlcbiAgICAgICAgLm1hcCgoaGlkZGVuTGFiZWw6IEhUTUxFbGVtZW50KSA9PiBoaWRkZW5MYWJlbC5nZXRBdHRyaWJ1dGUoJ2ZvcicpKTtcblxuICAgICAgaXNUYWJMYWJlbEhpZGRlbiA9IGhpZGRlbkxhYmVsc0lEcy5pbmRleE9mKGNvbnRlbnRUYWJJRCkgPiAtMTtcbiAgICB9XG5cbiAgICByZXR1cm4gaXNUYWJMYWJlbEhpZGRlbjtcbiAgfVxuXG4gIHByaXZhdGUgZm9jdXNNZW51VGFiT3B0aW9uKGRpcmVjdGlvbjogRGlyZWN0aW9uKSB7XG4gICAgaWYgKHRoaXMuaGlkZGVuTGFiZWxzLmNsYXNzTGlzdC5jb250YWlucygnb3BlbmVkJykpIHtcbiAgICAgIGlmICh0aGlzLmhpZGRlbkxhYmVsc01lbnUpIHtcbiAgICAgICAgY29uc3QgaGlkZGVuVGFiT3B0aW9ucyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKFxuICAgICAgICAgIHRoaXMuaGlkZGVuTGFiZWxzTWVudS5xdWVyeVNlbGVjdG9yQWxsKCdibXctY29udGVudC10YWItbGFiZWwnKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBoaWRkZW5UYWJPcHRpb25zLmxlbmd0aCAmJlxuICAgICAgICAgIGhpZGRlblRhYk9wdGlvbnMuc29tZSgodGFiT3B0aW9uOiBIVE1MRWxlbWVudCkgPT4gIXRhYk9wdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGVkJykpXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnN0IGZvY3VzZWRUYWJPcHRpb25JbmRleDogbnVtYmVyID0gaGlkZGVuVGFiT3B0aW9ucy5maW5kSW5kZXgoKHRhYk9wdGlvbjogSFRNTEVsZW1lbnQpID0+XG4gICAgICAgICAgICB0YWJPcHRpb24uY2xhc3NMaXN0LmNvbnRhaW5zKCdmb2N1c2VkJylcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaGlkZGVuVGFiT3B0aW9ucy5mb3JFYWNoKCh0YWJPcHRpb246IEhUTUxFbGVtZW50KSA9PiB0YWJPcHRpb24uY2xhc3NMaXN0LnJlbW92ZSgnZm9jdXNlZCcpKTtcblxuICAgICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5VcDpcbiAgICAgICAgICAgICAgdGhpcy5zZXRQcmV2aW91c1RhYk9wdGlvbkFzRm9jdXNlZChmb2N1c2VkVGFiT3B0aW9uSW5kZXgpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLkRvd246XG4gICAgICAgICAgICAgIHRoaXMuc2V0TmV4dFRhYk9wdGlvbkFzRm9jdXNlZChmb2N1c2VkVGFiT3B0aW9uSW5kZXgpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyZSBhcmUgbm8gb3B0aW9ucyBpbiB0aGUgdGhyZWUtZG90cyBjb250YWluZXInKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldE5leHRUYWJPcHRpb25Bc0ZvY3VzZWQodGFiT3B0aW9uSW5kZXg6IG51bWJlcikge1xuICAgIGNvbnN0IGhpZGRlblRhYk9wdGlvbnMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChcbiAgICAgIHRoaXMuaGlkZGVuTGFiZWxzTWVudS5xdWVyeVNlbGVjdG9yQWxsKCdibXctY29udGVudC10YWItbGFiZWwnKVxuICAgICk7XG5cbiAgICBpZiAodGFiT3B0aW9uSW5kZXggIT09IC0xICYmIHRhYk9wdGlvbkluZGV4ICE9PSBoaWRkZW5UYWJPcHRpb25zLmxlbmd0aCAtIDEpIHtcbiAgICAgIHRhYk9wdGlvbkluZGV4ID0gdGFiT3B0aW9uSW5kZXggKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICB0YWJPcHRpb25JbmRleCA9IDA7XG4gICAgfVxuXG4gICAgaWYgKGhpZGRlblRhYk9wdGlvbnNbdGFiT3B0aW9uSW5kZXhdLmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZWQnKSkge1xuICAgICAgdGhpcy5zZXROZXh0VGFiT3B0aW9uQXNGb2N1c2VkKHRhYk9wdGlvbkluZGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGlkZGVuVGFiT3B0aW9uc1t0YWJPcHRpb25JbmRleF0uY2xhc3NMaXN0LmFkZCgnZm9jdXNlZCcpO1xuICAgICAgaGlkZGVuVGFiT3B0aW9uc1t0YWJPcHRpb25JbmRleF0ucXVlcnlTZWxlY3RvcignbGFiZWwnKS5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0UHJldmlvdXNUYWJPcHRpb25Bc0ZvY3VzZWQodGFiT3B0aW9uSW5kZXg6IG51bWJlcikge1xuICAgIGNvbnN0IGhpZGRlblRhYk9wdGlvbnMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChcbiAgICAgIHRoaXMuaGlkZGVuTGFiZWxzTWVudS5xdWVyeVNlbGVjdG9yQWxsKCdibXctY29udGVudC10YWItbGFiZWwnKVxuICAgICk7XG5cbiAgICBpZiAodGFiT3B0aW9uSW5kZXggIT09IC0xICYmIHRhYk9wdGlvbkluZGV4ICE9PSAwKSB7XG4gICAgICB0YWJPcHRpb25JbmRleCA9IHRhYk9wdGlvbkluZGV4IC0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGFiT3B0aW9uSW5kZXggPSBoaWRkZW5UYWJPcHRpb25zLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgaWYgKGhpZGRlblRhYk9wdGlvbnNbdGFiT3B0aW9uSW5kZXhdLmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZWQnKSkge1xuICAgICAgdGhpcy5zZXRQcmV2aW91c1RhYk9wdGlvbkFzRm9jdXNlZCh0YWJPcHRpb25JbmRleCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhpZGRlblRhYk9wdGlvbnNbdGFiT3B0aW9uSW5kZXhdLmNsYXNzTGlzdC5hZGQoJ2ZvY3VzZWQnKTtcbiAgICAgIGhpZGRlblRhYk9wdGlvbnNbdGFiT3B0aW9uSW5kZXhdLnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJykuZm9jdXMoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==