import { __decorate } from "tslib";
import { AfterContentChecked, AfterContentInit, Component, ContentChildren, EventEmitter, HostBinding, Input, OnChanges, OnDestroy, OnInit, Output, QueryList, HostListener, ElementRef } from '@angular/core';
import { PanelComponent } from '../panel/panel.component';
let AccordionComponent = class AccordionComponent {
    constructor(elem) {
        this.elem = elem;
        this.activePanelId = null;
        this.activePanelIdChange = new EventEmitter();
        this.subscriptions = [];
    }
    onKeydown(event) {
        const key = event.code || event.keyCode;
        switch (key) {
            case 'Enter':
            case 'NumpadEnter':
            case 13:
            case 'Space':
            case 32:
                const targetedPanel = Array.prototype.slice
                    .call(this.elem.nativeElement.querySelectorAll('.panel'))
                    .find((panel) => panel === event.target);
                if (targetedPanel) {
                    this.setActivePanel(this.panels.find(panel => panel.labelsDiv.nativeElement === targetedPanel).id, targetedPanel.classList.contains('opened'));
                }
                event.stopImmediatePropagation();
                break;
        }
    }
    ngOnInit() {
        if (typeof this.id === 'undefined') {
            this.id = this.createId();
        }
    }
    ngOnChanges() {
        if (!this.panels)
            return;
        this.setActivePanel(this.activePanelId);
    }
    ngAfterContentInit() {
        this.panels.changes.subscribe(this.setupPanels.bind(this));
        this.setupPanels();
    }
    ngOnDestroy() {
        this.subscriptions.forEach(subscription => subscription.unsubscribe());
    }
    setupPanels() {
        this.subscriptions.forEach(subscription => subscription.unsubscribe());
        this.subscriptions = this.panels.map((panel) => {
            return panel.toggleEvent.subscribe(event => {
                this.setActivePanel(panel.id, event.opened);
            });
        });
        if (this.activePanelId) {
            return this.setActivePanel(this.activePanelId);
        }
    }
    setActivePanel(activePanelId, opened = true) {
        this.panels.forEach((panel) => {
            if (panel.id !== activePanelId && this.canTogglePanel(panel)) {
                panel.opened = false;
            }
            if (panel.id === activePanelId) {
                panel.opened = opened;
                this.activePanelId = opened ? activePanelId : null;
                this.activePanelIdChange.emit(this.activePanelId);
            }
        });
    }
    canTogglePanel(panel) {
        return !panel.disabled && !panel.nonCollapsible;
    }
    createId() {
        return Math.random()
            .toString(36)
            .substring(2);
    }
};
AccordionComponent.ctorParameters = () => [
    { type: ElementRef }
];
__decorate([
    ContentChildren(PanelComponent)
], AccordionComponent.prototype, "panels", void 0);
__decorate([
    Input()
], AccordionComponent.prototype, "activePanelId", void 0);
__decorate([
    HostBinding('attr.id'),
    Input()
], AccordionComponent.prototype, "id", void 0);
__decorate([
    Output()
], AccordionComponent.prototype, "activePanelIdChange", void 0);
__decorate([
    HostListener('keydown', ['$event'])
], AccordionComponent.prototype, "onKeydown", null);
AccordionComponent = __decorate([
    Component({
        selector: 'bmw-accordion',
        template: "<ng-content></ng-content>\n",
        styles: [":host{display:block}:host ::ng-deep bmw-panel{margin-bottom:var(--spacing-bmw-xs)}"]
    })
], AccordionComponent);
export { AccordionComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3JkaW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BibXctZHMvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImFjY29yZGlvbi9hY2NvcmRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsbUJBQW1CLEVBQ25CLGdCQUFnQixFQUNoQixTQUFTLEVBQ1QsZUFBZSxFQUNmLFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUNMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFRMUQsSUFBYSxrQkFBa0IsR0FBL0IsTUFBYSxrQkFBa0I7SUFnQjdCLFlBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7UUFYcEMsa0JBQWEsR0FBVyxJQUFJLENBQUM7UUFPN0Isd0JBQW1CLEdBQXlCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFdkQsa0JBQWEsR0FBbUIsRUFBRSxDQUFDO0lBRUosQ0FBQztJQUd4QyxTQUFTLENBQUMsS0FBb0I7UUFDNUIsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3hDLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLGFBQWEsQ0FBQztZQUNuQixLQUFLLEVBQUUsQ0FBQztZQUNSLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSztxQkFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3FCQUN4RCxJQUFJLENBQUMsQ0FB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QUssQ0FBQyxjQUFjLENBQUM7SUFDbEQsQ0FBQztJQUVPLFFBQVE7UUFDZCxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUU7YUFDakIsUUFBUSxDQUFDLEVBQUUsQ0FBQzthQUNaLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDO0NBQ0YsQ0FBQTs7WUEvRTJCLFVBQVU7O0FBZHBDO0lBREMsZUFBZSxDQUFDLGNBQWMsQ0FBQztrREFDRTtBQUdsQztJQURDLEtBQUssRUFBRTt5REFDcUI7QUFJN0I7SUFGQyxXQUFXLENBQUMsU0FBUyxDQUFDO0lBQ3RCLEtBQUssRUFBRTs4Q0FDRztBQUdYO0lBREMsTUFBTSxFQUFFOytEQUNzRDtBQU8vRDtJQURDLFlBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzttREFxQm5DO0FBdkNVLGtCQUFrQjtJQUw5QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsZUFBZTtRQUN6Qix1Q0FBeUM7O0tBRTFDLENBQUM7R0FDVyxrQkFBa0IsQ0ErRjlCO1NBL0ZZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyQ29udGVudENoZWNrZWQsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG4gIEhvc3RMaXN0ZW5lcixcbiAgRWxlbWVudFJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBhbmVsQ29tcG9uZW50IH0gZnJvbSAnLi4vcGFuZWwvcGFuZWwuY29tcG9uZW50JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdibXctYWNjb3JkaW9uJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2FjY29yZGlvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2FjY29yZGlvbi5jb21wb25lbnQubGVzcyddXG59KVxuZXhwb3J0IGNsYXNzIEFjY29yZGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3kge1xuICBAQ29udGVudENoaWxkcmVuKFBhbmVsQ29tcG9uZW50KVxuICBwYW5lbHM6IFF1ZXJ5TGlzdDxQYW5lbENvbXBvbmVudD47XG5cbiAgQElucHV0KClcbiAgYWN0aXZlUGFuZWxJZDogc3RyaW5nID0gbnVsbDtcblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICBASW5wdXQoKVxuICBpZDogc3RyaW5nO1xuXG4gIEBPdXRwdXQoKVxuICBhY3RpdmVQYW5lbElkQ2hhbmdlOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtOiBFbGVtZW50UmVmKSB7fVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICBvbktleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBjb25zdCBrZXkgPSBldmVudC5jb2RlIHx8IGV2ZW50LmtleUNvZGU7XG4gICAgc3dpdGNoIChrZXkpIHtcbiAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgIGNhc2UgJ051bXBhZEVudGVyJzpcbiAgICAgIGNhc2UgMTM6XG4gICAgICBjYXNlICdTcGFjZSc6XG4gICAgICBjYXNlIDMyOlxuICAgICAgICBjb25zdCB0YXJnZXRlZFBhbmVsID0gQXJyYXkucHJvdG90eXBlLnNsaWNlXG4gICAgICAgICAgLmNhbGwodGhpcy5lbGVtLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBhbmVsJykpXG4gICAgICAgICAgLmZpbmQoKHBhbmVsOiBFdmVudFRhcmdldCkgPT4gcGFuZWwgPT09IGV2ZW50LnRhcmdldCk7XG4gICAgICAgIGlmICh0YXJnZXRlZFBhbmVsKSB7XG4gICAgICAgICAgdGhpcy5zZXRBY3RpdmVQYW5lbChcbiAgICAgICAgICAgIHRoaXMucGFuZWxzLmZpbmQocGFuZWwgPT4gcGFuZWwubGFiZWxzRGl2Lm5hdGl2ZUVsZW1lbnQgPT09IHRhcmdldGVkUGFuZWwpLmlkLFxuICAgICAgICAgICAgdGFyZ2V0ZWRQYW5lbC5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW5lZCcpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLmlkID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5pZCA9IHRoaXMuY3JlYXRlSWQoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICBpZiAoIXRoaXMucGFuZWxzKSByZXR1cm47XG4gICAgdGhpcy5zZXRBY3RpdmVQYW5lbCh0aGlzLmFjdGl2ZVBhbmVsSWQpO1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuICAgIHRoaXMucGFuZWxzLmNoYW5nZXMuc3Vic2NyaWJlKHRoaXMuc2V0dXBQYW5lbHMuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5zZXR1cFBhbmVscygpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2goc3Vic2NyaXB0aW9uID0+IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0dXBQYW5lbHMoKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmZvckVhY2goc3Vic2NyaXB0aW9uID0+IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSB0aGlzLnBhbmVscy5tYXAoKHBhbmVsOiBQYW5lbENvbXBvbmVudCkgPT4ge1xuICAgICAgcmV0dXJuIHBhbmVsLnRvZ2dsZUV2ZW50LnN1YnNjcmliZShldmVudCA9PiB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlUGFuZWwocGFuZWwuaWQsIGV2ZW50Lm9wZW5lZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpZiAodGhpcy5hY3RpdmVQYW5lbElkKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXRBY3RpdmVQYW5lbCh0aGlzLmFjdGl2ZVBhbmVsSWQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0QWN0aXZlUGFuZWwoYWN0aXZlUGFuZWxJZDogc3RyaW5nLCBvcGVuZWQgPSB0cnVlKSB7XG4gICAgdGhpcy5wYW5lbHMuZm9yRWFjaCgocGFuZWw6IFBhbmVsQ29tcG9uZW50KSA9PiB7XG4gICAgICBpZiAocGFuZWwuaWQgIT09IGFjdGl2ZVBhbmVsSWQgJiYgdGhpcy5jYW5Ub2dnbGVQYW5lbChwYW5lbCkpIHtcbiAgICAgICAgcGFuZWwub3BlbmVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAocGFuZWwuaWQgPT09IGFjdGl2ZVBhbmVsSWQpIHtcbiAgICAgICAgcGFuZWwub3BlbmVkID0gb3BlbmVkO1xuICAgICAgICB0aGlzLmFjdGl2ZVBhbmVsSWQgPSBvcGVuZWQgPyBhY3RpdmVQYW5lbElkIDogbnVsbDtcbiAgICAgICAgdGhpcy5hY3RpdmVQYW5lbElkQ2hhbmdlLmVtaXQodGhpcy5hY3RpdmVQYW5lbElkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY2FuVG9nZ2xlUGFuZWwocGFuZWw6IFBhbmVsQ29tcG9uZW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICFwYW5lbC5kaXNhYmxlZCAmJiAhcGFuZWwubm9uQ29sbGFwc2libGU7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUlkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIE1hdGgucmFuZG9tKClcbiAgICAgIC50b1N0cmluZygzNilcbiAgICAgIC5zdWJzdHJpbmcoMik7XG4gIH1cbn1cbiJdfQ==