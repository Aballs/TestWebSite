import { __decorate } from "tslib";
import { Component, Input, Output, EventEmitter, HostListener, ViewChild, isDevMode } from '@angular/core';
let TableComponent = class TableComponent {
    constructor() {
        this.hideHeader = false;
        this.zebra = false;
        this.stickHeader = false;
        this.tableSorted = new EventEmitter();
        this.isLoading = false;
    }
    onScroll() {
        if (this.stickHeader) {
            if (this.headerContainer.nativeElement.getBoundingClientRect().top <= 0 &&
                this.tableContainer.nativeElement.getBoundingClientRect().bottom > 0 &&
                this.tableContainer.nativeElement.getBoundingClientRect().top < 0) {
                if (this.isIE()) {
                    this.headerContainer.nativeElement.classList.add('fixed');
                    this.headerContainer.nativeElement.setAttribute('style', `
              left: -${window.pageXOffset}px;
            `);
                }
            }
            else {
                if (this.isIE()) {
                    this.headerContainer.nativeElement.classList.remove('fixed');
                }
            }
            if (this.isIE()) {
                this.setElementsWidthRecursivelyBecauseHTMLTablesAreHardToDealWith(this.tableContainer.nativeElement);
            }
        }
    }
    shouldHaveStickHeader() {
        return this.stickHeader && !this.isIE();
    }
    ngOnInit() {
        var _a, _b, _c;
        if ((_a = this.data) === null || _a === void 0 ? void 0 : _a.length) {
            this.rowsAfterSort = this.data.map(i => (Object.assign({}, i)));
        }
        // keep the legacy input
        else if ((_b = this.rowData) === null || _b === void 0 ? void 0 : _b.length) {
            if (isDevMode()) {
                console.warn('<bmw-table> `rowData` input is deprecated. Please use `data` instead');
            }
            this.rowsAfterSort = this.rowData.map(i => (Object.assign({}, i)));
        }
        // keep the legacy input
        if ((_c = this.columnDefs) === null || _c === void 0 ? void 0 : _c.length) {
            if (isDevMode()) {
                console.warn('<bmw-table> `columnDefs` input is deprecated. Please use `columns` instead');
            }
            this.columns = this.columnDefs;
        }
    }
    ngOnChanges(changes) {
        if (changes['data']) {
            this.rowsAfterSort = this.data.map(i => (Object.assign({}, i)));
        }
        // keep the legacy input
        else if (changes['rowData']) {
            this.rowsAfterSort = this.rowData.map(i => (Object.assign({}, i)));
        }
        // keep the legacy input
        else if (changes['columnDefs']) {
            this.columns = this.columnDefs;
        }
    }
    ngAfterContentInit() {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
    }
    applySortToRows(header) {
        this.isLoading = true;
        if (header.sort === 'asc') {
            this.rowsAfterSort = this.rowsAfterSort.sort((a, b) => a[header.field] > b[header.field] ? 1 : a[header.field] === b[header.field] ? 0 : -1);
        }
        else if (header.sort === 'desc') {
            this.rowsAfterSort = this.rowsAfterSort.sort((a, b) => a[header.field] < b[header.field] ? 1 : a[header.field] === b[header.field] ? 0 : -1);
        }
        this.tableSorted.emit(header);
        this.isLoading = false;
    }
    toggleSort(header) {
        if (header.sorted) {
            if (header.sort === null || header.sort === 'asc') {
                header.sort = 'desc';
            }
            else {
                header.sort = 'asc';
            }
        }
        else {
            if (!header.sort) {
                header.sort = 'asc';
            }
        }
    }
    sortRowsByProperty(property) {
        var _a;
        if ((_a = this.columns) === null || _a === void 0 ? void 0 : _a.some(col => col.field === property && col.sortable === true)) {
            this.columns.forEach(header => {
                if (header.sortable && header.field === property) {
                    this.toggleSort(header);
                    this.applySortToRows(header);
                    header.sorted = true;
                }
                else {
                    header.sort = null;
                    header.sorted = false;
                }
            });
        }
    }
    setElementsWidthRecursivelyBecauseHTMLTablesAreHardToDealWith(element) {
        this.setElementInlineWidth(element);
        for (let i = 0; i < element.childNodes.length; i++) {
            this.setElementsWidthRecursivelyBecauseHTMLTablesAreHardToDealWith(element.childNodes[i]);
        }
    }
    setElementInlineWidth(element) {
        if (element.getBoundingClientRect) {
            const width = element.getBoundingClientRect().width;
            element.setAttribute('style', `
    width: ${width}px !important;
    max-width: ${width}px !important;
    `);
        }
    }
    isIE() {
        let result = false;
        if (window.navigator.userAgent.indexOf('MSIE ') > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))
            result = true;
        return result;
    }
};
__decorate([
    Input()
], TableComponent.prototype, "columnDefs", void 0);
__decorate([
    Input()
], TableComponent.prototype, "columns", void 0);
__decorate([
    Input()
], TableComponent.prototype, "rowData", void 0);
__decorate([
    Input()
], TableComponent.prototype, "data", void 0);
__decorate([
    Input()
], TableComponent.prototype, "id", void 0);
__decorate([
    Input()
], TableComponent.prototype, "hideHeader", void 0);
__decorate([
    Input()
], TableComponent.prototype, "zebra", void 0);
__decorate([
    Input()
], TableComponent.prototype, "stickHeader", void 0);
__decorate([
    Output()
], TableComponent.prototype, "tableSorted", void 0);
__decorate([
    ViewChild('tableContainer')
], TableComponent.prototype, "tableContainer", void 0);
__decorate([
    ViewChild('headerContainer')
], TableComponent.prototype, "headerContainer", void 0);
__decorate([
    HostListener('window:scroll')
], TableComponent.prototype, "onScroll", null);
TableComponent = __decorate([
    Component({
        selector: 'bmw-table',
        template: "<table #tableContainer [ngClass]=\"{ zebra: zebra }\">\n  <thead #headerContainer [ngClass]=\"{ fixed: shouldHaveStickHeader() }\">\n    <tr class=\"header\" *ngIf=\"!hideHeader\">\n      <th\n        class=\"header-cell\"\n        [ngClass]=\"{ 'header-cell-sortable': column.sortable }\"\n        *ngFor=\"let column of columns\"\n        (click)=\"sortRowsByProperty(column.field)\"\n      >\n        <div class=\"header-cell-label\">\n          <span>{{ column.headerName }}</span>\n          <i\n            class=\"header-icon iwp-icon-gen_sort_list_asc\"\n            *ngIf=\"column.sortable && (column.sort === 'asc' || column.sort === null)\"\n            [ngClass]=\"{ sortInactive: !column.sorted }\"\n          ></i>\n          <i\n            class=\"header-icon iwp-icon-gen_sort_list_desc\"\n            *ngIf=\"column.sortable && column.sort === 'desc'\"\n            [ngClass]=\"{ sortInactive: !column.sorted }\"\n          ></i>\n        </div>\n      </th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr class=\"row\" *ngFor=\"let row of rowsAfterSort\">\n      <td class=\"row-cell\" *ngFor=\"let column of columns\">\n        {{ row[column.field] }}\n      </td>\n    </tr>\n  </tbody>\n</table>\n",
        styles: [":host{display:block;min-width:100%}table{min-width:100%;color:var(--color-bmw-basic4);font-family:Arial;font-size:var(--typography__regular-text__font-size);line-height:var(--typography__regular-text__line-height);background-color:var(--color-bmw-basic5);border-collapse:separate;border-spacing:0}table *{box-sizing:border-box;outline:0}table * :after,table * :before{outline:0;box-sizing:border-box}table .iwp-icon-gen_sort_list_asc:before{content:' \\e982'}table .iwp-icon-gen_sort_list_desc:before{content:' \\e983'}table thead.fixed .header-cell{position:sticky;position:-webkit-sticky;top:0;background-color:var(--table__header-cell__default__background-color);border-right:1px solid var(--table__header-cell__default__border-right-color)}table .header{font-family:bmwgroup;font-size:var(--typography__table-headline-text__font-size);line-height:var(--typography__table-headline-text__line-height);font-weight:700;background-color:var(--table__header-cell__default__background-color);color:var(--color-bmw-basic4);margin-bottom:-1px;border-bottom-color:var(--color-bmw-basic5);height:var(--table__header__default__height);flex-direction:row}table .header-cell{padding:var(--spacing-bmw-xs);border-right:1px solid var(--table__header-cell__default__border-right-color)}table .header-cell-label{display:flex;flex:1 1 auto;overflow:hidden;align-items:center;text-overflow:ellipsis;-ms-grid-row-align:stretch;align-self:stretch}table .header-cell-label>span{padding-right:var(--spacing-bmw-xs);text-align:left}table .header-cell-sortable{cursor:pointer}table .header-cell-sortable .header-icon{font-family:iwp;display:block;speak:none;font-size:var(--table__icons__font-size);color:var(--color-bmw-basic4);font-style:normal;font-weight:400;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased}table .header-cell-sortable .header-icon.sortInactive{color:var(--color-bmw-basic4);opacity:.4}table .header-cell-sortable:hover{background-color:var(--table__header-cell__hover__background-color)}table .header-cell::after{display:none}table.zebra .row:nth-child(even){background-color:var(--table__row__zebra__background-color)}table.zebra .row:nth-child(even):hover{background-color:var(--table__row__hover__background-color)}table .row{background-color:var(--table__row__default__background-color);height:var(--table__row__default__height)}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){table thead.fixed{position:fixed;top:0;right:0;pointer-events:none}table thead.fixed+tbody:before{content:'\\200C';display:block;line-height:var(--table__cell__height)}table .row{box-shadow:inset 0 -1px 0 0 var(--table__row__border-bottom-color)}}table .row:hover{background-color:var(--table__row__hover__background-color)}table .row-cell{font-family:Arial;font-size:var(--typography__component-text__font-size);line-height:var(--typography__component-text__line-height);color:var(--color-bmw-basic4);padding:calc(var(--table__cell__padding) - 1px) var(--spacing-bmw-xs);outline:0;border-bottom:1px solid var(--table__row__border-bottom-color)}table .row-cell>*{height:var(--table__cell__height);display:flex;align-items:center}"]
    })
], TableComponent);
export { TableComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsidGFibGUvdGFibGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFFTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFFWixTQUFTLEVBQ1QsU0FBUyxFQUdWLE1BQU0sZUFBZSxDQUFDO0FBbUJ2QixJQUFhLGNBQWMsR0FBM0IsTUFBYSxjQUFjO0lBc0N6QjtRQXJCQSxlQUFVLEdBQUcsS0FBSyxDQUFDO1FBR25CLFVBQUssR0FBRyxLQUFLLENBQUM7UUFHZCxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUdwQixnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFnQixDQUFDO1FBUXhDLGNBQVMsR0FBRyxLQUFLLENBQUM7SUFJVixDQUFDO0lBR2hCLFFBQVE7UUFDTixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDcEIsSUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUNuRSxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDO2dCQUNwRSxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLEVBQ2pFO2dCQUNBLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO29CQUNmLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzFELElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FDN0MsT0FBTyxFQUNQO3VCQUNXLE1BQU0sQ0FBQyxXQUFXO2FBQzVCLENBQ0YsQ0FBQztpQkFDSDthQUNGO2lCQUFNO2dCQUNMLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO29CQUNmLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzlEO2FBQ0Y7WUFFRCxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDZixJQUFJLENBQUMsNkRBQTZELENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQzthQUN2RztTQUNGO0lBQ0gsQ0FBQztJQUVELHFCQUFxQjtRQUNuQixPQUFPLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUMsQ0FBQztJQUVELFFBQVE7O1FBQ04sVUFBSSxJQUFJLENBQUMsSUFBSSwwQ0FBRSxNQUFNLEVBQUU7WUFDckIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLG1CQUFNLENBQUMsRUFBRyxDQUFDLENBQUM7U0FDckQ7UUFDRCx3QkFBd0I7YUFDbkIsVUFBSSxJQUFJLENBQUMsT0FBTywwQ0FBRSxNQUFNLEVBQUU7WUFDN0IsSUFBSSxTQUFTLEVBQUUsRUFBRTtnQkFDZixPQUFPLENBQUMsSUFBSSxDQUFDLHNFQUFzRSxDQUFDLENBQUM7YUFDdEY7WUFFRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsbUJBQU0sQ0FBQyxFQUFHLENBQUMsQ0FBQztTQUN4RDtRQUVELHdCQUF3QjtRQUN4QixVQUFJLElBQUksQ0FBQyxVQUFVLDBDQUFFLE1BQU0sRUFBRTtZQUMzQixJQUFJLFNBQVMsRUFBRSxFQUFFO2dCQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsNEVBQTRFLENBQUMsQ0FBQzthQUM1RjtZQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztTQUNoQztJQUNILENBQUM7SUFFRCxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbkIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLG1CQUFNLENBQUMsRUFBRyxDQUFDLENBQUM7U0FDckQ7UUFDRCx3QkFBd0I7YUFDbkIsSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLG1CQUFNLENBQUMsRUFBRyxDQUFDLENBQUM7U0FDeEQ7UUFDRCx3QkFBd0I7YUFDbkIsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDOUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1NBQ2hDO0lBQ0gsQ0FBQztJQUVELGtCQUFrQjtRQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNaLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtpQkFDcEIsUUFBUSxDQUFDLEVBQUUsQ0FBQztpQkFDWixTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDakI7SUFDSCxDQUFDO0lBRUQsZUFBZSxDQUFDLE1BQW9CO1FBQ2xDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxLQUFLLEVBQUU7WUFDekIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUNwRCxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUNyRixDQUFDO1NBQ0g7YUFBTSxJQUFJLE1BQU0sQ0FBQyxJQUFJLEtBQUssTUFBTSxFQUFFO1lBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FDcEQsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDckYsQ0FBQztTQUNIO1FBRUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7SUFDekIsQ0FBQztJQUVPLFVBQVUsQ0FBQyxNQUFvQjtRQUNyQyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUU7WUFDakIsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLElBQUksSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLEtBQUssRUFBRTtnQkFDakQsTUFBTSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7YUFDdEI7aUJBQU07Z0JBQ0wsTUFBTSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUM7YUFDckI7U0FDRjthQUFNO1lBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUU7Z0JBQ2hCLE1BQU0sQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO2FBQ3JCO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsa0JBQWtCLENBQUMsUUFBZ0I7O1FBQ2pDLFVBQUksSUFBSSxDQUFDLE9BQU8sMENBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxRQUFRLElBQUksR0FBRyxDQUFDLFFBQVEsS0FBSyxJQUFJLEdBQUc7WUFDOUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzVCLElBQUksTUFBTSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRTtvQkFDaEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDeEIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDN0IsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7aUJBQ3RCO3FCQUFNO29CQUNMLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO29CQUNuQixNQUFNLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztpQkFDdkI7WUFDSCxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVPLDZEQUE2RCxDQUFDLE9BQU87UUFDM0UsSUFBSSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXBDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNsRCxJQUFJLENBQUMsNkRBQTZELENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzNGO0lBQ0gsQ0FBQztJQUVPLHFCQUFxQixDQUFDLE9BQU87UUFDbkMsSUFBSSxPQUFPLENBQUMscUJBQXFCLEVBQUU7WUFDakMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixFQUFFLENBQUMsS0FBSyxDQUFDO1lBRXBELE9BQU8sQ0FBQyxZQUFZLENBQ2xCLE9BQU8sRUFDUDthQUNLLEtBQUs7aUJBQ0QsS0FBSztLQUNqQixDQUNFLENBQUM7U0FDSDtJQUNILENBQUM7SUFFTyxJQUFJO1FBQ1YsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRW5CLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUM7WUFDckcsTUFBTSxHQUFHLElBQUksQ0FBQztRQUVoQixPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0NBQ0YsQ0FBQTtBQTlMQztJQURDLEtBQUssRUFBRTtrREFDbUI7QUFHM0I7SUFEQyxLQUFLLEVBQUU7K0NBQ2dCO0FBR3hCO0lBREMsS0FBSyxFQUFFOytDQUNhO0FBR3JCO0lBREMsS0FBSyxFQUFFOzRDQUNVO0FBR2xCO0lBREMsS0FBSyxFQUFFOzBDQUNHO0FBR1g7SUFEQyxLQUFLLEVBQUU7a0RBQ1c7QUFHbkI7SUFEQyxLQUFLLEVBQUU7NkNBQ007QUFHZDtJQURDLEtBQUssRUFBRTttREFDWTtBQUdwQjtJQURDLE1BQU0sRUFBRTttREFDc0M7QUFHL0M7SUFEQyxTQUFTLENBQUMsZ0JBQWdCLENBQUM7c0RBQ0Q7QUFHM0I7SUFEQyxTQUFTLENBQUMsaUJBQWlCLENBQUM7dURBQ0Q7QUFTNUI7SUFEQyxZQUFZLENBQUMsZUFBZSxDQUFDOzhDQTJCN0I7QUFuRVUsY0FBYztJQUwxQixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsV0FBVztRQUNyQiwyc0NBQXFDOztLQUV0QyxDQUFDO0dBQ1csY0FBYyxDQWdNMUI7U0FoTVksY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBJbnB1dCxcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RMaXN0ZW5lcixcbiAgRWxlbWVudFJlZixcbiAgVmlld0NoaWxkLFxuICBpc0Rldk1vZGUsXG4gIE9uQ2hhbmdlcyxcbiAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIElUYWJsZUhlYWRlciB7XG4gIGZpZWxkOiBzdHJpbmc7XG4gIGhlYWRlck5hbWU/OiBzdHJpbmc7XG4gIHNvcnRlZD86IGJvb2xlYW47XG4gIHNvcnRhYmxlPzogYm9vbGVhbjtcbiAgc29ydD86ICdhc2MnIHwgJ2Rlc2MnO1xufVxuXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgSVRhYmxlUm93IHtcbiAgW2tleTogc3RyaW5nXTogc3RyaW5nIHwgc3RyaW5nW10gfCBudW1iZXI7XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Jtdy10YWJsZScsXG4gIHRlbXBsYXRlVXJsOiAnLi90YWJsZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RhYmxlLmNvbXBvbmVudC5sZXNzJ11cbn0pXG5leHBvcnQgY2xhc3MgVGFibGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgpXG4gIGNvbHVtbkRlZnM6IElUYWJsZUhlYWRlcltdO1xuXG4gIEBJbnB1dCgpXG4gIGNvbHVtbnM6IElUYWJsZUhlYWRlcltdO1xuXG4gIEBJbnB1dCgpXG4gIHJvd0RhdGE6IElUYWJsZVJvd1tdO1xuXG4gIEBJbnB1dCgpXG4gIGRhdGE6IElUYWJsZVJvd1tdO1xuXG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQElucHV0KClcbiAgaGlkZUhlYWRlciA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIHplYnJhID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgc3RpY2tIZWFkZXIgPSBmYWxzZTtcblxuICBAT3V0cHV0KClcbiAgdGFibGVTb3J0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPElUYWJsZUhlYWRlcj4oKTtcblxuICBAVmlld0NoaWxkKCd0YWJsZUNvbnRhaW5lcicpXG4gIHRhYmxlQ29udGFpbmVyOiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGQoJ2hlYWRlckNvbnRhaW5lcicpXG4gIGhlYWRlckNvbnRhaW5lcjogRWxlbWVudFJlZjtcblxuICBwdWJsaWMgaXNMb2FkaW5nID0gZmFsc2U7XG5cbiAgcHVibGljIHJvd3NBZnRlclNvcnQ6IElUYWJsZVJvd1tdO1xuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6c2Nyb2xsJylcbiAgb25TY3JvbGwoKSB7XG4gICAgaWYgKHRoaXMuc3RpY2tIZWFkZXIpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5oZWFkZXJDb250YWluZXIubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgPD0gMCAmJlxuICAgICAgICB0aGlzLnRhYmxlQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuYm90dG9tID4gMCAmJlxuICAgICAgICB0aGlzLnRhYmxlQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIDwgMFxuICAgICAgKSB7XG4gICAgICAgIGlmICh0aGlzLmlzSUUoKSkge1xuICAgICAgICAgIHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZml4ZWQnKTtcbiAgICAgICAgICB0aGlzLmhlYWRlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LnNldEF0dHJpYnV0ZShcbiAgICAgICAgICAgICdzdHlsZScsXG4gICAgICAgICAgICBgXG4gICAgICAgICAgICAgIGxlZnQ6IC0ke3dpbmRvdy5wYWdlWE9mZnNldH1weDtcbiAgICAgICAgICAgIGBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5pc0lFKCkpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2ZpeGVkJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNJRSgpKSB7XG4gICAgICAgIHRoaXMuc2V0RWxlbWVudHNXaWR0aFJlY3Vyc2l2ZWx5QmVjYXVzZUhUTUxUYWJsZXNBcmVIYXJkVG9EZWFsV2l0aCh0aGlzLnRhYmxlQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNob3VsZEhhdmVTdGlja0hlYWRlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdGlja0hlYWRlciAmJiAhdGhpcy5pc0lFKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kYXRhPy5sZW5ndGgpIHtcbiAgICAgIHRoaXMucm93c0FmdGVyU29ydCA9IHRoaXMuZGF0YS5tYXAoaSA9PiAoeyAuLi5pIH0pKTtcbiAgICB9XG4gICAgLy8ga2VlcCB0aGUgbGVnYWN5IGlucHV0XG4gICAgZWxzZSBpZiAodGhpcy5yb3dEYXRhPy5sZW5ndGgpIHtcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJzxibXctdGFibGU+IGByb3dEYXRhYCBpbnB1dCBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIGBkYXRhYCBpbnN0ZWFkJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucm93c0FmdGVyU29ydCA9IHRoaXMucm93RGF0YS5tYXAoaSA9PiAoeyAuLi5pIH0pKTtcbiAgICB9XG5cbiAgICAvLyBrZWVwIHRoZSBsZWdhY3kgaW5wdXRcbiAgICBpZiAodGhpcy5jb2x1bW5EZWZzPy5sZW5ndGgpIHtcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJzxibXctdGFibGU+IGBjb2x1bW5EZWZzYCBpbnB1dCBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIGBjb2x1bW5zYCBpbnN0ZWFkJyk7XG4gICAgICB9XG4gICAgICB0aGlzLmNvbHVtbnMgPSB0aGlzLmNvbHVtbkRlZnM7XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzWydkYXRhJ10pIHtcbiAgICAgIHRoaXMucm93c0FmdGVyU29ydCA9IHRoaXMuZGF0YS5tYXAoaSA9PiAoeyAuLi5pIH0pKTtcbiAgICB9XG4gICAgLy8ga2VlcCB0aGUgbGVnYWN5IGlucHV0XG4gICAgZWxzZSBpZiAoY2hhbmdlc1sncm93RGF0YSddKSB7XG4gICAgICB0aGlzLnJvd3NBZnRlclNvcnQgPSB0aGlzLnJvd0RhdGEubWFwKGkgPT4gKHsgLi4uaSB9KSk7XG4gICAgfVxuICAgIC8vIGtlZXAgdGhlIGxlZ2FjeSBpbnB1dFxuICAgIGVsc2UgaWYgKGNoYW5nZXNbJ2NvbHVtbkRlZnMnXSkge1xuICAgICAgdGhpcy5jb2x1bW5zID0gdGhpcy5jb2x1bW5EZWZzO1xuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpXG4gICAgICAgIC50b1N0cmluZygzNilcbiAgICAgICAgLnN1YnN0cmluZygyKTtcbiAgICB9XG4gIH1cblxuICBhcHBseVNvcnRUb1Jvd3MoaGVhZGVyOiBJVGFibGVIZWFkZXIpOiB2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgaWYgKGhlYWRlci5zb3J0ID09PSAnYXNjJykge1xuICAgICAgdGhpcy5yb3dzQWZ0ZXJTb3J0ID0gdGhpcy5yb3dzQWZ0ZXJTb3J0LnNvcnQoKGEsIGIpID0+XG4gICAgICAgIGFbaGVhZGVyLmZpZWxkXSA+IGJbaGVhZGVyLmZpZWxkXSA/IDEgOiBhW2hlYWRlci5maWVsZF0gPT09IGJbaGVhZGVyLmZpZWxkXSA/IDAgOiAtMVxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKGhlYWRlci5zb3J0ID09PSAnZGVzYycpIHtcbiAgICAgIHRoaXMucm93c0FmdGVyU29ydCA9IHRoaXMucm93c0FmdGVyU29ydC5zb3J0KChhLCBiKSA9PlxuICAgICAgICBhW2hlYWRlci5maWVsZF0gPCBiW2hlYWRlci5maWVsZF0gPyAxIDogYVtoZWFkZXIuZmllbGRdID09PSBiW2hlYWRlci5maWVsZF0gPyAwIDogLTFcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy50YWJsZVNvcnRlZC5lbWl0KGhlYWRlcik7XG4gICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgdG9nZ2xlU29ydChoZWFkZXI6IElUYWJsZUhlYWRlcikge1xuICAgIGlmIChoZWFkZXIuc29ydGVkKSB7XG4gICAgICBpZiAoaGVhZGVyLnNvcnQgPT09IG51bGwgfHwgaGVhZGVyLnNvcnQgPT09ICdhc2MnKSB7XG4gICAgICAgIGhlYWRlci5zb3J0ID0gJ2Rlc2MnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGVhZGVyLnNvcnQgPSAnYXNjJztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFoZWFkZXIuc29ydCkge1xuICAgICAgICBoZWFkZXIuc29ydCA9ICdhc2MnO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNvcnRSb3dzQnlQcm9wZXJ0eShwcm9wZXJ0eTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29sdW1ucz8uc29tZShjb2wgPT4gY29sLmZpZWxkID09PSBwcm9wZXJ0eSAmJiBjb2wuc29ydGFibGUgPT09IHRydWUpKSB7XG4gICAgICB0aGlzLmNvbHVtbnMuZm9yRWFjaChoZWFkZXIgPT4ge1xuICAgICAgICBpZiAoaGVhZGVyLnNvcnRhYmxlICYmIGhlYWRlci5maWVsZCA9PT0gcHJvcGVydHkpIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZVNvcnQoaGVhZGVyKTtcbiAgICAgICAgICB0aGlzLmFwcGx5U29ydFRvUm93cyhoZWFkZXIpO1xuICAgICAgICAgIGhlYWRlci5zb3J0ZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhlYWRlci5zb3J0ID0gbnVsbDtcbiAgICAgICAgICBoZWFkZXIuc29ydGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0RWxlbWVudHNXaWR0aFJlY3Vyc2l2ZWx5QmVjYXVzZUhUTUxUYWJsZXNBcmVIYXJkVG9EZWFsV2l0aChlbGVtZW50KSB7XG4gICAgdGhpcy5zZXRFbGVtZW50SW5saW5lV2lkdGgoZWxlbWVudCk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5zZXRFbGVtZW50c1dpZHRoUmVjdXJzaXZlbHlCZWNhdXNlSFRNTFRhYmxlc0FyZUhhcmRUb0RlYWxXaXRoKGVsZW1lbnQuY2hpbGROb2Rlc1tpXSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRFbGVtZW50SW5saW5lV2lkdGgoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCkge1xuICAgICAgY29uc3Qgd2lkdGggPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuXG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShcbiAgICAgICAgJ3N0eWxlJyxcbiAgICAgICAgYFxuICAgIHdpZHRoOiAke3dpZHRofXB4ICFpbXBvcnRhbnQ7XG4gICAgbWF4LXdpZHRoOiAke3dpZHRofXB4ICFpbXBvcnRhbnQ7XG4gICAgYFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGlzSUUoKTogYm9vbGVhbiB7XG4gICAgbGV0IHJlc3VsdCA9IGZhbHNlO1xuXG4gICAgaWYgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUgJykgPiAwIHx8ICEhbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvVHJpZGVudC4qcnZcXDoxMVxcLi8pKVxuICAgICAgcmVzdWx0ID0gdHJ1ZTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn1cbiJdfQ==