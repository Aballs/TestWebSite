import { __decorate, __param } from "tslib";
import { AfterContentInit, Component, ContentChildren, ContentChild, ElementRef, EventEmitter, HostBinding, HostListener, Input, OnChanges, OnDestroy, OnInit, Output, QueryList, ViewChild, AfterViewInit, Self, Optional, ChangeDetectorRef, SimpleChanges } from '@angular/core';
import { ComboBoxDropdownItemComponent } from './combo-box-dropdown-item.component';
import { ComboBoxInputComponent } from './combo-box-input.component';
import { LabelComponent } from '../label/label.component';
import { ControlValueAccessor, NgControl } from '@angular/forms';
import { fromEvent, merge, Subject } from 'rxjs';
import { map, takeUntil } from 'rxjs/operators';
let ComboBoxComponent = class ComboBoxComponent {
    constructor(control, elementRef, cdRef) {
        this.control = control;
        this.elementRef = elementRef;
        this.cdRef = cdRef;
        this.noResultsPlaceholder = 'No results found';
        this.disabled = false;
        this.tabIndex = 0;
        this.required = false;
        this.clearable = true;
        this.hostTabIndex = '-1';
        this.filteredItems = [];
        this._items = [];
        this.selectedItems = [];
        this.opened = false;
        this.showInvalidState = false;
        this.comboFocused = false;
        this._type = "SINGLE" /* SINGLE */;
        this._inputFocused = false;
        this._isTouched = false;
        this.multiComboBoxText = 'Selected';
        this.scrollOffset = 0;
        this.onDestroy$ = new Subject();
        this.changeEvent = new EventEmitter();
        this.open = new EventEmitter();
        /**
         * Text to be used in multi combo boxes that use text instead of tags.
         * It can be a string or a callback function that takes the array of selected items and returns the text in a custom format.
         * In case of providing a string, it replaces the text of the default format: 'Selected (0)'.
         */
        this.selectedOptionsText = items => 'Selected (' + items.length + ')';
        this._onChange = () => { };
        this._onTouched = () => { };
        this._defaultFilter = (searchQuery, allComboBoxItems) => allComboBoxItems.filter(({ label }) => (label === null || label === void 0 ? void 0 : label.toString().toLocaleLowerCase().includes(this.input.value.toLocaleLowerCase())) ? true
            : false);
        if (this.control)
            this.control.valueAccessor = this;
    }
    get value() {
        return this._value;
    }
    set value(newValue) {
        this.changeValue(newValue, { emitEvent: true });
    }
    get useMulti() {
        return this._type === "MULTI" /* MULTI */;
    }
    set type(comboBoxType) {
        // coerce inputType
        if (this._type !== comboBoxType) {
            this._type = comboBoxType;
        }
    }
    onKeydown(event) {
        const key = event.code || event.keyCode;
        switch (key) {
            case 'ArrowDown':
            case 40:
                if (this.opened) {
                    this.setNextItemAsFocused();
                    this.cdRef.detectChanges();
                    this.showInvalidState = false;
                }
                else {
                    this.toggle();
                }
                event.preventDefault();
                break;
            case 'ArrowUp':
            case 38:
                if (this.opened) {
                    this.setPreviousItemAsFocused();
                    this.cdRef.detectChanges();
                    this.showInvalidState = false;
                }
                else {
                    this.toggle();
                }
                event.preventDefault();
                break;
            case 'Backspace':
            case 8:
            case 'Delete':
            case 46:
                if (this.useMulti && this.selectedItems.length > 0 && !this.comboFocused) {
                    const focusedTag = this.selectedItems.find(item => item.focused === true);
                    if (focusedTag) {
                        this.toggleMultiModeItem(focusedTag);
                        this.inputBox.nativeElement.querySelector('input').focus();
                    }
                }
                break;
            case 'Enter':
            case 'NumpadEnter':
            case 13:
                if (event.target === this.inputBox.nativeElement.querySelector('.clear.iwp-icon-gen_close')) {
                    this.clear();
                }
                else if (this.opened && this.filteredItems.length > 0) {
                    const isOnlyItemLeft = this.filteredItems.length === 1;
                    let itemToSelect;
                    if (isOnlyItemLeft) {
                        itemToSelect = this.filteredItems[0];
                    }
                    else {
                        itemToSelect = this.filteredItems.find(item => item.focused === true);
                    }
                    if (itemToSelect && !itemToSelect.disabled) {
                        if (!this.useMulti) {
                            this.selectItem(this.items.find(item => item.value === itemToSelect.value));
                            this.resetFocusedItem();
                            this.inputBox.nativeElement.querySelector('input').blur();
                        }
                        else {
                            this.toggleMultiModeItem(itemToSelect, { removeFocusAfterSelection: false });
                            if (isOnlyItemLeft) {
                                this.input.value = '';
                                this.cleanFilter();
                            }
                        }
                    }
                }
                event.stopPropagation();
                event.preventDefault();
                break;
            case 'Space':
            case 32:
                if (!this.opened || !this.input.value) {
                    this.toggle();
                    event.returnValue = false;
                    this.inputBox.nativeElement.querySelector('input').focus();
                }
                break;
            case 'Escape':
            case 27:
            case 'Tab':
            case 9:
                if (this.opened) {
                    this.toggle(false);
                }
                this.updateViewInputAfterDropdownClosed();
                if (!this.filteredItems.find(item => item.focused === true)) {
                    this.comboFocused = false;
                }
                break;
        }
    }
    onFocusout({ target }) {
        if (target === this.inputBox.nativeElement.querySelector('input') && !this.opened) {
            this.updateViewInputAfterDropdownClosed();
        }
    }
    ngOnInit() {
        var _a;
        this._listenToInputFocus();
        (_a = this.control) === null || _a === void 0 ? void 0 : _a.valueChanges.pipe(takeUntil(this.onDestroy$)).subscribe(e => {
            this._validate();
        });
        this.elementRef.nativeElement.focus = () => {
            this.focusInput();
            this.toggle(true);
        };
        this.updateMultiComboBoxText();
    }
    ngAfterContentInit() {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
        this.filter();
        this._validate();
        this.items.changes.pipe(takeUntil(this.onDestroy$)).subscribe(() => {
            this.mapItems();
            this.updateViewInput();
            this.cleanFilter();
        });
        this.refreshItemsState();
        if (this._label) {
            this._label.inputId = this.id;
        }
        this._setGridClasses();
    }
    ngAfterViewInit() {
        if (this._value) {
            // Initial value was set, update selected items
            this.updateViewInput();
            this.cleanFilter();
            this.cdRef.detectChanges();
        }
    }
    mapItems() {
        this._items = this.items.map(item => {
            return {
                value: item.value,
                label: item.label,
                disabled: item.disabled,
                focused: item.focused,
                selected: item.selected,
                id: item.id
            };
        });
    }
    ngOnChanges(changes) {
        if (changes.selectedOptionsText) {
            this.updateMultiComboBoxText();
        }
        this.filter();
        this._validate();
    }
    ngOnDestroy() {
        this.cdRef.detach();
        this.onDestroy$.next();
        this.onDestroy$.complete();
    }
    focusTag(selectedItem) {
        selectedItem.focused = true;
    }
    focusoutTag(selectedItem) {
        selectedItem.focused = false;
    }
    selectTag(selectedItem) {
        if (selectedItem) {
            // remove selection from all tags
            this.selectedItems = this.selectedItems.map(item => {
                item.focused = false;
                return item;
            });
            this.updateMultiComboBoxText();
        }
    }
    toggle(state) {
        if (!this.disabled) {
            const initialOpenedState = this.opened;
            if (typeof state !== 'undefined') {
                this.opened = state;
            }
            else {
                this.opened = !this.opened;
            }
            if (this.opened !== initialOpenedState) {
                if (this.opened) {
                    this.outsideCallback = this.onClickOutside.bind(this);
                    document.addEventListener('mouseup', this.outsideCallback);
                    document.addEventListener('touchend', this.outsideCallback);
                    this.inputBox.nativeElement.querySelector('input').focus();
                    this.open.emit();
                }
                else {
                    this.resetFocusedItem();
                    document.removeEventListener('mouseup', this.outsideCallback);
                    document.removeEventListener('touchend', this.outsideCallback);
                    this.comboFocused = this._inputFocused;
                }
            }
        }
    }
    onClickOutside({ target }) {
        var _a;
        if (!this.elementRef.nativeElement.querySelector('.combo-box-container').contains(target) &&
            !((_a = target.shadowRoot) === null || _a === void 0 ? void 0 : _a.querySelector('bmw-combo-box'))) {
            this.toggle(false);
            this.updateViewInputAfterDropdownClosed();
        }
    }
    refreshItemsState() {
        this.mapItems();
        this.filteredItems = [...this._items];
    }
    resetFocusedItem() {
        this.filteredItems.forEach(item => (item.focused = false));
    }
    setPreviousItemAsFocused() {
        if (this.opened && this.filteredItems.length > 0 && this.filteredItems.some(item => !item.disabled)) {
            let focusedItemIndex = this.filteredItems.findIndex(item => item.focused === true);
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== 0) {
                focusedItemIndex = focusedItemIndex - 1;
            }
            else {
                focusedItemIndex = this.filteredItems.length - 1;
            }
            this.filteredItems[focusedItemIndex].focused = true;
            if (this.filteredItems[focusedItemIndex].disabled) {
                this.setPreviousItemAsFocused();
            }
        }
    }
    setNextItemAsFocused() {
        if (this.opened && this.filteredItems.length > 0 && this.filteredItems.filter(item => !item.disabled).length > 0) {
            let focusedItemIndex = this.filteredItems.findIndex(item => item.focused === true);
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== this.filteredItems.length - 1) {
                focusedItemIndex = focusedItemIndex + 1;
            }
            else {
                focusedItemIndex = 0;
            }
            this.filteredItems[focusedItemIndex].focused = true;
            if (this.filteredItems[focusedItemIndex].disabled) {
                this.setNextItemAsFocused();
            }
        }
    }
    toggleMultiModeItem(item, options) {
        item.selected = !item.selected;
        this.updateSelectedItems(item);
        if (!options || options.removeFocusAfterSelection) {
            const currentlyFocusedIndex = this.filteredItems.findIndex(searchedItem => !!searchedItem.focused);
            if (currentlyFocusedIndex > 0) {
                this.filteredItems[currentlyFocusedIndex].focused = false;
            }
        }
        const itemInDropdownList = this.filteredItems.find(dropdownItem => dropdownItem.value === item.value);
        itemInDropdownList.selected = item.selected;
        this.findFocusedTag();
        this.emitSelectedItemsChange();
        this._validate();
    }
    updateSelectedItems(item) {
        if (item.selected) {
            this.selectedItems.push(item);
        }
        else {
            this.selectedItems = this.selectedItems.filter(function (element) {
                return element.value !== item.value;
            });
        }
        this.updateMultiComboBoxText();
    }
    updateViewInput() {
        var _a;
        if (Array.isArray(this._value) || this.useMulti) {
            this._items = this._items.map(item => {
                var _a;
                item.selected = (_a = this._value) === null || _a === void 0 ? void 0 : _a.includes(item.value);
                return item;
            });
            this.selectedItems = this._items.filter(item => item.selected);
            this.updateMultiComboBoxText();
        }
        else {
            if (this._value === null) {
                this.resetDropdownItems();
            }
            const selectedItem = this.findItemByValue(this._value);
            if (this.input) {
                this.input.value = (_a = selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.label) !== null && _a !== void 0 ? _a : '';
            }
        }
    }
    updateMultiComboBoxText() {
        if (this.useMulti) {
            if (typeof this.selectedOptionsText === 'function') {
                this.multiComboBoxText = this.selectedOptionsText(this.selectedItems);
            }
            else {
                this.multiComboBoxText = this.selectedOptionsText + ' (' + this.selectedItems.length + ')';
            }
        }
    }
    focusFirstFilteredItem() {
        if (this.input && this.opened && this.filteredItems.length > 0 && this.filteredItems.some(item => !item.disabled)) {
            const enabledItems = this.filteredItems.filter(item => !item.disabled);
            enabledItems[0].focused = true;
            this.cdRef.detectChanges();
            this.inputBox.nativeElement.querySelector('input').focus();
            this.showInvalidState = false;
        }
    }
    updateViewInputAfterDropdownClosed() {
        this.resetFocusedItem();
        if (!this.useMulti && this._value) {
            this.updateViewInput();
        }
        else {
            this.input.value = '';
        }
        this.cleanFilter();
        this._validate();
    }
    resetDropdownItems() {
        this.filteredItems = [...this._items];
        this.selectedItems = [];
        this.updateMultiComboBoxText();
        this._items = this._items.map(item => {
            item.selected = false;
            return item;
        });
    }
    emitSelectedItemsChange() {
        const _selectedItems = this._items.filter(item => item.selected).map(item => item.value);
        this.value = _selectedItems;
        this.changeEvent.emit(_selectedItems);
        this._onChange(_selectedItems);
        this._onTouched();
    }
    filter() {
        var _a, _b, _c;
        this.resetFocusedItem();
        if (!this._items) {
            this.filteredItems = [];
            return;
        }
        const filter = (_a = this.customFilter) !== null && _a !== void 0 ? _a : this._defaultFilter;
        this.filteredItems = filter((_c = (_b = this.input) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.toString(), this._items);
    }
    filterAndOpenDropdown() {
        this.filter();
        this.toggle(true);
        this.focusFirstFilteredItem();
    }
    cleanFilter() {
        if (!this._items) {
            this.filteredItems = [];
        }
        else {
            this.filteredItems = this._items;
        }
    }
    selectItem(item) {
        if (this.useMulti) {
            this.toggleMultiModeItem(item);
        }
        else {
            this.value = item.value;
            this.filteredItems = [...this._items];
            this.toggle(false);
            this.changeEvent.emit(item.value);
            this._onTouched();
            this._validate();
        }
    }
    findItemByValue(value) {
        if (!this.items)
            return null;
        return this.items.filter(item => {
            return item.value === value || JSON.stringify(item.value) === JSON.stringify(value);
        })[0];
    }
    clear() {
        this._value = null;
        this.input.value = null;
        this.changeEvent.emit(null);
        this._onChange(null);
        this._onTouched();
        this._validate();
    }
    isFormReset() {
        let reset = false;
        if (this.control) {
            const { pristine } = this.control;
            reset = this._value === null && pristine !== false;
        }
        return reset;
    }
    registerOnChange(fn) {
        this._onChange = fn;
    }
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    writeValue(value) {
        this.changeValue(value, { emitEvent: false });
    }
    setDisabledState(disabled) {
        this.disabled = disabled;
    }
    changeValue(newValue, options) {
        this._value = newValue;
        this.updateViewInput();
        if (Array.isArray(newValue)) {
            this.findFocusedTag();
        }
        if (options.emitEvent && !this.isFormReset()) {
            this._onChange(newValue);
        }
        this._validate();
    }
    _validate() {
        if (this.control) {
            const { touched, invalid } = this.control;
            this.showInvalidState = invalid && touched;
        }
        else {
            if (this.useMulti) {
                this.showInvalidState =
                    this._isTouched && this.required === true && this._items.filter(item => item.selected).length === 0;
            }
            else {
                this.showInvalidState = this._isTouched && this.required === true && !this._value;
            }
        }
    }
    _listenToInputFocus() {
        if (!this.inputBox)
            return;
        const inputElement = this.inputBox.nativeElement.querySelector('input');
        const focusEvent = fromEvent(inputElement, 'focus').pipe(map(() => 'focus'));
        const blurEvent = fromEvent(inputElement, 'blur').pipe(map(() => 'blur'));
        merge(focusEvent, blurEvent)
            .pipe(takeUntil(this.onDestroy$), map(eventName => (eventName === 'focus' ? true : false)))
            .subscribe(inputFocus => {
            this.comboFocused = inputFocus;
        });
    }
    focusInput() {
        if (!this.disabled) {
            this._inputFocused = true;
            this.comboFocused = true;
        }
    }
    focusoutInput() {
        this._inputFocused = false;
        this.comboFocused = this.opened;
    }
    _setGridClasses() {
        const listOfClasses = Array.from(this.elementRef.nativeElement.classList);
        this.gridClasses = listOfClasses.filter((item) => item.match(/bmw__grid__cell.*/));
        if (this.gridClasses.length > 0) {
            const wrapperClassList = this.elementRef.nativeElement.querySelector('div.combo-box-container').classList;
            wrapperClassList.value.split(' ').forEach((className) => {
                if (className.match(/bmw__grid__cell.*/)) {
                    wrapperClassList.remove(className);
                }
            });
            this.gridClasses.forEach((className) => {
                this.elementRef.nativeElement.querySelector('div.combo-box-container').classList.add(className);
                this.elementRef.nativeElement.classList.remove(className);
            });
        }
    }
    findFocusedTag() {
        setTimeout(() => {
            const focused = this.elementRef.nativeElement.querySelector('bmw-tag div.focused');
            if (!focused) {
                this.scrollOffset = 0;
                return;
            }
            const diff = focused.parentElement.getBoundingClientRect().x -
                focused.parentElement.parentElement.parentElement.getBoundingClientRect().x -
                this.scrollOffset;
            if (diff < 0) {
                this.scrollOffset = -diff;
            }
            else {
                this.scrollOffset = 0;
            }
        });
    }
    click() {
        this.toggle();
    }
    inputTouched() {
        this._isTouched = true;
        this._onTouched();
    }
};
ComboBoxComponent.ctorParameters = () => [
    { type: NgControl, decorators: [{ type: Self }, { type: Optional }] },
    { type: ElementRef },
    { type: ChangeDetectorRef }
];
__decorate([
    Input()
], ComboBoxComponent.prototype, "placeholder", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "noResultsPlaceholder", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "disabled", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "tabIndex", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "required", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "clearable", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "customFilter", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "textInsteadOfTags", void 0);
__decorate([
    HostBinding('attr.id'),
    Input()
], ComboBoxComponent.prototype, "id", void 0);
__decorate([
    HostBinding('attr.tabindex')
], ComboBoxComponent.prototype, "hostTabIndex", void 0);
__decorate([
    ContentChildren(ComboBoxDropdownItemComponent)
], ComboBoxComponent.prototype, "items", void 0);
__decorate([
    ContentChild(LabelComponent, { static: true })
], ComboBoxComponent.prototype, "_label", void 0);
__decorate([
    ViewChild(ComboBoxInputComponent)
], ComboBoxComponent.prototype, "input", void 0);
__decorate([
    ViewChild('inputBox')
], ComboBoxComponent.prototype, "inputBox", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "value", null);
__decorate([
    Input()
], ComboBoxComponent.prototype, "type", null);
__decorate([
    Output()
], ComboBoxComponent.prototype, "changeEvent", void 0);
__decorate([
    Output()
], ComboBoxComponent.prototype, "open", void 0);
__decorate([
    Input()
], ComboBoxComponent.prototype, "selectedOptionsText", void 0);
__decorate([
    HostListener('keydown', ['$event'])
], ComboBoxComponent.prototype, "onKeydown", null);
__decorate([
    HostListener('focusout', ['$event'])
], ComboBoxComponent.prototype, "onFocusout", null);
ComboBoxComponent = __decorate([
    Component({
        selector: 'bmw-combo-box',
        template: "<div\n  class=\"combo-box-wrapper bmw__margin-bottom__xs\"\n  [ngClass]=\"{ bmw__grid__inner: gridClasses?.length }\"\n  [class.disabled]=\"disabled\"\n  [attr.aria-disabled]=\"disabled\"\n>\n  <ng-content select=\"bmw-label\"></ng-content>\n  <div class=\"combo-box-container\">\n    <div\n      class=\"combo-box\"\n      [class.disabled]=\"disabled\"\n      [class.invalid]=\"showInvalidState\"\n      [class.focused]=\"comboFocused\"\n    >\n      <div\n        class=\"select bmw-component-text outer-container\"\n        [class.open]=\"opened\"\n        [class.multi-combo-box]=\"useMulti\"\n        (click)=\"click()\"\n        #inputBox\n      >\n        <div class=\"combo-box-outer-wrapper inner-container\">\n          <div class=\"combo-box-inner-wrapper moving-container\">\n            <div\n              *ngIf=\"useMulti\"\n              class=\"multi-combo-box-tags\"\n              [ngClass]=\"{ 'multi-combo-box-tags--hidden': textInsteadOfTags }\"\n              [ngStyle]=\"{ left: scrollOffset.toString() + 'px' }\"\n            >\n              <ng-container *ngFor=\"let item of selectedItems\">\n                <bmw-tag\n                  *ngIf=\"item.selected\"\n                  [focused]=\"item.focused\"\n                  [label]=\"item.label\"\n                  [disabled]=\"item.disabled\"\n                  (click)=\"selectTag(item)\"\n                  (removeEvent)=\"toggleMultiModeItem(item)\"\n                  (focus)=\"focusTag(item)\"\n                  (focusout)=\"focusoutTag(item)\"\n                  [tabindex]=\"disabled ? -1 : tabIndex\"\n                ></bmw-tag>\n              </ng-container>\n            </div>\n            <div class=\"multi-combo-box-text-container\">\n              <span\n                *ngIf=\"useMulti\"\n                class=\"bmw-component-text multi-combo-box-text\"\n                [ngClass]=\"{ 'multi-combo-box-text--show': textInsteadOfTags }\"\n                [title]=\"multiComboBoxText\"\n              >\n                {{ multiComboBoxText }}\n              </span>\n            </div>\n            <input\n              [id]=\"'input-in-' + id\"\n              bmwComboBoxInput\n              [placeholder]=\"selectedItems.length === 0 ? placeholder || '' : ''\"\n              (inputEvent)=\"filterAndOpenDropdown()\"\n              [class.filled]=\"value\"\n              [class.invalid]=\"showInvalidState\"\n              [attr.aria-label]=\"'input-for-' + id\"\n              (focus)=\"focusInput()\"\n              (focusout)=\"focusoutInput()\"\n              (blur)=\"inputTouched()\"\n              [disabled]=\"disabled\"\n              [tabindex]=\"disabled ? -1 : tabIndex\"\n              [required]=\"required\"\n            />\n            <i\n              *ngIf=\"!useMulti && value && clearable\"\n              class=\"clear iwp-icon-gen_close\"\n              (click)=\"clear()\"\n              [tabindex]=\"disabled ? -1 : tabIndex\"\n            ></i>\n          </div>\n        </div>\n        <i class=\"arrow\" [class.iwp-icon-gen_arrow_down]=\"!opened\" [class.iwp-icon-gen_arrow_up]=\"opened\"></i>\n      </div>\n      <div [class.open]=\"opened\" class=\"dropdown-menu\">\n        <ng-container *ngIf=\"!useMulti\">\n          <bmw-combo-box-dropdown-item\n            *ngFor=\"let item of filteredItems\"\n            [value]=\"item.value\"\n            [label]=\"item.label\"\n            [disabled]=\"item.disabled\"\n            [focused]=\"item.focused\"\n            [id]=\"item.id\"\n            [selected]=\"item.value === value\"\n            (clickEvent)=\"selectItem(item)\"\n          >\n          </bmw-combo-box-dropdown-item>\n        </ng-container>\n        <ng-container *ngIf=\"useMulti\">\n          <bmw-combo-box-dropdown-checkbox-item\n            *ngFor=\"let item of filteredItems\"\n            [value]=\"item.value\"\n            [label]=\"item.label\"\n            [disabled]=\"item.disabled\"\n            [focused]=\"item.focused\"\n            [id]=\"item.id\"\n            [selected]=\"item.selected\"\n            (selectedChange)=\"toggleMultiModeItem(item)\"\n          >\n          </bmw-combo-box-dropdown-checkbox-item>\n        </ng-container>\n        <ng-container *ngIf=\"filteredItems.length === 0\">\n          <bmw-combo-box-dropdown-item [value]=\"noResultsPlaceholder\" [label]=\"noResultsPlaceholder\" [disabled]=\"true\">\n          </bmw-combo-box-dropdown-item>\n        </ng-container>\n      </div>\n    </div>\n    <ng-content select=\"bmw-error-message\"></ng-content>\n  </div>\n</div>\n",
        styles: [".combo-box{position:relative;cursor:pointer}input{height:var(--inputfield__default__height);text-overflow:ellipsis}.label{color:var(--combo-box__label__color)}.arrow{position:absolute;top:0;right:0;padding:var(--combo-box__default__padding);padding-bottom:0;padding-top:0;line-height:var(--inputfield__default__height);z-index:var(--combo-box__arrow__z-index)}.arrow:focus{outline:0}.clear{position:absolute;top:0;right:calc(var(--typography__component-text__font-size) + 2 * var(--combo-box__default__padding));padding:var(--combo-box__default__padding);padding-bottom:0;padding-top:0;line-height:var(--inputfield__default__height)}.clear:focus{outline:0}.clear:focus:before{outline:solid 1px;outline-color:var(--color-bmw-highlight)}bmw-tag{margin-right:var(--combo-box__tag__margin-right)}bmw-tag:focus{outline:0}.combo-box-wrapper,.label{grid-row-gap:0}.combo-box-wrapper.disabled,.label.disabled{pointer-events:none}.combo-box-wrapper.disabled .combo-box-select,.combo-box-wrapper.disabled .multi-combo-box,.label.disabled .combo-box-select,.label.disabled .multi-combo-box{border-bottom-color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled ::ng-deep label,.label.disabled ::ng-deep label{cursor:no-drop;color:var(--inputfield__disabled__color)}.combo-box-wrapper.disabled input,.label.disabled input{color:var(--combo-box__disabled__color);border-bottom-color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled input::-moz-placeholder,.label.disabled input::-moz-placeholder{color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled input:-ms-input-placeholder,.label.disabled input:-ms-input-placeholder{color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled input::placeholder,.label.disabled input::placeholder{color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled .arrow,.combo-box-wrapper.disabled .clear,.label.disabled .arrow,.label.disabled .clear{color:var(--combo-box__disabled__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused){background-color:var(--combo-box__error__background-color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) .combo-box-select,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) .multi-combo-box{border-bottom-color:var(--combo-box__error__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label{border-bottom-color:var(--combo-box__error__color);background-color:transparent}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input::-moz-placeholder,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label::-moz-placeholder{color:var(--combo-box__placeholder__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input:-ms-input-placeholder,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label:-ms-input-placeholder{color:var(--combo-box__placeholder__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input::placeholder,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label::placeholder{color:var(--combo-box__placeholder__color)}:host:focus{outline:0}.combo-box.invalid:not(.disabled){background-color:var(--combo-box__error__background-color)!important}.combo-box.invalid:not(.disabled) .combo-box-select,.combo-box.invalid:not(.disabled) .multi-combo-box{border-bottom-color:var(--combo-box__error__color)}.combo-box.invalid:not(.disabled) input,.combo-box.invalid:not(.disabled) label{border-bottom-color:var(--combo-box__error__color);background-color:transparent!important}.combo-box.invalid:not(.disabled) input::-moz-placeholder,.combo-box.invalid:not(.disabled) label::-moz-placeholder{color:var(--combo-box__placeholder__color)}.combo-box.invalid:not(.disabled) input:-ms-input-placeholder,.combo-box.invalid:not(.disabled) label:-ms-input-placeholder{color:var(--combo-box__placeholder__color)}.combo-box.invalid:not(.disabled) input::placeholder,.combo-box.invalid:not(.disabled) label::placeholder{color:var(--combo-box__placeholder__color)}.combo-box.focused{outline:solid 1px!important;outline-color:var(--combo-box__inputfield__focused__outline-color)!important;outline-offset:-1px}div.dropdown-menu{display:none;position:absolute;z-index:var(--combo-box__popup__z-index);overflow-y:auto;width:calc(100% - 2px);max-height:calc(5.66 * (var(--dropdown__default__line-height) + 2 * var(--combo-box__default__padding)));border:solid 1px var(--combo-box__dropdown-menu__border-color);border-top:none}div.dropdown-menu.open{display:block}.combo-box-wrapper.disabled{cursor:no-drop}.combo-box,.combo-box input{background-color:var(--combo-box__default__background-color)}::ng-deep .reversed .combo-box{background-color:var(--combo-box__reversed__background-color)!important}::ng-deep .reversed .combo-box input{background-color:var(--combo-box__reversed__background-color)!important}.multi-combo-box{display:flex;border-bottom:1px solid var(--combo-box__inputfield__default__border-bottom-color)}.multi-combo-box input{border:none}.multi-combo-box .combo-box-wrapper{display:flex;overflow:hidden}.multi-combo-box .multi-combo-box-tags{display:var(--combo-box__multiselect__tags__display);padding-top:calc(var(--combo-box__tag__margin-right) - 1px);padding-left:calc(var(--combo-box__tag__margin-right) - 1px);position:relative}.multi-combo-box .multi-combo-box-tags--hidden,.multi-combo-box .multi-combo-box-tags:empty{display:var(--combo-box__multiselect__no__tags__display)}.multi-combo-box .multi-combo-box-text-container{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;max-width:calc(100% - var(--combo-box__inputfield__default__min-width))}.multi-combo-box .multi-combo-box-text-container .multi-combo-box-text{display:var(--combo-box__multiselect__mobile-text__display);padding:var(--combo-box__text-instead-of-tags__padding);text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.multi-combo-box .multi-combo-box-text-container .multi-combo-box-text--show{display:var(--combo-box__multiselect__desktop__and__mobile-text__display)}.multi-combo-box-ellipsis{-ms-grid-row-align:center;align-self:center;padding-left:calc(var(--combo-box__tag__margin-right) - 1px)}.inner-container,.outer-container{width:100%}.multi-combo-box .outer-container{display:flex}.multi-combo-box .inner-container{overflow:hidden;margin-left:1px}.multi-combo-box .moving-container{display:flex;width:100%;justify-content:flex-end}"]
    }),
    __param(0, Self()), __param(0, Optional())
], ComboBoxComponent);
export { ComboBoxComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tYm94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BibXctZHMvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImNvbWJvLWJveC9jb21iby1ib3guY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsWUFBWSxFQUNaLFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULFNBQVMsRUFDVCxNQUFNLEVBQ04sTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1QsYUFBYSxFQUNiLElBQUksRUFDSixRQUFRLEVBQ1IsaUJBQWlCLEVBQ2pCLGFBQWEsRUFDZCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNwRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBdUJoRCxJQUFhLGlCQUFpQixHQUE5QixNQUFhLGlCQUFpQjtJQWdPNUIsWUFDOEIsT0FBa0IsRUFDdEMsVUFBc0IsRUFDdEIsS0FBd0I7UUFGSixZQUFPLEdBQVAsT0FBTyxDQUFXO1FBQ3RDLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsVUFBSyxHQUFMLEtBQUssQ0FBbUI7UUE3TmxDLHlCQUFvQixHQUFHLGtCQUFrQixDQUFDO1FBRzFDLGFBQVEsR0FBRyxL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LEVBQUUsQ0FBQTtHQWpPVixpQkFBaUIsQ0F5ckI3QjtTQXpyQlksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIENvbnRlbnRDaGlsZCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSG9zdExpc3RlbmVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG4gIFZpZXdDaGlsZCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgU2VsZixcbiAgT3B0aW9uYWwsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tYm9Cb3hEcm9wZG93bkl0ZW1Db21wb25lbnQgfSBmcm9tICcuL2NvbWJvLWJveC1kcm9wZG93bi1pdGVtLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb21ib0JveElucHV0Q29tcG9uZW50IH0gZnJvbSAnLi9jb21iby1ib3gtaW5wdXQuY29tcG9uZW50JztcbmltcG9ydCB7IExhYmVsQ29tcG9uZW50IH0gZnJvbSAnLi4vbGFiZWwvbGFiZWwuY29tcG9uZW50JztcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOZ0NvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBmcm9tRXZlbnQsIG1lcmdlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuZXhwb3J0IGNvbnN0IGVudW0gQ29tYm9Cb3hUeXBlIHtcbiAgU0lOR0xFID0gJ1NJTkdMRScsXG4gIE1VTFRJID0gJ01VTFRJJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbWJvQm94SXRlbSB7XG4gIHZhbHVlOiBhbnk7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGRpc2FibGVkOiBib29sZWFuO1xuICBmb2N1c2VkPzogYm9vbGVhbjtcbiAgc2VsZWN0ZWQ6IGJvb2xlYW47XG4gIGlkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIENvbWJvQm94RmlsdGVyID0gKHNlYXJjaFF1ZXJ5OiBzdHJpbmcsIGFsbENvbWJvQm94SXRlbXM6IENvbWJvQm94SXRlbVtdKSA9PiBDb21ib0JveEl0ZW1bXTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LWNvbWJvLWJveCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb21iby1ib3guY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9jb21iby1ib3guY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDb21ib0JveENvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgQWZ0ZXJWaWV3SW5pdCwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgQElucHV0KClcbiAgcGxhY2Vob2xkZXI6IHN0cmluZztcblxuICBASW5wdXQoKVxuICBub1Jlc3VsdHNQbGFjZWhvbGRlciA9ICdObyByZXN1bHRzIGZvdW5kJztcblxuICBASW5wdXQoKVxuICBkaXNhYmxlZCA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIHRhYkluZGV4ID0gMDtcblxuICBASW5wdXQoKVxuICByZXF1aXJlZCA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpXG4gIGNsZWFyYWJsZSA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgY3VzdG9tRmlsdGVyOiBDb21ib0JveEZpbHRlcjtcblxuICAvKipcbiAgICogU2hvdyB0aGUgbXVsdGlDb21ib0JveFRleHQgc3RyaW5nIGluc3RlYWQgb2YgZWFjaCB0YWcuIChkZWZhdWx0ID0gZmFsc2UpXG4gICAqL1xuICBASW5wdXQoKVxuICB0ZXh0SW5zdGVhZE9mVGFnczogYm9vbGVhbjtcblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICBASW5wdXQoKVxuICBpZDogc3RyaW5nO1xuXG4gIEBIb3N0QmluZGluZygnYXR0ci50YWJpbmRleCcpXG4gIGhvc3RUYWJJbmRleCA9ICctMSc7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihDb21ib0JveERyb3Bkb3duSXRlbUNvbXBvbmVudClcbiAgaXRlbXM6IFF1ZXJ5TGlzdDxDb21ib0JveERyb3Bkb3duSXRlbUNvbXBvbmVudD47XG5cbiAgQENvbnRlbnRDaGlsZChMYWJlbENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSlcbiAgcHJpdmF0ZSBfbGFiZWw6IExhYmVsQ29tcG9uZW50O1xuXG4gIGZpbHRlcmVkSXRlbXM6IENvbWJvQm94SXRlbVtdID0gW107XG5cbiAgX2l0ZW1zOiBDb21ib0JveEl0ZW1bXSA9IFtdO1xuICBzZWxlY3RlZEl0ZW1zOiBDb21ib0JveEl0ZW1bXSA9IFtdO1xuXG4gIEBWaWV3Q2hpbGQoQ29tYm9Cb3hJbnB1dENvbXBvbmVudClcbiAgaW5wdXQ6IENvbWJvQm94SW5wdXRDb21wb25lbnQ7XG5cbiAgQFZpZXdDaGlsZCgnaW5wdXRCb3gnKVxuICBpbnB1dEJveDogRWxlbWVudFJlZjtcblxuICBvcGVuZWQgPSBmYWxzZTtcbiAgc2hvd0ludmFsaWRTdGF0ZSA9IGZhbHNlO1xuICBjb21ib0ZvY3VzZWQgPSBmYWxzZTtcbiAgZ3JpZENsYXNzZXM6IHN0cmluZ1tdO1xuXG4gIHByaXZhdGUgX3ZhbHVlOiBhbnk7XG4gIHByaXZhdGUgX3R5cGUgPSBDb21ib0JveFR5cGUuU0lOR0xFO1xuICBwcml2YXRlIF9pbnB1dEZvY3VzZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfaXNUb3VjaGVkID0gZmFsc2U7XG4gIHB1YmxpYyBtdWx0aUNvbWJvQm94VGV4dCA9ICdTZWxlY3RlZCc7XG4gIHB1YmxpYyBzY3JvbGxPZmZzZXQgPSAwO1xuXG4gIHByaXZhdGUgb25EZXN0cm95JCA9IG5ldyBTdWJqZWN0KCk7XG4gIG91dHNpZGVDYWxsYmFjazogYW55O1xuXG4gIGdldCB2YWx1ZSgpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCB2YWx1ZShuZXdWYWx1ZTogYW55KSB7XG4gICAgdGhpcy5jaGFuZ2VWYWx1ZShuZXdWYWx1ZSwgeyBlbWl0RXZlbnQ6IHRydWUgfSk7XG4gIH1cblxuICBnZXQgdXNlTXVsdGkoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX3R5cGUgPT09IENvbWJvQm94VHlwZS5NVUxUSTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCB0eXBlKGNvbWJvQm94VHlwZTogQ29tYm9Cb3hUeXBlKSB7XG4gICAgLy8gY29lcmNlIGlucHV0VHlwZVxuICAgIGlmICh0aGlzLl90eXBlICE9PSBjb21ib0JveFR5cGUpIHtcbiAgICAgIHRoaXMuX3R5cGUgPSBjb21ib0JveFR5cGU7XG4gICAgfVxuICB9XG5cbiAgQE91dHB1dCgpXG4gIGNoYW5nZUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgpXG4gIG9wZW4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvKipcbiAgICogVGV4dCB0byBiZSB1c2VkIGluIG11bHRpIGNvbWJvIGJveGVzIHRoYXQgdXNlIHRleHQgaW5zdGVhZCBvZiB0YWdzLlxuICAgKiBJdCBjYW4gYmUgYSBzdHJpbmcgb3IgYSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSBhcnJheSBvZiBzZWxlY3RlZCBpdGVtcyBhbmQgcmV0dXJucyB0aGUgdGV4dCBpbiBhIGN1c3RvbSBmb3JtYXQuXG4gICAqIEluIGNhc2Ugb2YgcHJvdmlkaW5nIGEgc3RyaW5nLCBpdCByZXBsYWNlcyB0aGUgdGV4dCBvZiB0aGUgZGVmYXVsdCBmb3JtYXQ6ICdTZWxlY3RlZCAoMCknLlxuICAgKi9cbiAgQElucHV0KClcbiAgc2VsZWN0ZWRPcHRpb25zVGV4dDogc3RyaW5nIHwgKChpdGVtczogQ29tYm9Cb3hJdGVtW10pID0+IHN0cmluZykgPSBpdGVtcyA9PiAnU2VsZWN0ZWQgKCcgKyBpdGVtcy5sZW5ndGggKyAnKSc7XG5cbiAgcHJpdmF0ZSBfb25DaGFuZ2U6ICh2YWx1ZTogYW55KSA9PiB2b2lkID0gKCkgPT4ge307XG4gIHByaXZhdGUgX29uVG91Y2hlZDogKCkgPT4gYW55ID0gKCkgPT4ge307XG5cbiAgcHJpdmF0ZSBfZGVmYXVsdEZpbHRlcjogQ29tYm9Cb3hGaWx0ZXIgPSAoc2VhcmNoUXVlcnksIGFsbENvbWJvQm94SXRlbXMpID0+XG4gICAgYWxsQ29tYm9Cb3hJdGVtcy5maWx0ZXIoKHsgbGFiZWwgfSkgPT5cbiAgICAgIGxhYmVsXG4gICAgICAgID8udG9TdHJpbmcoKVxuICAgICAgICAudG9Mb2NhbGVMb3dlckNhc2UoKVxuICAgICAgICAuaW5jbHVkZXModGhpcy5pbnB1dC52YWx1ZS50b0xvY2FsZUxvd2VyQ2FzZSgpKVxuICAgICAgICA/IHRydWVcbiAgICAgICAgOiBmYWxzZVxuICAgICk7XG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXG4gIG9uS2V5ZG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGNvbnN0IGtleSA9IGV2ZW50LmNvZGUgfHwgZXZlbnQua2V5Q29kZTtcbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgY2FzZSAnQXJyb3dEb3duJzpcbiAgICAgIGNhc2UgNDA6XG4gICAgICAgIGlmICh0aGlzLm9wZW5lZCkge1xuICAgICAgICAgIHRoaXMuc2V0TmV4dEl0ZW1Bc0ZvY3VzZWQoKTtcbiAgICAgICAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICB0aGlzLnNob3dJbnZhbGlkU3RhdGUgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZSgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgIGNhc2UgMzg6XG4gICAgICAgIGlmICh0aGlzLm9wZW5lZCkge1xuICAgICAgICAgIHRoaXMuc2V0UHJldmlvdXNJdGVtQXNGb2N1c2VkKCk7XG4gICAgICAgICAgdGhpcy5jZFJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgICAgdGhpcy5zaG93SW52YWxpZFN0YXRlID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50b2dnbGUoKTtcbiAgICAgICAgfVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnQmFja3NwYWNlJzpcbiAgICAgIGNhc2UgODpcbiAgICAgIGNhc2UgJ0RlbGV0ZSc6XG4gICAgICBjYXNlIDQ2OlxuICAgICAgICBpZiAodGhpcy51c2VNdWx0aSAmJiB0aGlzLnNlbGVjdGVkSXRlbXMubGVuZ3RoID4gMCAmJiAhdGhpcy5jb21ib0ZvY3VzZWQpIHtcbiAgICAgICAgICBjb25zdCBmb2N1c2VkVGFnOiBDb21ib0JveEl0ZW0gPSB0aGlzLnNlbGVjdGVkSXRlbXMuZmluZChpdGVtID0+IGl0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICAgICAgaWYgKGZvY3VzZWRUYWcpIHtcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlTXVsdGlNb2RlSXRlbShmb2N1c2VkVGFnKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRCb3gubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpLmZvY3VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdFbnRlcic6XG4gICAgICBjYXNlICdOdW1wYWRFbnRlcic6XG4gICAgICBjYXNlIDEzOlxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzLmlucHV0Qm94Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNsZWFyLml3cC1pY29uLWdlbl9jbG9zZScpKSB7XG4gICAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3BlbmVkICYmIHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgaXNPbmx5SXRlbUxlZnQ6IGJvb2xlYW4gPSB0aGlzLmZpbHRlcmVkSXRlbXMubGVuZ3RoID09PSAxO1xuICAgICAgICAgIGxldCBpdGVtVG9TZWxlY3Q6IENvbWJvQm94SXRlbTtcblxuICAgICAgICAgIGlmIChpc09ubHlJdGVtTGVmdCkge1xuICAgICAgICAgICAgaXRlbVRvU2VsZWN0ID0gdGhpcy5maWx0ZXJlZEl0ZW1zWzBdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtVG9TZWxlY3QgPSB0aGlzLmZpbHRlcmVkSXRlbXMuZmluZChpdGVtID0+IGl0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGl0ZW1Ub1NlbGVjdCAmJiAhaXRlbVRvU2VsZWN0LmRpc2FibGVkKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMudXNlTXVsdGkpIHtcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RJdGVtKHRoaXMuaXRlbXMuZmluZChpdGVtID0+IGl0ZW0udmFsdWUgPT09IGl0ZW1Ub1NlbGVjdC52YWx1ZSkpO1xuICAgICAgICAgICAgICB0aGlzLnJlc2V0Rm9jdXNlZEl0ZW0oKTtcbiAgICAgICAgICAgICAgdGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykuYmx1cigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy50b2dnbGVNdWx0aU1vZGVJdGVtKGl0ZW1Ub1NlbGVjdCwgeyByZW1vdmVGb2N1c0FmdGVyU2VsZWN0aW9uOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgaWYgKGlzT25seUl0ZW1MZWZ0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xlYW5GaWx0ZXIoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ1NwYWNlJzpcbiAgICAgIGNhc2UgMzI6XG4gICAgICAgIGlmICghdGhpcy5vcGVuZWQgfHwgIXRoaXMuaW5wdXQudmFsdWUpIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZSgpO1xuICAgICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykuZm9jdXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdFc2NhcGUnOlxuICAgICAgY2FzZSAyNzpcbiAgICAgIGNhc2UgJ1RhYic6XG4gICAgICBjYXNlIDk6XG4gICAgICAgIGlmICh0aGlzLm9wZW5lZCkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlKGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlVmlld0lucHV0QWZ0ZXJEcm9wZG93bkNsb3NlZCgpO1xuXG4gICAgICAgIGlmICghdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbmQoaXRlbSA9PiBpdGVtLmZvY3VzZWQgPT09IHRydWUpKSB7XG4gICAgICAgICAgdGhpcy5jb21ib0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdmb2N1c291dCcsIFsnJGV2ZW50J10pXG4gIG9uRm9jdXNvdXQoeyB0YXJnZXQgfSkge1xuICAgIGlmICh0YXJnZXQgPT09IHRoaXMuaW5wdXRCb3gubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpICYmICF0aGlzLm9wZW5lZCkge1xuICAgICAgdGhpcy51cGRhdGVWaWV3SW5wdXRBZnRlckRyb3Bkb3duQ2xvc2VkKCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQFNlbGYoKSBAT3B0aW9uYWwoKSBwcml2YXRlIGNvbnRyb2w6IE5nQ29udHJvbCxcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBjZFJlZjogQ2hhbmdlRGV0ZWN0b3JSZWZcbiAgKSB7XG4gICAgaWYgKHRoaXMuY29udHJvbCkgdGhpcy5jb250cm9sLnZhbHVlQWNjZXNzb3IgPSB0aGlzO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5fbGlzdGVuVG9JbnB1dEZvY3VzKCk7XG5cbiAgICB0aGlzLmNvbnRyb2w/LnZhbHVlQ2hhbmdlcy5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKS5zdWJzY3JpYmUoZSA9PiB7XG4gICAgICB0aGlzLl92YWxpZGF0ZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZm9jdXMgPSAoKSA9PiB7XG4gICAgICB0aGlzLmZvY3VzSW5wdXQoKTtcbiAgICAgIHRoaXMudG9nZ2xlKHRydWUpO1xuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZU11bHRpQ29tYm9Cb3hUZXh0KCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgaWYgKCF0aGlzLmlkKSB7XG4gICAgICB0aGlzLmlkID0gTWF0aC5yYW5kb20oKVxuICAgICAgICAudG9TdHJpbmcoMzYpXG4gICAgICAgIC5zdWJzdHJpbmcoMik7XG4gICAgfVxuXG4gICAgdGhpcy5maWx0ZXIoKTtcbiAgICB0aGlzLl92YWxpZGF0ZSgpO1xuXG4gICAgdGhpcy5pdGVtcy5jaGFuZ2VzLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLm1hcEl0ZW1zKCk7XG4gICAgICB0aGlzLnVwZGF0ZVZpZXdJbnB1dCgpO1xuICAgICAgdGhpcy5jbGVhbkZpbHRlcigpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5yZWZyZXNoSXRlbXNTdGF0ZSgpO1xuXG4gICAgaWYgKHRoaXMuX2xhYmVsKSB7XG4gICAgICB0aGlzLl9sYWJlbC5pbnB1dElkID0gdGhpcy5pZDtcbiAgICB9XG4gICAgdGhpcy5fc2V0R3JpZENsYXNzZXMoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAodGhpcy5fdmFsdWUpIHtcbiAgICAgIC8vIEluaXRpYWwgdmFsdWUgd2FzIHNldCwgdXBkYXRlIHNlbGVjdGVkIGl0ZW1zXG4gICAgICB0aGlzLnVwZGF0ZVZpZXdJbnB1dCgpO1xuICAgICAgdGhpcy5jbGVhbkZpbHRlcigpO1xuICAgICAgdGhpcy5jZFJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgbWFwSXRlbXMoKSB7XG4gICAgdGhpcy5faXRlbXMgPSB0aGlzLml0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLFxuICAgICAgICBsYWJlbDogaXRlbS5sYWJlbCxcbiAgICAgICAgZGlzYWJsZWQ6IGl0ZW0uZGlzYWJsZWQsXG4gICAgICAgIGZvY3VzZWQ6IGl0ZW0uZm9jdXNlZCxcbiAgICAgICAgc2VsZWN0ZWQ6IGl0ZW0uc2VsZWN0ZWQsXG4gICAgICAgIGlkOiBpdGVtLmlkXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICAgIGlmIChjaGFuZ2VzLnNlbGVjdGVkT3B0aW9uc1RleHQpIHtcbiAgICAgIHRoaXMudXBkYXRlTXVsdGlDb21ib0JveFRleHQoKTtcbiAgICB9XG4gICAgdGhpcy5maWx0ZXIoKTtcbiAgICB0aGlzLl92YWxpZGF0ZSgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5jZFJlZi5kZXRhY2goKTtcbiAgICB0aGlzLm9uRGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgZm9jdXNUYWcoc2VsZWN0ZWRJdGVtOiBDb21ib0JveEl0ZW0pIHtcbiAgICBzZWxlY3RlZEl0ZW0uZm9jdXNlZCA9IHRydWU7XG4gIH1cblxuICBmb2N1c291dFRhZyhzZWxlY3RlZEl0ZW06IENvbWJvQm94SXRlbSkge1xuICAgIHNlbGVjdGVkSXRlbS5mb2N1c2VkID0gZmFsc2U7XG4gIH1cblxuICBzZWxlY3RUYWcoc2VsZWN0ZWRJdGVtOiBDb21ib0JveEl0ZW0pIHtcbiAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAvLyByZW1vdmUgc2VsZWN0aW9uIGZyb20gYWxsIHRhZ3NcbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHRoaXMuc2VsZWN0ZWRJdGVtcy5tYXAoaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0uZm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy51cGRhdGVNdWx0aUNvbWJvQm94VGV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIHRvZ2dsZShzdGF0ZT86IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIGNvbnN0IGluaXRpYWxPcGVuZWRTdGF0ZSA9IHRoaXMub3BlbmVkO1xuXG4gICAgICBpZiAodHlwZW9mIHN0YXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLm9wZW5lZCA9IHN0YXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcGVuZWQgPSAhdGhpcy5vcGVuZWQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wZW5lZCAhPT0gaW5pdGlhbE9wZW5lZFN0YXRlKSB7XG4gICAgICAgIGlmICh0aGlzLm9wZW5lZCkge1xuICAgICAgICAgIHRoaXMub3V0c2lkZUNhbGxiYWNrID0gdGhpcy5vbkNsaWNrT3V0c2lkZS5iaW5kKHRoaXMpO1xuICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm91dHNpZGVDYWxsYmFjayk7XG4gICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm91dHNpZGVDYWxsYmFjayk7XG4gICAgICAgICAgdGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykuZm9jdXMoKTtcbiAgICAgICAgICB0aGlzLm9wZW4uZW1pdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucmVzZXRGb2N1c2VkSXRlbSgpO1xuICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm91dHNpZGVDYWxsYmFjayk7XG4gICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm91dHNpZGVDYWxsYmFjayk7XG5cbiAgICAgICAgICB0aGlzLmNvbWJvRm9jdXNlZCA9IHRoaXMuX2lucHV0Rm9jdXNlZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uQ2xpY2tPdXRzaWRlKHsgdGFyZ2V0IH0pIHtcbiAgICBpZiAoXG4gICAgICAhdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNvbWJvLWJveC1jb250YWluZXInKS5jb250YWlucyh0YXJnZXQpICYmXG4gICAgICAhdGFyZ2V0LnNoYWRvd1Jvb3Q/LnF1ZXJ5U2VsZWN0b3IoJ2Jtdy1jb21iby1ib3gnKVxuICAgICkge1xuICAgICAgdGhpcy50b2dnbGUoZmFsc2UpO1xuICAgICAgdGhpcy51cGRhdGVWaWV3SW5wdXRBZnRlckRyb3Bkb3duQ2xvc2VkKCk7XG4gICAgfVxuICB9XG5cbiAgcmVmcmVzaEl0ZW1zU3RhdGUoKSB7XG4gICAgdGhpcy5tYXBJdGVtcygpO1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IFsuLi50aGlzLl9pdGVtc107XG4gIH1cblxuICByZXNldEZvY3VzZWRJdGVtKCkge1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcy5mb3JFYWNoKGl0ZW0gPT4gKGl0ZW0uZm9jdXNlZCA9IGZhbHNlKSk7XG4gIH1cblxuICBzZXRQcmV2aW91c0l0ZW1Bc0ZvY3VzZWQoKSB7XG4gICAgaWYgKHRoaXMub3BlbmVkICYmIHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGggPiAwICYmIHRoaXMuZmlsdGVyZWRJdGVtcy5zb21lKGl0ZW0gPT4gIWl0ZW0uZGlzYWJsZWQpKSB7XG4gICAgICBsZXQgZm9jdXNlZEl0ZW1JbmRleDogbnVtYmVyID0gdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICB0aGlzLnJlc2V0Rm9jdXNlZEl0ZW0oKTtcbiAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ICE9PSAtMSAmJiBmb2N1c2VkSXRlbUluZGV4ICE9PSAwKSB7XG4gICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSBmb2N1c2VkSXRlbUluZGV4IC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSB0aGlzLmZpbHRlcmVkSXRlbXMubGVuZ3RoIC0gMTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zW2ZvY3VzZWRJdGVtSW5kZXhdLmZvY3VzZWQgPSB0cnVlO1xuXG4gICAgICBpZiAodGhpcy5maWx0ZXJlZEl0ZW1zW2ZvY3VzZWRJdGVtSW5kZXhdLmRpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuc2V0UHJldmlvdXNJdGVtQXNGb2N1c2VkKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0TmV4dEl0ZW1Bc0ZvY3VzZWQoKSB7XG4gICAgaWYgKHRoaXMub3BlbmVkICYmIHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGggPiAwICYmIHRoaXMuZmlsdGVyZWRJdGVtcy5maWx0ZXIoaXRlbSA9PiAhaXRlbS5kaXNhYmxlZCkubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IGZvY3VzZWRJdGVtSW5kZXg6IG51bWJlciA9IHRoaXMuZmlsdGVyZWRJdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmZvY3VzZWQgPT09IHRydWUpO1xuICAgICAgdGhpcy5yZXNldEZvY3VzZWRJdGVtKCk7XG4gICAgICBpZiAoZm9jdXNlZEl0ZW1JbmRleCAhPT0gLTEgJiYgZm9jdXNlZEl0ZW1JbmRleCAhPT0gdGhpcy5maWx0ZXJlZEl0ZW1zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgZm9jdXNlZEl0ZW1JbmRleCA9IGZvY3VzZWRJdGVtSW5kZXggKyAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9jdXNlZEl0ZW1JbmRleCA9IDA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZmlsdGVyZWRJdGVtc1tmb2N1c2VkSXRlbUluZGV4XS5mb2N1c2VkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuZmlsdGVyZWRJdGVtc1tmb2N1c2VkSXRlbUluZGV4XS5kaXNhYmxlZCkge1xuICAgICAgICB0aGlzLnNldE5leHRJdGVtQXNGb2N1c2VkKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlTXVsdGlNb2RlSXRlbShpdGVtOiBDb21ib0JveEl0ZW0sIG9wdGlvbnM/OiB7IHJlbW92ZUZvY3VzQWZ0ZXJTZWxlY3Rpb246IGJvb2xlYW4gfSkge1xuICAgIGl0ZW0uc2VsZWN0ZWQgPSAhaXRlbS5zZWxlY3RlZDtcblxuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRJdGVtcyhpdGVtKTtcblxuICAgIGlmICghb3B0aW9ucyB8fCBvcHRpb25zLnJlbW92ZUZvY3VzQWZ0ZXJTZWxlY3Rpb24pIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRJbmRleCA9IHRoaXMuZmlsdGVyZWRJdGVtcy5maW5kSW5kZXgoc2VhcmNoZWRJdGVtID0+ICEhc2VhcmNoZWRJdGVtLmZvY3VzZWQpO1xuICAgICAgaWYgKGN1cnJlbnRseUZvY3VzZWRJbmRleCA+IDApIHtcbiAgICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zW2N1cnJlbnRseUZvY3VzZWRJbmRleF0uZm9jdXNlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGl0ZW1JbkRyb3Bkb3duTGlzdCA9IHRoaXMuZmlsdGVyZWRJdGVtcy5maW5kKGRyb3Bkb3duSXRlbSA9PiBkcm9wZG93bkl0ZW0udmFsdWUgPT09IGl0ZW0udmFsdWUpO1xuXG4gICAgaXRlbUluRHJvcGRvd25MaXN0LnNlbGVjdGVkID0gaXRlbS5zZWxlY3RlZDtcblxuICAgIHRoaXMuZmluZEZvY3VzZWRUYWcoKTtcbiAgICB0aGlzLmVtaXRTZWxlY3RlZEl0ZW1zQ2hhbmdlKCk7XG4gICAgdGhpcy5fdmFsaWRhdGUoKTtcbiAgfVxuXG4gIHVwZGF0ZVNlbGVjdGVkSXRlbXMoaXRlbTogQ29tYm9Cb3hJdGVtKSB7XG4gICAgaWYgKGl0ZW0uc2VsZWN0ZWQpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5wdXNoKGl0ZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSB0aGlzLnNlbGVjdGVkSXRlbXMuZmlsdGVyKGZ1bmN0aW9uKGVsZW1lbnQ6IENvbWJvQm94SXRlbSkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC52YWx1ZSAhPT0gaXRlbS52YWx1ZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZU11bHRpQ29tYm9Cb3hUZXh0KCk7XG4gIH1cblxuICB1cGRhdGVWaWV3SW5wdXQoKTogdm9pZCB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5fdmFsdWUpIHx8IHRoaXMudXNlTXVsdGkpIHtcbiAgICAgIHRoaXMuX2l0ZW1zID0gdGhpcy5faXRlbXMubWFwKGl0ZW0gPT4ge1xuICAgICAgICBpdGVtLnNlbGVjdGVkID0gKHRoaXMuX3ZhbHVlIGFzIGFueVtdKT8uaW5jbHVkZXMoaXRlbS52YWx1ZSk7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHRoaXMuX2l0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0uc2VsZWN0ZWQpO1xuICAgICAgdGhpcy51cGRhdGVNdWx0aUNvbWJvQm94VGV4dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5fdmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5yZXNldERyb3Bkb3duSXRlbXMoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtID0gdGhpcy5maW5kSXRlbUJ5VmFsdWUodGhpcy5fdmFsdWUpO1xuXG4gICAgICBpZiAodGhpcy5pbnB1dCkge1xuICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gc2VsZWN0ZWRJdGVtPy5sYWJlbCA/PyAnJztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1cGRhdGVNdWx0aUNvbWJvQm94VGV4dCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy51c2VNdWx0aSkge1xuICAgICAgaWYgKHR5cGVvZiB0aGlzLnNlbGVjdGVkT3B0aW9uc1RleHQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhpcy5tdWx0aUNvbWJvQm94VGV4dCA9IHRoaXMuc2VsZWN0ZWRPcHRpb25zVGV4dCh0aGlzLnNlbGVjdGVkSXRlbXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tdWx0aUNvbWJvQm94VGV4dCA9IHRoaXMuc2VsZWN0ZWRPcHRpb25zVGV4dCArICcgKCcgKyB0aGlzLnNlbGVjdGVkSXRlbXMubGVuZ3RoICsgJyknO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZvY3VzRmlyc3RGaWx0ZXJlZEl0ZW0oKSB7XG4gICAgaWYgKHRoaXMuaW5wdXQgJiYgdGhpcy5vcGVuZWQgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLnNvbWUoaXRlbSA9PiAhaXRlbS5kaXNhYmxlZCkpIHtcbiAgICAgIGNvbnN0IGVuYWJsZWRJdGVtcyA9IHRoaXMuZmlsdGVyZWRJdGVtcy5maWx0ZXIoaXRlbSA9PiAhaXRlbS5kaXNhYmxlZCk7XG4gICAgICBlbmFibGVkSXRlbXNbMF0uZm9jdXNlZCA9IHRydWU7XG4gICAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIHRoaXMuaW5wdXRCb3gubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpLmZvY3VzKCk7XG4gICAgICB0aGlzLnNob3dJbnZhbGlkU3RhdGUgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVWaWV3SW5wdXRBZnRlckRyb3Bkb3duQ2xvc2VkKCk6IHZvaWQge1xuICAgIHRoaXMucmVzZXRGb2N1c2VkSXRlbSgpO1xuXG4gICAgaWYgKCF0aGlzLnVzZU11bHRpICYmIHRoaXMuX3ZhbHVlKSB7XG4gICAgICB0aGlzLnVwZGF0ZVZpZXdJbnB1dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlucHV0LnZhbHVlID0gJyc7XG4gICAgfVxuXG4gICAgdGhpcy5jbGVhbkZpbHRlcigpO1xuICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG4gIH1cblxuICByZXNldERyb3Bkb3duSXRlbXMoKTogdm9pZCB7XG4gICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gWy4uLnRoaXMuX2l0ZW1zXTtcbiAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcbiAgICB0aGlzLnVwZGF0ZU11bHRpQ29tYm9Cb3hUZXh0KCk7XG4gICAgdGhpcy5faXRlbXMgPSB0aGlzLl9pdGVtcy5tYXAoaXRlbSA9PiB7XG4gICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9KTtcbiAgfVxuXG4gIGVtaXRTZWxlY3RlZEl0ZW1zQ2hhbmdlKCk6IHZvaWQge1xuICAgIGNvbnN0IF9zZWxlY3RlZEl0ZW1zID0gdGhpcy5faXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zZWxlY3RlZCkubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSk7XG4gICAgdGhpcy52YWx1ZSA9IF9zZWxlY3RlZEl0ZW1zO1xuICAgIHRoaXMuY2hhbmdlRXZlbnQuZW1pdChfc2VsZWN0ZWRJdGVtcyk7XG4gICAgdGhpcy5fb25DaGFuZ2UoX3NlbGVjdGVkSXRlbXMpO1xuICAgIHRoaXMuX29uVG91Y2hlZCgpO1xuICB9XG5cbiAgZmlsdGVyKCkge1xuICAgIHRoaXMucmVzZXRGb2N1c2VkSXRlbSgpO1xuICAgIGlmICghdGhpcy5faXRlbXMpIHtcbiAgICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IFtdO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBmaWx0ZXI6IENvbWJvQm94RmlsdGVyID0gdGhpcy5jdXN0b21GaWx0ZXIgPz8gdGhpcy5fZGVmYXVsdEZpbHRlcjtcbiAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSBmaWx0ZXIodGhpcy5pbnB1dD8udmFsdWU/LnRvU3RyaW5nKCksIHRoaXMuX2l0ZW1zKTtcbiAgfVxuXG4gIGZpbHRlckFuZE9wZW5Ecm9wZG93bigpIHtcbiAgICB0aGlzLmZpbHRlcigpO1xuICAgIHRoaXMudG9nZ2xlKHRydWUpO1xuICAgIHRoaXMuZm9jdXNGaXJzdEZpbHRlcmVkSXRlbSgpO1xuICB9XG5cbiAgY2xlYW5GaWx0ZXIoKSB7XG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IHRoaXMuX2l0ZW1zO1xuICAgIH1cbiAgfVxuXG4gIHNlbGVjdEl0ZW0oaXRlbTogQ29tYm9Cb3hEcm9wZG93bkl0ZW1Db21wb25lbnQpIHtcbiAgICBpZiAodGhpcy51c2VNdWx0aSkge1xuICAgICAgdGhpcy50b2dnbGVNdWx0aU1vZGVJdGVtKGl0ZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZhbHVlID0gaXRlbS52YWx1ZTtcbiAgICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IFsuLi50aGlzLl9pdGVtc107XG4gICAgICB0aGlzLnRvZ2dsZShmYWxzZSk7XG4gICAgICB0aGlzLmNoYW5nZUV2ZW50LmVtaXQoaXRlbS52YWx1ZSk7XG4gICAgICB0aGlzLl9vblRvdWNoZWQoKTtcbiAgICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG4gICAgfVxuICB9XG5cbiAgZmluZEl0ZW1CeVZhbHVlKHZhbHVlOiBhbnkpOiBDb21ib0JveERyb3Bkb3duSXRlbUNvbXBvbmVudCB7XG4gICAgaWYgKCF0aGlzLml0ZW1zKSByZXR1cm4gbnVsbDtcblxuICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbHRlcihpdGVtID0+IHtcbiAgICAgIHJldHVybiBpdGVtLnZhbHVlID09PSB2YWx1ZSB8fCBKU09OLnN0cmluZ2lmeShpdGVtLnZhbHVlKSA9PT0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIH0pWzBdO1xuICB9XG5cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5fdmFsdWUgPSBudWxsO1xuICAgIHRoaXMuaW5wdXQudmFsdWUgPSBudWxsO1xuICAgIHRoaXMuY2hhbmdlRXZlbnQuZW1pdChudWxsKTtcbiAgICB0aGlzLl9vbkNoYW5nZShudWxsKTtcbiAgICB0aGlzLl9vblRvdWNoZWQoKTtcbiAgICB0aGlzLl92YWxpZGF0ZSgpO1xuICB9XG5cbiAgaXNGb3JtUmVzZXQoKSB7XG4gICAgbGV0IHJlc2V0ID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5jb250cm9sKSB7XG4gICAgICBjb25zdCB7IHByaXN0aW5lIH0gPSB0aGlzLmNvbnRyb2w7XG4gICAgICByZXNldCA9IHRoaXMuX3ZhbHVlID09PSBudWxsICYmIHByaXN0aW5lICE9PSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzZXQ7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAodmFsdWU6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX29uQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5fb25Ub3VjaGVkID0gZm47XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmNoYW5nZVZhbHVlKHZhbHVlLCB7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGRpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGRpc2FibGVkO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGFuZ2VWYWx1ZShuZXdWYWx1ZTogYW55LCBvcHRpb25zOiB7IGVtaXRFdmVudDogYm9vbGVhbiB9KSB7XG4gICAgdGhpcy5fdmFsdWUgPSBuZXdWYWx1ZTtcblxuICAgIHRoaXMudXBkYXRlVmlld0lucHV0KCk7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShuZXdWYWx1ZSkpIHtcbiAgICAgIHRoaXMuZmluZEZvY3VzZWRUYWcoKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5lbWl0RXZlbnQgJiYgIXRoaXMuaXNGb3JtUmVzZXQoKSkge1xuICAgICAgdGhpcy5fb25DaGFuZ2UobmV3VmFsdWUpO1xuICAgIH1cbiAgICB0aGlzLl92YWxpZGF0ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfdmFsaWRhdGUoKSB7XG4gICAgaWYgKHRoaXMuY29udHJvbCkge1xuICAgICAgY29uc3QgeyB0b3VjaGVkLCBpbnZhbGlkIH0gPSB0aGlzLmNvbnRyb2w7XG4gICAgICB0aGlzLnNob3dJbnZhbGlkU3RhdGUgPSBpbnZhbGlkICYmIHRvdWNoZWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLnVzZU11bHRpKSB7XG4gICAgICAgIHRoaXMuc2hvd0ludmFsaWRTdGF0ZSA9XG4gICAgICAgICAgdGhpcy5faXNUb3VjaGVkICYmIHRoaXMucmVxdWlyZWQgPT09IHRydWUgJiYgdGhpcy5faXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zZWxlY3RlZCkubGVuZ3RoID09PSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zaG93SW52YWxpZFN0YXRlID0gdGhpcy5faXNUb3VjaGVkICYmIHRoaXMucmVxdWlyZWQgPT09IHRydWUgJiYgIXRoaXMuX3ZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2xpc3RlblRvSW5wdXRGb2N1cygpIHtcbiAgICBpZiAoIXRoaXMuaW5wdXRCb3gpIHJldHVybjtcbiAgICBjb25zdCBpbnB1dEVsZW1lbnQgPSAodGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIGNvbnN0IGZvY3VzRXZlbnQgPSBmcm9tRXZlbnQoaW5wdXRFbGVtZW50LCAnZm9jdXMnKS5waXBlKG1hcCgoKSA9PiAnZm9jdXMnKSk7XG4gICAgY29uc3QgYmx1ckV2ZW50ID0gZnJvbUV2ZW50KGlucHV0RWxlbWVudCwgJ2JsdXInKS5waXBlKG1hcCgoKSA9PiAnYmx1cicpKTtcblxuICAgIG1lcmdlKGZvY3VzRXZlbnQsIGJsdXJFdmVudClcbiAgICAgIC5waXBlKFxuICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSxcbiAgICAgICAgbWFwKGV2ZW50TmFtZSA9PiAoZXZlbnROYW1lID09PSAnZm9jdXMnID8gdHJ1ZSA6IGZhbHNlKSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoaW5wdXRGb2N1cyA9PiB7XG4gICAgICAgIHRoaXMuY29tYm9Gb2N1c2VkID0gaW5wdXRGb2N1cztcbiAgICAgIH0pO1xuICB9XG5cbiAgZm9jdXNJbnB1dCgpIHtcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuX2lucHV0Rm9jdXNlZCA9IHRydWU7XG4gICAgICB0aGlzLmNvbWJvRm9jdXNlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgZm9jdXNvdXRJbnB1dCgpIHtcbiAgICB0aGlzLl9pbnB1dEZvY3VzZWQgPSBmYWxzZTtcbiAgICB0aGlzLmNvbWJvRm9jdXNlZCA9IHRoaXMub3BlbmVkO1xuICB9XG5cbiAgcHJpdmF0ZSBfc2V0R3JpZENsYXNzZXMoKSB7XG4gICAgY29uc3QgbGlzdE9mQ2xhc3NlcyA9IEFycmF5LmZyb20oKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5jbGFzc0xpc3QpO1xuICAgIHRoaXMuZ3JpZENsYXNzZXMgPSBsaXN0T2ZDbGFzc2VzLmZpbHRlcigoaXRlbTogc3RyaW5nKSA9PiBpdGVtLm1hdGNoKC9ibXdfX2dyaWRfX2NlbGwuKi8pKTtcbiAgICBpZiAodGhpcy5ncmlkQ2xhc3Nlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCB3cmFwcGVyQ2xhc3NMaXN0ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignZGl2LmNvbWJvLWJveC1jb250YWluZXInKS5jbGFzc0xpc3Q7XG4gICAgICB3cmFwcGVyQ2xhc3NMaXN0LnZhbHVlLnNwbGl0KCcgJykuZm9yRWFjaCgoY2xhc3NOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGNsYXNzTmFtZS5tYXRjaCgvYm13X19ncmlkX19jZWxsLiovKSkge1xuICAgICAgICAgIHdyYXBwZXJDbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5ncmlkQ2xhc3Nlcy5mb3JFYWNoKChjbGFzc05hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuY29tYm8tYm94LWNvbnRhaW5lcicpLmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcbiAgICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaW5kRm9jdXNlZFRhZygpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IGZvY3VzZWQgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdibXctdGFnIGRpdi5mb2N1c2VkJyk7XG4gICAgICBpZiAoIWZvY3VzZWQpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxPZmZzZXQgPSAwO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRpZmYgPVxuICAgICAgICBmb2N1c2VkLnBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueCAtXG4gICAgICAgIGZvY3VzZWQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkueCAtXG4gICAgICAgIHRoaXMuc2Nyb2xsT2Zmc2V0O1xuICAgICAgaWYgKGRpZmYgPCAwKSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsT2Zmc2V0ID0gLWRpZmY7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNjcm9sbE9mZnNldCA9IDA7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgY2xpY2soKSB7XG4gICAgdGhpcy50b2dnbGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBpbnB1dFRvdWNoZWQoKSB7XG4gICAgdGhpcy5faXNUb3VjaGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9vblRvdWNoZWQoKTtcbiAgfVxufVxuIl19