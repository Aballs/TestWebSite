import { __decorate } from "tslib";
import { Component, Input, ContentChild, ViewChild, HostBinding, Output, EventEmitter, HostListener, ViewContainerRef } from '@angular/core';
import { PanelContentComponent } from './panel-content.component';
import { IconButtonComponent } from '../icon-button/icon-button.component';
let PanelComponent = class PanelComponent {
    constructor() {
        this.disabled = false;
        this.opened = false;
        this.nonCollapsible = false;
        this.toggleEvent = new EventEmitter();
        this.overflowing = false;
        this.overflowingMenuState = false;
    }
    onResize() {
        this.resizer();
    }
    onKeydown(event) {
        const key = event.code || event.keyCode;
        switch (key) {
            case 'Enter':
            case 'NumpadEnter':
            case 13:
            case 'Space':
            case 32:
                if (event.target === this.labelsDiv.nativeElement) {
                    this.toggle();
                    event.preventDefault();
                    event.stopPropagation();
                }
                break;
        }
    }
    ngOnInit() {
        this.checkProperties();
    }
    ngOnChanges() {
        this.checkProperties();
    }
    ngAfterViewInit() {
        this.visibleIconsContainer.insert(this.icons.createEmbeddedView(null));
        setTimeout(() => {
            this.hideIconsIfNecessary();
        });
    }
    checkProperties() {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
        if (this.nonCollapsible === true) {
            this.opened = true;
        }
    }
    closeMenu(e) {
        const leavingParent = !this.threeDots.nativeElement.contains(e.relatedTarget);
        if (leavingParent) {
            this.toggleOveflowingMenu(e, false);
        }
    }
    resizer() {
        let resizeTimer;
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            this.hideIconsIfNecessary(true);
        });
    }
    hideIconsIfNecessary(showAllFirst) {
        if (!this.labelsDiv)
            return;
        if (showAllFirst) {
            this.showAllIcons();
            this.overflowing = false;
        }
        const defaultHeight = this.labelsDiv.nativeElement.offsetHeight;
        const height = this.labelWrapper.nativeElement.offsetHeight;
        if (height > defaultHeight) {
            this.overflowing = true;
            const id = this.hideLastIcon();
            if (id) {
                setTimeout(() => {
                    this.hideIconsIfNecessary();
                });
            }
        }
    }
    showAllIcons() {
        while (this.hiddenIconsContainer.length > 0) {
            this.visibleIconsContainer.insert(this.hiddenIconsContainer.detach(0));
        }
    }
    hideLastIcon() {
        const length = this.visibleIconsContainer.length;
        this.hiddenIconsContainer.insert(this.visibleIconsContainer.detach(length - 1), 0);
        return length > 1;
    }
    toggle(state) {
        if (this.nonCollapsible || this.disabled)
            return;
        if (typeof state !== 'undefined') {
            this.opened = state;
        }
        else {
            this.opened = !this.opened;
        }
        this.toggleEvent.emit({
            id: this.id,
            opened: this.opened
        });
    }
    toggleOveflowingMenu(e, state) {
        if (this.disabled)
            return;
        if (typeof state !== 'undefined') {
            this.overflowingMenuState = state;
        }
        else {
            this.overflowingMenuState = !this.overflowingMenuState;
        }
        e.stopPropagation();
    }
};
__decorate([
    ContentChild(PanelContentComponent)
], PanelComponent.prototype, "childPanelContentComponent", void 0);
__decorate([
    ViewChild('tpl')
], PanelComponent.prototype, "icons", void 0);
__decorate([
    ViewChild('panel')
], PanelComponent.prototype, "labelsDiv", void 0);
__decorate([
    ViewChild('threeDots')
], PanelComponent.prototype, "threeDots", void 0);
__decorate([
    ViewChild('labelWrapper')
], PanelComponent.prototype, "labelWrapper", void 0);
__decorate([
    ViewChild('hiddenIconsContainer', { read: ViewContainerRef })
], PanelComponent.prototype, "hiddenIconsContainer", void 0);
__decorate([
    ViewChild('visibleIconsContainer', { read: ViewContainerRef })
], PanelComponent.prototype, "visibleIconsContainer", void 0);
__decorate([
    Input()
], PanelComponent.prototype, "disabled", void 0);
__decorate([
    Input()
], PanelComponent.prototype, "opened", void 0);
__decorate([
    Input()
], PanelComponent.prototype, "nonCollapsible", void 0);
__decorate([
    HostBinding('attr.id'),
    Input()
], PanelComponent.prototype, "id", void 0);
__decorate([
    Output()
], PanelComponent.prototype, "toggleEvent", void 0);
__decorate([
    HostListener('window:resize')
], PanelComponent.prototype, "onResize", null);
__decorate([
    HostListener('keydown', ['$event'])
], PanelComponent.prototype, "onKeydown", null);
PanelComponent = __decorate([
    Component({
        selector: 'bmw-panel',
        template: "<div class=\"wrapper\" [class.disabled]=\"disabled\" [attr.aria-disabled]=\"disabled\">\n  <div\n    [tabindex]=\"disabled || nonCollapsible ? -1 : 0\"\n    class=\"panel\"\n    [class.opened]=\"opened\"\n    [class.overflowing]=\"overflowing\"\n    [class.disabled]=\"disabled\"\n    [class.non-collapsible]=\"nonCollapsible\"\n    #panel\n    (click)=\"toggle()\"\n    [attr.aria-expanded]=\"opened\"\n  >\n    <div class=\"label-wrapper\" #labelWrapper>\n      <ng-content select=\"bmw-panel-label\"></ng-content>\n      <ng-container #visibleIconsContainer>\n        <ng-template #tpl>\n          <ng-content select=\"bmw-icon-button\"></ng-content>\n        </ng-template>\n      </ng-container>\n    </div>\n  </div>\n  <div\n    tabindex=\"0\"\n    class=\"three-dots\"\n    [class.opened]=\"overflowingMenuState\"\n    [class.disabled]=\"disabled\"\n    [class.non-collapsible]=\"nonCollapsible\"\n    [class.overflowing]=\"overflowing\"\n    #threeDots\n    (click)=\"toggleOveflowingMenu($event)\"\n    (focusout)=\"closeMenu($event)\"\n    [attr.aria-expanded]=\"overflowingMenuState\"\n  >\n    <div class=\"menu\"><ng-container #hiddenIconsContainer></ng-container></div>\n  </div>\n  <div class=\"content\" [class.disabled]=\"disabled\" [class.opened]=\"opened\">\n    <ng-content select=\"bmw-panel-content\"></ng-content>\n  </div>\n</div>\n",
        entryComponents: [IconButtonComponent],
        styles: [":host{display:block}.wrapper{position:relative}.wrapper .panel{cursor:pointer;padding-right:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding));background-color:var(--panel__defualt__background-color);color:var(--panel__labels__default__color);height:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding))}.wrapper .panel:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}.wrapper .panel .label-wrapper{width:100%;display:flex;flex-wrap:wrap}.wrapper .panel.overflowing{padding-right:calc(2 * (var(--panel__default__line-height) + 2 * var(--panel__default__padding)))}.wrapper .panel ::ng-deep bmw-icon-button{flex-grow:0;display:inline-flex;margin-right:var(--panel__icons__margin-right)}.wrapper .panel.disabled{pointer-events:none;opacity:.5}.wrapper .panel:not(.non-collapsible)::after{font-family:iwp;content:'\\e92f';position:absolute;right:0;top:0;height:var(--panel__default__line-height);width:var(--panel__default__line-height);font-size:var(--panel__default__line-height);padding:var(--panel__default__padding)}.wrapper .panel:not(.non-collapsible):hover{background-color:var(--panel__hover__background-color)}.wrapper .panel.non-collapsible{padding-right:initial;cursor:default}.wrapper .panel.non-collapsible.overflowing{padding-right:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding))}.wrapper .three-dots{display:none;position:absolute;cursor:pointer;top:0;right:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding));order:2;box-sizing:content-box;height:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding))}.wrapper .three-dots:focus{outline:0;background-color:var(--panel__more-dots__selected__background-color)}.wrapper .three-dots.non-collapsible{right:0}.wrapper .three-dots.disabled{pointer-events:none}.wrapper .three-dots .menu{display:none;position:absolute;background-color:var(--panel__more-dots__menu__background-color);top:100%;right:-1px;z-index:var(--panel__z-index-base);border:solid 1px var(--panel__more-dots__menu__border-color);border-top:none}.wrapper .three-dots .menu label{display:block;max-width:100%}.wrapper .three-dots.opened .menu{display:inline-block}.wrapper .three-dots::after{display:inline-block;line-height:var(--panel__default__line-height);font-size:var(--panel__default__line-height);padding:var(--panel__default__padding);font-family:iwp;content:'\\ea22'}.wrapper .three-dots.overflowing{display:inline-block}.wrapper .panel:not(.non-collapsible).opened::after{content:'\\e932'}.wrapper .content.disabled{pointer-events:none;opacity:.5}.wrapper .content{display:none}.wrapper .content.opened{display:block}.wrapper.disabled{cursor:no-drop}"]
    })
], PanelComponent);
export { PanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsicGFuZWwvcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUdULEtBQUssRUFDTCxZQUFZLEVBQ1osU0FBUyxFQUVULFdBQVcsRUFDWCxNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFDWixnQkFBZ0IsRUFHakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFRM0UsSUFBYSxjQUFjLEdBQTNCLE1BQWEsY0FBYztJQW9EekI7UUFwQ0EsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUVqQixXQUFNLEdBQUcsS0FBSyxDQUFDO1FBRWYsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFNdkIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RDLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLHlCQUFvQixHQUFHLEtBQUssQ0FBQztJQXdCZCxDQUFDO0lBdEJoQixRQUFRO1FBQ04sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFHRCxTQUFTLENBQUMsS0FBb0I7UUFDNUIsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3hDLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLGFBQWEsQ0FBQztZQUNuQixLQUFLLEVBQUUsQ0FBQztZQUNSLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFBRTtvQkFDakQsSUFB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Q0FBQztvREFDRDtBQUV6QjtJQURDLFNBQVMsQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxDQUFDOzREQUN2QjtBQUV2QztJQURDLFNBQVMsQ0FBQyx1QkFBdUIsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxDQUFDOzZEQUN2QjtBQUV4QztJQURDLEtBQUssRUFBRTtnREFDUztBQUVqQjtJQURDLEtBQUssRUFBRTs4Q0FDTztBQUVmO0lBREMsS0FBSyxFQUFFO3NEQUNlO0FBR3ZCO0lBRkMsV0FBVyxDQUFDLFNBQVMsQ0FBQztJQUN0QixLQUFLLEVBQUU7MENBQ0c7QUFHWDtJQURDLE1BQU0sRUFBRTttREFDNkI7QUFJdEM7SUFEQyxZQUFZLENBQUMsZUFBZSxDQUFDOzhDQUc3QjtBQUdEO0lBREMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDOytDQWdCbkM7QUFsRFUsY0FBYztJQU4xQixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsV0FBVztRQUNyQix5MUNBQXFDO1FBRXJDLGVBQWUsRUFBRSxDQUFDLG1CQUFtQixDQUFDOztLQUN2QyxDQUFDO0dBQ1csY0FBYyxDQTJKMUI7U0EzSlksY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgQ29udGVudENoaWxkLFxuICBWaWV3Q2hpbGQsXG4gIE9uQ2hhbmdlcyxcbiAgSG9zdEJpbmRpbmcsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIFRlbXBsYXRlUmVmLFxuICBBZnRlclZpZXdJbml0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUGFuZWxDb250ZW50Q29tcG9uZW50IH0gZnJvbSAnLi9wYW5lbC1jb250ZW50LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJY29uQnV0dG9uQ29tcG9uZW50IH0gZnJvbSAnLi4vaWNvbi1idXR0b24vaWNvbi1idXR0b24uY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LXBhbmVsJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BhbmVsLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcGFuZWwuY29tcG9uZW50Lmxlc3MnXSxcbiAgZW50cnlDb21wb25lbnRzOiBbSWNvbkJ1dHRvbkNvbXBvbmVudF1cbn0pXG5leHBvcnQgY2xhc3MgUGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcyB7XG4gIEBDb250ZW50Q2hpbGQoUGFuZWxDb250ZW50Q29tcG9uZW50KVxuICBjaGlsZFBhbmVsQ29udGVudENvbXBvbmVudDogUGFuZWxDb250ZW50Q29tcG9uZW50O1xuICBAVmlld0NoaWxkKCd0cGwnKVxuICBpY29uczogVGVtcGxhdGVSZWY8YW55PjtcbiAgQFZpZXdDaGlsZCgncGFuZWwnKVxuICBsYWJlbHNEaXY6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3RocmVlRG90cycpXG4gIHRocmVlRG90czogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnbGFiZWxXcmFwcGVyJylcbiAgbGFiZWxXcmFwcGVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdoaWRkZW5JY29uc0NvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KVxuICBoaWRkZW5JY29uc0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcbiAgQFZpZXdDaGlsZCgndmlzaWJsZUljb25zQ29udGFpbmVyJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pXG4gIHZpc2libGVJY29uc0NvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcbiAgQElucHV0KClcbiAgZGlzYWJsZWQgPSBmYWxzZTtcbiAgQElucHV0KClcbiAgb3BlbmVkID0gZmFsc2U7XG4gIEBJbnB1dCgpXG4gIG5vbkNvbGxhcHNpYmxlID0gZmFsc2U7XG4gIEBIb3N0QmluZGluZygnYXR0ci5pZCcpXG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQE91dHB1dCgpXG4gIHRvZ2dsZUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIG92ZXJmbG93aW5nID0gZmFsc2U7XG4gIG92ZXJmbG93aW5nTWVudVN0YXRlID0gZmFsc2U7XG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnKVxuICBvblJlc2l6ZSgpIHtcbiAgICB0aGlzLnJlc2l6ZXIoKTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxuICBvbktleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBjb25zdCBrZXkgPSBldmVudC5jb2RlIHx8IGV2ZW50LmtleUNvZGU7XG4gICAgc3dpdGNoIChrZXkpIHtcbiAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgIGNhc2UgJ051bXBhZEVudGVyJzpcbiAgICAgIGNhc2UgMTM6XG4gICAgICBjYXNlICdTcGFjZSc6XG4gICAgICBjYXNlIDMyOlxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSB0aGlzLmxhYmVsc0Rpdi5uYXRpdmVFbGVtZW50KSB7XG4gICAgICAgICAgdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNoZWNrUHJvcGVydGllcygpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy5jaGVja1Byb3BlcnRpZXMoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLnZpc2libGVJY29uc0NvbnRhaW5lci5pbnNlcnQodGhpcy5pY29ucy5jcmVhdGVFbWJlZGRlZFZpZXcobnVsbCkpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5oaWRlSWNvbnNJZk5lY2Vzc2FyeSgpO1xuICAgIH0pO1xuICB9XG5cbiAgY2hlY2tQcm9wZXJ0aWVzKCkge1xuICAgIGlmICghdGhpcy5pZCkge1xuICAgICAgdGhpcy5pZCA9IE1hdGgucmFuZG9tKClcbiAgICAgICAgLnRvU3RyaW5nKDM2KVxuICAgICAgICAuc3Vic3RyaW5nKDIpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm5vbkNvbGxhcHNpYmxlID09PSB0cnVlKSB7XG4gICAgICB0aGlzLm9wZW5lZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgY2xvc2VNZW51KGU6IE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCBsZWF2aW5nUGFyZW50ID0gIXRoaXMudGhyZWVEb3RzLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoPE5vZGU+ZS5yZWxhdGVkVGFyZ2V0KTtcbiAgICBpZiAobGVhdmluZ1BhcmVudCkge1xuICAgICAgdGhpcy50b2dnbGVPdmVmbG93aW5nTWVudShlLCBmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgcmVzaXplcigpIHtcbiAgICBsZXQgcmVzaXplVGltZXI6IG51bWJlcjtcblxuICAgIGNsZWFyVGltZW91dChyZXNpemVUaW1lcik7XG4gICAgcmVzaXplVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuaGlkZUljb25zSWZOZWNlc3NhcnkodHJ1ZSk7XG4gICAgfSk7XG4gIH1cblxuICBoaWRlSWNvbnNJZk5lY2Vzc2FyeShzaG93QWxsRmlyc3Q/OiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLmxhYmVsc0RpdikgcmV0dXJuO1xuICAgIGlmIChzaG93QWxsRmlyc3QpIHtcbiAgICAgIHRoaXMuc2hvd0FsbEljb25zKCk7XG4gICAgICB0aGlzLm92ZXJmbG93aW5nID0gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGRlZmF1bHRIZWlnaHQgPSB0aGlzLmxhYmVsc0Rpdi5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmxhYmVsV3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICBpZiAoaGVpZ2h0ID4gZGVmYXVsdEhlaWdodCkge1xuICAgICAgdGhpcy5vdmVyZmxvd2luZyA9IHRydWU7XG4gICAgICBjb25zdCBpZCA9IHRoaXMuaGlkZUxhc3RJY29uKCk7XG4gICAgICBpZiAoaWQpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5oaWRlSWNvbnNJZk5lY2Vzc2FyeSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzaG93QWxsSWNvbnMoKSB7XG4gICAgd2hpbGUgKHRoaXMuaGlkZGVuSWNvbnNDb250YWluZXIubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy52aXNpYmxlSWNvbnNDb250YWluZXIuaW5zZXJ0KHRoaXMuaGlkZGVuSWNvbnNDb250YWluZXIuZGV0YWNoKDApKTtcbiAgICB9XG4gIH1cblxuICBoaWRlTGFzdEljb24oKTogYm9vbGVhbiB7XG4gICAgY29uc3QgbGVuZ3RoID0gdGhpcy52aXNpYmxlSWNvbnNDb250YWluZXIubGVuZ3RoO1xuICAgIHRoaXMuaGlkZGVuSWNvbnNDb250YWluZXIuaW5zZXJ0KHRoaXMudmlzaWJsZUljb25zQ29udGFpbmVyLmRldGFjaChsZW5ndGggLSAxKSwgMCk7XG5cbiAgICByZXR1cm4gbGVuZ3RoID4gMTtcbiAgfVxuXG4gIHRvZ2dsZShzdGF0ZT86IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5ub25Db2xsYXBzaWJsZSB8fCB0aGlzLmRpc2FibGVkKSByZXR1cm47XG5cbiAgICBpZiAodHlwZW9mIHN0YXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5vcGVuZWQgPSBzdGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5vcGVuZWQgPSAhdGhpcy5vcGVuZWQ7XG4gICAgfVxuXG4gICAgdGhpcy50b2dnbGVFdmVudC5lbWl0KHtcbiAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgb3BlbmVkOiB0aGlzLm9wZW5lZFxuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlT3ZlZmxvd2luZ01lbnUoZTogTW91c2VFdmVudCwgc3RhdGU/OiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjtcblxuICAgIGlmICh0eXBlb2Ygc3RhdGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLm92ZXJmbG93aW5nTWVudVN0YXRlID0gc3RhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3ZlcmZsb3dpbmdNZW51U3RhdGUgPSAhdGhpcy5vdmVyZmxvd2luZ01lbnVTdGF0ZTtcbiAgICB9XG5cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG59XG4iXX0=