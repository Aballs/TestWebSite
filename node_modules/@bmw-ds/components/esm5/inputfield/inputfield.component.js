import { __decorate } from "tslib";
import { BaseInput } from './base-input';
import { AfterContentInit, ChangeDetectorRef, Component, ContentChild, HostListener, Input, OnInit, Output, EventEmitter, ViewChild, OnDestroy } from '@angular/core';
import { LabelComponent } from '../label/label.component';
var InputfieldComponent = /** @class */ (function () {
    function InputfieldComponent(cdRef) {
        this.cdRef = cdRef;
        this.filePlaceholder = '';
        this.iconClicked = new EventEmitter();
        this.preventSettingIDAutomatically = false;
    }
    Object.defineProperty(InputfieldComponent.prototype, "disabled", {
        get: function () {
            return this._disabled;
        },
        set: function (value) {
            this._disabled = value;
            if (this._label) {
                this._label.disabled = value;
            }
            this.cdRef.detectChanges();
        },
        enumerable: true,
        configurable: true
    });
    InputfieldComponent.prototype.ngOnInit = function () {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
    };
    InputfieldComponent.prototype.iconClick = function () {
        this.iconClicked.emit(this);
    };
    InputfieldComponent.prototype.ngAfterContentInit = function () {
        var _this = this;
        var _a;
        if (!this.input) {
            throw new Error('The inputfield must contain an element with the bmwInput directive.');
        }
        if (!this.preventSettingIDAutomatically) {
            var inputId = 'bmw-input-' + this.id;
            this.input.withIcon = this.icon && this.icon.length > 0;
            this.input.id = inputId;
            if (this._label) {
                this._label.inputId = this.input.id;
            }
        }
        this.type = this.input.type;
        // explicitly call change detection to avoid issues with dynamic component creation
        this.cdRef.detectChanges();
        this.disabled = this.input.disabled;
        this.input.disableToggle.subscribe(function (value) {
            _this.disabled = value;
        });
        window.MutationObserver = window.MutationObserver;
        this.filePlaceholder = ((_a = this.input) === null || _a === void 0 ? void 0 : _a.placeholder) || this.input._el.nativeElement.placeholder;
        this.mutationObserver = new MutationObserver(function (mutationRecord) {
            var placeholderMutation = mutationRecord.find(function (mutation) { return mutation.attributeName === 'placeholder'; });
            if (placeholderMutation) {
                _this.filePlaceholder = placeholderMutation.target.placeholder;
            }
        });
        this.mutationObserver.observe(this.input._el.nativeElement, { attributes: true });
    };
    InputfieldComponent.prototype._onInput = function () {
        // this is required in order to be notified about changes to the native input element
    };
    InputfieldComponent.prototype.ngOnDestroy = function () {
        var _a;
        (_a = this.mutationObserver) === null || _a === void 0 ? void 0 : _a.disconnect();
    };
    InputfieldComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input()
    ], InputfieldComponent.prototype, "icon", void 0);
    __decorate([
        Input()
    ], InputfieldComponent.prototype, "id", void 0);
    __decorate([
        Input()
    ], InputfieldComponent.prototype, "disabled", null);
    __decorate([
        Output()
    ], InputfieldComponent.prototype, "iconClicked", void 0);
    __decorate([
        ContentChild(BaseInput, { static: true })
    ], InputfieldComponent.prototype, "input", void 0);
    __decorate([
        Input()
    ], InputfieldComponent.prototype, "preventSettingIDAutomatically", void 0);
    __decorate([
        ContentChild(LabelComponent, { static: true })
    ], InputfieldComponent.prototype, "_label", void 0);
    __decorate([
        HostListener('input')
    ], InputfieldComponent.prototype, "_onInput", null);
    InputfieldComponent = __decorate([
        Component({
            selector: 'bmw-inputfield',
            template: "<div class=\"wrapper\" [class.with-icon]=\"icon\">\n  <div class=\"input\" [ngClass]=\"{ bmw__grid__inner: input.classes?.length }\">\n    <ng-content select=\"bmw-label\"></ng-content>\n    <div class=\"input-wrapper\" [ngClass]=\"[(input.classes || []).join(' ')]\">\n      <ng-content select=\"[bmwInput]\" ngProjectAs=\"input[bmwInput]\"></ng-content>\n      <div class=\"file-input\" *ngIf=\"type === 'file'\">\n        <input\n          bmwInput\n          class=\"bmw-input inputFileDisplay\"\n          [disabled]=\"disabled\"\n          readonly\n          [placeholder]=\"filePlaceholder\"\n          type=\"text\"\n        />\n        <bmw-button type=\"button\" button=\"secondary\" [disabled]=\"disabled\">Browse...</bmw-button>\n      </div>\n      <i *ngIf=\"icon\" (click)=\"iconClick()\" [ngClass]=\"[icon, 'icon']\" [class.disabled]=\"disabled\"></i>\n      <ng-content select=\"bmw-error-message\"></ng-content>\n    </div>\n  </div>\n</div>\n",
            styles: [".wrapper.with-icon .input ::ng-deep .stepper-controls{right:calc(var(--inputfield__default__line-height) + 2 * var(--inputfield__icon__padding))}.wrapper .input ::ng-deep .stepper-controls{height:var(--inputfield__default__height);position:absolute;top:0;right:0;display:flex;align-items:center;flex-wrap:nowrap;justify-content:space-around;margin-left:var(--inputfield__default__stepper-controls__margin-left);-ms-grid-column-align:left;justify-self:left}.wrapper .input ::ng-deep .stepper-controls .stepper-button{display:flex}.wrapper .input ::ng-deep .stepper-controls .stepper-button::-ms-clear{display:none}.wrapper .input ::ng-deep .stepper-controls .stepper-button:after{display:flex;align-items:center;justify-content:center;font-size:var(--inputfield__default__line-height);width:var(--inputfield__default__stepper-button__height);height:var(--inputfield__default__stepper-button__width);cursor:pointer;margin:0 auto}.wrapper .input ::ng-deep .stepper-controls .stepper-button:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}.wrapper .input ::ng-deep .stepper-controls .stepper-button:hover{background-color:var(--color-bmw-basic1-shade2)}.wrapper .input ::ng-deep .stepper-controls .stepper-button.increase{right:0}.wrapper .input ::ng-deep .stepper-controls .stepper-button.increase:after{content:'\\e982';font-family:iwp}.wrapper .input ::ng-deep .stepper-controls .stepper-button.decrease{right:var(--inputfield__default__stepper-button__right)}.wrapper .input ::ng-deep .stepper-controls .stepper-button.decrease:after{content:'\\e983';font-family:iwp}.wrapper ::ng-deep .bmw-input[type=number]{-webkit-appearance:textfield;-moz-appearance:textfield;appearance:textfield}.wrapper ::ng-deep .bmw-input[type=number]::-ms-clear{display:none}.wrapper ::ng-deep .bmw-input[type=number]:disabled~.stepper-controls .stepper-button:after{cursor:no-drop;opacity:.5}.wrapper ::ng-deep .bmw-input[type=number]:disabled~.stepper-controls .stepper-button:hover{background-color:inherit}.wrapper ::ng-deep .bmw-input[type=number]:disabled~.stepper-controls .stepper-button:focus{outline:0}.wrapper .file-input{display:flex;align-items:flex-end;flex-wrap:nowrap;z-index:var(--inputfield__z-index);width:100%}.wrapper .file-input bmw-button{order:2;flex:1 0;margin-left:var(--spacing-bmw-xs);height:100%}.wrapper .file-input bmw-button ::ng-deep button{padding:var(--inputfield__browse-button__padding);height:100%}.wrapper .file-input bmw-button ::ng-deep .bmw-component-headline-text{line-height:1rem}.wrapper ::ng-deep .bmw-input[type=file]{display:none;position:relative;z-index:2;cursor:pointer;font-size:0;width:.1px;height:.1px}.wrapper ::ng-deep .bmw-input[type=file]::-ms-clear{display:none}.wrapper ::ng-deep .bmw-input[type=file]:disabled{cursor:no-drop}.wrapper ::ng-deep .bmw-input[type=file]:disabled::-webkit-file-upload-button{cursor:no-drop}.wrapper ::ng-deep .bmw-input[type=file]::-webkit-file-upload-button{cursor:pointer}.wrapper ::ng-deep .bmw-input[type=file].ng-invalid.ng-touched+div>.bmw-input{background-color:var(--inputfield__error__background-color)!important;border-bottom-color:var(--inputfield__error__color)!important}.wrapper{position:relative;margin-bottom:var(--inputfield__default__margin-bottom);box-sizing:border-box;justify-content:flex-start;flex-wrap:wrap}.wrapper .stateWrapper{position:relative;display:var(--inputfield__default__state-wrapper__display);width:var(--inputfield__default__state-wrapper__width)}.wrapper .input-wrapper{position:relative;display:flex;flex-wrap:wrap}.wrapper .input{position:relative;grid-row-gap:0}.wrapper ::ng-deep .bmw-input{border:none;border-radius:0;border-bottom:1px solid var(--inputfield__default__border-bottom__color);box-sizing:border-box;color:var(--inputfield__default__color);background-color:var(--inputfield__default__background-color);font-family:Arial;font-size:var(--typography__component-text__font-size);line-height:var(--typography__component-text__line-height);opacity:1;width:100%;padding:var(--inputfield__input__padding);padding-top:var(--inputfield__input__padding-top);padding-bottom:var(--inputfield__input__padding-bottom)}.wrapper ::ng-deep .bmw-input:not(textarea){height:var(--inputfield__default__height)}.wrapper ::ng-deep .bmw-input::-ms-clear{display:none}.wrapper ::ng-deep .bmw-input::after{content:'\\ea93';font-family:iwp}.wrapper ::ng-deep .bmw-input::-moz-placeholder{font-family:Arial;font-size:var(--typography__component-text__font-size);line-height:var(--typography__component-text__line-height);color:var(--inputfield__placeholder__color);opacity:1}.wrapper ::ng-deep .bmw-input:-ms-input-placeholder{font-family:Arial;font-size:var(--typography__component-text__font-size);line-height:var(--typography__component-text__line-height);color:var(--inputfield__placeholder__color);opacity:1}.wrapper ::ng-deep .bmw-input::placeholder{font-family:Arial;font-size:var(--typography__component-text__font-size);line-height:var(--typography__component-text__line-height);color:var(--inputfield__placeholder__color);opacity:1}.wrapper ::ng-deep .bmw-input:focus:not([readonly]){outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px;border-bottom-color:var(--inputfield__hover__border-bottom__color)}.wrapper ::ng-deep .bmw-input:focus[readonly]{outline:0}.wrapper ::ng-deep .bmw-input:hover{border-bottom-color:var(--inputfield__hover__border-bottom__color)}::ng-deep .wrapper ::ng-deep .bmw-input.ng-invalid.ng-touched{background-color:var(--inputfield__error__background-color)!important;border-bottom-color:var(--inputfield__error__color)!important}.wrapper ::ng-deep .bmw-input:disabled{color:var(--inputfield__disabled__color);border-color:var(--inputfield__disabled__color);cursor:no-drop}.wrapper ::ng-deep .bmw-input:disabled+div.stepper-controls{color:var(--inputfield__disabled__color)}.wrapper ::ng-deep .bmw-input:disabled::-moz-placeholder{color:var(--inputfield__disabled__color)}.wrapper ::ng-deep .bmw-input:disabled:-ms-input-placeholder{color:var(--inputfield__disabled__color)}.wrapper ::ng-deep .bmw-input:disabled::placeholder{color:var(--inputfield__disabled__color)}.wrapper ::ng-deep .bmw-input:-moz-read-only:not(.inputFileDisplay){border:none;background-color:rgba(0,0,0,0)!important;color:var(--inputfield__readonly__color);cursor:default}.wrapper ::ng-deep .bmw-input:read-only:not(.inputFileDisplay){border:none;background-color:rgba(0,0,0,0)!important;color:var(--inputfield__readonly__color);cursor:default}.wrapper ::ng-deep .bmw-input:-moz-read-only:not(.inputFileDisplay)+div.stateWrapper div.steppers{display:none}.wrapper ::ng-deep .bmw-input:read-only:not(.inputFileDisplay)+div.stateWrapper div.steppers{display:none}.wrapper.with-icon ::ng-deep input{padding-right:calc(var(--inputfield__input__padding) + var(--inputfield__icon__size__with-padding))}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.wrapper.with-icon ::ng-deep input{padding-right:30px}}.wrapper span.label{display:block;line-height:calc(2 * var(--inputfield__default__line-height))}.wrapper i{display:inline-block;width:var(--inputfield__default__line-height);height:var(--inputfield__default__line-height);margin-left:calc(0px - var(--inputfield__default__line-height) - 2 * var(--inputfield__icon__padding));-ms-grid-row-align:center;align-self:center}.wrapper i:before{width:var(--inputfield__default__line-height);height:var(--inputfield__default__line-height);font-size:var(--inputfield__default__line-height)}.wrapper ::ng-deep .bmw-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.wrapper ::ng-deep .bmw-input[type=password]{font-family:input-password,Arial}.wrapper ::ng-deep textarea.bmw-input{padding-top:var(--spacing-bmw-xs);padding-bottom:calc(var(--spacing-bmw-xs) - 1px)}::ng-deep .reversed .wrapper input,::ng-deep .reversed .wrapper textarea{background-color:var(--inputfield__reversed__background-color)!important}.icon.disabled{color:var(--inputfield__disabled__color)}"]
        })
    ], InputfieldComponent);
    return InputfieldComponent;
}());
export { InputfieldComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRmaWVsZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYm13LWRzL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJpbnB1dGZpZWxkL2lucHV0ZmllbGQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFDTCxnQkFBZ0IsRUFDaEIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQU8xRDtJQXNDRSw2QkFBb0IsS0FBd0I7UUFBeEIsVUFBSyxHQUFMLEtBQUssQ0FBbUI7UUFoQzVDLG9CQUFlLEdBQVEsRUFBRSxDQUFDO1FBYTFCLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFjcEQsa0NBQTZCLEdBQUcsS0FBSyxDQUFDO0lBS1MsQ0FBQztJQTlCaEQsc0JBQUkseUNBQVE7YUFPWjtZQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUN4QixDQUFDO2FBVEQsVUFBYSxLQUFjO1lBQ3pCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1lBQ3ZCLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDZixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7YUFDOUI7WUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdCLENBQUM7OztPQUFBO0lBMEJELHNDQUFRLEdBQVI7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNaLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtp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RUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7dURBQ2hCO0lBbUQvQjtRQURDLFlBQVksQ0FBQyxPQUFPLENBQUM7dURBR3JCO0lBekZVLG1CQUFtQjtRQUwvQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsZ0JBQWdCO1lBQzFCLDg4QkFBMEM7O1NBRTNDLENBQUM7T0FDVyxtQkFBbUIsQ0E4Ri9CO0lBQUQsMEJBQUM7Q0FBQSxBQTlGRCxJQThGQztTQTlGWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlSW5wdXQgfSBmcm9tICcuL2Jhc2UtaW5wdXQnO1xuaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBIb3N0TGlzdGVuZXIsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBWaWV3Q2hpbGQsXG4gIE9uRGVzdHJveVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJtd0lucHV0RGlyZWN0aXZlIH0gZnJvbSAnLi9ibXctaW5wdXQuZGlyZWN0aXZlJztcbmltcG9ydCB7IExhYmVsQ29tcG9uZW50IH0gZnJvbSAnLi4vbGFiZWwvbGFiZWwuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LWlucHV0ZmllbGQnLFxuICB0ZW1wbGF0ZVVybDogJy4vaW5wdXRmaWVsZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2lucHV0ZmllbGQuY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBJbnB1dGZpZWxkQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKVxuICBpY29uOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG4gIG11dGF0aW9uT2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXI7XG4gIGZpbGVQbGFjZWhvbGRlcjogYW55ID0gJyc7XG4gIEBJbnB1dCgpXG4gIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2Rpc2FibGVkID0gdmFsdWU7XG4gICAgaWYgKHRoaXMuX2xhYmVsKSB7XG4gICAgICB0aGlzLl9sYWJlbC5kaXNhYmxlZCA9IHZhbHVlO1xuICAgIH1cbiAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuICBnZXQgZGlzYWJsZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xuICB9XG4gIEBPdXRwdXQoKVxuICBpY29uQ2xpY2tlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIHR5cGU6IHN0cmluZztcblxuICAvKipcbiAgICogUGxlYXNlIGxlYXZlIGl0IHVuZGVmaW5lZCBhbmQgZG9uJ3QgaW5pdGlhbGl6ZSBpdCB3aXRoIGZhbHNlXG4gICAqIGFzIHRoZSBibXdJbnB1dCBkaXJlY3RpdmUgbmVlZHMgdGhhdCBpbmZvcm1hdGlvblxuICAgKiB0byB3b3JrIGNvcnJlY3RseSBvciB5b3UgcnVuIGludG8gdGhlIHByb2JsZW0gdGhhdCB0aGUgaW5wdXRmaWVsZCB3YW50cyB0byByZWFkXG4gICAqIGZyb20gdGhlIGJtd0lucHV0IGFuZCB2aWNlIHZlcnNhXG4gICAqL1xuICBfZGlzYWJsZWQ6IGJvb2xlYW47XG4gIEBDb250ZW50Q2hpbGQoQmFzZUlucHV0LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBwdWJsaWMgaW5wdXQ7XG5cbiAgQElucHV0KClcbiAgcHJldmVudFNldHRpbmdJREF1dG9tYXRpY2FsbHkgPSBmYWxzZTtcblxuICBAQ29udGVudENoaWxkKExhYmVsQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBwcml2YXRlIF9sYWJlbDogTGFiZWxDb21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjZFJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKCF0aGlzLmlkKSB7XG4gICAgICB0aGlzLmlkID0gTWF0aC5yYW5kb20oKVxuICAgICAgICAudG9TdHJpbmcoMzYpXG4gICAgICAgIC5zdWJzdHJpbmcoMik7XG4gICAgfVxuICB9XG5cbiAgaWNvbkNsaWNrKCkge1xuICAgIHRoaXMuaWNvbkNsaWNrZWQuZW1pdCh0aGlzKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuaW5wdXQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGlucHV0ZmllbGQgbXVzdCBjb250YWluIGFuIGVsZW1lbnQgd2l0aCB0aGUgYm13SW5wdXQgZGlyZWN0aXZlLicpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMucHJldmVudFNldHRpbmdJREF1dG9tYXRpY2FsbHkpIHtcbiAgICAgIGNvbnN0IGlucHV0SWQgPSAnYm13LWlucHV0LScgKyB0aGlzLmlkO1xuICAgICAgdGhpcy5pbnB1dC53aXRoSWNvbiA9IHRoaXMuaWNvbiAmJiB0aGlzLmljb24ubGVuZ3RoID4gMDtcbiAgICAgIHRoaXMuaW5wdXQuaWQgPSBpbnB1dElkO1xuICAgICAgaWYgKHRoaXMuX2xhYmVsKSB7XG4gICAgICAgIHRoaXMuX2xhYmVsLmlucHV0SWQgPSB0aGlzLmlucHV0LmlkO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnR5cGUgPSB0aGlzLmlucHV0LnR5cGU7XG4gICAgLy8gZXhwbGljaXRseSBjYWxsIGNoYW5nZSBkZXRlY3Rpb24gdG8gYXZvaWQgaXNzdWVzIHdpdGggZHluYW1pYyBjb21wb25lbnQgY3JlYXRpb25cbiAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICB0aGlzLmRpc2FibGVkID0gdGhpcy5pbnB1dC5kaXNhYmxlZDtcblxuICAgIHRoaXMuaW5wdXQuZGlzYWJsZVRvZ2dsZS5zdWJzY3JpYmUoKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICB0aGlzLmRpc2FibGVkID0gdmFsdWU7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyO1xuICAgIHRoaXMuZmlsZVBsYWNlaG9sZGVyID0gdGhpcy5pbnB1dD8ucGxhY2Vob2xkZXIgfHwgdGhpcy5pbnB1dC5fZWwubmF0aXZlRWxlbWVudC5wbGFjZWhvbGRlcjtcbiAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtdXRhdGlvblJlY29yZCA9PiB7XG4gICAgICBjb25zdCBwbGFjZWhvbGRlck11dGF0aW9uOiBNdXRhdGlvblJlY29yZCA9IG11dGF0aW9uUmVjb3JkLmZpbmQoXG4gICAgICAgIG11dGF0aW9uID0+IG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgPT09ICdwbGFjZWhvbGRlcidcbiAgICAgICk7XG4gICAgICBpZiAocGxhY2Vob2xkZXJNdXRhdGlvbikge1xuICAgICAgICB0aGlzLmZpbGVQbGFjZWhvbGRlciA9IChwbGFjZWhvbGRlck11dGF0aW9uLnRhcmdldCBhcyBhbnkpLnBsYWNlaG9sZGVyO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMubXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKHRoaXMuaW5wdXQuX2VsLm5hdGl2ZUVsZW1lbnQsIHsgYXR0cmlidXRlczogdHJ1ZSB9KTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2lucHV0JylcbiAgX29uSW5wdXQoKSB7XG4gICAgLy8gdGhpcyBpcyByZXF1aXJlZCBpbiBvcmRlciB0byBiZSBub3RpZmllZCBhYm91dCBjaGFuZ2VzIHRvIHRoZSBuYXRpdmUgaW5wdXQgZWxlbWVudFxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5tdXRhdGlvbk9ic2VydmVyPy5kaXNjb25uZWN0KCk7XG4gIH1cbn1cbiJdfQ==