import { __decorate, __param, __read, __spread } from "tslib";
import { AfterContentInit, Component, ContentChildren, ContentChild, ElementRef, EventEmitter, HostBinding, HostListener, Input, OnChanges, OnDestroy, OnInit, Output, QueryList, ViewChild, AfterViewInit, Self, Optional, ChangeDetectorRef, SimpleChanges } from '@angular/core';
import { ComboBoxDropdownItemComponent } from './combo-box-dropdown-item.component';
import { ComboBoxInputComponent } from './combo-box-input.component';
import { LabelComponent } from '../label/label.component';
import { ControlValueAccessor, NgControl } from '@angular/forms';
import { fromEvent, merge, Subject } from 'rxjs';
import { map, takeUntil } from 'rxjs/operators';
var ComboBoxComponent = /** @class */ (function () {
    function ComboBoxComponent(control, elementRef, cdRef) {
        var _this = this;
        this.control = control;
        this.elementRef = elementRef;
        this.cdRef = cdRef;
        this.noResultsPlaceholder = 'No results found';
        this.disabled = false;
        this.tabIndex = 0;
        this.required = false;
        this.clearable = true;
        this.hostTabIndex = '-1';
        this.filteredItems = [];
        this._items = [];
        this.selectedItems = [];
        this.opened = false;
        this.showInvalidState = false;
        this.comboFocused = false;
        this._type = "SINGLE" /* SINGLE */;
        this._inputFocused = false;
        this._isTouched = false;
        this.multiComboBoxText = 'Selected';
        this.scrollOffset = 0;
        this.onDestroy$ = new Subject();
        this.changeEvent = new EventEmitter();
        this.open = new EventEmitter();
        /**
         * Text to be used in multi combo boxes that use text instead of tags.
         * It can be a string or a callback function that takes the array of selected items and returns the text in a custom format.
         * In case of providing a string, it replaces the text of the default format: 'Selected (0)'.
         */
        this.selectedOptionsText = function (items) { return 'Selected (' + items.length + ')'; };
        this._onChange = function () { };
        this._onTouched = function () { };
        this._defaultFilter = function (searchQuery, allComboBoxItems) {
            return allComboBoxItems.filter(function (_a) {
                var label = _a.label;
                return (label === null || label === void 0 ? void 0 : label.toString().toLocaleLowerCase().includes(_this.input.value.toLocaleLowerCase())) ? true
                    : false;
            });
        };
        if (this.control)
            this.control.valueAccessor = this;
    }
    Object.defineProperty(ComboBoxComponent.prototype, "value", {
        get: function () {
            return this._value;
        },
        set: function (newValue) {
            this.changeValue(newValue, { emitEvent: true });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboBoxComponent.prototype, "useMulti", {
        get: function () {
            return this._type === "MULTI" /* MULTI */;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ComboBoxComponent.prototype, "type", {
        set: function (comboBoxType) {
            // coerce inputType
            if (this._type !== comboBoxType) {
                this._type = comboBoxType;
            }
        },
        enumerable: true,
        configurable: true
    });
    ComboBoxComponent.prototype.onKeydown = function (event) {
        var key = event.code || event.keyCode;
        switch (key) {
            case 'ArrowDown':
            case 40:
                if (this.opened) {
                    this.setNextItemAsFocused();
                    this.cdRef.detectChanges();
                    this.showInvalidState = false;
                }
                else {
                    this.toggle();
                }
                event.preventDefault();
                break;
            case 'ArrowUp':
            case 38:
                if (this.opened) {
                    this.setPreviousItemAsFocused();
                    this.cdRef.detectChanges();
                    this.showInvalidState = false;
                }
                else {
                    this.toggle();
                }
                event.preventDefault();
                break;
            case 'Backspace':
            case 8:
            case 'Delete':
            case 46:
                if (this.useMulti && this.selectedItems.length > 0 && !this.comboFocused) {
                    var focusedTag = this.selectedItems.find(function (item) { return item.focused === true; });
                    if (focusedTag) {
                        this.toggleMultiModeItem(focusedTag);
                        this.inputBox.nativeElement.querySelector('input').focus();
                    }
                }
                break;
            case 'Enter':
            case 'NumpadEnter':
            case 13:
                if (event.target === this.inputBox.nativeElement.querySelector('.clear.iwp-icon-gen_close')) {
                    this.clear();
                }
                else if (this.opened && this.filteredItems.length > 0) {
                    var isOnlyItemLeft = this.filteredItems.length === 1;
                    var itemToSelect_1;
                    if (isOnlyItemLeft) {
                        itemToSelect_1 = this.filteredItems[0];
                    }
                    else {
                        itemToSelect_1 = this.filteredItems.find(function (item) { return item.focused === true; });
                    }
                    if (itemToSelect_1 && !itemToSelect_1.disabled) {
                        if (!this.useMulti) {
                            this.selectItem(this.items.find(function (item) { return item.value === itemToSelect_1.value; }));
                            this.resetFocusedItem();
                            this.inputBox.nativeElement.querySelector('input').blur();
                        }
                        else {
                            this.toggleMultiModeItem(itemToSelect_1, { removeFocusAfterSelection: false });
                            if (isOnlyItemLeft) {
                                this.input.value = '';
                                this.cleanFilter();
                            }
                        }
                    }
                }
                event.stopPropagation();
                event.preventDefault();
                break;
            case 'Space':
            case 32:
                if (!this.opened || !this.input.value) {
                    this.toggle();
                    event.returnValue = false;
                    this.inputBox.nativeElement.querySelector('input').focus();
                }
                break;
            case 'Escape':
            case 27:
            case 'Tab':
            case 9:
                if (this.opened) {
                    this.toggle(false);
                }
                this.updateViewInputAfterDropdownClosed();
                if (!this.filteredItems.find(function (item) { return item.focused === true; })) {
                    this.comboFocused = false;
                }
                break;
        }
    };
    ComboBoxComponent.prototype.onFocusout = function (_a) {
        var target = _a.target;
        if (target === this.inputBox.nativeElement.querySelector('input') && !this.opened) {
            this.updateViewInputAfterDropdownClosed();
        }
    };
    ComboBoxComponent.prototype.ngOnInit = function () {
        var _this = this;
        var _a;
        this._listenToInputFocus();
        (_a = this.control) === null || _a === void 0 ? void 0 : _a.valueChanges.pipe(takeUntil(this.onDestroy$)).subscribe(function (e) {
            _this._validate();
        });
        this.elementRef.nativeElement.focus = function () {
            _this.focusInput();
            _this.toggle(true);
        };
        this.updateMultiComboBoxText();
    };
    ComboBoxComponent.prototype.ngAfterContentInit = function () {
        var _this = this;
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
        this.filter();
        this._validate();
        this.items.changes.pipe(takeUntil(this.onDestroy$)).subscribe(function () {
            _this.mapItems();
            _this.updateViewInput();
            _this.cleanFilter();
        });
        this.refreshItemsState();
        if (this._label) {
            this._label.inputId = this.id;
        }
        this._setGridClasses();
    };
    ComboBoxComponent.prototype.ngAfterViewInit = function () {
        if (this._value) {
            // Initial value was set, update selected items
            this.updateViewInput();
            this.cleanFilter();
            this.cdRef.detectChanges();
        }
    };
    ComboBoxComponent.prototype.mapItems = function () {
        this._items = this.items.map(function (item) {
            return {
                value: item.value,
                label: item.label,
                disabled: item.disabled,
                focused: item.focused,
                selected: item.selected,
                id: item.id
            };
        });
    };
    ComboBoxComponent.prototype.ngOnChanges = function (changes) {
        if (changes.selectedOptionsText) {
            this.updateMultiComboBoxText();
        }
        this.filter();
        this._validate();
    };
    ComboBoxComponent.prototype.ngOnDestroy = function () {
        this.cdRef.detach();
        this.onDestroy$.next();
        this.onDestroy$.complete();
    };
    ComboBoxComponent.prototype.focusTag = function (selectedItem) {
        selectedItem.focused = true;
    };
    ComboBoxComponent.prototype.focusoutTag = function (selectedItem) {
        selectedItem.focused = false;
    };
    ComboBoxComponent.prototype.selectTag = function (selectedItem) {
        if (selectedItem) {
            // remove selection from all tags
            this.selectedItems = this.selectedItems.map(function (item) {
                item.focused = false;
                return item;
            });
            this.updateMultiComboBoxText();
        }
    };
    ComboBoxComponent.prototype.toggle = function (state) {
        if (!this.disabled) {
            var initialOpenedState = this.opened;
            if (typeof state !== 'undefined') {
                this.opened = state;
            }
            else {
                this.opened = !this.opened;
            }
            if (this.opened !== initialOpenedState) {
                if (this.opened) {
                    this.outsideCallback = this.onClickOutside.bind(this);
                    document.addEventListener('mouseup', this.outsideCallback);
                    document.addEventListener('touchend', this.outsideCallback);
                    this.inputBox.nativeElement.querySelector('input').focus();
                    this.open.emit();
                }
                else {
                    this.resetFocusedItem();
                    document.removeEventListener('mouseup', this.outsideCallback);
                    document.removeEventListener('touchend', this.outsideCallback);
                    this.comboFocused = this._inputFocused;
                }
            }
        }
    };
    ComboBoxComponent.prototype.onClickOutside = function (_a) {
        var target = _a.target;
        var _b;
        if (!this.elementRef.nativeElement.querySelector('.combo-box-container').contains(target) &&
            !((_b = target.shadowRoot) === null || _b === void 0 ? void 0 : _b.querySelector('bmw-combo-box'))) {
            this.toggle(false);
            this.updateViewInputAfterDropdownClosed();
        }
    };
    ComboBoxComponent.prototype.refreshItemsState = function () {
        this.mapItems();
        this.filteredItems = __spread(this._items);
    };
    ComboBoxComponent.prototype.resetFocusedItem = function () {
        this.filteredItems.forEach(function (item) { return (item.focused = false); });
    };
    ComboBoxComponent.prototype.setPreviousItemAsFocused = function () {
        if (this.opened && this.filteredItems.length > 0 && this.filteredItems.some(function (item) { return !item.disabled; })) {
            var focusedItemIndex = this.filteredItems.findIndex(function (item) { return item.focused === true; });
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== 0) {
                focusedItemIndex = focusedItemIndex - 1;
            }
            else {
                focusedItemIndex = this.filteredItems.length - 1;
            }
            this.filteredItems[focusedItemIndex].focused = true;
            if (this.filteredItems[focusedItemIndex].disabled) {
                this.setPreviousItemAsFocused();
            }
        }
    };
    ComboBoxComponent.prototype.setNextItemAsFocused = function () {
        if (this.opened && this.filteredItems.length > 0 && this.filteredItems.filter(function (item) { return !item.disabled; }).length > 0) {
            var focusedItemIndex = this.filteredItems.findIndex(function (item) { return item.focused === true; });
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== this.filteredItems.length - 1) {
                focusedItemIndex = focusedItemIndex + 1;
            }
            else {
                focusedItemIndex = 0;
            }
            this.filteredItems[focusedItemIndex].focused = true;
            if (this.filteredItems[focusedItemIndex].disabled) {
                this.setNextItemAsFocused();
            }
        }
    };
    ComboBoxComponent.prototype.toggleMultiModeItem = function (item, options) {
        item.selected = !item.selected;
        this.updateSelectedItems(item);
        if (!options || options.removeFocusAfterSelection) {
            var currentlyFocusedIndex = this.filteredItems.findIndex(function (searchedItem) { return !!searchedItem.focused; });
            if (currentlyFocusedIndex > 0) {
                this.filteredItems[currentlyFocusedIndex].focused = false;
            }
        }
        var itemInDropdownList = this.filteredItems.find(function (dropdownItem) { return dropdownItem.value === item.value; });
        itemInDropdownList.selected = item.selected;
        this.findFocusedTag();
        this.emitSelectedItemsChange();
        this._validate();
    };
    ComboBoxComponent.prototype.updateSelectedItems = function (item) {
        if (item.selected) {
            this.selectedItems.push(item);
        }
        else {
            this.selectedItems = this.selectedItems.filter(function (element) {
                return element.value !== item.value;
            });
        }
        this.updateMultiComboBoxText();
    };
    ComboBoxComponent.prototype.updateViewInput = function () {
        var _this = this;
        var _a;
        if (Array.isArray(this._value) || this.useMulti) {
            this._items = this._items.map(function (item) {
                var _a;
                item.selected = (_a = _this._value) === null || _a === void 0 ? void 0 : _a.includes(item.value);
                return item;
            });
            this.selectedItems = this._items.filter(function (item) { return item.selected; });
            this.updateMultiComboBoxText();
        }
        else {
            if (this._value === null) {
                this.resetDropdownItems();
            }
            var selectedItem = this.findItemByValue(this._value);
            if (this.input) {
                this.input.value = (_a = selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.label) !== null && _a !== void 0 ? _a : '';
            }
        }
    };
    ComboBoxComponent.prototype.updateMultiComboBoxText = function () {
        if (this.useMulti) {
            if (typeof this.selectedOptionsText === 'function') {
                this.multiComboBoxText = this.selectedOptionsText(this.selectedItems);
            }
            else {
                this.multiComboBoxText = this.selectedOptionsText + ' (' + this.selectedItems.length + ')';
            }
        }
    };
    ComboBoxComponent.prototype.focusFirstFilteredItem = function () {
        if (this.input && this.opened && this.filteredItems.length > 0 && this.filteredItems.some(function (item) { return !item.disabled; })) {
            var enabledItems = this.filteredItems.filter(function (item) { return !item.disabled; });
            enabledItems[0].focused = true;
            this.cdRef.detectChanges();
            this.inputBox.nativeElement.querySelector('input').focus();
            this.showInvalidState = false;
        }
    };
    ComboBoxComponent.prototype.updateViewInputAfterDropdownClosed = function () {
        this.resetFocusedItem();
        if (!this.useMulti && this._value) {
            this.updateViewInput();
        }
        else {
            this.input.value = '';
        }
        this.cleanFilter();
        this._validate();
    };
    ComboBoxComponent.prototype.resetDropdownItems = function () {
        this.filteredItems = __spread(this._items);
        this.selectedItems = [];
        this.updateMultiComboBoxText();
        this._items = this._items.map(function (item) {
            item.selected = false;
            return item;
        });
    };
    ComboBoxComponent.prototype.emitSelectedItemsChange = function () {
        var _selectedItems = this._items.filter(function (item) { return item.selected; }).map(function (item) { return item.value; });
        this.value = _selectedItems;
        this.changeEvent.emit(_selectedItems);
        this._onChange(_selectedItems);
        this._onTouched();
    };
    ComboBoxComponent.prototype.filter = function () {
        var _a, _b, _c;
        this.resetFocusedItem();
        if (!this._items) {
            this.filteredItems = [];
            return;
        }
        var filter = (_a = this.customFilter) !== null && _a !== void 0 ? _a : this._defaultFilter;
        this.filteredItems = filter((_c = (_b = this.input) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.toString(), this._items);
    };
    ComboBoxComponent.prototype.filterAndOpenDropdown = function () {
        this.filter();
        this.toggle(true);
        this.focusFirstFilteredItem();
    };
    ComboBoxComponent.prototype.cleanFilter = function () {
        if (!this._items) {
            this.filteredItems = [];
        }
        else {
            this.filteredItems = this._items;
        }
    };
    ComboBoxComponent.prototype.selectItem = function (item) {
        if (this.useMulti) {
            this.toggleMultiModeItem(item);
        }
        else {
            this.value = item.value;
            this.filteredItems = __spread(this._items);
            this.toggle(false);
            this.changeEvent.emit(item.value);
            this._onTouched();
            this._validate();
        }
    };
    ComboBoxComponent.prototype.findItemByValue = function (value) {
        if (!this.items)
            return null;
        return this.items.filter(function (item) {
            return item.value === value || JSON.stringify(item.value) === JSON.stringify(value);
        })[0];
    };
    ComboBoxComponent.prototype.clear = function () {
        this._value = null;
        this.input.value = null;
        this.changeEvent.emit(null);
        this._onChange(null);
        this._onTouched();
        this._validate();
    };
    ComboBoxComponent.prototype.isFormReset = function () {
        var reset = false;
        if (this.control) {
            var pristine = this.control.pristine;
            reset = this._value === null && pristine !== false;
        }
        return reset;
    };
    ComboBoxComponent.prototype.registerOnChange = function (fn) {
        this._onChange = fn;
    };
    ComboBoxComponent.prototype.registerOnTouched = function (fn) {
        this._onTouched = fn;
    };
    ComboBoxComponent.prototype.writeValue = function (value) {
        this.changeValue(value, { emitEvent: false });
    };
    ComboBoxComponent.prototype.setDisabledState = function (disabled) {
        this.disabled = disabled;
    };
    ComboBoxComponent.prototype.changeValue = function (newValue, options) {
        this._value = newValue;
        this.updateViewInput();
        if (Array.isArray(newValue)) {
            this.findFocusedTag();
        }
        if (options.emitEvent && !this.isFormReset()) {
            this._onChange(newValue);
        }
        this._validate();
    };
    ComboBoxComponent.prototype._validate = function () {
        if (this.control) {
            var _a = this.control, touched = _a.touched, invalid = _a.invalid;
            this.showInvalidState = invalid && touched;
        }
        else {
            if (this.useMulti) {
                this.showInvalidState =
                    this._isTouched && this.required === true && this._items.filter(function (item) { return item.selected; }).length === 0;
            }
            else {
                this.showInvalidState = this._isTouched && this.required === true && !this._value;
            }
        }
    };
    ComboBoxComponent.prototype._listenToInputFocus = function () {
        var _this = this;
        if (!this.inputBox)
            return;
        var inputElement = this.inputBox.nativeElement.querySelector('input');
        var focusEvent = fromEvent(inputElement, 'focus').pipe(map(function () { return 'focus'; }));
        var blurEvent = fromEvent(inputElement, 'blur').pipe(map(function () { return 'blur'; }));
        merge(focusEvent, blurEvent)
            .pipe(takeUntil(this.onDestroy$), map(function (eventName) { return (eventName === 'focus' ? true : false); }))
            .subscribe(function (inputFocus) {
            _this.comboFocused = inputFocus;
        });
    };
    ComboBoxComponent.prototype.focusInput = function () {
        if (!this.disabled) {
            this._inputFocused = true;
            this.comboFocused = true;
        }
    };
    ComboBoxComponent.prototype.focusoutInput = function () {
        this._inputFocused = false;
        this.comboFocused = this.opened;
    };
    ComboBoxComponent.prototype._setGridClasses = function () {
        var _this = this;
        var listOfClasses = Array.from(this.elementRef.nativeElement.classList);
        this.gridClasses = listOfClasses.filter(function (item) { return item.match(/bmw__grid__cell.*/); });
        if (this.gridClasses.length > 0) {
            var wrapperClassList_1 = this.elementRef.nativeElement.querySelector('div.combo-box-container').classList;
            wrapperClassList_1.value.split(' ').forEach(function (className) {
                if (className.match(/bmw__grid__cell.*/)) {
                    wrapperClassList_1.remove(className);
                }
            });
            this.gridClasses.forEach(function (className) {
                _this.elementRef.nativeElement.querySelector('div.combo-box-container').classList.add(className);
                _this.elementRef.nativeElement.classList.remove(className);
            });
        }
    };
    ComboBoxComponent.prototype.findFocusedTag = function () {
        var _this = this;
        setTimeout(function () {
            var focused = _this.elementRef.nativeElement.querySelector('bmw-tag div.focused');
            if (!focused) {
                _this.scrollOffset = 0;
                return;
            }
            var diff = focused.parentElement.getBoundingClientRect().x -
                focused.parentElement.parentElement.parentElement.getBoundingClientRect().x -
                _this.scrollOffset;
            if (diff < 0) {
                _this.scrollOffset = -diff;
            }
            else {
                _this.scrollOffset = 0;
            }
        });
    };
    ComboBoxComponent.prototype.click = function () {
        this.toggle();
    };
    ComboBoxComponent.prototype.inputTouched = function () {
        this._isTouched = true;
        this._onTouched();
    };
    ComboBoxComponent.ctorParameters = function () { return [
        { type: NgControl, decorators: [{ type: Self }, { type: Optional }] },
        { type: ElementRef },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "placeholder", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "noResultsPlaceholder", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "disabled", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "tabIndex", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "required", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "clearable", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "customFilter", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "textInsteadOfTags", void 0);
    __decorate([
        HostBinding('attr.id'),
        Input()
    ], ComboBoxComponent.prototype, "id", void 0);
    __decorate([
        HostBinding('attr.tabindex')
    ], ComboBoxComponent.prototype, "hostTabIndex", void 0);
    __decorate([
        ContentChildren(ComboBoxDropdownItemComponent)
    ], ComboBoxComponent.prototype, "items", void 0);
    __decorate([
        ContentChild(LabelComponent, { static: true })
    ], ComboBoxComponent.prototype, "_label", void 0);
    __decorate([
        ViewChild(ComboBoxInputComponent)
    ], ComboBoxComponent.prototype, "input", void 0);
    __decorate([
        ViewChild('inputBox')
    ], ComboBoxComponent.prototype, "inputBox", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "value", null);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "type", null);
    __decorate([
        Output()
    ], ComboBoxComponent.prototype, "changeEvent", void 0);
    __decorate([
        Output()
    ], ComboBoxComponent.prototype, "open", void 0);
    __decorate([
        Input()
    ], ComboBoxComponent.prototype, "selectedOptionsText", void 0);
    __decorate([
        HostListener('keydown', ['$event'])
    ], ComboBoxComponent.prototype, "onKeydown", null);
    __decorate([
        HostListener('focusout', ['$event'])
    ], ComboBoxComponent.prototype, "onFocusout", null);
    ComboBoxComponent = __decorate([
        Component({
            selector: 'bmw-combo-box',
            template: "<div\n  class=\"combo-box-wrapper bmw__margin-bottom__xs\"\n  [ngClass]=\"{ bmw__grid__inner: gridClasses?.length }\"\n  [class.disabled]=\"disabled\"\n  [attr.aria-disabled]=\"disabled\"\n>\n  <ng-content select=\"bmw-label\"></ng-content>\n  <div class=\"combo-box-container\">\n    <div\n      class=\"combo-box\"\n      [class.disabled]=\"disabled\"\n      [class.invalid]=\"showInvalidState\"\n      [class.focused]=\"comboFocused\"\n    >\n      <div\n        class=\"select bmw-component-text outer-container\"\n        [class.open]=\"opened\"\n        [class.multi-combo-box]=\"useMulti\"\n        (click)=\"click()\"\n        #inputBox\n      >\n        <div class=\"combo-box-outer-wrapper inner-container\">\n          <div class=\"combo-box-inner-wrapper moving-container\">\n            <div\n              *ngIf=\"useMulti\"\n              class=\"multi-combo-box-tags\"\n              [ngClass]=\"{ 'multi-combo-box-tags--hidden': textInsteadOfTags }\"\n              [ngStyle]=\"{ left: scrollOffset.toString() + 'px' }\"\n            >\n              <ng-container *ngFor=\"let item of selectedItems\">\n                <bmw-tag\n                  *ngIf=\"item.selected\"\n                  [focused]=\"item.focused\"\n                  [label]=\"item.label\"\n                  [disabled]=\"item.disabled\"\n                  (click)=\"selectTag(item)\"\n                  (removeEvent)=\"toggleMultiModeItem(item)\"\n                  (focus)=\"focusTag(item)\"\n                  (focusout)=\"focusoutTag(item)\"\n                  [tabindex]=\"disabled ? -1 : tabIndex\"\n                ></bmw-tag>\n              </ng-container>\n            </div>\n            <div class=\"multi-combo-box-text-container\">\n              <span\n                *ngIf=\"useMulti\"\n                class=\"bmw-component-text multi-combo-box-text\"\n                [ngClass]=\"{ 'multi-combo-box-text--show': textInsteadOfTags }\"\n                [title]=\"multiComboBoxText\"\n              >\n                {{ multiComboBoxText }}\n              </span>\n            </div>\n            <input\n              [id]=\"'input-in-' + id\"\n              bmwComboBoxInput\n              [placeholder]=\"selectedItems.length === 0 ? placeholder || '' : ''\"\n              (inputEvent)=\"filterAndOpenDropdown()\"\n              [class.filled]=\"value\"\n              [class.invalid]=\"showInvalidState\"\n              [attr.aria-label]=\"'input-for-' + id\"\n              (focus)=\"focusInput()\"\n              (focusout)=\"focusoutInput()\"\n              (blur)=\"inputTouched()\"\n              [disabled]=\"disabled\"\n              [tabindex]=\"disabled ? -1 : tabIndex\"\n              [required]=\"required\"\n            />\n            <i\n              *ngIf=\"!useMulti && value && clearable\"\n              class=\"clear iwp-icon-gen_close\"\n              (click)=\"clear()\"\n              [tabindex]=\"disabled ? -1 : tabIndex\"\n            ></i>\n          </div>\n        </div>\n        <i class=\"arrow\" [class.iwp-icon-gen_arrow_down]=\"!opened\" [class.iwp-icon-gen_arrow_up]=\"opened\"></i>\n      </div>\n      <div [class.open]=\"opened\" class=\"dropdown-menu\">\n        <ng-container *ngIf=\"!useMulti\">\n          <bmw-combo-box-dropdown-item\n            *ngFor=\"let item of filteredItems\"\n            [value]=\"item.value\"\n            [label]=\"item.label\"\n            [disabled]=\"item.disabled\"\n            [focused]=\"item.focused\"\n            [id]=\"item.id\"\n            [selected]=\"item.value === value\"\n            (clickEvent)=\"selectItem(item)\"\n          >\n          </bmw-combo-box-dropdown-item>\n        </ng-container>\n        <ng-container *ngIf=\"useMulti\">\n          <bmw-combo-box-dropdown-checkbox-item\n            *ngFor=\"let item of filteredItems\"\n            [value]=\"item.value\"\n            [label]=\"item.label\"\n            [disabled]=\"item.disabled\"\n            [focused]=\"item.focused\"\n            [id]=\"item.id\"\n            [selected]=\"item.selected\"\n            (selectedChange)=\"toggleMultiModeItem(item)\"\n          >\n          </bmw-combo-box-dropdown-checkbox-item>\n        </ng-container>\n        <ng-container *ngIf=\"filteredItems.length === 0\">\n          <bmw-combo-box-dropdown-item [value]=\"noResultsPlaceholder\" [label]=\"noResultsPlaceholder\" [disabled]=\"true\">\n          </bmw-combo-box-dropdown-item>\n        </ng-container>\n      </div>\n    </div>\n    <ng-content select=\"bmw-error-message\"></ng-content>\n  </div>\n</div>\n",
            styles: [".combo-box{position:relative;cursor:pointer}input{height:var(--inputfield__default__height);text-overflow:ellipsis}.label{color:var(--combo-box__label__color)}.arrow{position:absolute;top:0;right:0;padding:var(--combo-box__default__padding);padding-bottom:0;padding-top:0;line-height:var(--inputfield__default__height);z-index:var(--combo-box__arrow__z-index)}.arrow:focus{outline:0}.clear{position:absolute;top:0;right:calc(var(--typography__component-text__font-size) + 2 * var(--combo-box__default__padding));padding:var(--combo-box__default__padding);padding-bottom:0;padding-top:0;line-height:var(--inputfield__default__height)}.clear:focus{outline:0}.clear:focus:before{outline:solid 1px;outline-color:var(--color-bmw-highlight)}bmw-tag{margin-right:var(--combo-box__tag__margin-right)}bmw-tag:focus{outline:0}.combo-box-wrapper,.label{grid-row-gap:0}.combo-box-wrapper.disabled,.label.disabled{pointer-events:none}.combo-box-wrapper.disabled .combo-box-select,.combo-box-wrapper.disabled .multi-combo-box,.label.disabled .combo-box-select,.label.disabled .multi-combo-box{border-bottom-color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled ::ng-deep label,.label.disabled ::ng-deep label{cursor:no-drop;color:var(--inputfield__disabled__color)}.combo-box-wrapper.disabled input,.label.disabled input{color:var(--combo-box__disabled__color);border-bottom-color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled input::-moz-placeholder,.label.disabled input::-moz-placeholder{color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled input:-ms-input-placeholder,.label.disabled input:-ms-input-placeholder{color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled input::placeholder,.label.disabled input::placeholder{color:var(--combo-box__disabled__color)}.combo-box-wrapper.disabled .arrow,.combo-box-wrapper.disabled .clear,.label.disabled .arrow,.label.disabled .clear{color:var(--combo-box__disabled__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused){background-color:var(--combo-box__error__background-color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) .combo-box-select,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) .multi-combo-box{border-bottom-color:var(--combo-box__error__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label{border-bottom-color:var(--combo-box__error__color);background-color:transparent}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input::-moz-placeholder,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label::-moz-placeholder{color:var(--combo-box__placeholder__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input:-ms-input-placeholder,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label:-ms-input-placeholder{color:var(--combo-box__placeholder__color)}:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) input::placeholder,:host.ng-invalid.ng-touched .combo-box:not(.disabled):not(.focused) label::placeholder{color:var(--combo-box__placeholder__color)}:host:focus{outline:0}.combo-box.invalid:not(.disabled){background-color:var(--combo-box__error__background-color)!important}.combo-box.invalid:not(.disabled) .combo-box-select,.combo-box.invalid:not(.disabled) .multi-combo-box{border-bottom-color:var(--combo-box__error__color)}.combo-box.invalid:not(.disabled) input,.combo-box.invalid:not(.disabled) label{border-bottom-color:var(--combo-box__error__color);background-color:transparent!important}.combo-box.invalid:not(.disabled) input::-moz-placeholder,.combo-box.invalid:not(.disabled) label::-moz-placeholder{color:var(--combo-box__placeholder__color)}.combo-box.invalid:not(.disabled) input:-ms-input-placeholder,.combo-box.invalid:not(.disabled) label:-ms-input-placeholder{color:var(--combo-box__placeholder__color)}.combo-box.invalid:not(.disabled) input::placeholder,.combo-box.invalid:not(.disabled) label::placeholder{color:var(--combo-box__placeholder__color)}.combo-box.focused{outline:solid 1px!important;outline-color:var(--combo-box__inputfield__focused__outline-color)!important;outline-offset:-1px}div.dropdown-menu{display:none;position:absolute;z-index:var(--combo-box__popup__z-index);overflow-y:auto;width:calc(100% - 2px);max-height:calc(5.66 * (var(--dropdown__default__line-height) + 2 * var(--combo-box__default__padding)));border:solid 1px var(--combo-box__dropdown-menu__border-color);border-top:none}div.dropdown-menu.open{display:block}.combo-box-wrapper.disabled{cursor:no-drop}.combo-box,.combo-box input{background-color:var(--combo-box__default__background-color)}::ng-deep .reversed .combo-box{background-color:var(--combo-box__reversed__background-color)!important}::ng-deep .reversed .combo-box input{background-color:var(--combo-box__reversed__background-color)!important}.multi-combo-box{display:flex;border-bottom:1px solid var(--combo-box__inputfield__default__border-bottom-color)}.multi-combo-box input{border:none}.multi-combo-box .combo-box-wrapper{display:flex;overflow:hidden}.multi-combo-box .multi-combo-box-tags{display:var(--combo-box__multiselect__tags__display);padding-top:calc(var(--combo-box__tag__margin-right) - 1px);padding-left:calc(var(--combo-box__tag__margin-right) - 1px);position:relative}.multi-combo-box .multi-combo-box-tags--hidden,.multi-combo-box .multi-combo-box-tags:empty{display:var(--combo-box__multiselect__no__tags__display)}.multi-combo-box .multi-combo-box-text-container{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;max-width:calc(100% - var(--combo-box__inputfield__default__min-width))}.multi-combo-box .multi-combo-box-text-container .multi-combo-box-text{display:var(--combo-box__multiselect__mobile-text__display);padding:var(--combo-box__text-instead-of-tags__padding);text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.multi-combo-box .multi-combo-box-text-container .multi-combo-box-text--show{display:var(--combo-box__multiselect__desktop__and__mobile-text__display)}.multi-combo-box-ellipsis{-ms-grid-row-align:center;align-self:center;padding-left:calc(var(--combo-box__tag__margin-right) - 1px)}.inner-container,.outer-container{width:100%}.multi-combo-box .outer-container{display:flex}.multi-combo-box .inner-container{overflow:hidden;margin-left:1px}.multi-combo-box .moving-container{display:flex;width:100%;justify-content:flex-end}"]
        }),
        __param(0, Self()), __param(0, Optional())
    ], ComboBoxComponent);
    return ComboBoxComponent;
}());
export { ComboBoxComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8tYm94LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BibXctZHMvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImNvbWJvLWJveC9jb21iby1ib3guY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsWUFBWSxFQUNaLFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULFNBQVMsRUFDVCxNQUFNLEVBQ04sTUFBTSxFQUNOLFNBQVMsRUFDVCxTQUFTLEVBQ1QsYUFBYSxFQUNiLElBQUksRUFDSixRQUFRLEVBQ1IsaUJBQWlCLEVBQ2pCLGFBQWEsRUFDZCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNwRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNyRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBdUJoRDtJQWdPRSwyQkFDOEIsT0FBa0IsRUFDdEMsVUFBc0IsRUFDdEIsS0FBd0I7UUFIbEMsaUJBTUM7UUFMNkIsWUFBTyxHQUFQLE9BQU8sQ0FBVztRQUN0QyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBN05sQyx5QkFBb0IsR0FBRyxrQkFBa0IsQ0FBQztRQUcxQyxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBR2pCLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFHYixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBR2pCLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFnQmpCLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBUXBCLGtCQUFhLEdBQW1CLEVBQUUsQ0FBQztRQUVuQyxXQUFNLEdBQW1CLEVBQUUsQ0FBQztRQUM1QixrQkFBYSxHQUFtQixFQUFFLENBQUM7UUFRbkMsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUN6QixpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUliLFVBQUsseUJBQXVCO1FBQzVCLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFDcEIsc0JBQWlCLEdBQUcsVUFBVSxDQUFDO1FBQy9CLGlCQUFZLEdBQUcsQ0FBQyxDQUFDO1FBRWhCLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBeUJuQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFHdEMsU0FBSSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFL0I7Ozs7V0FJRztRQUVILHdCQUFtQixHQUFpRCxVQUFBLEtBQUssSUFBSSxPQUFBLFlBQVksR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBakMsQ0FBaUMsQ0FBQztRQUV2RyxjQUFTLEdBQXlCLGNBQU8sQ0FBQyxDQUFDO1FBQzNDLGVBQVUsR0FBYyxjQUFPLENBQUMsQ0FBQztRQUVqQyxtQkFBYyxHQUFtQixVQUFDLFdBQVcsRUFBRSxnQkFBZ0I7WUFDckUsT0FBQSxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsVUFBQyxFQUFTO29CQUFQLGdCQUFLO2dCQUM5QixPQUFBLENBQUEsS0FBSyxhQUFMLEtBQUssdUJBQUwsS0FBSyxDQUNELFFBQVEsR0FDVCxpQkFBaUIsR0FDakIsUUFBUSxDQUFDLEtBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLEdBQzlDLENBQUMsQ0FBQyxJQUFJO29CQUNOLENBQUMsQ0FBQyxLQUFLO1lBTFQsQ0FLUyxDQUNWO1FBUEQsQ0FPQyxDQUFDO1FBbUhGLElBQUksSUFBSSxDQUFDLE9BQU87WUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFDdEQsQ0FBQztJQWxLRCxzQkFBSSxvQ0FBSzthQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3JCLENBQUM7YUFHRCxVQUFVLFFBQWE7WUFDckIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNsRCxDQUFDOzs7T0FMQTtJQU9ELHNCQUFJLHVDQUFRO2FBQVo7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLHdCQUF1QixDQUFDO1FBQzNDLENBQUM7OztPQUFBO0lBR0Qsc0JBQUksbUNBQUk7YUFBUixVQUFTLFlBQTBCO1lBQ2pDLG1CQUFtQjtZQUNuQixJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssWUFBWSxFQUFFO2dCQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLFlBQVksQ0FBQzthQUMzQjtRQUNILENBQUM7OztPQUFBO0lBOEJELHFDQUFTLEdBQVQsVUFBVSxLQUFvQjtRQUM1QixJQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUM7UUFDeEMsUUFBUSxHQUFHLEVBQUU7WUFDWCxLQUFLLFdBQVcsQ0FBQztZQUNqQixLQUFLLEVBQUU7Z0JBQ0wsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO29CQUNmLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO29CQUM1QixJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUMzQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO2lCQUMvQjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7aUJBQ2Y7Z0JBQ0QsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN2QixNQUFNO1lBRVIsS0FBSyxTQUFTLENBQUM7WUFDZixLQUFLLEVBQUU7Z0JBQ0wsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO29CQUNmLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO29CQUNoQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUMzQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO2lCQUMvQjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7aUJBQ2Y7Z0JBQ0QsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN2QixNQUFNO1lBRVIsS0FBSyxXQUFXLENBQUM7WUFDakIsS0FBSyxDQUFDLENBQUM7WUFDUCxLQUFLLFFBQVEsQ0FBQztZQUNkLEtBQUssRUFBRTtnQkFDTCxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRTtvQkFDeEUsSUFBTSxVQUFVLEdBQWlCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLE9BQU8sS0FBSyxJQUFJLEVBQXJCLENBQXFCLENBQUMsQ0FBQztvQkFDeEYsSUFBSSxVQUFVLEVBQUU7d0JBQ2QsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxDQUFDO3dCQUNyQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7cUJBQzVEO2lCQUNGO2dCQUNELE1BQU07WUFFUixLQUFLLE9BQU8sQ0FBQztZQUNiLEtBQUssYUFBYSxDQUFDO1lBQ25CLEtBQUssRUFBRTtnQkFDTCxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLDJCQUEyQixDQUFDLEVBQUU7b0JBQzNGLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztpQkFDZDtxQkFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUN2RCxJQUFNLGNBQWMsR0FBWSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7b0JBQ2hFLElBQUksY0FBMEIsQ0FBQztvQkFFL0IsSUFBSSxjQUFjLEVBQUU7d0JBQ2xCLGNBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUN0Qzt5QkFBTTt3QkFDTCxjQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksRUFBckIsQ0FBcUIsQ0FBQyxDQUFDO3FCQUN2RTtvQkFFRCxJQUFJLGNBQVksSUFBSSxDQUFDLGNBQVksQ0FBQyxRQUFRLEVBQUU7d0JBQzFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFOzRCQUNsQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEtBQUssS0FBSyxjQUFZLENBQUMsS0FBSyxFQUFqQyxDQUFpQyxDQUFDLENBQUMsQ0FBQzs0QkFDNUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7NEJBQ3hCLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQzt5QkFDM0Q7NkJBQU07NEJBQ0wsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGNBQVksRUFBRSxFQUFFLHlCQUF5QixFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7NEJBQzdFLElBQUksY0FBYyxFQUFFO2dDQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7Z0NBQ3RCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQzs2QkFDcEI7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7Z0JBQ0QsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUN4QixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ3ZCLE1BQU07WUFFUixLQUFLLE9BQU8sQ0FBQztZQUNiLEtBQUssRUFBRTtnQkFDTCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFO29CQUNyQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7b0JBQ2QsS0FBSyxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7b0JBQzFCLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztpQkFDNUQ7Z0JBRUQsTUFBTTtZQUVSLEtBQUssUUFBUSxDQUFDO1lBQ2QsS0FBSyxFQUFFLENBQUM7WUFDUixLQUFLLEtBQUssQ0FBQztZQUNYLEtBQUssQ0FBQztnQkFDSixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7b0JBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDcEI7Z0JBRUQsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLENBQUM7Z0JBRTFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxPQUFPLEtBQUssSUFBSSxFQUFyQixDQUFxQixDQUFDLEVBQUU7b0JBQzNELElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO2lCQUMzQjtnQkFDRCxNQUFNO1NBQ1Q7SUFDSCxDQUFDO0lBR0Qsc0NBQVUsR0FBVixVQUFXLEVBQVU7WUFBUixrQkFBTTtRQUNqQixJQUFJLE1BQU0sS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2pGLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxDQUFDO1NBQzNDO0lBQ0gsQ0FBQztJQVVELG9DQUFRLEdBQVI7UUFBQSxpQkFhQzs7UUFaQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUUzQixNQUFBLElBQUksQ0FBQyxPQUFPLDBDQUFFLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxTQUFTLENBQUMsVUFBQSxDQUFDO1lBQ3JFLEtBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNuQixDQUFDLEVBQUU7UUFFSCxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEdBQUc7WUFDcEMsS0FBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2xCLEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQyxDQUFDO1FBRUYsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVELDhDQUFrQixHQUFsQjtRQUFBLGlCQXNCQztRQXJCQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNaLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtpQkFDcEIsUUFBUSxDQUFDLEVBQUUsQ0FBQztpQkFDWixTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDakI7UUFFRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDZCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFakIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDNUQsS0FBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hCLEtBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN2QixLQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUV6QixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1NBQy9CO1FBQ0QsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFRCwyQ0FBZSxHQUFmO1FBQ0UsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2YsK0NBQStDO1lBQy9DLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN2QixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRCxvQ0FBUSxHQUFSO1FBQ0UsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFBLElBQUk7WUFDL0IsT0FBTztnQkFDTCxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7Z0JBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztnQkFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO2dCQUN2QixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87Z0JBQ3JCLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtnQkFDdkIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFO2FBQ1osQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHVDQUFXLEdBQVgsVUFBWSxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRTtZQUMvQixJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztTQUNoQztRQUNELElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsdUNBQVcsR0FBWDtRQUNFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxvQ0FBUSxHQUFSLFVBQVMsWUFBMEI7UUFDakMsWUFBWSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVELHVDQUFXLEdBQVgsVUFBWSxZQUEwQjtRQUNwQyxZQUFZLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztJQUMvQixDQUFDO0lBRUQscUNBQVMsR0FBVCxVQUFVLFlBQTBCO1FBQ2xDLElBQUksWUFBWSxFQUFFO1lBQ2hCLGlDQUFpQztZQUNqQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLFVBQUEsSUFBSTtnQkFDOUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7Z0JBQ3JCLE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztTQUNoQztJQUNILENBQUM7SUFFRCxrQ0FBTSxHQUFOLFVBQU8sS0FBZTtRQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNsQixJQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFFdkMsSUFBSSxPQUFPLEtBQUssS0FBSyxXQUFXLEVBQUU7Z0JBQ2hDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO2FBQ3JCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO2FBQzVCO1lBRUQsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLGtCQUFrQixFQUFFO2dCQUN0QyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7b0JBQ2YsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDdEQsUUFBUSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBQzNELFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO29CQUM1RCxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQzNELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7aUJBQ2xCO3FCQUFNO29CQUNMLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO29CQUN4QixRQUFRLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztvQkFDOUQsUUFBUSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBRS9ELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztpQkFDeEM7YUFDRjtTQUNGO0lBQ0gsQ0FBQztJQUVELDBDQUFjLEdBQWQsVUFBZSxFQUFVO1lBQVIsa0JBQU07O1FBQ3JCLElBQ0UsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQ3JGLFFBQUMsTUFBTSxDQUFDLFVBQVUsMENBQUUsYUFBYSxDQUFDLGVBQWUsRUFBQyxFQUNsRDtZQUNBLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkIsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLENBQUM7U0FDM0M7SUFDSCxDQUFDO0lBRUQsNkNBQWlCLEdBQWpCO1FBQ0UsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxhQUFhLFlBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRCw0Q0FBZ0IsR0FBaEI7UUFDRSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsRUFBdEIsQ0FBc0IsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRCxvREFBd0IsR0FBeEI7UUFDRSxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFkLENBQWMsQ0FBQyxFQUFFO1lBQ25HLElBQUksZ0JBQWdCLEdBQVcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksRUFBckIsQ0FBcUIsQ0FBQyxDQUFDO1lBQzNGLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3hCLElBQUksZ0JBQWdCLEtBQUssQ0FBQyxDQUFDLElBQUksZ0JBQWdCLEtBQUssQ0FBQyxFQUFFO2dCQUNyRCxnQkFBZ0IsR0FBRyxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7YUFDekM7aUJBQU07Z0JBQ0wsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2FBQ2xEO1lBRUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFFcEQsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLENBQUMsUUFBUSxFQUFFO2dCQUNqRCxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQzthQUNqQztTQUNGO0lBQ0gsQ0FBQztJQUVELGdEQUFvQixHQUFwQjtRQUNFLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQWQsQ0FBYyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNoSCxJQUFJLGdCQUFnQixHQUFXLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLE9BQU8sS0FBSyxJQUFJLEVBQXJCLENBQXFCLENBQUMsQ0FBQztZQUMzRixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUN4QixJQUFJLGdCQUFnQixLQUFLLENBQUMsQ0FBQyxJQUFJLGdCQUFnQixLQUFLLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDakYsZ0JBQWdCLEdBQUcsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDO2FBQ3pDO2lCQUFNO2dCQUNMLGdCQUFnQixHQUFHLENBQUMsQ0FBQzthQUN0QjtZQUVELElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBRXBELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFFBQVEsRUFBRTtnQkFDakQsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7YUFDN0I7U0FDRjtJQUNILENBQUM7SUFFRCwrQ0FBbUIsR0FBbkIsVUFBb0IsSUFBa0IsRUFBRSxPQUFnRDtRQUN0RixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUUvQixJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFL0IsSUFBSSxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUMseUJBQXlCLEVBQUU7WUFDakQsSUFBTSxxQkFBcUIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxVQUFBLFlBQVksSUFBSSxPQUFBLENBQUMsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUF0QixDQUFzQixDQUFDLENBQUM7WUFDbkcsSUFBSSxxQkFBcUIsR0FBRyxDQUFDLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUMsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO2FBQzNEO1NBQ0Y7UUFFRCxJQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFVBQUEsWUFBWSxJQUFJLE9BQUEsWUFBWSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSyxFQUFqQyxDQUFpQyxDQUFDLENBQUM7UUFFdEcsa0JBQWtCLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFFNUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsK0NBQW1CLEdBQW5CLFVBQW9CLElBQWtCO1FBQ3BDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMvQjthQUFNO1lBQ0wsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxVQUFTLE9BQXFCO2dCQUMzRSxPQUFPLE9BQU8sQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN0QyxDQUFDLENBQUMsQ0FBQztTQUNKO1FBQ0QsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVELDJDQUFlLEdBQWY7UUFBQSxpQkFvQkM7O1FBbkJDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUMvQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQUEsSUFBSTs7Z0JBQ2hDLElBQUksQ0FBQyxRQUFRLFNBQUksS0FBSSxDQUFDLE1BQWdCLDBDQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzdELE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLFFBQVEsRUFBYixDQUFhLENBQUMsQ0FBQztZQUMvRCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztTQUNoQzthQUFNO1lBQ0wsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksRUFBRTtnQkFDeEIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7YUFDM0I7WUFFRCxJQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUV2RCxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQUcsWUFBWSxhQUFaLFlBQVksdUJBQVosWUFBWSxDQUFFLEtBQUssbUNBQUksRUFBRSxDQUFDO2FBQzlDO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsbURBQXVCLEdBQXZCO1FBQ0UsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksT0FBTyxJQUFJLENBQUMsbUJBQW1CLEtBQUssVUFBVSxFQUFFO2dCQUNsRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQzthQUN2RTtpQkFBTTtnQkFDTCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7YUFDNUY7U0FDRjtJQUNILENBQUM7SUFFRCxrREFBc0IsR0FBdEI7UUFDRSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQWQsQ0FBYyxDQUFDLEVBQUU7WUFDakgsSUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQWQsQ0FBYyxDQUFDLENBQUM7WUFDdkUsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDL0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDM0QsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztTQUMvQjtJQUNILENBQUM7SUFFRCw4REFBa0MsR0FBbEM7UUFDRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUV4QixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2pDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUN4QjthQUFNO1lBQ0wsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1NBQ3ZCO1FBRUQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsOENBQWtCLEdBQWxCO1FBQ0UsSUFBSSxDQUFDLGFBQWEsWUFBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7UUFDeEIsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLElBQUk7WUFDaEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7WUFDdEIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxtREFBdUIsR0FBdkI7UUFDRSxJQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxRQUFRLEVBQWIsQ0FBYSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLEtBQUssRUFBVixDQUFVLENBQUMsQ0FBQztRQUN6RixJQUFJLENBQUMsS0FBSyxHQUFHLGNBQWMsQ0FBQztRQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRUQsa0NBQU0sR0FBTjs7UUFDRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNoQixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztZQUN4QixPQUFPO1NBQ1I7UUFDRCxJQUFNLE1BQU0sU0FBbUIsSUFBSSxDQUFDLFlBQVksbUNBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUN4RSxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sYUFBQyxJQUFJLENBQUMsS0FBSywwQ0FBRSxLQUFLLDBDQUFFLFFBQVEsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUUsQ0FBQztJQUVELGlEQUFxQixHQUFyQjtRQUNFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVELHVDQUFXLEdBQVg7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNoQixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztTQUN6QjthQUFNO1lBQ0wsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQztJQUVELHNDQUFVLEdBQVYsVUFBVyxJQUFtQztRQUM1QyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDakIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hDO2FBQU07WUFDTCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDeEIsSUFBSSxDQUFDLGFBQWEsWUFBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFRCwyQ0FBZSxHQUFmLFVBQWdCLEtBQVU7UUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFFN0IsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUk7WUFDM0IsT0FBTyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RGLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQztJQUVELGlDQUFLLEdBQUw7UUFDRSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztRQUNuQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCx1Q0FBVyxHQUFYO1FBQ0UsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBRWxCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNSLElBQUEsZ0NBQVEsQ0FBa0I7WUFDbEMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLEtBQUssSUFBSSxJQUFJLFFBQVEsS0FBSyxLQUFLLENBQUM7U0FDcEQ7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCw0Q0FBZ0IsR0FBaEIsVUFBaUIsRUFBd0I7UUFDdkMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVELDZDQUFpQixHQUFqQixVQUFrQixFQUFPO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxzQ0FBVSxHQUFWLFVBQVcsS0FBVTtRQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCw0Q0FBZ0IsR0FBaEIsVUFBaUIsUUFBaUI7UUFDaEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7SUFDM0IsQ0FBQztJQUVPLHVDQUFXLEdBQW5CLFVBQW9CLFFBQWEsRUFBRSxPQUErQjtRQUNoRSxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQztRQUV2QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFFdkIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzNCLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztTQUN2QjtRQUVELElBQUksT0FBTyxDQUFDLFNBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRTtZQUM1QyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQzFCO1FBQ0QsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFTyxxQ0FBUyxHQUFqQjtRQUNFLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNWLElBQUEsaUJBQW1DLEVBQWpDLG9CQUFPLEVBQUUsb0JBQXdCLENBQUM7WUFDMUMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLE9BQU8sSUFBSSxPQUFPLENBQUM7U0FDNUM7YUFBTTtZQUNMLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDakIsSUFBSSxDQUFDLGdCQUFnQjtvQkFDbkIsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxRQUFRLEVBQWIsQ0FBYSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQzthQUN2RztpQkFBTTtnQkFDTCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7YUFDbkY7U0FDRjtJQUNILENBQUM7SUFFTywrQ0FBbUIsR0FBM0I7UUFBQSxpQkFjQztRQWJDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUTtZQUFFLE9BQU87UUFDM0IsSUFBTSxZQUFZLEdBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUE2QixDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN6RixJQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBTSxPQUFBLE9BQU8sRUFBUCxDQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdFLElBQU0sU0FBUyxHQUFHLFNBQVMsQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxjQUFNLE9BQUEsTUFBTSxFQUFOLENBQU0sQ0FBQyxDQUFDLENBQUM7UUFFMUUsS0FBSyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUM7YUFDekIsSUFBSSxDQUNILFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQzFCLEdBQUcsQ0FBQyxVQUFBLFNBQVMsSUFBSSxPQUFBLENBQUMsU0FBUyxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBdEMsQ0FBc0MsQ0FBQyxDQUN6RDthQUNBLFNBQVMsQ0FBQyxVQUFBLFVBQVU7WUFDbkIsS0FBSSxDQUFDLFlBQVksR0FBRyxVQUFVLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsc0NBQVUsR0FBVjtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1lBQzFCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1NBQzFCO0lBQ0gsQ0FBQztJQUVELHlDQUFhLEdBQWI7UUFDRSxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztRQUMzQixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDbEMsQ0FBQztJQUVPLDJDQUFlLEdBQXZCO1FBQUEsaUJBZUM7UUFkQyxJQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBNkIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzRixJQUFJLENBQUMsV0FBVyxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFZLElBQUssT0FBQSxJQUFJLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLEVBQS9CLENBQStCLENBQUMsQ0FBQztRQUMzRixJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMvQixJQUFNLGtCQUFnQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUMxRyxrQkFBZ0IsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFDLFNBQWlCO2dCQUMxRCxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsRUFBRTtvQkFDeEMsa0JBQWdCLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUNwQztZQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsVUFBQyxTQUFpQjtnQkFDekMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLHlCQUF5QixDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDaEcsS0FBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM1RCxDQUFDLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVPLDBDQUFjLEdBQXRCO1FBQUEsaUJBa0JDO1FBakJDLFVBQVUsQ0FBQztZQUNULElBQU0sT0FBTyxHQUFHLEtBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ25GLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBQ1osS0FBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7Z0JBQ3RCLE9BQU87YUFDUjtZQUVELElBQU0sSUFBSSxHQUNSLE9BQU8sQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO2dCQUMvQyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO2dCQUMzRSxLQUFJLENBQUMsWUFBWSxDQUFDO1lBQ3BCLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTtnQkFDWixLQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsSUFBSSxDQUFDO2FBQzNCO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO2FBQ3ZCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0saUNBQUssR0FBWjtRQUNFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBRU0sd0NBQVksR0FBbkI7UUFDRSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDcEIsQ0FBQzs7Z0JBdmRzQyxTQUFTLHVCQUE3QyxJQUFJLFlBQUksUUFBUTtnQkFDRyxVQUFVO2dCQUNmLGlCQUFpQjs7SUFoT2xDO1FBREMsS0FBSyxFQUFFOzBEQUNZO0lBR3BCO1FBREMsS0FBSyxFQUFFO21FQUNrQztJQUcxQztRQURDLEtBQUssRUFBRTt1REFDUztJQUdqQjtRQURDLEtBQUssRUFBRTt1REFDSztJQUdiO1FBREMsS0FBSyxFQUFFO3VEQUNTO0lBR2pCO1FBREMsS0FBSyxFQUFFO3dEQUNTO0lBR2pCO1FBREMsS0FBSyxFQUFFOzJEQUNxQjtJQU03QjtRQURDLEtBQUssRUFBRTtnRUFDbUI7SUFJM0I7UUFGQyxXQUFXLENBQUMsU0FBUyxDQUFDO1FBQ3RCLEtBQUssRUFBRTtpREFDRztJQUdYO1FBREMsV0FBVyxDQUFDLGVBQWUsQ0FBQzsyREFDVDtJQUdwQjtRQURDLGVBQWUsQ0FBQyw2QkFBNkIsQ0FBQztvREFDQztJQUdoRDtRQURDLFlBQVksQ0FBQyxjQUFjLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7cURBQ2hCO0lBUS9CO1FBREMsU0FBUyxDQUFDLHNCQUFzQixDQUFDO29EQUNKO0lBRzlCO1FBREMsU0FBUyxDQUFDLFVBQVUsQ0FBQzt1REFDRDtJQXNCckI7UUFEQyxLQUFLLEVBQUU7a0RBR1A7SUFPRDtRQURDLEtBQUssRUFBRTtpREFNUDtJQUdEO1FBREMsTUFBTSxFQUFFOzBEQUM2QjtJQUd0QztRQURDLE1BQU0sRUFBRTttREFDc0I7SUFRL0I7UUFEQyxLQUFLLEVBQUU7a0VBQ3VHO0lBZ0IvRztRQURDLFlBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztzREFtR25DO0lBR0Q7UUFEQyxZQUFZLENBQUMsVUFBVSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7dURBS3BDO0lBOU5VLGlCQUFpQjtRQUw3QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsZUFBZTtZQUN6QiwwK0lBQXlDOztTQUUxQyxDQUFDO1FBa09HLFdBQUEsSUFBSSxFQUFFLENBQUEsRUFBRSxXQUFBLFFBQVEsRUFBRSxDQUFBO09Bak9WLGlCQUFpQixDQXlyQjdCO0lBQUQsd0JBQUM7Q0FBQSxBQXpyQkQsSUF5ckJDO1NBenJCWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgQ29udGVudENoaWxkLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RCaW5kaW5nLFxuICBIb3N0TGlzdGVuZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBBZnRlclZpZXdJbml0LFxuICBTZWxmLFxuICBPcHRpb25hbCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb21ib0JveERyb3Bkb3duSXRlbUNvbXBvbmVudCB9IGZyb20gJy4vY29tYm8tYm94LWRyb3Bkb3duLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IENvbWJvQm94SW5wdXRDb21wb25lbnQgfSBmcm9tICcuL2NvbWJvLWJveC1pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgTGFiZWxDb21wb25lbnQgfSBmcm9tICcuLi9sYWJlbC9sYWJlbC5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IGZyb21FdmVudCwgbWVyZ2UsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5leHBvcnQgY29uc3QgZW51bSBDb21ib0JveFR5cGUge1xuICBTSU5HTEUgPSAnU0lOR0xFJyxcbiAgTVVMVEkgPSAnTVVMVEknXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tYm9Cb3hJdGVtIHtcbiAgdmFsdWU6IGFueTtcbiAgbGFiZWw6IHN0cmluZztcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIGZvY3VzZWQ/OiBib29sZWFuO1xuICBzZWxlY3RlZDogYm9vbGVhbjtcbiAgaWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IHR5cGUgQ29tYm9Cb3hGaWx0ZXIgPSAoc2VhcmNoUXVlcnk6IHN0cmluZywgYWxsQ29tYm9Cb3hJdGVtczogQ29tYm9Cb3hJdGVtW10pID0+IENvbWJvQm94SXRlbVtdO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdibXctY29tYm8tYm94JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbWJvLWJveC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NvbWJvLWJveC5jb21wb25lbnQubGVzcyddXG59KVxuZXhwb3J0IGNsYXNzIENvbWJvQm94Q29tcG9uZW50XG4gIGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBBZnRlclZpZXdJbml0LCBDb250cm9sVmFsdWVBY2Nlc3NvciwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKVxuICBwbGFjZWhvbGRlcjogc3RyaW5nO1xuXG4gIEBJbnB1dCgpXG4gIG5vUmVzdWx0c1BsYWNlaG9sZGVyID0gJ05vIHJlc3VsdHMgZm91bmQnO1xuXG4gIEBJbnB1dCgpXG4gIGRpc2FibGVkID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgdGFiSW5kZXggPSAwO1xuXG4gIEBJbnB1dCgpXG4gIHJlcXVpcmVkID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgY2xlYXJhYmxlID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICBjdXN0b21GaWx0ZXI6IENvbWJvQm94RmlsdGVyO1xuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBtdWx0aUNvbWJvQm94VGV4dCBzdHJpbmcgaW5zdGVhZCBvZiBlYWNoIHRhZy4gKGRlZmF1bHQgPSBmYWxzZSlcbiAgICovXG4gIEBJbnB1dCgpXG4gIHRleHRJbnN0ZWFkT2ZUYWdzOiBib29sZWFuO1xuXG4gIEBIb3N0QmluZGluZygnYXR0ci5pZCcpXG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLnRhYmluZGV4JylcbiAgaG9zdFRhYkluZGV4ID0gJy0xJztcblxuICBAQ29udGVudENoaWxkcmVuKENvbWJvQm94RHJvcGRvd25JdGVtQ29tcG9uZW50KVxuICBpdGVtczogUXVlcnlMaXN0PENvbWJvQm94RHJvcGRvd25JdGVtQ29tcG9uZW50PjtcblxuICBAQ29udGVudENoaWxkKExhYmVsQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBwcml2YXRlIF9sYWJlbDogTGFiZWxDb21wb25lbnQ7XG5cbiAgZmlsdGVyZWRJdGVtczogQ29tYm9Cb3hJdGVtW10gPSBbXTtcblxuICBfaXRlbXM6IENvbWJvQm94SXRlbVtdID0gW107XG4gIHNlbGVjdGVkSXRlbXM6IENvbWJvQm94SXRlbVtdID0gW107XG5cbiAgQFZpZXdDaGlsZChDb21ib0JveElucHV0Q29tcG9uZW50KVxuICBpbnB1dDogQ29tYm9Cb3hJbnB1dENvbXBvbmVudDtcblxuICBAVmlld0NoaWxkKCdpbnB1dEJveCcpXG4gIGlucHV0Qm94OiBFbGVtZW50UmVmO1xuXG4gIG9wZW5lZCA9IGZhbHNlO1xuICBzaG93SW52YWxpZFN0YXRlID0gZmFsc2U7XG4gIGNvbWJvRm9jdXNlZCA9IGZhbHNlO1xuICBncmlkQ2xhc3Nlczogc3RyaW5nW107XG5cbiAgcHJpdmF0ZSBfdmFsdWU6IGFueTtcbiAgcHJpdmF0ZSBfdHlwZSA9IENvbWJvQm94VHlwZS5TSU5HTEU7XG4gIHByaXZhdGUgX2lucHV0Rm9jdXNlZCA9IGZhbHNlO1xuICBwcml2YXRlIF9pc1RvdWNoZWQgPSBmYWxzZTtcbiAgcHVibGljIG11bHRpQ29tYm9Cb3hUZXh0ID0gJ1NlbGVjdGVkJztcbiAgcHVibGljIHNjcm9sbE9mZnNldCA9IDA7XG5cbiAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3QoKTtcbiAgb3V0c2lkZUNhbGxiYWNrOiBhbnk7XG5cbiAgZ2V0IHZhbHVlKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgQElucHV0KClcbiAgc2V0IHZhbHVlKG5ld1ZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLmNoYW5nZVZhbHVlKG5ld1ZhbHVlLCB7IGVtaXRFdmVudDogdHJ1ZSB9KTtcbiAgfVxuXG4gIGdldCB1c2VNdWx0aSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fdHlwZSA9PT0gQ29tYm9Cb3hUeXBlLk1VTFRJO1xuICB9XG5cbiAgQElucHV0KClcbiAgc2V0IHR5cGUoY29tYm9Cb3hUeXBlOiBDb21ib0JveFR5cGUpIHtcbiAgICAvLyBjb2VyY2UgaW5wdXRUeXBlXG4gICAgaWYgKHRoaXMuX3R5cGUgIT09IGNvbWJvQm94VHlwZSkge1xuICAgICAgdGhpcy5fdHlwZSA9IGNvbWJvQm94VHlwZTtcbiAgICB9XG4gIH1cblxuICBAT3V0cHV0KClcbiAgY2hhbmdlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBAT3V0cHV0KClcbiAgb3BlbiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKlxuICAgKiBUZXh0IHRvIGJlIHVzZWQgaW4gbXVsdGkgY29tYm8gYm94ZXMgdGhhdCB1c2UgdGV4dCBpbnN0ZWFkIG9mIHRhZ3MuXG4gICAqIEl0IGNhbiBiZSBhIHN0cmluZyBvciBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIGFycmF5IG9mIHNlbGVjdGVkIGl0ZW1zIGFuZCByZXR1cm5zIHRoZSB0ZXh0IGluIGEgY3VzdG9tIGZvcm1hdC5cbiAgICogSW4gY2FzZSBvZiBwcm92aWRpbmcgYSBzdHJpbmcsIGl0IHJlcGxhY2VzIHRoZSB0ZXh0IG9mIHRoZSBkZWZhdWx0IGZvcm1hdDogJ1NlbGVjdGVkICgwKScuXG4gICAqL1xuICBASW5wdXQoKVxuICBzZWxlY3RlZE9wdGlvbnNUZXh0OiBzdHJpbmcgfCAoKGl0ZW1zOiBDb21ib0JveEl0ZW1bXSkgPT4gc3RyaW5nKSA9IGl0ZW1zID0+ICdTZWxlY3RlZCAoJyArIGl0ZW1zLmxlbmd0aCArICcpJztcblxuICBwcml2YXRlIF9vbkNoYW5nZTogKHZhbHVlOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7fTtcbiAgcHJpdmF0ZSBfb25Ub3VjaGVkOiAoKSA9PiBhbnkgPSAoKSA9PiB7fTtcblxuICBwcml2YXRlIF9kZWZhdWx0RmlsdGVyOiBDb21ib0JveEZpbHRlciA9IChzZWFyY2hRdWVyeSwgYWxsQ29tYm9Cb3hJdGVtcykgPT5cbiAgICBhbGxDb21ib0JveEl0ZW1zLmZpbHRlcigoeyBsYWJlbCB9KSA9PlxuICAgICAgbGFiZWxcbiAgICAgICAgPy50b1N0cmluZygpXG4gICAgICAgIC50b0xvY2FsZUxvd2VyQ2FzZSgpXG4gICAgICAgIC5pbmNsdWRlcyh0aGlzLmlucHV0LnZhbHVlLnRvTG9jYWxlTG93ZXJDYXNlKCkpXG4gICAgICAgID8gdHJ1ZVxuICAgICAgICA6IGZhbHNlXG4gICAgKTtcblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgY29uc3Qga2V5ID0gZXZlbnQuY29kZSB8fCBldmVudC5rZXlDb2RlO1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdBcnJvd0Rvd24nOlxuICAgICAgY2FzZSA0MDpcbiAgICAgICAgaWYgKHRoaXMub3BlbmVkKSB7XG4gICAgICAgICAgdGhpcy5zZXROZXh0SXRlbUFzRm9jdXNlZCgpO1xuICAgICAgICAgIHRoaXMuY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgIHRoaXMuc2hvd0ludmFsaWRTdGF0ZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0Fycm93VXAnOlxuICAgICAgY2FzZSAzODpcbiAgICAgICAgaWYgKHRoaXMub3BlbmVkKSB7XG4gICAgICAgICAgdGhpcy5zZXRQcmV2aW91c0l0ZW1Bc0ZvY3VzZWQoKTtcbiAgICAgICAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICB0aGlzLnNob3dJbnZhbGlkU3RhdGUgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnRvZ2dsZSgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdCYWNrc3BhY2UnOlxuICAgICAgY2FzZSA4OlxuICAgICAgY2FzZSAnRGVsZXRlJzpcbiAgICAgIGNhc2UgNDY6XG4gICAgICAgIGlmICh0aGlzLnVzZU11bHRpICYmIHRoaXMuc2VsZWN0ZWRJdGVtcy5sZW5ndGggPiAwICYmICF0aGlzLmNvbWJvRm9jdXNlZCkge1xuICAgICAgICAgIGNvbnN0IGZvY3VzZWRUYWc6IENvbWJvQm94SXRlbSA9IHRoaXMuc2VsZWN0ZWRJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5mb2N1c2VkID09PSB0cnVlKTtcbiAgICAgICAgICBpZiAoZm9jdXNlZFRhZykge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVNdWx0aU1vZGVJdGVtKGZvY3VzZWRUYWcpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykuZm9jdXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgIGNhc2UgJ051bXBhZEVudGVyJzpcbiAgICAgIGNhc2UgMTM6XG4gICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMuaW5wdXRCb3gubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2xlYXIuaXdwLWljb24tZ2VuX2Nsb3NlJykpIHtcbiAgICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcGVuZWQgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBpc09ubHlJdGVtTGVmdDogYm9vbGVhbiA9IHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGggPT09IDE7XG4gICAgICAgICAgbGV0IGl0ZW1Ub1NlbGVjdDogQ29tYm9Cb3hJdGVtO1xuXG4gICAgICAgICAgaWYgKGlzT25seUl0ZW1MZWZ0KSB7XG4gICAgICAgICAgICBpdGVtVG9TZWxlY3QgPSB0aGlzLmZpbHRlcmVkSXRlbXNbMF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZW1Ub1NlbGVjdCA9IHRoaXMuZmlsdGVyZWRJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5mb2N1c2VkID09PSB0cnVlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoaXRlbVRvU2VsZWN0ICYmICFpdGVtVG9TZWxlY3QuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy51c2VNdWx0aSkge1xuICAgICAgICAgICAgICB0aGlzLnNlbGVjdEl0ZW0odGhpcy5pdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS52YWx1ZSA9PT0gaXRlbVRvU2VsZWN0LnZhbHVlKSk7XG4gICAgICAgICAgICAgIHRoaXMucmVzZXRGb2N1c2VkSXRlbSgpO1xuICAgICAgICAgICAgICB0aGlzLmlucHV0Qm94Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQnKS5ibHVyKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnRvZ2dsZU11bHRpTW9kZUl0ZW0oaXRlbVRvU2VsZWN0LCB7IHJlbW92ZUZvY3VzQWZ0ZXJTZWxlY3Rpb246IGZhbHNlIH0pO1xuICAgICAgICAgICAgICBpZiAoaXNPbmx5SXRlbUxlZnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhbkZpbHRlcigpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnU3BhY2UnOlxuICAgICAgY2FzZSAzMjpcbiAgICAgICAgaWYgKCF0aGlzLm9wZW5lZCB8fCAhdGhpcy5pbnB1dC52YWx1ZSkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmlucHV0Qm94Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQnKS5mb2N1cygpO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0VzY2FwZSc6XG4gICAgICBjYXNlIDI3OlxuICAgICAgY2FzZSAnVGFiJzpcbiAgICAgIGNhc2UgOTpcbiAgICAgICAgaWYgKHRoaXMub3BlbmVkKSB7XG4gICAgICAgICAgdGhpcy50b2dnbGUoZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51cGRhdGVWaWV3SW5wdXRBZnRlckRyb3Bkb3duQ2xvc2VkKCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmZpbHRlcmVkSXRlbXMuZmluZChpdGVtID0+IGl0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSkpIHtcbiAgICAgICAgICB0aGlzLmNvbWJvRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgWyckZXZlbnQnXSlcbiAgb25Gb2N1c291dCh7IHRhcmdldCB9KSB7XG4gICAgaWYgKHRhcmdldCA9PT0gdGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykgJiYgIXRoaXMub3BlbmVkKSB7XG4gICAgICB0aGlzLnVwZGF0ZVZpZXdJbnB1dEFmdGVyRHJvcGRvd25DbG9zZWQoKTtcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBAU2VsZigpIEBPcHRpb25hbCgpIHByaXZhdGUgY29udHJvbDogTmdDb250cm9sLFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIGNkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHtcbiAgICBpZiAodGhpcy5jb250cm9sKSB0aGlzLmNvbnRyb2wudmFsdWVBY2Nlc3NvciA9IHRoaXM7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLl9saXN0ZW5Ub0lucHV0Rm9jdXMoKTtcblxuICAgIHRoaXMuY29udHJvbD8udmFsdWVDaGFuZ2VzLnBpcGUodGFrZVVudGlsKHRoaXMub25EZXN0cm95JCkpLnN1YnNjcmliZShlID0+IHtcbiAgICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5mb2N1cyA9ICgpID0+IHtcbiAgICAgIHRoaXMuZm9jdXNJbnB1dCgpO1xuICAgICAgdGhpcy50b2dnbGUodHJ1ZSk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlTXVsdGlDb21ib0JveFRleHQoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpXG4gICAgICAgIC50b1N0cmluZygzNilcbiAgICAgICAgLnN1YnN0cmluZygyKTtcbiAgICB9XG5cbiAgICB0aGlzLmZpbHRlcigpO1xuICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG5cbiAgICB0aGlzLml0ZW1zLmNoYW5nZXMucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMubWFwSXRlbXMoKTtcbiAgICAgIHRoaXMudXBkYXRlVmlld0lucHV0KCk7XG4gICAgICB0aGlzLmNsZWFuRmlsdGVyKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZnJlc2hJdGVtc1N0YXRlKCk7XG5cbiAgICBpZiAodGhpcy5fbGFiZWwpIHtcbiAgICAgIHRoaXMuX2xhYmVsLmlucHV0SWQgPSB0aGlzLmlkO1xuICAgIH1cbiAgICB0aGlzLl9zZXRHcmlkQ2xhc3NlcygpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIGlmICh0aGlzLl92YWx1ZSkge1xuICAgICAgLy8gSW5pdGlhbCB2YWx1ZSB3YXMgc2V0LCB1cGRhdGUgc2VsZWN0ZWQgaXRlbXNcbiAgICAgIHRoaXMudXBkYXRlVmlld0lucHV0KCk7XG4gICAgICB0aGlzLmNsZWFuRmlsdGVyKCk7XG4gICAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBtYXBJdGVtcygpIHtcbiAgICB0aGlzLl9pdGVtcyA9IHRoaXMuaXRlbXMubWFwKGl0ZW0gPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IGl0ZW0udmFsdWUsXG4gICAgICAgIGxhYmVsOiBpdGVtLmxhYmVsLFxuICAgICAgICBkaXNhYmxlZDogaXRlbS5kaXNhYmxlZCxcbiAgICAgICAgZm9jdXNlZDogaXRlbS5mb2N1c2VkLFxuICAgICAgICBzZWxlY3RlZDogaXRlbS5zZWxlY3RlZCxcbiAgICAgICAgaWQ6IGl0ZW0uaWRcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMuc2VsZWN0ZWRPcHRpb25zVGV4dCkge1xuICAgICAgdGhpcy51cGRhdGVNdWx0aUNvbWJvQm94VGV4dCgpO1xuICAgIH1cbiAgICB0aGlzLmZpbHRlcigpO1xuICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmNkUmVmLmRldGFjaCgpO1xuICAgIHRoaXMub25EZXN0cm95JC5uZXh0KCk7XG4gICAgdGhpcy5vbkRlc3Ryb3kkLmNvbXBsZXRlKCk7XG4gIH1cblxuICBmb2N1c1RhZyhzZWxlY3RlZEl0ZW06IENvbWJvQm94SXRlbSkge1xuICAgIHNlbGVjdGVkSXRlbS5mb2N1c2VkID0gdHJ1ZTtcbiAgfVxuXG4gIGZvY3Vzb3V0VGFnKHNlbGVjdGVkSXRlbTogQ29tYm9Cb3hJdGVtKSB7XG4gICAgc2VsZWN0ZWRJdGVtLmZvY3VzZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHNlbGVjdFRhZyhzZWxlY3RlZEl0ZW06IENvbWJvQm94SXRlbSkge1xuICAgIGlmIChzZWxlY3RlZEl0ZW0pIHtcbiAgICAgIC8vIHJlbW92ZSBzZWxlY3Rpb24gZnJvbSBhbGwgdGFnc1xuICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gdGhpcy5zZWxlY3RlZEl0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgICAgaXRlbS5mb2N1c2VkID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnVwZGF0ZU11bHRpQ29tYm9Cb3hUZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlKHN0YXRlPzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgICAgY29uc3QgaW5pdGlhbE9wZW5lZFN0YXRlID0gdGhpcy5vcGVuZWQ7XG5cbiAgICAgIGlmICh0eXBlb2Ygc3RhdGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMub3BlbmVkID0gc3RhdGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm9wZW5lZCA9ICF0aGlzLm9wZW5lZDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3BlbmVkICE9PSBpbml0aWFsT3BlbmVkU3RhdGUpIHtcbiAgICAgICAgaWYgKHRoaXMub3BlbmVkKSB7XG4gICAgICAgICAgdGhpcy5vdXRzaWRlQ2FsbGJhY2sgPSB0aGlzLm9uQ2xpY2tPdXRzaWRlLmJpbmQodGhpcyk7XG4gICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub3V0c2lkZUNhbGxiYWNrKTtcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub3V0c2lkZUNhbGxiYWNrKTtcbiAgICAgICAgICB0aGlzLmlucHV0Qm94Lm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXQnKS5mb2N1cygpO1xuICAgICAgICAgIHRoaXMub3Blbi5lbWl0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5yZXNldEZvY3VzZWRJdGVtKCk7XG4gICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub3V0c2lkZUNhbGxiYWNrKTtcbiAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub3V0c2lkZUNhbGxiYWNrKTtcblxuICAgICAgICAgIHRoaXMuY29tYm9Gb2N1c2VkID0gdGhpcy5faW5wdXRGb2N1c2VkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgb25DbGlja091dHNpZGUoeyB0YXJnZXQgfSkge1xuICAgIGlmIChcbiAgICAgICF0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY29tYm8tYm94LWNvbnRhaW5lcicpLmNvbnRhaW5zKHRhcmdldCkgJiZcbiAgICAgICF0YXJnZXQuc2hhZG93Um9vdD8ucXVlcnlTZWxlY3RvcignYm13LWNvbWJvLWJveCcpXG4gICAgKSB7XG4gICAgICB0aGlzLnRvZ2dsZShmYWxzZSk7XG4gICAgICB0aGlzLnVwZGF0ZVZpZXdJbnB1dEFmdGVyRHJvcGRvd25DbG9zZWQoKTtcbiAgICB9XG4gIH1cblxuICByZWZyZXNoSXRlbXNTdGF0ZSgpIHtcbiAgICB0aGlzLm1hcEl0ZW1zKCk7XG4gICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gWy4uLnRoaXMuX2l0ZW1zXTtcbiAgfVxuXG4gIHJlc2V0Rm9jdXNlZEl0ZW0oKSB7XG4gICAgdGhpcy5maWx0ZXJlZEl0ZW1zLmZvckVhY2goaXRlbSA9PiAoaXRlbS5mb2N1c2VkID0gZmFsc2UpKTtcbiAgfVxuXG4gIHNldFByZXZpb3VzSXRlbUFzRm9jdXNlZCgpIHtcbiAgICBpZiAodGhpcy5vcGVuZWQgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLnNvbWUoaXRlbSA9PiAhaXRlbS5kaXNhYmxlZCkpIHtcbiAgICAgIGxldCBmb2N1c2VkSXRlbUluZGV4OiBudW1iZXIgPSB0aGlzLmZpbHRlcmVkSXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5mb2N1c2VkID09PSB0cnVlKTtcbiAgICAgIHRoaXMucmVzZXRGb2N1c2VkSXRlbSgpO1xuICAgICAgaWYgKGZvY3VzZWRJdGVtSW5kZXggIT09IC0xICYmIGZvY3VzZWRJdGVtSW5kZXggIT09IDApIHtcbiAgICAgICAgZm9jdXNlZEl0ZW1JbmRleCA9IGZvY3VzZWRJdGVtSW5kZXggLSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9jdXNlZEl0ZW1JbmRleCA9IHRoaXMuZmlsdGVyZWRJdGVtcy5sZW5ndGggLSAxO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmZpbHRlcmVkSXRlbXNbZm9jdXNlZEl0ZW1JbmRleF0uZm9jdXNlZCA9IHRydWU7XG5cbiAgICAgIGlmICh0aGlzLmZpbHRlcmVkSXRlbXNbZm9jdXNlZEl0ZW1JbmRleF0uZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5zZXRQcmV2aW91c0l0ZW1Bc0ZvY3VzZWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXROZXh0SXRlbUFzRm9jdXNlZCgpIHtcbiAgICBpZiAodGhpcy5vcGVuZWQgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbHRlcihpdGVtID0+ICFpdGVtLmRpc2FibGVkKS5sZW5ndGggPiAwKSB7XG4gICAgICBsZXQgZm9jdXNlZEl0ZW1JbmRleDogbnVtYmVyID0gdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICB0aGlzLnJlc2V0Rm9jdXNlZEl0ZW0oKTtcbiAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ICE9PSAtMSAmJiBmb2N1c2VkSXRlbUluZGV4ICE9PSB0aGlzLmZpbHRlcmVkSXRlbXMubGVuZ3RoIC0gMSkge1xuICAgICAgICBmb2N1c2VkSXRlbUluZGV4ID0gZm9jdXNlZEl0ZW1JbmRleCArIDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb2N1c2VkSXRlbUluZGV4ID0gMDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zW2ZvY3VzZWRJdGVtSW5kZXhdLmZvY3VzZWQgPSB0cnVlO1xuXG4gICAgICBpZiAodGhpcy5maWx0ZXJlZEl0ZW1zW2ZvY3VzZWRJdGVtSW5kZXhdLmRpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuc2V0TmV4dEl0ZW1Bc0ZvY3VzZWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0b2dnbGVNdWx0aU1vZGVJdGVtKGl0ZW06IENvbWJvQm94SXRlbSwgb3B0aW9ucz86IHsgcmVtb3ZlRm9jdXNBZnRlclNlbGVjdGlvbjogYm9vbGVhbiB9KSB7XG4gICAgaXRlbS5zZWxlY3RlZCA9ICFpdGVtLnNlbGVjdGVkO1xuXG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZEl0ZW1zKGl0ZW0pO1xuXG4gICAgaWYgKCFvcHRpb25zIHx8IG9wdGlvbnMucmVtb3ZlRm9jdXNBZnRlclNlbGVjdGlvbikge1xuICAgICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZEluZGV4ID0gdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbmRJbmRleChzZWFyY2hlZEl0ZW0gPT4gISFzZWFyY2hlZEl0ZW0uZm9jdXNlZCk7XG4gICAgICBpZiAoY3VycmVudGx5Rm9jdXNlZEluZGV4ID4gMCkge1xuICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXNbY3VycmVudGx5Rm9jdXNlZEluZGV4XS5mb2N1c2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaXRlbUluRHJvcGRvd25MaXN0ID0gdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbmQoZHJvcGRvd25JdGVtID0+IGRyb3Bkb3duSXRlbS52YWx1ZSA9PT0gaXRlbS52YWx1ZSk7XG5cbiAgICBpdGVtSW5Ecm9wZG93bkxpc3Quc2VsZWN0ZWQgPSBpdGVtLnNlbGVjdGVkO1xuXG4gICAgdGhpcy5maW5kRm9jdXNlZFRhZygpO1xuICAgIHRoaXMuZW1pdFNlbGVjdGVkSXRlbXNDaGFuZ2UoKTtcbiAgICB0aGlzLl92YWxpZGF0ZSgpO1xuICB9XG5cbiAgdXBkYXRlU2VsZWN0ZWRJdGVtcyhpdGVtOiBDb21ib0JveEl0ZW0pIHtcbiAgICBpZiAoaXRlbS5zZWxlY3RlZCkge1xuICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2goaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IHRoaXMuc2VsZWN0ZWRJdGVtcy5maWx0ZXIoZnVuY3Rpb24oZWxlbWVudDogQ29tYm9Cb3hJdGVtKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50LnZhbHVlICE9PSBpdGVtLnZhbHVlO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlTXVsdGlDb21ib0JveFRleHQoKTtcbiAgfVxuXG4gIHVwZGF0ZVZpZXdJbnB1dCgpOiB2b2lkIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLl92YWx1ZSkgfHwgdGhpcy51c2VNdWx0aSkge1xuICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLl9pdGVtcy5tYXAoaXRlbSA9PiB7XG4gICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSAodGhpcy5fdmFsdWUgYXMgYW55W10pPy5pbmNsdWRlcyhpdGVtLnZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gdGhpcy5faXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5zZWxlY3RlZCk7XG4gICAgICB0aGlzLnVwZGF0ZU11bHRpQ29tYm9Cb3hUZXh0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLl92YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLnJlc2V0RHJvcGRvd25JdGVtcygpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzZWxlY3RlZEl0ZW0gPSB0aGlzLmZpbmRJdGVtQnlWYWx1ZSh0aGlzLl92YWx1ZSk7XG5cbiAgICAgIGlmICh0aGlzLmlucHV0KSB7XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBzZWxlY3RlZEl0ZW0/LmxhYmVsID8/ICcnO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZU11bHRpQ29tYm9Cb3hUZXh0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnVzZU11bHRpKSB7XG4gICAgICBpZiAodHlwZW9mIHRoaXMuc2VsZWN0ZWRPcHRpb25zVGV4dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLm11bHRpQ29tYm9Cb3hUZXh0ID0gdGhpcy5zZWxlY3RlZE9wdGlvbnNUZXh0KHRoaXMuc2VsZWN0ZWRJdGVtcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm11bHRpQ29tYm9Cb3hUZXh0ID0gdGhpcy5zZWxlY3RlZE9wdGlvbnNUZXh0ICsgJyAoJyArIHRoaXMuc2VsZWN0ZWRJdGVtcy5sZW5ndGggKyAnKSc7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZm9jdXNGaXJzdEZpbHRlcmVkSXRlbSgpIHtcbiAgICBpZiAodGhpcy5pbnB1dCAmJiB0aGlzLm9wZW5lZCAmJiB0aGlzLmZpbHRlcmVkSXRlbXMubGVuZ3RoID4gMCAmJiB0aGlzLmZpbHRlcmVkSXRlbXMuc29tZShpdGVtID0+ICFpdGVtLmRpc2FibGVkKSkge1xuICAgICAgY29uc3QgZW5hYmxlZEl0ZW1zID0gdGhpcy5maWx0ZXJlZEl0ZW1zLmZpbHRlcihpdGVtID0+ICFpdGVtLmRpc2FibGVkKTtcbiAgICAgIGVuYWJsZWRJdGVtc1swXS5mb2N1c2VkID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgdGhpcy5pbnB1dEJveC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0JykuZm9jdXMoKTtcbiAgICAgIHRoaXMuc2hvd0ludmFsaWRTdGF0ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZVZpZXdJbnB1dEFmdGVyRHJvcGRvd25DbG9zZWQoKTogdm9pZCB7XG4gICAgdGhpcy5yZXNldEZvY3VzZWRJdGVtKCk7XG5cbiAgICBpZiAoIXRoaXMudXNlTXVsdGkgJiYgdGhpcy5fdmFsdWUpIHtcbiAgICAgIHRoaXMudXBkYXRlVmlld0lucHV0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSAnJztcbiAgICB9XG5cbiAgICB0aGlzLmNsZWFuRmlsdGVyKCk7XG4gICAgdGhpcy5fdmFsaWRhdGUoKTtcbiAgfVxuXG4gIHJlc2V0RHJvcGRvd25JdGVtcygpOiB2b2lkIHtcbiAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSBbLi4udGhpcy5faXRlbXNdO1xuICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xuICAgIHRoaXMudXBkYXRlTXVsdGlDb21ib0JveFRleHQoKTtcbiAgICB0aGlzLl9pdGVtcyA9IHRoaXMuX2l0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBpdGVtO1xuICAgIH0pO1xuICB9XG5cbiAgZW1pdFNlbGVjdGVkSXRlbXNDaGFuZ2UoKTogdm9pZCB7XG4gICAgY29uc3QgX3NlbGVjdGVkSXRlbXMgPSB0aGlzLl9pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnNlbGVjdGVkKS5tYXAoaXRlbSA9PiBpdGVtLnZhbHVlKTtcbiAgICB0aGlzLnZhbHVlID0gX3NlbGVjdGVkSXRlbXM7XG4gICAgdGhpcy5jaGFuZ2VFdmVudC5lbWl0KF9zZWxlY3RlZEl0ZW1zKTtcbiAgICB0aGlzLl9vbkNoYW5nZShfc2VsZWN0ZWRJdGVtcyk7XG4gICAgdGhpcy5fb25Ub3VjaGVkKCk7XG4gIH1cblxuICBmaWx0ZXIoKSB7XG4gICAgdGhpcy5yZXNldEZvY3VzZWRJdGVtKCk7XG4gICAgaWYgKCF0aGlzLl9pdGVtcykge1xuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gW107XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZpbHRlcjogQ29tYm9Cb3hGaWx0ZXIgPSB0aGlzLmN1c3RvbUZpbHRlciA/PyB0aGlzLl9kZWZhdWx0RmlsdGVyO1xuICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IGZpbHRlcih0aGlzLmlucHV0Py52YWx1ZT8udG9TdHJpbmcoKSwgdGhpcy5faXRlbXMpO1xuICB9XG5cbiAgZmlsdGVyQW5kT3BlbkRyb3Bkb3duKCkge1xuICAgIHRoaXMuZmlsdGVyKCk7XG4gICAgdGhpcy50b2dnbGUodHJ1ZSk7XG4gICAgdGhpcy5mb2N1c0ZpcnN0RmlsdGVyZWRJdGVtKCk7XG4gIH1cblxuICBjbGVhbkZpbHRlcigpIHtcbiAgICBpZiAoIXRoaXMuX2l0ZW1zKSB7XG4gICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSBbXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gdGhpcy5faXRlbXM7XG4gICAgfVxuICB9XG5cbiAgc2VsZWN0SXRlbShpdGVtOiBDb21ib0JveERyb3Bkb3duSXRlbUNvbXBvbmVudCkge1xuICAgIGlmICh0aGlzLnVzZU11bHRpKSB7XG4gICAgICB0aGlzLnRvZ2dsZU11bHRpTW9kZUl0ZW0oaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsdWUgPSBpdGVtLnZhbHVlO1xuICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gWy4uLnRoaXMuX2l0ZW1zXTtcbiAgICAgIHRoaXMudG9nZ2xlKGZhbHNlKTtcbiAgICAgIHRoaXMuY2hhbmdlRXZlbnQuZW1pdChpdGVtLnZhbHVlKTtcbiAgICAgIHRoaXMuX29uVG91Y2hlZCgpO1xuICAgICAgdGhpcy5fdmFsaWRhdGUoKTtcbiAgICB9XG4gIH1cblxuICBmaW5kSXRlbUJ5VmFsdWUodmFsdWU6IGFueSk6IENvbWJvQm94RHJvcGRvd25JdGVtQ29tcG9uZW50IHtcbiAgICBpZiAoIXRoaXMuaXRlbXMpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKGl0ZW0gPT4ge1xuICAgICAgcmV0dXJuIGl0ZW0udmFsdWUgPT09IHZhbHVlIHx8IEpTT04uc3RyaW5naWZ5KGl0ZW0udmFsdWUpID09PSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfSlbMF07XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICB0aGlzLl92YWx1ZSA9IG51bGw7XG4gICAgdGhpcy5pbnB1dC52YWx1ZSA9IG51bGw7XG4gICAgdGhpcy5jaGFuZ2VFdmVudC5lbWl0KG51bGwpO1xuICAgIHRoaXMuX29uQ2hhbmdlKG51bGwpO1xuICAgIHRoaXMuX29uVG91Y2hlZCgpO1xuICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG4gIH1cblxuICBpc0Zvcm1SZXNldCgpIHtcbiAgICBsZXQgcmVzZXQgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLmNvbnRyb2wpIHtcbiAgICAgIGNvbnN0IHsgcHJpc3RpbmUgfSA9IHRoaXMuY29udHJvbDtcbiAgICAgIHJlc2V0ID0gdGhpcy5fdmFsdWUgPT09IG51bGwgJiYgcHJpc3RpbmUgIT09IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiByZXNldDtcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fb25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLl9vblRvdWNoZWQgPSBmbjtcbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsdWU6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuY2hhbmdlVmFsdWUodmFsdWUsIHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgfVxuXG4gIHNldERpc2FibGVkU3RhdGUoZGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc2FibGVkID0gZGlzYWJsZWQ7XG4gIH1cblxuICBwcml2YXRlIGNoYW5nZVZhbHVlKG5ld1ZhbHVlOiBhbnksIG9wdGlvbnM6IHsgZW1pdEV2ZW50OiBib29sZWFuIH0pIHtcbiAgICB0aGlzLl92YWx1ZSA9IG5ld1ZhbHVlO1xuXG4gICAgdGhpcy51cGRhdGVWaWV3SW5wdXQoKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG5ld1ZhbHVlKSkge1xuICAgICAgdGhpcy5maW5kRm9jdXNlZFRhZygpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmVtaXRFdmVudCAmJiAhdGhpcy5pc0Zvcm1SZXNldCgpKSB7XG4gICAgICB0aGlzLl9vbkNoYW5nZShuZXdWYWx1ZSk7XG4gICAgfVxuICAgIHRoaXMuX3ZhbGlkYXRlKCk7XG4gIH1cblxuICBwcml2YXRlIF92YWxpZGF0ZSgpIHtcbiAgICBpZiAodGhpcy5jb250cm9sKSB7XG4gICAgICBjb25zdCB7IHRvdWNoZWQsIGludmFsaWQgfSA9IHRoaXMuY29udHJvbDtcbiAgICAgIHRoaXMuc2hvd0ludmFsaWRTdGF0ZSA9IGludmFsaWQgJiYgdG91Y2hlZDtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMudXNlTXVsdGkpIHtcbiAgICAgICAgdGhpcy5zaG93SW52YWxpZFN0YXRlID1cbiAgICAgICAgICB0aGlzLl9pc1RvdWNoZWQgJiYgdGhpcy5yZXF1aXJlZCA9PT0gdHJ1ZSAmJiB0aGlzLl9pdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnNlbGVjdGVkKS5sZW5ndGggPT09IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNob3dJbnZhbGlkU3RhdGUgPSB0aGlzLl9pc1RvdWNoZWQgJiYgdGhpcy5yZXF1aXJlZCA9PT0gdHJ1ZSAmJiAhdGhpcy5fdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfbGlzdGVuVG9JbnB1dEZvY3VzKCkge1xuICAgIGlmICghdGhpcy5pbnB1dEJveCkgcmV0dXJuO1xuICAgIGNvbnN0IGlucHV0RWxlbWVudCA9ICh0aGlzLmlucHV0Qm94Lm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgY29uc3QgZm9jdXNFdmVudCA9IGZyb21FdmVudChpbnB1dEVsZW1lbnQsICdmb2N1cycpLnBpcGUobWFwKCgpID0+ICdmb2N1cycpKTtcbiAgICBjb25zdCBibHVyRXZlbnQgPSBmcm9tRXZlbnQoaW5wdXRFbGVtZW50LCAnYmx1cicpLnBpcGUobWFwKCgpID0+ICdibHVyJykpO1xuXG4gICAgbWVyZ2UoZm9jdXNFdmVudCwgYmx1ckV2ZW50KVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpLFxuICAgICAgICBtYXAoZXZlbnROYW1lID0+IChldmVudE5hbWUgPT09ICdmb2N1cycgPyB0cnVlIDogZmFsc2UpKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShpbnB1dEZvY3VzID0+IHtcbiAgICAgICAgdGhpcy5jb21ib0ZvY3VzZWQgPSBpbnB1dEZvY3VzO1xuICAgICAgfSk7XG4gIH1cblxuICBmb2N1c0lucHV0KCkge1xuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5faW5wdXRGb2N1c2VkID0gdHJ1ZTtcbiAgICAgIHRoaXMuY29tYm9Gb2N1c2VkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBmb2N1c291dElucHV0KCkge1xuICAgIHRoaXMuX2lucHV0Rm9jdXNlZCA9IGZhbHNlO1xuICAgIHRoaXMuY29tYm9Gb2N1c2VkID0gdGhpcy5vcGVuZWQ7XG4gIH1cblxuICBwcml2YXRlIF9zZXRHcmlkQ2xhc3NlcygpIHtcbiAgICBjb25zdCBsaXN0T2ZDbGFzc2VzID0gQXJyYXkuZnJvbSgodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQpLmNsYXNzTGlzdCk7XG4gICAgdGhpcy5ncmlkQ2xhc3NlcyA9IGxpc3RPZkNsYXNzZXMuZmlsdGVyKChpdGVtOiBzdHJpbmcpID0+IGl0ZW0ubWF0Y2goL2Jtd19fZ3JpZF9fY2VsbC4qLykpO1xuICAgIGlmICh0aGlzLmdyaWRDbGFzc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHdyYXBwZXJDbGFzc0xpc3QgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuY29tYm8tYm94LWNvbnRhaW5lcicpLmNsYXNzTGlzdDtcbiAgICAgIHdyYXBwZXJDbGFzc0xpc3QudmFsdWUuc3BsaXQoJyAnKS5mb3JFYWNoKChjbGFzc05hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAoY2xhc3NOYW1lLm1hdGNoKC9ibXdfX2dyaWRfX2NlbGwuKi8pKSB7XG4gICAgICAgICAgd3JhcHBlckNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmdyaWRDbGFzc2VzLmZvckVhY2goKGNsYXNzTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5jb21iby1ib3gtY29udGFpbmVyJykuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZpbmRGb2N1c2VkVGFnKCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgZm9jdXNlZCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Jtdy10YWcgZGl2LmZvY3VzZWQnKTtcbiAgICAgIGlmICghZm9jdXNlZCkge1xuICAgICAgICB0aGlzLnNjcm9sbE9mZnNldCA9IDA7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGlmZiA9XG4gICAgICAgIGZvY3VzZWQucGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS54IC1cbiAgICAgICAgZm9jdXNlZC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS54IC1cbiAgICAgICAgdGhpcy5zY3JvbGxPZmZzZXQ7XG4gICAgICBpZiAoZGlmZiA8IDApIHtcbiAgICAgICAgdGhpcy5zY3JvbGxPZmZzZXQgPSAtZGlmZjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsT2Zmc2V0ID0gMDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBjbGljaygpIHtcbiAgICB0aGlzLnRvZ2dsZSgpO1xuICB9XG5cbiAgcHVibGljIGlucHV0VG91Y2hlZCgpIHtcbiAgICB0aGlzLl9pc1RvdWNoZWQgPSB0cnVlO1xuICAgIHRoaXMuX29uVG91Y2hlZCgpO1xuICB9XG59XG4iXX0=