import { __assign, __decorate } from "tslib";
import { Component, Input, Output, EventEmitter, HostListener, ViewChild, isDevMode } from '@angular/core';
var TableComponent = /** @class */ (function () {
    function TableComponent() {
        this.hideHeader = false;
        this.zebra = false;
        this.stickHeader = false;
        this.tableSorted = new EventEmitter();
        this.isLoading = false;
    }
    TableComponent.prototype.onScroll = function () {
        if (this.stickHeader) {
            if (this.headerContainer.nativeElement.getBoundingClientRect().top <= 0 &&
                this.tableContainer.nativeElement.getBoundingClientRect().bottom > 0 &&
                this.tableContainer.nativeElement.getBoundingClientRect().top < 0) {
                if (this.isIE()) {
                    this.headerContainer.nativeElement.classList.add('fixed');
                    this.headerContainer.nativeElement.setAttribute('style', "\n              left: -" + window.pageXOffset + "px;\n            ");
                }
            }
            else {
                if (this.isIE()) {
                    this.headerContainer.nativeElement.classList.remove('fixed');
                }
            }
            if (this.isIE()) {
                this.setElementsWidthRecursivelyBecauseHTMLTablesAreHardToDealWith(this.tableContainer.nativeElement);
            }
        }
    };
    TableComponent.prototype.shouldHaveStickHeader = function () {
        return this.stickHeader && !this.isIE();
    };
    TableComponent.prototype.ngOnInit = function () {
        var _a, _b, _c;
        if ((_a = this.data) === null || _a === void 0 ? void 0 : _a.length) {
            this.rowsAfterSort = this.data.map(function (i) { return (__assign({}, i)); });
        }
        // keep the legacy input
        else if ((_b = this.rowData) === null || _b === void 0 ? void 0 : _b.length) {
            if (isDevMode()) {
                console.warn('<bmw-table> `rowData` input is deprecated. Please use `data` instead');
            }
            this.rowsAfterSort = this.rowData.map(function (i) { return (__assign({}, i)); });
        }
        // keep the legacy input
        if ((_c = this.columnDefs) === null || _c === void 0 ? void 0 : _c.length) {
            if (isDevMode()) {
                console.warn('<bmw-table> `columnDefs` input is deprecated. Please use `columns` instead');
            }
            this.columns = this.columnDefs;
        }
    };
    TableComponent.prototype.ngOnChanges = function (changes) {
        if (changes['data']) {
            this.rowsAfterSort = this.data.map(function (i) { return (__assign({}, i)); });
        }
        // keep the legacy input
        else if (changes['rowData']) {
            this.rowsAfterSort = this.rowData.map(function (i) { return (__assign({}, i)); });
        }
        // keep the legacy input
        else if (changes['columnDefs']) {
            this.columns = this.columnDefs;
        }
    };
    TableComponent.prototype.ngAfterContentInit = function () {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
    };
    TableComponent.prototype.applySortToRows = function (header) {
        this.isLoading = true;
        if (header.sort === 'asc') {
            this.rowsAfterSort = this.rowsAfterSort.sort(function (a, b) {
                return a[header.field] > b[header.field] ? 1 : a[header.field] === b[header.field] ? 0 : -1;
            });
        }
        else if (header.sort === 'desc') {
            this.rowsAfterSort = this.rowsAfterSort.sort(function (a, b) {
                return a[header.field] < b[header.field] ? 1 : a[header.field] === b[header.field] ? 0 : -1;
            });
        }
        this.tableSorted.emit(header);
        this.isLoading = false;
    };
    TableComponent.prototype.toggleSort = function (header) {
        if (header.sorted) {
            if (header.sort === null || header.sort === 'asc') {
                header.sort = 'desc';
            }
            else {
                header.sort = 'asc';
            }
        }
        else {
            if (!header.sort) {
                header.sort = 'asc';
            }
        }
    };
    TableComponent.prototype.sortRowsByProperty = function (property) {
        var _this = this;
        var _a;
        if ((_a = this.columns) === null || _a === void 0 ? void 0 : _a.some(function (col) { return col.field === property && col.sortable === true; })) {
            this.columns.forEach(function (header) {
                if (header.sortable && header.field === property) {
                    _this.toggleSort(header);
                    _this.applySortToRows(header);
                    header.sorted = true;
                }
                else {
                    header.sort = null;
                    header.sorted = false;
                }
            });
        }
    };
    TableComponent.prototype.setElementsWidthRecursivelyBecauseHTMLTablesAreHardToDealWith = function (element) {
        this.setElementInlineWidth(element);
        for (var i = 0; i < element.childNodes.length; i++) {
            this.setElementsWidthRecursivelyBecauseHTMLTablesAreHardToDealWith(element.childNodes[i]);
        }
    };
    TableComponent.prototype.setElementInlineWidth = function (element) {
        if (element.getBoundingClientRect) {
            var width = element.getBoundingClientRect().width;
            element.setAttribute('style', "\n    width: " + width + "px !important;\n    max-width: " + width + "px !important;\n    ");
        }
    };
    TableComponent.prototype.isIE = function () {
        var result = false;
        if (window.navigator.userAgent.indexOf('MSIE ') > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))
            result = true;
        return result;
    };
    __decorate([
        Input()
    ], TableComponent.prototype, "columnDefs", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "columns", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "rowData", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "data", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "id", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "hideHeader", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "zebra", void 0);
    __decorate([
        Input()
    ], TableComponent.prototype, "stickHeader", void 0);
    __decorate([
        Output()
    ], TableComponent.prototype, "tableSorted", void 0);
    __decorate([
        ViewChild('tableContainer')
    ], TableComponent.prototype, "tableContainer", void 0);
    __decorate([
        ViewChild('headerContainer')
    ], TableComponent.prototype, "headerContainer", void 0);
    __decorate([
        HostListener('window:scroll')
    ], TableComponent.prototype, "onScroll", null);
    TableComponent = __decorate([
        Component({
            selector: 'bmw-table',
            template: "<table #tableContainer [ngClass]=\"{ zebra: zebra }\">\n  <thead #headerContainer [ngClass]=\"{ fixed: shouldHaveStickHeader() }\">\n    <tr class=\"header\" *ngIf=\"!hideHeader\">\n      <th\n        class=\"header-cell\"\n        [ngClass]=\"{ 'header-cell-sortable': column.sortable }\"\n        *ngFor=\"let column of columns\"\n        (click)=\"sortRowsByProperty(column.field)\"\n      >\n        <div class=\"header-cell-label\">\n          <span>{{ column.headerName }}</span>\n          <i\n            class=\"header-icon iwp-icon-gen_sort_list_asc\"\n            *ngIf=\"column.sortable && (column.sort === 'asc' || column.sort === null)\"\n            [ngClass]=\"{ sortInactive: !column.sorted }\"\n          ></i>\n          <i\n            class=\"header-icon iwp-icon-gen_sort_list_desc\"\n            *ngIf=\"column.sortable && column.sort === 'desc'\"\n            [ngClass]=\"{ sortInactive: !column.sorted }\"\n          ></i>\n        </div>\n      </th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr class=\"row\" *ngFor=\"let row of rowsAfterSort\">\n      <td class=\"row-cell\" *ngFor=\"let column of columns\">\n        {{ row[column.field] }}\n      </td>\n    </tr>\n  </tbody>\n</table>\n",
            styles: [":host{display:block;min-width:100%}table{min-width:100%;color:var(--color-bmw-basic4);font-family:Arial;font-size:var(--typography__regular-text__font-size);line-height:var(--typography__regular-text__line-height);background-color:var(--color-bmw-basic5);border-collapse:separate;border-spacing:0}table *{box-sizing:border-box;outline:0}table * :after,table * :before{outline:0;box-sizing:border-box}table .iwp-icon-gen_sort_list_asc:before{content:' \\e982'}table .iwp-icon-gen_sort_list_desc:before{content:' \\e983'}table thead.fixed .header-cell{position:sticky;position:-webkit-sticky;top:0;background-color:var(--table__header-cell__default__background-color);border-right:1px solid var(--table__header-cell__default__border-right-color)}table .header{font-family:bmwgroup;font-size:var(--typography__table-headline-text__font-size);line-height:var(--typography__table-headline-text__line-height);font-weight:700;background-color:var(--table__header-cell__default__background-color);color:var(--color-bmw-basic4);margin-bottom:-1px;border-bottom-color:var(--color-bmw-basic5);height:var(--table__header__default__height);flex-direction:row}table .header-cell{padding:var(--spacing-bmw-xs);border-right:1px solid var(--table__header-cell__default__border-right-color)}table .header-cell-label{display:flex;flex:1 1 auto;overflow:hidden;align-items:center;text-overflow:ellipsis;-ms-grid-row-align:stretch;align-self:stretch}table .header-cell-label>span{padding-right:var(--spacing-bmw-xs);text-align:left}table .header-cell-sortable{cursor:pointer}table .header-cell-sortable .header-icon{font-family:iwp;display:block;speak:none;font-size:var(--table__icons__font-size);color:var(--color-bmw-basic4);font-style:normal;font-weight:400;font-variant:normal;text-transform:none;-webkit-font-smoothing:antialiased}table .header-cell-sortable .header-icon.sortInactive{color:var(--color-bmw-basic4);opacity:.4}table .header-cell-sortable:hover{background-color:var(--table__header-cell__hover__background-color)}table .header-cell::after{display:none}table.zebra .row:nth-child(even){background-color:var(--table__row__zebra__background-color)}table.zebra .row:nth-child(even):hover{background-color:var(--table__row__hover__background-color)}table .row{background-color:var(--table__row__default__background-color);height:var(--table__row__default__height)}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){table thead.fixed{position:fixed;top:0;right:0;pointer-events:none}table thead.fixed+tbody:before{content:'\\200C';display:block;line-height:var(--table__cell__height)}table .row{box-shadow:inset 0 -1px 0 0 var(--table__row__border-bottom-color)}}table .row:hover{background-color:var(--table__row__hover__background-color)}table .row-cell{font-family:Arial;font-size:var(--typography__component-text__font-size);line-height:var(--typography__component-text__line-height);color:var(--color-bmw-basic4);padding:calc(var(--table__cell__padding) - 1px) var(--spacing-bmw-xs);outline:0;border-bottom:1px solid var(--table__row__border-bottom-color)}table .row-cell>*{height:var(--table__cell__height);display:flex;align-items:center}"]
        })
    ], TableComponent);
    return TableComponent;
}());
export { TableComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsidGFibGUvdGFibGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFFTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFFWixTQUFTLEVBQ1QsU0FBUyxFQUdWLE1BQU0sZUFBZSxDQUFDO0FBbUJ2QjtJQXNDRTtRQXJCQSxlQUFVLEdBQUcsS0FBSyxDQUFDO1FBR25CLFVBQUssR0FBRyxLQUFLLENBQUM7UUFHZCxnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUdwQixnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFnQixDQUFDO1FBUXhDLGNBQVMsR0FBRyxLQUFLLENBQUM7SUFJVixDQUFDO0lBR2hCLGlDQUFRLEdBQVI7UUFDRSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDcEIsSUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUNuRSxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDO2dCQUNwRSxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLEVBQ2pFO2dCQUNBLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO29CQUNmLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzFELElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FDN0MsT0FBTyxFQUNQLDRCQUNXLE1BQU0sQ0FBQyxXQUFXLHNCQUM1QixDQUNGLENBQUM7aUJBQ0g7YUFDRjtpQkFBTTtnQkFDTCxJ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bnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBFbGVtZW50UmVmLFxuICBWaWV3Q2hpbGQsXG4gIGlzRGV2TW9kZSxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5leHBvcnQgZGVjbGFyZSBpbnRlcmZhY2UgSVRhYmxlSGVhZGVyIHtcbiAgZmllbGQ6IHN0cmluZztcbiAgaGVhZGVyTmFtZT86IHN0cmluZztcbiAgc29ydGVkPzogYm9vbGVhbjtcbiAgc29ydGFibGU/OiBib29sZWFuO1xuICBzb3J0PzogJ2FzYycgfCAnZGVzYyc7XG59XG5cbmV4cG9ydCBkZWNsYXJlIGludGVyZmFjZSBJVGFibGVSb3cge1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBzdHJpbmdbXSB8IG51bWJlcjtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LXRhYmxlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3RhYmxlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGFibGUuY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYWJsZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KClcbiAgY29sdW1uRGVmczogSVRhYmxlSGVhZGVyW107XG5cbiAgQElucHV0KClcbiAgY29sdW1uczogSVRhYmxlSGVhZGVyW107XG5cbiAgQElucHV0KClcbiAgcm93RGF0YTogSVRhYmxlUm93W107XG5cbiAgQElucHV0KClcbiAgZGF0YTogSVRhYmxlUm93W107XG5cbiAgQElucHV0KClcbiAgaWQ6IHN0cmluZztcblxuICBASW5wdXQoKVxuICBoaWRlSGVhZGVyID0gZmFsc2U7XG5cbiAgQElucHV0KClcbiAgemVicmEgPSBmYWxzZTtcblxuICBASW5wdXQoKVxuICBzdGlja0hlYWRlciA9IGZhbHNlO1xuXG4gIEBPdXRwdXQoKVxuICB0YWJsZVNvcnRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SVRhYmxlSGVhZGVyPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3RhYmxlQ29udGFpbmVyJylcbiAgdGFibGVDb250YWluZXI6IEVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZCgnaGVhZGVyQ29udGFpbmVyJylcbiAgaGVhZGVyQ29udGFpbmVyOiBFbGVtZW50UmVmO1xuXG4gIHB1YmxpYyBpc0xvYWRpbmcgPSBmYWxzZTtcblxuICBwdWJsaWMgcm93c0FmdGVyU29ydDogSVRhYmxlUm93W107XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpzY3JvbGwnKVxuICBvblNjcm9sbCgpIHtcbiAgICBpZiAodGhpcy5zdGlja0hlYWRlcikge1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmhlYWRlckNvbnRhaW5lci5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCA8PSAwICYmXG4gICAgICAgIHRoaXMudGFibGVDb250YWluZXIubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5ib3R0b20gPiAwICYmXG4gICAgICAgIHRoaXMudGFibGVDb250YWluZXIubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgPCAwXG4gICAgICApIHtcbiAgICAgICAgaWYgKHRoaXMuaXNJRSgpKSB7XG4gICAgICAgICAgdGhpcy5oZWFkZXJDb250YWluZXIubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmaXhlZCcpO1xuICAgICAgICAgIHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgJ3N0eWxlJyxcbiAgICAgICAgICAgIGBcbiAgICAgICAgICAgICAgbGVmdDogLSR7d2luZG93LnBhZ2VYT2Zmc2V0fXB4O1xuICAgICAgICAgICAgYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmlzSUUoKSkge1xuICAgICAgICAgIHRoaXMuaGVhZGVyQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZml4ZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc0lFKCkpIHtcbiAgICAgICAgdGhpcy5zZXRFbGVtZW50c1dpZHRoUmVjdXJzaXZlbHlCZWNhdXNlSFRNTFRhYmxlc0FyZUhhcmRUb0RlYWxXaXRoKHRoaXMudGFibGVDb250YWluZXIubmF0aXZlRWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2hvdWxkSGF2ZVN0aWNrSGVhZGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0aWNrSGVhZGVyICYmICF0aGlzLmlzSUUoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRhdGE/Lmxlbmd0aCkge1xuICAgICAgdGhpcy5yb3dzQWZ0ZXJTb3J0ID0gdGhpcy5kYXRhLm1hcChpID0+ICh7IC4uLmkgfSkpO1xuICAgIH1cbiAgICAvLyBrZWVwIHRoZSBsZWdhY3kgaW5wdXRcbiAgICBlbHNlIGlmICh0aGlzLnJvd0RhdGE/Lmxlbmd0aCkge1xuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignPGJtdy10YWJsZT4gYHJvd0RhdGFgIGlucHV0IGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgYGRhdGFgIGluc3RlYWQnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yb3dzQWZ0ZXJTb3J0ID0gdGhpcy5yb3dEYXRhLm1hcChpID0+ICh7IC4uLmkgfSkpO1xuICAgIH1cblxuICAgIC8vIGtlZXAgdGhlIGxlZ2FjeSBpbnB1dFxuICAgIGlmICh0aGlzLmNvbHVtbkRlZnM/Lmxlbmd0aCkge1xuICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignPGJtdy10YWJsZT4gYGNvbHVtbkRlZnNgIGlucHV0IGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgYGNvbHVtbnNgIGluc3RlYWQnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29sdW1ucyA9IHRoaXMuY29sdW1uRGVmcztcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXNbJ2RhdGEnXSkge1xuICAgICAgdGhpcy5yb3dzQWZ0ZXJTb3J0ID0gdGhpcy5kYXRhLm1hcChpID0+ICh7IC4uLmkgfSkpO1xuICAgIH1cbiAgICAvLyBrZWVwIHRoZSBsZWdhY3kgaW5wdXRcbiAgICBlbHNlIGlmIChjaGFuZ2VzWydyb3dEYXRhJ10pIHtcbiAgICAgIHRoaXMucm93c0FmdGVyU29ydCA9IHRoaXMucm93RGF0YS5tYXAoaSA9PiAoeyAuLi5pIH0pKTtcbiAgICB9XG4gICAgLy8ga2VlcCB0aGUgbGVnYWN5IGlucHV0XG4gICAgZWxzZSBpZiAoY2hhbmdlc1snY29sdW1uRGVmcyddKSB7XG4gICAgICB0aGlzLmNvbHVtbnMgPSB0aGlzLmNvbHVtbkRlZnM7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIGlmICghdGhpcy5pZCkge1xuICAgICAgdGhpcy5pZCA9IE1hdGgucmFuZG9tKClcbiAgICAgICAgLnRvU3RyaW5nKDM2KVxuICAgICAgICAuc3Vic3RyaW5nKDIpO1xuICAgIH1cbiAgfVxuXG4gIGFwcGx5U29ydFRvUm93cyhoZWFkZXI6IElUYWJsZUhlYWRlcik6IHZvaWQge1xuICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICBpZiAoaGVhZGVyLnNvcnQgPT09ICdhc2MnKSB7XG4gICAgICB0aGlzLnJvd3NBZnRlclNvcnQgPSB0aGlzLnJvd3NBZnRlclNvcnQuc29ydCgoYSwgYikgPT5cbiAgICAgICAgYVtoZWFkZXIuZmllbGRdID4gYltoZWFkZXIuZmllbGRdID8gMSA6IGFbaGVhZGVyLmZpZWxkXSA9PT0gYltoZWFkZXIuZmllbGRdID8gMCA6IC0xXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAoaGVhZGVyLnNvcnQgPT09ICdkZXNjJykge1xuICAgICAgdGhpcy5yb3dzQWZ0ZXJTb3J0ID0gdGhpcy5yb3dzQWZ0ZXJTb3J0LnNvcnQoKGEsIGIpID0+XG4gICAgICAgIGFbaGVhZGVyLmZpZWxkXSA8IGJbaGVhZGVyLmZpZWxkXSA/IDEgOiBhW2hlYWRlci5maWVsZF0gPT09IGJbaGVhZGVyLmZpZWxkXSA/IDAgOiAtMVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLnRhYmxlU29ydGVkLmVtaXQoaGVhZGVyKTtcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSB0b2dnbGVTb3J0KGhlYWRlcjogSVRhYmxlSGVhZGVyKSB7XG4gICAgaWYgKGhlYWRlci5zb3J0ZWQpIHtcbiAgICAgIGlmIChoZWFkZXIuc29ydCA9PT0gbnVsbCB8fCBoZWFkZXIuc29ydCA9PT0gJ2FzYycpIHtcbiAgICAgICAgaGVhZGVyLnNvcnQgPSAnZGVzYyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoZWFkZXIuc29ydCA9ICdhc2MnO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIWhlYWRlci5zb3J0KSB7XG4gICAgICAgIGhlYWRlci5zb3J0ID0gJ2FzYyc7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc29ydFJvd3NCeVByb3BlcnR5KHByb3BlcnR5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb2x1bW5zPy5zb21lKGNvbCA9PiBjb2wuZmllbGQgPT09IHByb3BlcnR5ICYmIGNvbC5zb3J0YWJsZSA9PT0gdHJ1ZSkpIHtcbiAgICAgIHRoaXMuY29sdW1ucy5mb3JFYWNoKGhlYWRlciA9PiB7XG4gICAgICAgIGlmIChoZWFkZXIuc29ydGFibGUgJiYgaGVhZGVyLmZpZWxkID09PSBwcm9wZXJ0eSkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlU29ydChoZWFkZXIpO1xuICAgICAgICAgIHRoaXMuYXBwbHlTb3J0VG9Sb3dzKGhlYWRlcik7XG4gICAgICAgICAgaGVhZGVyLnNvcnRlZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaGVhZGVyLnNvcnQgPSBudWxsO1xuICAgICAgICAgIGhlYWRlci5zb3J0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRFbGVtZW50c1dpZHRoUmVjdXJzaXZlbHlCZWNhdXNlSFRNTFRhYmxlc0FyZUhhcmRUb0RlYWxXaXRoKGVsZW1lbnQpIHtcbiAgICB0aGlzLnNldEVsZW1lbnRJbmxpbmVXaWR0aChlbGVtZW50KTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnNldEVsZW1lbnRzV2lkdGhSZWN1cnNpdmVseUJlY2F1c2VIVE1MVGFibGVzQXJlSGFyZFRvRGVhbFdpdGgoZWxlbWVudC5jaGlsZE5vZGVzW2ldKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEVsZW1lbnRJbmxpbmVXaWR0aChlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KSB7XG4gICAgICBjb25zdCB3aWR0aCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG5cbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFxuICAgICAgICAnc3R5bGUnLFxuICAgICAgICBgXG4gICAgd2lkdGg6ICR7d2lkdGh9cHggIWltcG9ydGFudDtcbiAgICBtYXgtd2lkdGg6ICR7d2lkdGh9cHggIWltcG9ydGFudDtcbiAgICBgXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNJRSgpOiBib29sZWFuIHtcbiAgICBsZXQgcmVzdWx0ID0gZmFsc2U7XG5cbiAgICBpZiAod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRSAnKSA+IDAgfHwgISFuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9UcmlkZW50LipydlxcOjExXFwuLykpXG4gICAgICByZXN1bHQgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuIl19