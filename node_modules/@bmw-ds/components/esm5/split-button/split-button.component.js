import { __decorate } from "tslib";
import { Component, Input, ViewContainerRef, ViewChild, ContentChild, HostBinding, AfterViewInit, EventEmitter, Output, HostListener, ElementRef } from '@angular/core';
import { ContextMenuComponent } from '../context-menu/context-menu.component';
var SplitButtonComponent = /** @class */ (function () {
    function SplitButtonComponent(elemRef) {
        this.elemRef = elemRef;
        this.itemSelected = new EventEmitter();
        this.clickEvent = new EventEmitter();
    }
    SplitButtonComponent.prototype.onKeydown = function (event) {
        var key = event.code || event.keyCode;
        switch (key) {
            case 'Enter':
            case 'NumpadEnter':
            case 27:
            case 'Space':
            case 32:
                if (event.target === this.elemRef.nativeElement.querySelector('.button-arrow') ||
                    event.target === this.elemRef.nativeElement.querySelector('.icon-arrow')) {
                    this.toggle();
                    event.preventDefault();
                    event.stopPropagation();
                }
                break;
        }
    };
    SplitButtonComponent.prototype.clickout = function (event) {
        if (!this.contextMenu.element.nativeElement.contains(event.target)) {
            this.toggle(false);
        }
        event.stopPropagation();
    };
    SplitButtonComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.childContextMenu.childContextMenuItems.forEach(function (item) {
            _this.assignClick(item);
        });
    };
    // Recursevly shake all menu items and emit item onClick and close menu
    SplitButtonComponent.prototype.assignClick = function (menuItem) {
        var _this = this;
        if (menuItem.subMenu) {
            menuItem.subMenu.childContextMenuItems.forEach(function (item) {
                _this.assignClick(item);
            });
            return;
        }
        menuItem.selected.subscribe(function (item) {
            _this.itemSelected.emit(item);
            _this.toggle(false);
        });
    };
    SplitButtonComponent.prototype.arrowButtonClick = function (event) {
        this.toggle();
        event === null || event === void 0 ? void 0 : event.stopPropagation();
    };
    SplitButtonComponent.prototype.buttonClick = function () {
        if (this.disabledButton)
            return;
        this.clickEvent.emit(this);
    };
    SplitButtonComponent.prototype.toggle = function (state) {
        if (!this.childContextMenu || !this.childContextMenu.toggle)
            return;
        this.childContextMenu.unselectSubs();
        this.childContextMenu.toggle(state);
    };
    Object.defineProperty(SplitButtonComponent.prototype, "focus", {
        get: function () {
            return this.childContextMenu ? this.childContextMenu.opened : false;
        },
        enumerable: true,
        configurable: true
    });
    SplitButtonComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        ContentChild(ContextMenuComponent)
    ], SplitButtonComponent.prototype, "childContextMenu", void 0);
    __decorate([
        ViewChild('contextMenu', { read: ViewContainerRef })
    ], SplitButtonComponent.prototype, "contextMenu", void 0);
    __decorate([
        Input()
    ], SplitButtonComponent.prototype, "iconClass", void 0);
    __decorate([
        Input()
    ], SplitButtonComponent.prototype, "disabledButton", void 0);
    __decorate([
        Input()
    ], SplitButtonComponent.prototype, "disabledMenu", void 0);
    __decorate([
        Output()
    ], SplitButtonComponent.prototype, "itemSelected", void 0);
    __decorate([
        Output()
    ], SplitButtonComponent.prototype, "clickEvent", void 0);
    __decorate([
        HostListener('keydown', ['$event'])
    ], SplitButtonComponent.prototype, "onKeydown", null);
    __decorate([
        HostListener('document:click', ['$event'])
    ], SplitButtonComponent.prototype, "clickout", null);
    __decorate([
        HostBinding('class.opened')
    ], SplitButtonComponent.prototype, "focus", null);
    SplitButtonComponent = __decorate([
        Component({
            selector: 'bmw-split-button',
            template: "<div #contextMenu>\n  <div class=\"icon-wrapper\" *ngIf=\"iconClass\">\n    <bmw-icon-button\n      [iconClass]=\"iconClass\"\n      (clickEvent)=\"buttonClick()\"\n      [disabled]=\"disabledButton\"\n      [tabIndex]=\"disabledButton ? -1 : 0\"\n    ></bmw-icon-button>\n    <div class=\"icon-arrow\" (click)=\"toggle()\" [class.disabled]=\"disabledMenu\" [tabindex]=\"disabledMenu ? -1 : 0\"></div>\n  </div>\n  <div class=\"button-wrapper\" *ngIf=\"!iconClass\">\n    <bmw-button\n      (click)=\"buttonClick()\"\n      [attr.disabled]=\"disabledButton\"\n      [disabled]=\"disabledButton\"\n      [tabIndex]=\"disabledButton ? -1 : 0\"\n    >\n      <ng-content select=\"label\"></ng-content>\n    </bmw-button>\n    <div\n      class=\"button-arrow\"\n      (click)=\"arrowButtonClick($event)\"\n      [class.disabled]=\"disabledMenu\"\n      [tabindex]=\"disabledMenu ? -1 : 0\"\n    ></div>\n  </div>\n  <ng-content select=\"bmw-context-menu\"></ng-content>\n</div>\n",
            styles: ["div:focus{outline:0}div.button-wrapper,div.icon-wrapper{position:relative;display:inline-block;vertical-align:middle;max-width:100%}div.button-wrapper div.button-arrow,div.button-wrapper div.icon-arrow,div.icon-wrapper div.button-arrow,div.icon-wrapper div.icon-arrow{cursor:pointer}div.button-wrapper div.button-arrow.disabled,div.button-wrapper div.icon-arrow.disabled,div.icon-wrapper div.button-arrow.disabled,div.icon-wrapper div.icon-arrow.disabled{cursor:no-drop}div.button-wrapper div.button-arrow.disabled:active::after,div.button-wrapper div.icon-arrow.disabled:active::after,div.icon-wrapper div.button-arrow.disabled:active::after,div.icon-wrapper div.icon-arrow.disabled:active::after{pointer-events:none}div.button-wrapper div.button-arrow.disabled::after,div.button-wrapper div.icon-arrow.disabled::after,div.icon-wrapper div.button-arrow.disabled::after,div.icon-wrapper div.icon-arrow.disabled::after{opacity:.7}div.button-wrapper div.button-arrow::after,div.button-wrapper div.icon-arrow::after,div.icon-wrapper div.button-arrow::after,div.icon-wrapper div.icon-arrow::after{content:'\\e92f';font-family:iwp;position:absolute;right:0;color:var(--split-button__default__color)}div.button-wrapper div.button-arrow:hover::after,div.button-wrapper div.icon-arrow:hover::after,div.icon-wrapper div.button-arrow:hover::after,div.icon-wrapper div.icon-arrow:hover::after{background-color:var(--split-button__selected__background-color)}div.button-wrapper div.button-arrow:focus::after,div.button-wrapper div.icon-arrow:focus::after,div.icon-wrapper div.button-arrow:focus::after,div.icon-wrapper div.icon-arrow:focus::after{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}div.icon-wrapper{padding-right:var(--split-button__icon__padding-right)}div.icon-wrapper div.icon-arrow::after{width:var(--split-button__icon__arrow__font-size);height:var(--split-button__icon__arrow__font-size);padding:var(--split-button__icon-inner__padding-vertical) var(--split-button__icon-inner__padding-horizontal);font-size:var(--split-button__icon__arrow__font-size);top:0}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){div.icon-wrapper div.icon-arrow::after{padding:10px 3px}}div.icon-wrapper div.icon-arrow.disabled:hover::after{background-color:initial}div.button-wrapper{padding-right:var(--split-button__button__padding-right)}div.button-wrapper div.button-arrow::after{width:var(--split-button__icon__arrow__width);height:var(--split-button__icon__arrow__height);padding:var(--split-button__button_inner__padding);font-size:var(--split-button__button__arrow__font-size);line-height:var(--split-button__icon__arrow__height);text-align:center;top:0;background-color:var(--split-button__default__background-color);border:solid 1px var(--split-button__default__border-color)}div.button-wrapper div.button-arrow.disabled:hover::after{background-color:var(--split-button__default__background-color)}:host{max-width:calc(100% - var(--split-button__button__padding-right));display:inline-block;position:relative}:host ::ng-deep label{cursor:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host ::ng-deep .bmw-context-menu{min-width:100%}:host.opened div.button-wrapper div.button-arrow::after,:host.opened div.button-wrapper div.icon-arrow::after,:host.opened div.icon-wrapper div.button-arrow::after,:host.opened div.icon-wrapper div.icon-arrow::after{content:'\\e932';background-color:var(--split-button__selected__background-color)}"]
        })
    ], SplitButtonComponent);
    return SplitButtonComponent;
}());
export { SplitButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXQtYnV0dG9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BibXctZHMvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNwbGl0LWJ1dHRvbi9zcGxpdC1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCxnQkFBZ0IsRUFDaEIsU0FBUyxFQUNULFlBQVksRUFDWixXQUFXLEVBQ1gsYUFBYSxFQUNiLFlBQVksRUFDWixNQUFNLEVBQ04sWUFBWSxFQUNaLFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsb0JBQW9CLEVBQTRCLE1BQU0sd0NBQXdDLENBQUM7QUFPeEc7SUE2Q0UsOEJBQW9CLE9BQW1CO1FBQW5CLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFqQ3ZDLGlCQUFZLEdBQTJDLElBQUksWUFBWSxFQUE0QixDQUFDO1FBRXBHLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBd0IsQ0FBQztJQStCWixDQUFDO0lBNUIzQyx3Q0FBUyxHQUFULFVBQVUsS0FBb0I7UUFDNUIsSUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3hDLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLGFBQWEsQ0FBQztZQUNuQixLQUFLLEVBQUUsQ0FBQztZQUNSLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLElBQ0UsS0FBSyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDO29CQUMxRSxLQUFLLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsRUFDeEU7b0JBQ0EsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO29CQUNk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QztJQTBDRDtRQURDLFdBQVcsQ0FBQyxjQUFjLENBQUM7cURBRzNCO0lBdkZVLG9CQUFvQjtRQUxoQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsa0JBQWtCO1lBQzVCLDQ5QkFBNEM7O1NBRTdDLENBQUM7T0FDVyxvQkFBb0IsQ0F3RmhDO0lBQUQsMkJBQUM7Q0FBQSxBQXhGRCxJQXdGQztTQXhGWSxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3Q2hpbGQsXG4gIENvbnRlbnRDaGlsZCxcbiAgSG9zdEJpbmRpbmcsXG4gIEFmdGVyVmlld0luaXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT3V0cHV0LFxuICBIb3N0TGlzdGVuZXIsXG4gIEVsZW1lbnRSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb250ZXh0TWVudUNvbXBvbmVudCwgQ29udGV4dE1lbnVJdGVtQ29tcG9uZW50IH0gZnJvbSAnLi4vY29udGV4dC1tZW51L2NvbnRleHQtbWVudS5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdibXctc3BsaXQtYnV0dG9uJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NwbGl0LWJ1dHRvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3NwbGl0LWJ1dHRvbi5jb21wb25lbnQubGVzcyddXG59KVxuZXhwb3J0IGNsYXNzIFNwbGl0QnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBDb250ZW50Q2hpbGQoQ29udGV4dE1lbnVDb21wb25lbnQpXG4gIGNoaWxkQ29udGV4dE1lbnU6IENvbnRleHRNZW51Q29tcG9uZW50O1xuICBAVmlld0NoaWxkKCdjb250ZXh0TWVudScsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KVxuICBjb250ZXh0TWVudTogVmlld0NvbnRhaW5lclJlZjtcbiAgQElucHV0KClcbiAgaWNvbkNsYXNzOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIGRpc2FibGVkQnV0dG9uOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBkaXNhYmxlZE1lbnU6IGJvb2xlYW47XG4gIEBPdXRwdXQoKVxuICBpdGVtU2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxDb250ZXh0TWVudUl0ZW1Db21wb25lbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxDb250ZXh0TWVudUl0ZW1Db21wb25lbnQ+KCk7XG4gIEBPdXRwdXQoKVxuICBjbGlja0V2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxTcGxpdEJ1dHRvbkNvbXBvbmVudD4oKTtcblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgY29uc3Qga2V5ID0gZXZlbnQuY29kZSB8fCBldmVudC5rZXlDb2RlO1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdFbnRlcic6XG4gICAgICBjYXNlICdOdW1wYWRFbnRlcic6XG4gICAgICBjYXNlIDI3OlxuICAgICAgY2FzZSAnU3BhY2UnOlxuICAgICAgY2FzZSAzMjpcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGV2ZW50LnRhcmdldCA9PT0gdGhpcy5lbGVtUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmJ1dHRvbi1hcnJvdycpIHx8XG4gICAgICAgICAgZXZlbnQudGFyZ2V0ID09PSB0aGlzLmVsZW1SZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuaWNvbi1hcnJvdycpXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDpjbGljaycsIFsnJGV2ZW50J10pXG4gIGNsaWNrb3V0KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmNvbnRleHRNZW51LmVsZW1lbnQubmF0aXZlRWxlbWVudC5jb250YWlucyhldmVudC50YXJnZXQpKSB7XG4gICAgICB0aGlzLnRvZ2dsZShmYWxzZSk7XG4gICAgfVxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtUmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmNoaWxkQ29udGV4dE1lbnUuY2hpbGRDb250ZXh0TWVudUl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICB0aGlzLmFzc2lnbkNsaWNrKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gUmVjdXJzZXZseSBzaGFrZSBhbGwgbWVudSBpdGVtcyBhbmQgZW1pdCBpdGVtIG9uQ2xpY2sgYW5kIGNsb3NlIG1lbnVcbiAgYXNzaWduQ2xpY2sobWVudUl0ZW06IENvbnRleHRNZW51SXRlbUNvbXBvbmVudCkge1xuICAgIGlmIChtZW51SXRlbS5zdWJNZW51KSB7XG4gICAgICBtZW51SXRlbS5zdWJNZW51LmNoaWxkQ29udGV4dE1lbnVJdGVtcy5mb3JFYWNoKChpdGVtOiBDb250ZXh0TWVudUl0ZW1Db21wb25lbnQpID0+IHtcbiAgICAgICAgdGhpcy5hc3NpZ25DbGljayhpdGVtKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBtZW51SXRlbS5zZWxlY3RlZC5zdWJzY3JpYmUoKGl0ZW06IENvbnRleHRNZW51SXRlbUNvbXBvbmVudCkgPT4ge1xuICAgICAgdGhpcy5pdGVtU2VsZWN0ZWQuZW1pdChpdGVtKTtcbiAgICAgIHRoaXMudG9nZ2xlKGZhbHNlKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFycm93QnV0dG9uQ2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICB0aGlzLnRvZ2dsZSgpO1xuICAgIGV2ZW50Py5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIGJ1dHRvbkNsaWNrKCkge1xuICAgIGlmICh0aGlzLmRpc2FibGVkQnV0dG9uKSByZXR1cm47XG4gICAgdGhpcy5jbGlja0V2ZW50LmVtaXQodGhpcyk7XG4gIH1cblxuICB0b2dnbGUoc3RhdGU/OiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLmNoaWxkQ29udGV4dE1lbnUgfHwgIXRoaXMuY2hpbGRDb250ZXh0TWVudS50b2dnbGUpIHJldHVybjtcblxuICAgIHRoaXMuY2hpbGRDb250ZXh0TWVudS51bnNlbGVjdFN1YnMoKTtcbiAgICB0aGlzLmNoaWxkQ29udGV4dE1lbnUudG9nZ2xlKHN0YXRlKTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3Mub3BlbmVkJylcbiAgZ2V0IGZvY3VzKCkge1xuICAgIHJldHVybiB0aGlzLmNoaWxkQ29udGV4dE1lbnUgPyB0aGlzLmNoaWxkQ29udGV4dE1lbnUub3BlbmVkIDogZmFsc2U7XG4gIH1cbn1cbiJdfQ==