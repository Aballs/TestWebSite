import { __decorate } from "tslib";
import { Component, Input, ContentChild, ViewChild, HostBinding, Output, EventEmitter, HostListener, ViewContainerRef } from '@angular/core';
import { PanelContentComponent } from './panel-content.component';
import { IconButtonComponent } from '../icon-button/icon-button.component';
var PanelComponent = /** @class */ (function () {
    function PanelComponent() {
        this.disabled = false;
        this.opened = false;
        this.nonCollapsible = false;
        this.toggleEvent = new EventEmitter();
        this.overflowing = false;
        this.overflowingMenuState = false;
    }
    PanelComponent.prototype.onResize = function () {
        this.resizer();
    };
    PanelComponent.prototype.onKeydown = function (event) {
        var key = event.code || event.keyCode;
        switch (key) {
            case 'Enter':
            case 'NumpadEnter':
            case 13:
            case 'Space':
            case 32:
                if (event.target === this.labelsDiv.nativeElement) {
                    this.toggle();
                    event.preventDefault();
                    event.stopPropagation();
                }
                break;
        }
    };
    PanelComponent.prototype.ngOnInit = function () {
        this.checkProperties();
    };
    PanelComponent.prototype.ngOnChanges = function () {
        this.checkProperties();
    };
    PanelComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.visibleIconsContainer.insert(this.icons.createEmbeddedView(null));
        setTimeout(function () {
            _this.hideIconsIfNecessary();
        });
    };
    PanelComponent.prototype.checkProperties = function () {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
        if (this.nonCollapsible === true) {
            this.opened = true;
        }
    };
    PanelComponent.prototype.closeMenu = function (e) {
        var leavingParent = !this.threeDots.nativeElement.contains(e.relatedTarget);
        if (leavingParent) {
            this.toggleOveflowingMenu(e, false);
        }
    };
    PanelComponent.prototype.resizer = function () {
        var _this = this;
        var resizeTimer;
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function () {
            _this.hideIconsIfNecessary(true);
        });
    };
    PanelComponent.prototype.hideIconsIfNecessary = function (showAllFirst) {
        var _this = this;
        if (!this.labelsDiv)
            return;
        if (showAllFirst) {
            this.showAllIcons();
            this.overflowing = false;
        }
        var defaultHeight = this.labelsDiv.nativeElement.offsetHeight;
        var height = this.labelWrapper.nativeElement.offsetHeight;
        if (height > defaultHeight) {
            this.overflowing = true;
            var id = this.hideLastIcon();
            if (id) {
                setTimeout(function () {
                    _this.hideIconsIfNecessary();
                });
            }
        }
    };
    PanelComponent.prototype.showAllIcons = function () {
        while (this.hiddenIconsContainer.length > 0) {
            this.visibleIconsContainer.insert(this.hiddenIconsContainer.detach(0));
        }
    };
    PanelComponent.prototype.hideLastIcon = function () {
        var length = this.visibleIconsContainer.length;
        this.hiddenIconsContainer.insert(this.visibleIconsContainer.detach(length - 1), 0);
        return length > 1;
    };
    PanelComponent.prototype.toggle = function (state) {
        if (this.nonCollapsible || this.disabled)
            return;
        if (typeof state !== 'undefined') {
            this.opened = state;
        }
        else {
            this.opened = !this.opened;
        }
        this.toggleEvent.emit({
            id: this.id,
            opened: this.opened
        });
    };
    PanelComponent.prototype.toggleOveflowingMenu = function (e, state) {
        if (this.disabled)
            return;
        if (typeof state !== 'undefined') {
            this.overflowingMenuState = state;
        }
        else {
            this.overflowingMenuState = !this.overflowingMenuState;
        }
        e.stopPropagation();
    };
    __decorate([
        ContentChild(PanelContentComponent)
    ], PanelComponent.prototype, "childPanelContentComponent", void 0);
    __decorate([
        ViewChild('tpl')
    ], PanelComponent.prototype, "icons", void 0);
    __decorate([
        ViewChild('panel')
    ], PanelComponent.prototype, "labelsDiv", void 0);
    __decorate([
        ViewChild('threeDots')
    ], PanelComponent.prototype, "threeDots", void 0);
    __decorate([
        ViewChild('labelWrapper')
    ], PanelComponent.prototype, "labelWrapper", void 0);
    __decorate([
        ViewChild('hiddenIconsContainer', { read: ViewContainerRef })
    ], PanelComponent.prototype, "hiddenIconsContainer", void 0);
    __decorate([
        ViewChild('visibleIconsContainer', { read: ViewContainerRef })
    ], PanelComponent.prototype, "visibleIconsContainer", void 0);
    __decorate([
        Input()
    ], PanelComponent.prototype, "disabled", void 0);
    __decorate([
        Input()
    ], PanelComponent.prototype, "opened", void 0);
    __decorate([
        Input()
    ], PanelComponent.prototype, "nonCollapsible", void 0);
    __decorate([
        HostBinding('attr.id'),
        Input()
    ], PanelComponent.prototype, "id", void 0);
    __decorate([
        Output()
    ], PanelComponent.prototype, "toggleEvent", void 0);
    __decorate([
        HostListener('window:resize')
    ], PanelComponent.prototype, "onResize", null);
    __decorate([
        HostListener('keydown', ['$event'])
    ], PanelComponent.prototype, "onKeydown", null);
    PanelComponent = __decorate([
        Component({
            selector: 'bmw-panel',
            template: "<div class=\"wrapper\" [class.disabled]=\"disabled\" [attr.aria-disabled]=\"disabled\">\n  <div\n    [tabindex]=\"disabled || nonCollapsible ? -1 : 0\"\n    class=\"panel\"\n    [class.opened]=\"opened\"\n    [class.overflowing]=\"overflowing\"\n    [class.disabled]=\"disabled\"\n    [class.non-collapsible]=\"nonCollapsible\"\n    #panel\n    (click)=\"toggle()\"\n    [attr.aria-expanded]=\"opened\"\n  >\n    <div class=\"label-wrapper\" #labelWrapper>\n      <ng-content select=\"bmw-panel-label\"></ng-content>\n      <ng-container #visibleIconsContainer>\n        <ng-template #tpl>\n          <ng-content select=\"bmw-icon-button\"></ng-content>\n        </ng-template>\n      </ng-container>\n    </div>\n  </div>\n  <div\n    tabindex=\"0\"\n    class=\"three-dots\"\n    [class.opened]=\"overflowingMenuState\"\n    [class.disabled]=\"disabled\"\n    [class.non-collapsible]=\"nonCollapsible\"\n    [class.overflowing]=\"overflowing\"\n    #threeDots\n    (click)=\"toggleOveflowingMenu($event)\"\n    (focusout)=\"closeMenu($event)\"\n    [attr.aria-expanded]=\"overflowingMenuState\"\n  >\n    <div class=\"menu\"><ng-container #hiddenIconsContainer></ng-container></div>\n  </div>\n  <div class=\"content\" [class.disabled]=\"disabled\" [class.opened]=\"opened\">\n    <ng-content select=\"bmw-panel-content\"></ng-content>\n  </div>\n</div>\n",
            entryComponents: [IconButtonComponent],
            styles: [":host{display:block}.wrapper{position:relative}.wrapper .panel{cursor:pointer;padding-right:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding));background-color:var(--panel__defualt__background-color);color:var(--panel__labels__default__color);height:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding))}.wrapper .panel:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}.wrapper .panel .label-wrapper{width:100%;display:flex;flex-wrap:wrap}.wrapper .panel.overflowing{padding-right:calc(2 * (var(--panel__default__line-height) + 2 * var(--panel__default__padding)))}.wrapper .panel ::ng-deep bmw-icon-button{flex-grow:0;display:inline-flex;margin-right:var(--panel__icons__margin-right)}.wrapper .panel.disabled{pointer-events:none;opacity:.5}.wrapper .panel:not(.non-collapsible)::after{font-family:iwp;content:'\\e92f';position:absolute;right:0;top:0;height:var(--panel__default__line-height);width:var(--panel__default__line-height);font-size:var(--panel__default__line-height);padding:var(--panel__default__padding)}.wrapper .panel:not(.non-collapsible):hover{background-color:var(--panel__hover__background-color)}.wrapper .panel.non-collapsible{padding-right:initial;cursor:default}.wrapper .panel.non-collapsible.overflowing{padding-right:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding))}.wrapper .three-dots{display:none;position:absolute;cursor:pointer;top:0;right:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding));order:2;box-sizing:content-box;height:calc(var(--panel__default__line-height) + 2 * var(--panel__default__padding))}.wrapper .three-dots:focus{outline:0;background-color:var(--panel__more-dots__selected__background-color)}.wrapper .three-dots.non-collapsible{right:0}.wrapper .three-dots.disabled{pointer-events:none}.wrapper .three-dots .menu{display:none;position:absolute;background-color:var(--panel__more-dots__menu__background-color);top:100%;right:-1px;z-index:var(--panel__z-index-base);border:solid 1px var(--panel__more-dots__menu__border-color);border-top:none}.wrapper .three-dots .menu label{display:block;max-width:100%}.wrapper .three-dots.opened .menu{display:inline-block}.wrapper .three-dots::after{display:inline-block;line-height:var(--panel__default__line-height);font-size:var(--panel__default__line-height);padding:var(--panel__default__padding);font-family:iwp;content:'\\ea22'}.wrapper .three-dots.overflowing{display:inline-block}.wrapper .panel:not(.non-collapsible).opened::after{content:'\\e932'}.wrapper .content.disabled{pointer-events:none;opacity:.5}.wrapper .content{display:none}.wrapper .content.opened{display:block}.wrapper.disabled{cursor:no-drop}"]
        })
    ], PanelComponent);
    return PanelComponent;
}());
export { PanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsicGFuZWwvcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUdULEtBQUssRUFDTCxZQUFZLEVBQ1osU0FBUyxFQUVULFdBQVcsRUFDWCxNQUFNLEVBQ04sWUFBWSxFQUNaLFlBQVksRUFDWixnQkFBZ0IsRUFHakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFRM0U7SUFvREU7UUFwQ0EsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUVqQixXQUFNLEdBQUcsS0FBSyxDQUFDO1FBRWYsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFNdkIsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RDLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLHlCQUFvQixHQUFHLEtBQUssQ0FBQztJQXdCZCxDQUFDO0lBdEJoQixpQ0FBUSxHQUFSO1FBQ0UsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFHRCxrQ0FBUyxHQUFULFVBQVUsS0FBb0I7UUFDNUIsSUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3hDLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLGFBQWEsQ0FBQztZQUNuQixLQUFLLEVBQUUsQ0FBQztZQUNSLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFBRTtvQkFDakQsSUFBSSxDQUFDLE1BQU0sRUFB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LENBQUMsV0FBVyxDQUFDO3FEQUNEO0lBRXRCO1FBREMsU0FBUyxDQUFDLGNBQWMsQ0FBQzt3REFDRDtJQUV6QjtRQURDLFNBQVMsQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxDQUFDO2dFQUN2QjtJQUV2QztRQURDLFNBQVMsQ0FBQyx1QkFBdUIsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxDQUFDO2lFQUN2QjtJQUV4QztRQURDLEtBQUssRUFBRTtvREFDUztJQUVqQjtRQURDLEtBQUssRUFBRTtrREFDTztJQUVmO1FBREMsS0FBSyxFQUFFOzBEQUNlO0lBR3ZCO1FBRkMsV0FBVyxDQUFDLFNBQVMsQ0FBQztRQUN0QixLQUFLLEVBQUU7OENBQ0c7SUFHWDtRQURDLE1BQU0sRUFBRTt1REFDNkI7SUFJdEM7UUFEQyxZQUFZLENBQUMsZUFBZSxDQUFDO2tEQUc3QjtJQUdEO1FBREMsWUFBWSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO21EQWdCbkM7SUFsRFUsY0FBYztRQU4xQixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsV0FBVztZQUNyQix5MUNBQXFDO1lBRXJDLGVBQWUsRUFBRSxDQUFDLG1CQUFtQixDQUFDOztTQUN2QyxDQUFDO09BQ1csY0FBYyxDQTJKMUI7SUFBRCxxQkFBQztDQUFBLEFBM0pELElBMkpDO1NBM0pZLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIE9uSW5pdCxcbiAgRWxlbWVudFJlZixcbiAgSW5wdXQsXG4gIENvbnRlbnRDaGlsZCxcbiAgVmlld0NoaWxkLFxuICBPbkNoYW5nZXMsXG4gIEhvc3RCaW5kaW5nLFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBUZW1wbGF0ZVJlZixcbiAgQWZ0ZXJWaWV3SW5pdFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBhbmVsQ29udGVudENvbXBvbmVudCB9IGZyb20gJy4vcGFuZWwtY29udGVudC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSWNvbkJ1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4uL2ljb24tYnV0dG9uL2ljb24tYnV0dG9uLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Jtdy1wYW5lbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9wYW5lbC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3BhbmVsLmNvbXBvbmVudC5sZXNzJ10sXG4gIGVudHJ5Q29tcG9uZW50czogW0ljb25CdXR0b25Db21wb25lbnRdXG59KVxuZXhwb3J0IGNsYXNzIFBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xuICBAQ29udGVudENoaWxkKFBhbmVsQ29udGVudENvbXBvbmVudClcbiAgY2hpbGRQYW5lbENvbnRlbnRDb21wb25lbnQ6IFBhbmVsQ29udGVudENvbXBvbmVudDtcbiAgQFZpZXdDaGlsZCgndHBsJylcbiAgaWNvbnM6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBWaWV3Q2hpbGQoJ3BhbmVsJylcbiAgbGFiZWxzRGl2OiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd0aHJlZURvdHMnKVxuICB0aHJlZURvdHM6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ2xhYmVsV3JhcHBlcicpXG4gIGxhYmVsV3JhcHBlcjogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnaGlkZGVuSWNvbnNDb250YWluZXInLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSlcbiAgaGlkZGVuSWNvbnNDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG4gIEBWaWV3Q2hpbGQoJ3Zpc2libGVJY29uc0NvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KVxuICB2aXNpYmxlSWNvbnNDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG4gIEBJbnB1dCgpXG4gIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpXG4gIG9wZW5lZCA9IGZhbHNlO1xuICBASW5wdXQoKVxuICBub25Db2xsYXBzaWJsZSA9IGZhbHNlO1xuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICBASW5wdXQoKVxuICBpZDogc3RyaW5nO1xuXG4gIEBPdXRwdXQoKVxuICB0b2dnbGVFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBvdmVyZmxvd2luZyA9IGZhbHNlO1xuICBvdmVyZmxvd2luZ01lbnVTdGF0ZSA9IGZhbHNlO1xuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJylcbiAgb25SZXNpemUoKSB7XG4gICAgdGhpcy5yZXNpemVyKCk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgY29uc3Qga2V5ID0gZXZlbnQuY29kZSB8fCBldmVudC5rZXlDb2RlO1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdFbnRlcic6XG4gICAgICBjYXNlICdOdW1wYWRFbnRlcic6XG4gICAgICBjYXNlIDEzOlxuICAgICAgY2FzZSAnU3BhY2UnOlxuICAgICAgY2FzZSAzMjpcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy5sYWJlbHNEaXYubmF0aXZlRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jaGVja1Byb3BlcnRpZXMoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIHRoaXMuY2hlY2tQcm9wZXJ0aWVzKCk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy52aXNpYmxlSWNvbnNDb250YWluZXIuaW5zZXJ0KHRoaXMuaWNvbnMuY3JlYXRlRW1iZWRkZWRWaWV3KG51bGwpKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuaGlkZUljb25zSWZOZWNlc3NhcnkoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNoZWNrUHJvcGVydGllcygpIHtcbiAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpXG4gICAgICAgIC50b1N0cmluZygzNilcbiAgICAgICAgLnN1YnN0cmluZygyKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5ub25Db2xsYXBzaWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5vcGVuZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlTWVudShlOiBNb3VzZUV2ZW50KSB7XG4gICAgY29uc3QgbGVhdmluZ1BhcmVudCA9ICF0aGlzLnRocmVlRG90cy5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKDxOb2RlPmUucmVsYXRlZFRhcmdldCk7XG4gICAgaWYgKGxlYXZpbmdQYXJlbnQpIHtcbiAgICAgIHRoaXMudG9nZ2xlT3ZlZmxvd2luZ01lbnUoZSwgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHJlc2l6ZXIoKSB7XG4gICAgbGV0IHJlc2l6ZVRpbWVyOiBudW1iZXI7XG5cbiAgICBjbGVhclRpbWVvdXQocmVzaXplVGltZXIpO1xuICAgIHJlc2l6ZVRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmhpZGVJY29uc0lmTmVjZXNzYXJ5KHRydWUpO1xuICAgIH0pO1xuICB9XG5cbiAgaGlkZUljb25zSWZOZWNlc3Nhcnkoc2hvd0FsbEZpcnN0PzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5sYWJlbHNEaXYpIHJldHVybjtcbiAgICBpZiAoc2hvd0FsbEZpcnN0KSB7XG4gICAgICB0aGlzLnNob3dBbGxJY29ucygpO1xuICAgICAgdGhpcy5vdmVyZmxvd2luZyA9IGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBkZWZhdWx0SGVpZ2h0ID0gdGhpcy5sYWJlbHNEaXYubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5sYWJlbFdyYXBwZXIubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgaWYgKGhlaWdodCA+IGRlZmF1bHRIZWlnaHQpIHtcbiAgICAgIHRoaXMub3ZlcmZsb3dpbmcgPSB0cnVlO1xuICAgICAgY29uc3QgaWQgPSB0aGlzLmhpZGVMYXN0SWNvbigpO1xuICAgICAgaWYgKGlkKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuaGlkZUljb25zSWZOZWNlc3NhcnkoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2hvd0FsbEljb25zKCkge1xuICAgIHdoaWxlICh0aGlzLmhpZGRlbkljb25zQ29udGFpbmVyLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMudmlzaWJsZUljb25zQ29udGFpbmVyLmluc2VydCh0aGlzLmhpZGRlbkljb25zQ29udGFpbmVyLmRldGFjaCgwKSk7XG4gICAgfVxuICB9XG5cbiAgaGlkZUxhc3RJY29uKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMudmlzaWJsZUljb25zQ29udGFpbmVyLmxlbmd0aDtcbiAgICB0aGlzLmhpZGRlbkljb25zQ29udGFpbmVyLmluc2VydCh0aGlzLnZpc2libGVJY29uc0NvbnRhaW5lci5kZXRhY2gobGVuZ3RoIC0gMSksIDApO1xuXG4gICAgcmV0dXJuIGxlbmd0aCA+IDE7XG4gIH1cblxuICB0b2dnbGUoc3RhdGU/OiBib29sZWFuKSB7XG4gICAgaWYgKHRoaXMubm9uQ29sbGFwc2libGUgfHwgdGhpcy5kaXNhYmxlZCkgcmV0dXJuO1xuXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMub3BlbmVkID0gc3RhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3BlbmVkID0gIXRoaXMub3BlbmVkO1xuICAgIH1cblxuICAgIHRoaXMudG9nZ2xlRXZlbnQuZW1pdCh7XG4gICAgICBpZDogdGhpcy5pZCxcbiAgICAgIG9wZW5lZDogdGhpcy5vcGVuZWRcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZU92ZWZsb3dpbmdNZW51KGU6IE1vdXNlRXZlbnQsIHN0YXRlPzogYm9vbGVhbikge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSByZXR1cm47XG5cbiAgICBpZiAodHlwZW9mIHN0YXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5vdmVyZmxvd2luZ01lbnVTdGF0ZSA9IHN0YXRlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm92ZXJmbG93aW5nTWVudVN0YXRlID0gIXRoaXMub3ZlcmZsb3dpbmdNZW51U3RhdGU7XG4gICAgfVxuXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxufVxuIl19