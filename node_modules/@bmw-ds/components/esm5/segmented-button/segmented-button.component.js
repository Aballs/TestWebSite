import { __decorate } from "tslib";
import { AfterViewInit, Component, ContentChildren, ViewChild, OnInit, QueryList, ViewContainerRef, ChangeDetectorRef, EventEmitter, Output, ElementRef, ViewRef, TemplateRef, HostListener, forwardRef, Input, EmbeddedViewRef, OnDestroy } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { Subject } from 'rxjs';
import { SegmentedButtonItemComponent } from './segmented-button-item/segmented-button-item.component';
var SegmentedButtonComponent = /** @class */ (function () {
    function SegmentedButtonComponent(cd, elementRef) {
        this.cd = cd;
        this.elementRef = elementRef;
        this.onDestroy$ = new Subject();
        this.uncheckable = true;
        this.updateEvent = new EventEmitter();
        this.isMenuClosed = true;
        this.buttonItemClickSubscriptions = [];
        this.visibleElements = [];
        this.hiddenElements = [];
        this._onChange = function () { };
        this._onTouched = function () { };
    }
    SegmentedButtonComponent_1 = SegmentedButtonComponent;
    SegmentedButtonComponent.prototype.onResize = function () {
        if (this.previousWidth >= this.elementRef.nativeElement.getBoundingClientRect().width) {
            //shrinking
            this._hideElement();
        }
        else {
            //expanding
            this._showElement();
        }
        this.previousWidth = this.elementRef.nativeElement.getBoundingClientRect().width;
    };
    SegmentedButtonComponent.prototype.onKeydown = function (event) {
        var _this = this;
        var key = event.code || event.keyCode;
        switch (key) {
            case 'ArrowDown':
            case 40:
                if (!this.isMenuClosed) {
                    this.setNextItemAsFocused();
                }
                event.preventDefault();
                break;
            case 'ArrowUp':
            case 38:
                if (!this.isMenuClosed) {
                    this.setPreviousItemAsFocused();
                }
                event.preventDefault();
                break;
            case 'Enter':
            case 'NumpadEnter':
            case 13:
                if (!this.isMenuClosed) {
                    var focusedItem = this.hiddenElements.find(function (el) { return el.item.focused === true; });
                    if (!focusedItem.item.disabled) {
                        this.selectButton(focusedItem.item);
                        focusedItem.item.focused = false;
                        this.childItemsComponent
                            .toArray()
                            .find(function (element) { return element.value === _this.value; })
                            .button.focus();
                    }
                }
                event.preventDefault();
                break;
            case 'Space':
            case 32:
                if (event.target === this.elementRef.nativeElement.querySelector('.extension-menu')) {
                    this.toggleMenu();
                    event.preventDefault();
                }
                break;
            case 'Tab':
            case 9:
                if (!this.isMenuClosed) {
                    this.toggleMenu();
                }
                break;
        }
    };
    SegmentedButtonComponent.prototype.ngOnInit = function () {
        if (!this.id)
            this.id = Math.random()
                .toString(36)
                .substring(2);
        if (!this.name)
            this.name = 'segmented-' + this.id;
        this.previousWidth = this.elementRef.nativeElement.getBoundingClientRect().width;
    };
    SegmentedButtonComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (!this.visibleItemsContainer)
            return;
        this.createView();
        this.childItemsComponent.changes.subscribe(function (buttonItems) {
            _this.destroyView();
            _this.createView();
            if (buttonItems.last.checked) {
                _this.clearOtherChildren(buttonItems.last);
                _this._onChange(buttonItems.last.value);
                _this.updateEvent.emit(_this);
            }
        });
    };
    SegmentedButtonComponent.prototype.ngOnDestroy = function () {
        this.onDestroy$.next();
        this.onDestroy$.complete();
    };
    SegmentedButtonComponent.prototype.createView = function () {
        var _this = this;
        this.visibleElements = this.childItemsComponent.toArray().map(function (element, index) {
            element.resetVisibility();
            var view = _this.visibleItemsContainer.createEmbeddedView(element.sample);
            _this.buttonItemClickSubscriptions.push(element.buttonClicked.subscribe(function () {
                _this.selectButton(element);
                if (!_this.isMenuClosed) {
                    _this.toggleMenu();
                }
            }));
            if (element.checked) {
                _this.value = element.value;
            }
            if (_this.disabled) {
                element.disabled = _this.disabled;
            }
            return {
                view: view,
                order: index,
                item: element
            };
        });
        this.dots = this.visibleItemsContainer.createEmbeddedView(this.dropdownButton);
        this.cd.detectChanges();
        if (this._isOverflow) {
            this.showDots = true;
            this._hideElement();
        }
    };
    SegmentedButtonComponent.prototype.destroyView = function () {
        this.buttonItemClickSubscriptions.forEach(function (buttonClickSubscription) {
            buttonClickSubscription.unsubscribe();
        });
        this.visibleItemsContainer.clear();
        this.hiddenElements = [];
    };
    SegmentedButtonComponent.prototype.resetFocusedItem = function () {
        this.hiddenElements.forEach(function (el) { return (el.item.focused = false); });
    };
    SegmentedButtonComponent.prototype.setPreviousItemAsFocused = function () {
        if (!this.isMenuClosed &&
            this.hiddenElements.length > 0 &&
            this.hiddenElements.filter(function (el) { return !el.item.disabled; }).length > 0) {
            var focusedItemIndex = this.hiddenElements.findIndex(function (el) { return el.item.focused === true; });
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== 0) {
                focusedItemIndex = focusedItemIndex - 1;
            }
            else {
                focusedItemIndex = this.hiddenElements.length - 1;
            }
            this.hiddenElements[focusedItemIndex].item.focused = true;
            if (this.hiddenElements[focusedItemIndex].item.disabled) {
                this.setPreviousItemAsFocused();
            }
        }
    };
    SegmentedButtonComponent.prototype.setNextItemAsFocused = function () {
        if (!this.isMenuClosed &&
            this.hiddenElements.length > 0 &&
            this.hiddenElements.filter(function (el) { return !el.item.disabled; }).length > 0) {
            var focusedItemIndex = this.hiddenElements.findIndex(function (el) { return el.item.focused === true; });
            this.resetFocusedItem();
            if (focusedItemIndex !== -1 && focusedItemIndex !== this.hiddenElements.length - 1) {
                focusedItemIndex = focusedItemIndex + 1;
            }
            else {
                focusedItemIndex = 0;
            }
            this.hiddenElements[focusedItemIndex].item.focused = true;
            if (this.hiddenElements[focusedItemIndex].item.disabled) {
                this.setNextItemAsFocused();
            }
        }
    };
    SegmentedButtonComponent.prototype.showSelected = function (value) {
        var _this = this;
        var checkedEl = this.hiddenElements.find(function (el) {
            return el.item.value === value;
        });
        if (checkedEl) {
            checkedEl.item.removeFromDropdown();
            checkedEl.item.toggleItemVisibility(this.isMenuClosed);
            this.hiddenElements = this.hiddenElements.filter(function (el) { return el.item.value !== _this.value; });
            this.visibleElements.push(checkedEl);
            this.sortArrays();
            this.positionOverflowedItems();
            this.cd.detectChanges();
            this._hideElement();
        }
    };
    SegmentedButtonComponent.prototype._showElement = function () {
        if (this.hiddenElements.length) {
            var el = this.hiddenElements[0];
            el.item.removeFromDropdown();
            el.item.toggleItemVisibility(this.isMenuClosed);
            this.hiddenElements.splice(0, 1);
            this.visibleElements.push(el);
            this.sortArrays();
            el.view.detectChanges();
            if (this._isOverflow) {
                this._hideElement();
            }
            else {
                this._showElement();
            }
        }
        else {
            this.showDots = false;
        }
    };
    SegmentedButtonComponent.prototype._hideElement = function () {
        if (!this._isOverflow || this.visibleElements.length < 2) {
            return;
        }
        var index = this.visibleElements.length - 1;
        if (this.visibleElements[index].item.value === this.value) {
            index = index - 1;
        }
        var el = this.visibleElements[index];
        el.item.moveToDropdown();
        el.item.toggleItemVisibility(this.isMenuClosed);
        this.visibleElements.splice(index, 1);
        this.hiddenElements.unshift(el);
        this.sortArrays();
        this.positionOverflowedItems();
        this.cd.detectChanges();
        this._hideElement();
    };
    SegmentedButtonComponent.prototype.sortArrays = function () {
        this.hiddenElements.sort(function (a, b) { return a.order - b.order; });
        this.visibleElements.sort(function (a, b) { return a.order - b.order; });
    };
    SegmentedButtonComponent.prototype.selectButton = function (buttonItem) {
        var isValueChanged = false;
        if (this.uncheckable) {
            this.value = !buttonItem.checked ? buttonItem.value : null;
            isValueChanged = true;
        }
        else {
            if (this.value !== buttonItem.value) {
                this.value = buttonItem.value;
                isValueChanged = true;
            }
        }
        if (isValueChanged) {
            this._toggleCheckedChildren(buttonItem);
            this.showSelected(this.value);
            this._onChange(this.value);
        }
        else {
            buttonItem.button.checked = true;
        }
    };
    SegmentedButtonComponent.prototype.toggleMenu = function (state) {
        var _this = this;
        if (!this.disabled) {
            state !== undefined ? (this.isMenuClosed = state) : (this.isMenuClosed = !this.isMenuClosed);
            this.hiddenElements.forEach(function (el) {
                el.item.toggleItemVisibility(_this.isMenuClosed);
                el.view.detectChanges();
            });
        }
    };
    SegmentedButtonComponent.prototype.getMaxElWidthInDropdown = function () {
        var _this = this;
        if (this.hiddenElements.length) {
            this.toggleMenu(false);
            this.maxElWidthInDropdown = this.hiddenElements[0].view.rootNodes[0].getBoundingClientRect().width;
            this.hiddenElements.forEach(function (el) {
                var elWidth = el.view.rootNodes[0].getBoundingClientRect().width;
                if (elWidth > _this.maxElWidthInDropdown) {
                    _this.maxElWidthInDropdown = elWidth;
                }
            });
            this.toggleMenu(true);
        }
    };
    SegmentedButtonComponent.prototype.positionOverflowedItems = function () {
        var _this = this;
        this.getMaxElWidthInDropdown();
        this.hiddenElements.forEach(function (el, index) {
            el.item.setTop(index + 1);
            el.item.setWidth(_this.maxElWidthInDropdown);
        });
        this.cd.detectChanges();
    };
    Object.defineProperty(SegmentedButtonComponent.prototype, "_isOverflow", {
        get: function () {
            this._segmentButtonHeight = this.segmentButton.nativeElement.getBoundingClientRect().height.toFixed(0);
            this._componentHeight = this.labelWrapper.nativeElement.getBoundingClientRect().height.toFixed(0);
            if (this._segmentButtonHeight !== this._componentHeight) {
                this.showDots = true;
                return true;
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    SegmentedButtonComponent.prototype._toggleCheckedChildren = function (item) {
        var _this = this;
        if (this.childItemsComponent) {
            this.childItemsComponent.toArray().forEach(function (element) {
                if (element === item) {
                    element.setChecked(_this.uncheckable ? !element.checked : true);
                    _this.updateEvent.emit(_this);
                }
                else {
                    element.setChecked(false);
                }
            });
        }
    };
    SegmentedButtonComponent.prototype.clearOtherChildren = function (item) {
        if (this.childItemsComponent) {
            this.childItemsComponent.toArray().forEach(function (element) {
                if (element !== item) {
                    element.setChecked(false);
                }
            });
        }
    };
    SegmentedButtonComponent.prototype.registerOnChange = function (fn) {
        this._onChange = fn;
    };
    SegmentedButtonComponent.prototype.registerOnTouched = function (fn) {
        this._onTouched = fn;
    };
    SegmentedButtonComponent.prototype.writeValue = function (value) {
        var _this = this;
        setTimeout(function () {
            var initialItem = _this.childItemsComponent.toArray().find(function (element) { return element.value === _this.value; });
            var itemToSelect = _this.childItemsComponent.toArray().find(function (element) { return element.value === value; });
            _this.value = value;
            if (initialItem) {
                initialItem.checked = false;
            }
            if (itemToSelect) {
                itemToSelect.checked = true;
            }
        });
    };
    SegmentedButtonComponent.prototype.setDisabledState = function () {
        this.childItemsComponent.forEach(function (el) {
            el.disabled = true;
        });
    };
    var SegmentedButtonComponent_1;
    SegmentedButtonComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ElementRef }
    ]; };
    __decorate([
        ViewChild('labelWrapper')
    ], SegmentedButtonComponent.prototype, "labelWrapper", void 0);
    __decorate([
        ViewChild('segmentButton')
    ], SegmentedButtonComponent.prototype, "segmentButton", void 0);
    __decorate([
        ViewChild('dropdownButton', { read: TemplateRef })
    ], SegmentedButtonComponent.prototype, "dropdownButton", void 0);
    __decorate([
        ViewChild('visibleItemsContainer', { read: ViewContainerRef })
    ], SegmentedButtonComponent.prototype, "visibleItemsContainer", void 0);
    __decorate([
        ContentChildren(SegmentedButtonItemComponent)
    ], SegmentedButtonComponent.prototype, "childItemsComponent", void 0);
    __decorate([
        Input()
    ], SegmentedButtonComponent.prototype, "id", void 0);
    __decorate([
        Input()
    ], SegmentedButtonComponent.prototype, "name", void 0);
    __decorate([
        Input()
    ], SegmentedButtonComponent.prototype, "disabled", void 0);
    __decorate([
        Input()
    ], SegmentedButtonComponent.prototype, "uncheckable", void 0);
    __decorate([
        Output()
    ], SegmentedButtonComponent.prototype, "updateEvent", void 0);
    __decorate([
        HostListener('window:resize')
    ], SegmentedButtonComponent.prototype, "onResize", null);
    __decorate([
        HostListener('keydown', ['$event'])
    ], SegmentedButtonComponent.prototype, "onKeydown", null);
    SegmentedButtonComponent = SegmentedButtonComponent_1 = __decorate([
        Component({
            selector: 'bmw-segmented-button',
            template: "<div #labelWrapper class=\"label-wrapper\">\n  <div #segmentButton class=\"segmented-button\">\n    <ng-container #visibleItemsContainer> </ng-container>\n  </div>\n</div>\n\n<ng-template #dropdownButton>\n  <div\n    #extensionMenu\n    class=\"extension-menu\"\n    [class.disabled]=\"disabled\"\n    [class.selected]=\"!isMenuClosed\"\n    (click)=\"toggleMenu()\"\n    [class.show]=\"showDots\"\n    tabindex=\"0\"\n  ></div>\n</ng-template>\n",
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return SegmentedButtonComponent_1; }),
                    multi: true
                }
            ],
            styles: [".label-wrapper{height:2rem}.show{display:block!important}.segmented-button{display:inline-flex;min-height:2rem;padding-right:var(--segmanted-button__wrapper__padding-right);min-width:var(--segmented-button__item__min-width);flex-wrap:wrap;position:relative}.segmented-button .extension-menu{position:absolute;right:0;display:none;white-space:nowrap;margin-left:-1px;background-color:var(--toggle-button__default__background-color);cursor:pointer;border:solid 1px var(--toggle-button__secondary__border__color)}.segmented-button ::ng-deep bmw-segmented-button-item:nth-child(2):last-child label span span{display:block;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.segmented-button .extension-menu.disabled{opacity:.7;border:solid 1px var(--color-bmw-basic3-shade2);background-color:var(--color-bmw-basic1-shade3)}.segmented-button .extension-menu.disabled:hover{cursor:no-drop;border:solid 1px var(--color-bmw-basic3-shade2);background-color:var(--color-bmw-basic1-shade3)}.segmented-button .extension-menu.selected{border:solid 1px var(--color-bmw-basic3-shade2);background-color:var(--color-bmw-basic1-shade2)}.segmented-button .extension-menu:after{display:inline-block;font-size:var(--segmented-button__dots__font-size);line-height:var(--segmented-button__dots__font-size);padding:var(--segmented-button__dots__padding-vertical) var(--card-tabs__label__icon__padding);font-family:iwp;color:var(--card-tabs__labels__default__color);content:'\\ea22'}.segmented-button .extension-menu:hover{border:solid 1px var(--color-bmw-basic1-shade2);background-color:var(--color-bmw-basic1-shade2)}.segmented-button .extension-menu:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px}.segmented-button .extension-menu .dropdown{position:absolute;top:calc(100% + 2px);right:-1px;display:none}.segmented-button .extension-menu .dropdown ::ng-deep bmw-segmented-button-item{z-index:-1;margin-left:0;margin-top:-1px;white-space:nowrap;display:block}@media screen and (max-width:37.49rem){.label-wrapper{height:2.5rem}}"]
        })
    ], SegmentedButtonComponent);
    return SegmentedButtonComponent;
}());
export { SegmentedButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VnbWVudGVkLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYm13LWRzL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJzZWdtZW50ZWQtYnV0dG9uL3NlZ21lbnRlZC1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsYUFBYSxFQUNiLFNBQVMsRUFDVCxlQUFlLEVBQ2YsU0FBUyxFQUNULE1BQU0sRUFDTixTQUFTLEVBQ1QsZ0JBQWdCLEVBQ2hCLGlCQUFpQixFQUNqQixZQUFZLEVBQ1osTUFBTSxFQUNOLFVBQVUsRUFDVixPQUFPLEVBQ1AsV0FBVyxFQUNYLFlBQVksRUFDWixVQUFVLEVBQ1YsS0FBSyxFQUNMLGVBQWUsRUFDZixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxPQUFPLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBY3ZHO0lBOEdFLGtDQUFvQixFQUFxQixFQUFVLFVBQXNCO1FBQXJELE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQTdHakUsZUFBVSxHQUFrQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBd0JsRCxnQkFBVyxHQUFHLElBQUksQ0FBQztRQUduQixnQkFBVyxHQUFHLElBQUksWUFBWSxFQUE0QixDQUFDO1FBSTNELGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBTXBCLGlDQUE0QixHQUFtQixFQUFFLENBQUM7UUFFbEQsb0JBQWUsR0FBd0YsRUFBRSxDQUFDO1FBQzFHLG1CQUFjLEdBQXdGLEVBQUUsQ0FBQztRQUN6RyxjQUFTLEdBQXlCLGNBQU8sQ0FBQyxDQUFDO1FBQzNDLGVBQVUsR0FBYyxjQUFPLENBQUMsQ0FBQztJQW1FMkMs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LEVBQUU7aUVBQ1c7SUFHbkI7UUFEQyxNQUFNLEVBQUU7aUVBQ2tEO0lBa0IzRDtRQURDLFlBQVksQ0FBQyxlQUFlLENBQUM7NERBVTdCO0lBR0Q7UUFEQyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7NkRBbURuQztJQTVHVSx3QkFBd0I7UUFacEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHNCQUFzQjtZQUNoQywyY0FBZ0Q7WUFFaEQsU0FBUyxFQUFFO2dCQUNUO29CQUNFLE9BQU8sRUFBRSxpQkFBaUI7b0JBQzFCLFdBQVcsRUFBRSxVQUFVLENBQUMsY0FBTSxPQUFBLDBCQUF3QixFQUF4QixDQUF3QixDQUFDO29CQUN2RCxLQUFLLEVBQUUsSUFBSTtpQkFDWjthQUNGOztTQUNGLENBQUM7T0FDVyx3QkFBd0IsQ0E2WnBDO0lBQUQsK0JBQUM7Q0FBQSxBQTdaRCxJQTZaQztTQTdaWSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgVmlld0NoaWxkLFxuICBPbkluaXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NvbnRhaW5lclJlZixcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgT3V0cHV0LFxuICBFbGVtZW50UmVmLFxuICBWaWV3UmVmLFxuICBUZW1wbGF0ZVJlZixcbiAgSG9zdExpc3RlbmVyLFxuICBmb3J3YXJkUmVmLFxuICBJbnB1dCxcbiAgRW1iZWRkZWRWaWV3UmVmLFxuICBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTdWJqZWN0LCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFNlZ21lbnRlZEJ1dHRvbkl0ZW1Db21wb25lbnQgfSBmcm9tICcuL3NlZ21lbnRlZC1idXR0b24taXRlbS9zZWdtZW50ZWQtYnV0dG9uLWl0ZW0uY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LXNlZ21lbnRlZC1idXR0b24nLFxuICB0ZW1wbGF0ZVVybDogJy4vc2VnbWVudGVkLWJ1dHRvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3NlZ21lbnRlZC1idXR0b24uY29tcG9uZW50Lmxlc3MnXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBTZWdtZW50ZWRCdXR0b25Db21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWVcbiAgICB9XG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgU2VnbWVudGVkQnV0dG9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgcHJpdmF0ZSBvbkRlc3Ryb3kkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcblxuICBAVmlld0NoaWxkKCdsYWJlbFdyYXBwZXInKVxuICBsYWJlbFdyYXBwZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3NlZ21lbnRCdXR0b24nKVxuICBzZWdtZW50QnV0dG9uOiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGQoJ2Ryb3Bkb3duQnV0dG9uJywgeyByZWFkOiBUZW1wbGF0ZVJlZiB9KVxuICBkcm9wZG93bkJ1dHRvbjogVGVtcGxhdGVSZWY8YW55PjtcblxuICBAVmlld0NoaWxkKCd2aXNpYmxlSXRlbXNDb250YWluZXInLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSlcbiAgdmlzaWJsZUl0ZW1zQ29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oU2VnbWVudGVkQnV0dG9uSXRlbUNvbXBvbmVudClcbiAgY2hpbGRJdGVtc0NvbXBvbmVudDogUXVlcnlMaXN0PFNlZ21lbnRlZEJ1dHRvbkl0ZW1Db21wb25lbnQ+O1xuXG4gIEBJbnB1dCgpXG4gIGlkOiBzdHJpbmc7XG4gIEBJbnB1dCgpXG4gIG5hbWU6IHN0cmluZztcbiAgQElucHV0KClcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgQElucHV0KClcbiAgdW5jaGVja2FibGUgPSB0cnVlO1xuXG4gIEBPdXRwdXQoKVxuICB1cGRhdGVFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8U2VnbWVudGVkQnV0dG9uQ29tcG9uZW50PigpO1xuXG4gIHZhbHVlOiBzdHJpbmc7XG4gIHNob3dEb3RzOiBib29sZWFuO1xuICBpc01lbnVDbG9zZWQgPSB0cnVlO1xuICBwcmV2aW91c1dpZHRoOiBudW1iZXI7XG4gIGRvdHM6IFZpZXdSZWY7XG4gIF9jb21wb25lbnRIZWlnaHQ6IG51bWJlcjtcbiAgX3NlZ21lbnRCdXR0b25IZWlnaHQ6IG51bWJlcjtcbiAgbWF4RWxXaWR0aEluRHJvcGRvd246IG51bWJlcjtcbiAgYnV0dG9uSXRlbUNsaWNrU3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcblxuICB2aXNpYmxlRWxlbWVudHM6IHsgdmlldzogRW1iZWRkZWRWaWV3UmVmPGFueT47IG9yZGVyOiBudW1iZXI7IGl0ZW06IFNlZ21lbnRlZEJ1dHRvbkl0ZW1Db21wb25lbnQgfVtdID0gW107XG4gIGhpZGRlbkVsZW1lbnRzOiB7IHZpZXc6IEVtYmVkZGVkVmlld1JlZjxhbnk+OyBvcmRlcjogbnVtYmVyOyBpdGVtOiBTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50IH1bXSA9IFtdO1xuICBfb25DaGFuZ2U6ICh2YWx1ZTogYW55KSA9PiB2b2lkID0gKCkgPT4ge307XG4gIF9vblRvdWNoZWQ6ICgpID0+IGFueSA9ICgpID0+IHt9O1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnKVxuICBvblJlc2l6ZSgpIHtcbiAgICBpZiAodGhpcy5wcmV2aW91c1dpZHRoID49IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKSB7XG4gICAgICAvL3Nocmlua2luZ1xuICAgICAgdGhpcy5faGlkZUVsZW1lbnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy9leHBhbmRpbmdcbiAgICAgIHRoaXMuX3Nob3dFbGVtZW50KCk7XG4gICAgfVxuICAgIHRoaXMucHJldmlvdXNXaWR0aCA9IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXG4gIG9uS2V5ZG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGNvbnN0IGtleSA9IGV2ZW50LmNvZGUgfHwgZXZlbnQua2V5Q29kZTtcbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgY2FzZSAnQXJyb3dEb3duJzpcbiAgICAgIGNhc2UgNDA6XG4gICAgICAgIGlmICghdGhpcy5pc01lbnVDbG9zZWQpIHtcbiAgICAgICAgICB0aGlzLnNldE5leHRJdGVtQXNGb2N1c2VkKCk7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgIGNhc2UgMzg6XG4gICAgICAgIGlmICghdGhpcy5pc01lbnVDbG9zZWQpIHtcbiAgICAgICAgICB0aGlzLnNldFByZXZpb3VzSXRlbUFzRm9jdXNlZCgpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnRW50ZXInOlxuICAgICAgY2FzZSAnTnVtcGFkRW50ZXInOlxuICAgICAgY2FzZSAxMzpcbiAgICAgICAgaWYgKCF0aGlzLmlzTWVudUNsb3NlZCkge1xuICAgICAgICAgIGNvbnN0IGZvY3VzZWRJdGVtID0gdGhpcy5oaWRkZW5FbGVtZW50cy5maW5kKGVsID0+IGVsLml0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICAgICAgaWYgKCFmb2N1c2VkSXRlbS5pdGVtLmRpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEJ1dHRvbihmb2N1c2VkSXRlbS5pdGVtKTtcblxuICAgICAgICAgICAgZm9jdXNlZEl0ZW0uaXRlbS5mb2N1c2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudFxuICAgICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAgIC5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC52YWx1ZSA9PT0gdGhpcy52YWx1ZSlcbiAgICAgICAgICAgICAgLmJ1dHRvbi5mb2N1cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1NwYWNlJzpcbiAgICAgIGNhc2UgMzI6XG4gICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5leHRlbnNpb24tbWVudScpKSB7XG4gICAgICAgICAgdGhpcy50b2dnbGVNZW51KCk7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnVGFiJzpcbiAgICAgIGNhc2UgOTpcbiAgICAgICAgaWYgKCF0aGlzLmlzTWVudUNsb3NlZCkge1xuICAgICAgICAgIHRoaXMudG9nZ2xlTWVudSgpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLCBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKCF0aGlzLmlkKVxuICAgICAgdGhpcy5pZCA9IE1hdGgucmFuZG9tKClcbiAgICAgICAgLnRvU3RyaW5nKDM2KVxuICAgICAgICAuc3Vic3RyaW5nKDIpO1xuXG4gICAgaWYgKCF0aGlzLm5hbWUpIHRoaXMubmFtZSA9ICdzZWdtZW50ZWQtJyArIHRoaXMuaWQ7XG5cbiAgICB0aGlzLnByZXZpb3VzV2lkdGggPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBpZiAoIXRoaXMudmlzaWJsZUl0ZW1zQ29udGFpbmVyKSByZXR1cm47XG5cbiAgICB0aGlzLmNyZWF0ZVZpZXcoKTtcblxuICAgIHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudC5jaGFuZ2VzLnN1YnNjcmliZSgoYnV0dG9uSXRlbXM6IFF1ZXJ5TGlzdDxTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50PikgPT4ge1xuICAgICAgdGhpcy5kZXN0cm95VmlldygpO1xuICAgICAgdGhpcy5jcmVhdGVWaWV3KCk7XG5cbiAgICAgIGlmIChidXR0b25JdGVtcy5sYXN0LmNoZWNrZWQpIHtcbiAgICAgICAgdGhpcy5jbGVhck90aGVyQ2hpbGRyZW4oYnV0dG9uSXRlbXMubGFzdCk7XG4gICAgICAgIHRoaXMuX29uQ2hhbmdlKGJ1dHRvbkl0ZW1zLmxhc3QudmFsdWUpO1xuICAgICAgICB0aGlzLnVwZGF0ZUV2ZW50LmVtaXQodGhpcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLm9uRGVzdHJveSQubmV4dCgpO1xuICAgIHRoaXMub25EZXN0cm95JC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgY3JlYXRlVmlldygpIHtcbiAgICB0aGlzLnZpc2libGVFbGVtZW50cyA9IHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudC50b0FycmF5KCkubWFwKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgZWxlbWVudC5yZXNldFZpc2liaWxpdHkoKTtcbiAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLnZpc2libGVJdGVtc0NvbnRhaW5lci5jcmVhdGVFbWJlZGRlZFZpZXcoZWxlbWVudC5zYW1wbGUpO1xuICAgICAgdGhpcy5idXR0b25JdGVtQ2xpY2tTdWJzY3JpcHRpb25zLnB1c2goXG4gICAgICAgIGVsZW1lbnQuYnV0dG9uQ2xpY2tlZC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc2VsZWN0QnV0dG9uKGVsZW1lbnQpO1xuXG4gICAgICAgICAgaWYgKCF0aGlzLmlzTWVudUNsb3NlZCkge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVNZW51KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgaWYgKGVsZW1lbnQuY2hlY2tlZCkge1xuICAgICAgICB0aGlzLnZhbHVlID0gZWxlbWVudC52YWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgIGVsZW1lbnQuZGlzYWJsZWQgPSB0aGlzLmRpc2FibGVkO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmlldzogdmlldyxcbiAgICAgICAgb3JkZXI6IGluZGV4LFxuICAgICAgICBpdGVtOiBlbGVtZW50XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHRoaXMuZG90cyA9IHRoaXMudmlzaWJsZUl0ZW1zQ29udGFpbmVyLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLmRyb3Bkb3duQnV0dG9uKTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICBpZiAodGhpcy5faXNPdmVyZmxvdykge1xuICAgICAgdGhpcy5zaG93RG90cyA9IHRydWU7XG4gICAgICB0aGlzLl9oaWRlRWxlbWVudCgpO1xuICAgIH1cbiAgfVxuXG4gIGRlc3Ryb3lWaWV3KCkge1xuICAgIHRoaXMuYnV0dG9uSXRlbUNsaWNrU3Vic2NyaXB0aW9ucy5mb3JFYWNoKGJ1dHRvbkNsaWNrU3Vic2NyaXB0aW9uID0+IHtcbiAgICAgIGJ1dHRvbkNsaWNrU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLnZpc2libGVJdGVtc0NvbnRhaW5lci5jbGVhcigpO1xuICAgIHRoaXMuaGlkZGVuRWxlbWVudHMgPSBbXTtcbiAgfVxuXG4gIHJlc2V0Rm9jdXNlZEl0ZW0oKSB7XG4gICAgdGhpcy5oaWRkZW5FbGVtZW50cy5mb3JFYWNoKGVsID0+IChlbC5pdGVtLmZvY3VzZWQgPSBmYWxzZSkpO1xuICB9XG5cbiAgc2V0UHJldmlvdXNJdGVtQXNGb2N1c2VkKCkge1xuICAgIGlmIChcbiAgICAgICF0aGlzLmlzTWVudUNsb3NlZCAmJlxuICAgICAgdGhpcy5oaWRkZW5FbGVtZW50cy5sZW5ndGggPiAwICYmXG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLmZpbHRlcihlbCA9PiAhZWwuaXRlbS5kaXNhYmxlZCkubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgbGV0IGZvY3VzZWRJdGVtSW5kZXg6IG51bWJlciA9IHRoaXMuaGlkZGVuRWxlbWVudHMuZmluZEluZGV4KGVsID0+IGVsLml0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICB0aGlzLnJlc2V0Rm9jdXNlZEl0ZW0oKTtcbiAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ICE9PSAtMSAmJiBmb2N1c2VkSXRlbUluZGV4ICE9PSAwKSB7XG4gICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSBmb2N1c2VkSXRlbUluZGV4IC0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvY3VzZWRJdGVtSW5kZXggPSB0aGlzLmhpZGRlbkVsZW1lbnRzLmxlbmd0aCAtIDE7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHNbZm9jdXNlZEl0ZW1JbmRleF0uaXRlbS5mb2N1c2VkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuaGlkZGVuRWxlbWVudHNbZm9jdXNlZEl0ZW1JbmRleF0uaXRlbS5kaXNhYmxlZCkge1xuICAgICAgICB0aGlzLnNldFByZXZpb3VzSXRlbUFzRm9jdXNlZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNldE5leHRJdGVtQXNGb2N1c2VkKCkge1xuICAgIGlmIChcbiAgICAgICF0aGlzLmlzTWVudUNsb3NlZCAmJlxuICAgICAgdGhpcy5oaWRkZW5FbGVtZW50cy5sZW5ndGggPiAwICYmXG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLmZpbHRlcihlbCA9PiAhZWwuaXRlbS5kaXNhYmxlZCkubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgbGV0IGZvY3VzZWRJdGVtSW5kZXg6IG51bWJlciA9IHRoaXMuaGlkZGVuRWxlbWVudHMuZmluZEluZGV4KGVsID0+IGVsLml0ZW0uZm9jdXNlZCA9PT0gdHJ1ZSk7XG4gICAgICB0aGlzLnJlc2V0Rm9jdXNlZEl0ZW0oKTtcbiAgICAgIGlmIChmb2N1c2VkSXRlbUluZGV4ICE9PSAtMSAmJiBmb2N1c2VkSXRlbUluZGV4ICE9PSB0aGlzLmhpZGRlbkVsZW1lbnRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgZm9jdXNlZEl0ZW1JbmRleCA9IGZvY3VzZWRJdGVtSW5kZXggKyAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9jdXNlZEl0ZW1JbmRleCA9IDA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHNbZm9jdXNlZEl0ZW1JbmRleF0uaXRlbS5mb2N1c2VkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuaGlkZGVuRWxlbWVudHNbZm9jdXNlZEl0ZW1JbmRleF0uaXRlbS5kaXNhYmxlZCkge1xuICAgICAgICB0aGlzLnNldE5leHRJdGVtQXNGb2N1c2VkKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2hvd1NlbGVjdGVkKHZhbHVlKSB7XG4gICAgY29uc3QgY2hlY2tlZEVsID0gdGhpcy5oaWRkZW5FbGVtZW50cy5maW5kKGVsID0+IHtcbiAgICAgIHJldHVybiBlbC5pdGVtLnZhbHVlID09PSB2YWx1ZTtcbiAgICB9KTtcbiAgICBpZiAoY2hlY2tlZEVsKSB7XG4gICAgICBjaGVja2VkRWwuaXRlbS5yZW1vdmVGcm9tRHJvcGRvd24oKTtcbiAgICAgIGNoZWNrZWRFbC5pdGVtLnRvZ2dsZUl0ZW1WaXNpYmlsaXR5KHRoaXMuaXNNZW51Q2xvc2VkKTtcbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHMgPSB0aGlzLmhpZGRlbkVsZW1lbnRzLmZpbHRlcihlbCA9PiBlbC5pdGVtLnZhbHVlICE9PSB0aGlzLnZhbHVlKTtcbiAgICAgIHRoaXMudmlzaWJsZUVsZW1lbnRzLnB1c2goY2hlY2tlZEVsKTtcbiAgICAgIHRoaXMuc29ydEFycmF5cygpO1xuICAgICAgdGhpcy5wb3NpdGlvbk92ZXJmbG93ZWRJdGVtcygpO1xuICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB0aGlzLl9oaWRlRWxlbWVudCgpO1xuICAgIH1cbiAgfVxuXG4gIF9zaG93RWxlbWVudCgpIHtcbiAgICBpZiAodGhpcy5oaWRkZW5FbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IGVsID0gdGhpcy5oaWRkZW5FbGVtZW50c1swXTtcbiAgICAgIGVsLml0ZW0ucmVtb3ZlRnJvbURyb3Bkb3duKCk7XG4gICAgICBlbC5pdGVtLnRvZ2dsZUl0ZW1WaXNpYmlsaXR5KHRoaXMuaXNNZW51Q2xvc2VkKTtcbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHMuc3BsaWNlKDAsIDEpO1xuICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHMucHVzaChlbCk7XG4gICAgICB0aGlzLnNvcnRBcnJheXMoKTtcbiAgICAgIGVsLnZpZXcuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgaWYgKHRoaXMuX2lzT3ZlcmZsb3cpIHtcbiAgICAgICAgdGhpcy5faGlkZUVsZW1lbnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3Nob3dFbGVtZW50KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2hvd0RvdHMgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBfaGlkZUVsZW1lbnQoKSB7XG4gICAgaWYgKCF0aGlzLl9pc092ZXJmbG93IHx8IHRoaXMudmlzaWJsZUVsZW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGluZGV4ID0gdGhpcy52aXNpYmxlRWxlbWVudHMubGVuZ3RoIC0gMTtcbiAgICBpZiAodGhpcy52aXNpYmxlRWxlbWVudHNbaW5kZXhdLml0ZW0udmFsdWUgPT09IHRoaXMudmFsdWUpIHtcbiAgICAgIGluZGV4ID0gaW5kZXggLSAxO1xuICAgIH1cblxuICAgIGNvbnN0IGVsID0gdGhpcy52aXNpYmxlRWxlbWVudHNbaW5kZXhdO1xuICAgIGVsLml0ZW0ubW92ZVRvRHJvcGRvd24oKTtcbiAgICBlbC5pdGVtLnRvZ2dsZUl0ZW1WaXNpYmlsaXR5KHRoaXMuaXNNZW51Q2xvc2VkKTtcbiAgICB0aGlzLnZpc2libGVFbGVtZW50cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIHRoaXMuaGlkZGVuRWxlbWVudHMudW5zaGlmdChlbCk7XG4gICAgdGhpcy5zb3J0QXJyYXlzKCk7XG4gICAgdGhpcy5wb3NpdGlvbk92ZXJmbG93ZWRJdGVtcygpO1xuICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMuX2hpZGVFbGVtZW50KCk7XG4gIH1cblxuICBzb3J0QXJyYXlzKCkge1xuICAgIHRoaXMuaGlkZGVuRWxlbWVudHMuc29ydCgoYSwgYikgPT4gYS5vcmRlciAtIGIub3JkZXIpO1xuICAgIHRoaXMudmlzaWJsZUVsZW1lbnRzLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTtcbiAgfVxuXG4gIHNlbGVjdEJ1dHRvbihidXR0b25JdGVtOiBTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50KSB7XG4gICAgbGV0IGlzVmFsdWVDaGFuZ2VkID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy51bmNoZWNrYWJsZSkge1xuICAgICAgdGhpcy52YWx1ZSA9ICFidXR0b25JdGVtLmNoZWNrZWQgPyBidXR0b25JdGVtLnZhbHVlIDogbnVsbDtcbiAgICAgIGlzVmFsdWVDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMudmFsdWUgIT09IGJ1dHRvbkl0ZW0udmFsdWUpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IGJ1dHRvbkl0ZW0udmFsdWU7XG4gICAgICAgIGlzVmFsdWVDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGlzVmFsdWVDaGFuZ2VkKSB7XG4gICAgICB0aGlzLl90b2dnbGVDaGVja2VkQ2hpbGRyZW4oYnV0dG9uSXRlbSk7XG4gICAgICB0aGlzLnNob3dTZWxlY3RlZCh0aGlzLnZhbHVlKTtcbiAgICAgIHRoaXMuX29uQ2hhbmdlKHRoaXMudmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidXR0b25JdGVtLmJ1dHRvbi5jaGVja2VkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICB0b2dnbGVNZW51KHN0YXRlPzogYm9vbGVhbikge1xuICAgIGlmICghdGhpcy5kaXNhYmxlZCkge1xuICAgICAgc3RhdGUgIT09IHVuZGVmaW5lZCA/ICh0aGlzLmlzTWVudUNsb3NlZCA9IHN0YXRlKSA6ICh0aGlzLmlzTWVudUNsb3NlZCA9ICF0aGlzLmlzTWVudUNsb3NlZCk7XG4gICAgICB0aGlzLmhpZGRlbkVsZW1lbnRzLmZvckVhY2goZWwgPT4ge1xuICAgICAgICBlbC5pdGVtLnRvZ2dsZUl0ZW1WaXNpYmlsaXR5KHRoaXMuaXNNZW51Q2xvc2VkKTtcbiAgICAgICAgZWwudmlldy5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBnZXRNYXhFbFdpZHRoSW5Ecm9wZG93bigpIHtcbiAgICBpZiAodGhpcy5oaWRkZW5FbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgIHRoaXMudG9nZ2xlTWVudShmYWxzZSk7XG4gICAgICB0aGlzLm1heEVsV2lkdGhJbkRyb3Bkb3duID0gdGhpcy5oaWRkZW5FbGVtZW50c1swXS52aWV3LnJvb3ROb2Rlc1swXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICAgIHRoaXMuaGlkZGVuRWxlbWVudHMuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgIGNvbnN0IGVsV2lkdGg6IG51bWJlciA9IGVsLnZpZXcucm9vdE5vZGVzWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICAgICAgICBpZiAoZWxXaWR0aCA+IHRoaXMubWF4RWxXaWR0aEluRHJvcGRvd24pIHtcbiAgICAgICAgICB0aGlzLm1heEVsV2lkdGhJbkRyb3Bkb3duID0gZWxXaWR0aDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnRvZ2dsZU1lbnUodHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgcG9zaXRpb25PdmVyZmxvd2VkSXRlbXMoKSB7XG4gICAgdGhpcy5nZXRNYXhFbFdpZHRoSW5Ecm9wZG93bigpO1xuICAgIHRoaXMuaGlkZGVuRWxlbWVudHMuZm9yRWFjaCgoZWwsIGluZGV4KSA9PiB7XG4gICAgICBlbC5pdGVtLnNldFRvcChpbmRleCArIDEpO1xuICAgICAgZWwuaXRlbS5zZXRXaWR0aCh0aGlzLm1heEVsV2lkdGhJbkRyb3Bkb3duKTtcbiAgICB9KTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIGdldCBfaXNPdmVyZmxvdygpOiBib29sZWFuIHtcbiAgICB0aGlzLl9zZWdtZW50QnV0dG9uSGVpZ2h0ID0gdGhpcy5zZWdtZW50QnV0dG9uLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0LnRvRml4ZWQoMCk7XG4gICAgdGhpcy5fY29tcG9uZW50SGVpZ2h0ID0gdGhpcy5sYWJlbFdyYXBwZXIubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQudG9GaXhlZCgwKTtcbiAgICBpZiAodGhpcy5fc2VnbWVudEJ1dHRvbkhlaWdodCAhPT0gdGhpcy5fY29tcG9uZW50SGVpZ2h0KSB7XG4gICAgICB0aGlzLnNob3dEb3RzID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBfdG9nZ2xlQ2hlY2tlZENoaWxkcmVuKGl0ZW06IFNlZ21lbnRlZEJ1dHRvbkl0ZW1Db21wb25lbnQpIHtcbiAgICBpZiAodGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50KSB7XG4gICAgICB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQudG9BcnJheSgpLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIGlmIChlbGVtZW50ID09PSBpdGVtKSB7XG4gICAgICAgICAgZWxlbWVudC5zZXRDaGVja2VkKHRoaXMudW5jaGVja2FibGUgPyAhZWxlbWVudC5jaGVja2VkIDogdHJ1ZSk7XG4gICAgICAgICAgdGhpcy51cGRhdGVFdmVudC5lbWl0KHRoaXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVsZW1lbnQuc2V0Q2hlY2tlZChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyT3RoZXJDaGlsZHJlbihpdGVtOiBTZWdtZW50ZWRCdXR0b25JdGVtQ29tcG9uZW50KSB7XG4gICAgaWYgKHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudCkge1xuICAgICAgdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LnRvQXJyYXkoKS5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICBpZiAoZWxlbWVudCAhPT0gaXRlbSkge1xuICAgICAgICAgIGVsZW1lbnQuc2V0Q2hlY2tlZChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fb25DaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5fb25Ub3VjaGVkID0gZm47XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IGluaXRpYWxJdGVtID0gdGhpcy5jaGlsZEl0ZW1zQ29tcG9uZW50LnRvQXJyYXkoKS5maW5kKGVsZW1lbnQgPT4gZWxlbWVudC52YWx1ZSA9PT0gdGhpcy52YWx1ZSk7XG4gICAgICBjb25zdCBpdGVtVG9TZWxlY3QgPSB0aGlzLmNoaWxkSXRlbXNDb21wb25lbnQudG9BcnJheSgpLmZpbmQoZWxlbWVudCA9PiBlbGVtZW50LnZhbHVlID09PSB2YWx1ZSk7XG5cbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcblxuICAgICAgaWYgKGluaXRpYWxJdGVtKSB7XG4gICAgICAgIGluaXRpYWxJdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW1Ub1NlbGVjdCkge1xuICAgICAgICBpdGVtVG9TZWxlY3QuY2hlY2tlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKCkge1xuICAgIHRoaXMuY2hpbGRJdGVtc0NvbXBvbmVudC5mb3JFYWNoKGVsID0+IHtcbiAgICAgIGVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfVxufVxuIl19