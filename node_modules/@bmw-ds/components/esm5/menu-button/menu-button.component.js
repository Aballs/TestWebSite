import { __decorate } from "tslib";
import { Component, ContentChild, HostBinding, Input, OnInit, ElementRef, AfterContentInit, isDevMode } from '@angular/core';
import { ContextMenuComponent, ContextMenuEventProviderDirective } from '../context-menu/context-menu.module';
var MenuButtonComponent = /** @class */ (function () {
    function MenuButtonComponent(elemRef) {
        this.elemRef = elemRef;
        this.styleVariant = 'default';
        this.sizeVariant = 'normal';
        this.preserveState = false;
    }
    MenuButtonComponent.prototype.ngOnInit = function () {
        if (!this.id) {
            this.id = Math.random()
                .toString(36)
                .substring(2);
        }
        // keep the legacy input "closeOnFocusout"
        if (this.closeOnClickOutside === undefined) {
            if (this.closeOnFocusout !== undefined && isDevMode()) {
                console.warn('<bmw-menu-button> `closeOnFocusout` input is deprecated. Please use `closeOnClickOutside` instead');
            }
            this.closeOnClickOutside = this.closeOnFocusout !== undefined ? this.closeOnFocusout : true;
        }
    };
    MenuButtonComponent.prototype.ngAfterContentInit = function () {
        var _this = this;
        var _a;
        (_a = this.eventProvider) === null || _a === void 0 ? void 0 : _a.itemSelected.subscribe(function (event) {
            if (event.leafItem) {
                _this.toggle(false);
            }
        });
        this.childContextMenu.closeOnClickOutside = this.closeOnClickOutside;
    };
    MenuButtonComponent.prototype.toggle = function (state) {
        if (!this.childContextMenu || !this.childContextMenu.toggle)
            return;
        this.childContextMenu.toggle(state);
        if (!this.preserveState && !this.childContextMenu.opened)
            this.childContextMenu.unselectSubs();
        document.removeEventListener('click', this.outsideCallback);
        if (this.opened) {
            this.outsideCallback = this.onClickOutside.bind(this);
            document.addEventListener('click', this.outsideCallback);
        }
    };
    MenuButtonComponent.prototype.onClickOutside = function (_a) {
        var target = _a.target;
        if (this.closeOnClickOutside && !this.elemRef.nativeElement.contains(target)) {
            this.toggle(false);
            document.removeEventListener('click', this.outsideCallback);
        }
    };
    Object.defineProperty(MenuButtonComponent.prototype, "opened", {
        get: function () {
            return this.childContextMenu ? this.childContextMenu.opened : false;
        },
        enumerable: true,
        configurable: true
    });
    MenuButtonComponent.prototype.click = function (event) {
        event.stopPropagation();
        this.toggle();
    };
    MenuButtonComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        ContentChild(ContextMenuComponent)
    ], MenuButtonComponent.prototype, "childContextMenu", void 0);
    __decorate([
        ContentChild(ContextMenuEventProviderDirective)
    ], MenuButtonComponent.prototype, "eventProvider", void 0);
    __decorate([
        Input()
    ], MenuButtonComponent.prototype, "disabled", void 0);
    __decorate([
        Input()
    ], MenuButtonComponent.prototype, "closeOnFocusout", void 0);
    __decorate([
        Input()
    ], MenuButtonComponent.prototype, "closeOnClickOutside", void 0);
    __decorate([
        Input()
    ], MenuButtonComponent.prototype, "styleVariant", void 0);
    __decorate([
        Input()
    ], MenuButtonComponent.prototype, "sizeVariant", void 0);
    __decorate([
        Input()
    ], MenuButtonComponent.prototype, "preserveState", void 0);
    __decorate([
        HostBinding('attr.id'),
        Input()
    ], MenuButtonComponent.prototype, "id", void 0);
    __decorate([
        HostBinding('class.opened')
    ], MenuButtonComponent.prototype, "opened", null);
    MenuButtonComponent = __decorate([
        Component({
            selector: 'bmw-menu-button',
            template: "<div>\n  <button\n    class=\"button\"\n    [ngClass]=\"[\n      styleVariant !== 'default' ? 'button--' + styleVariant : '',\n      sizeVariant !== 'normal' ? 'button--' + sizeVariant : ''\n    ]\"\n    [disabled]=\"disabled\"\n    (click)=\"click($event)\"\n  >\n    <div [ngClass]=\"sizeVariant === 'small' ? 'bmw-component-headline-text-small' : 'bmw-component-headline-text'\">\n      <ng-content select=\"label\"></ng-content>\n    </div>\n  </button>\n  <ng-content select=\"bmw-context-menu\"></ng-content>\n</div>\n",
            styles: ["div button{display:block;padding-right:calc(2 * var(--button__medium__padding) + var(--typography__component-headline-text__line-height) + 1px);box-sizing:border-box}div button div ::ng-deep label{width:100%;display:block;text-align:left;cursor:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div button.button--small{min-width:var(--menu-button__small__min-width)}div button.button--small ::ng-deep label{padding-right:calc(2 * var(--button__small__padding) + var(--typography__component-headline-text__line-height) + 1px);font-size:var(--menu-button__small__font-size);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div button div:after{font-family:iwp;content:'\\e92f';position:absolute;right:var(--button__medium__padding);font-size:var(--typography__component-headline-text__font-size);top:calc(50% - var(--typography__component-headline-text__line-height)/ 2 - 1px)}:host.opened div button{color:var(--toggle-button__secondary__selected__color)!important;background-color:var(--toggle-button__secondary__selected__background-color)!important}:host.opened div button.button--primary{color:var(--toggle-button__primary__color)!important;border:1px solid!important;background-color:var(--toggle-button__primary__selected__background-color)!important}:host.opened div button.button--secondary{color:var(--toggle-button__secondary__selected__color)!important;background-color:var(--toggle-button__secondary__selected__background-color)!important}:host.opened div button div:after{font-family:iwp;content:'\\e932'}:host{display:inline-block;position:relative;max-width:100%}:host ::ng-deep bmw-context-menu div:first-of-type{min-width:100%}", ".button{padding:var(--button__medium__padding);text-transform:uppercase;color:var(--button__default__color);border:solid 1px var(--button__default__border__color);background-color:var(--button__default__background-color);position:relative;max-width:100%;cursor:pointer}.button.icon-left{padding-left:calc(var(--typography__component-headline-text__line-height) + var(--button__medium__padding) + var(--button__default__icon__padding))}.button.icon-right{padding-right:calc(var(--typography__component-headline-text__line-height) + var(--button__medium__padding) + var(--button__default__icon__padding))}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.button{padding-top:calc(var(--button__medium__padding) + 2px);padding-bottom:calc(var(--button__medium__padding) - 2px)}.button.icon-left{padding-left:30px}.button.icon-right{padding-right:30px}}.button i{font-size:var(--typography__component-headline-text__font-size);line-height:var(--typography__component-headline-text__line-height);position:absolute;top:calc(50% - var(--typography__component-headline-text__line-height)/ 2)}.button i.icon-left{left:var(--button__medium__padding)}.button i.icon-right{right:var(--button__medium__padding)}.button:focus{outline:solid 1px;outline-color:var(--color-bmw-highlight);outline-offset:-1px;z-index:var(--z-index__content-base)}.button .bmw-component-headline-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.button.button--primary{border:solid 1px var(--button__primary__background-color);background-color:var(--button__primary__background-color);color:var(--button__primary__color)}.button.button--primary .bmw-component-headline-text,.button.button--primary .bmw-component-headline-text-small{color:var(--button__primary__color)}.button.button--primary:focus{outline:solid 1px;outline-color:var(--color-bmw-basic5);outline-offset:-3px}.button.button--secondary{border:solid 1px var(--button__secondary__border__color);background-color:var(--button__secondary__background-color)}.button:active{background-color:var(--button__default__active__background-color);border:solid 1px var(--button__default__active__background-color);color:var(--button__default__active__color)}.button:active .bmw-component-headline-text,.button:active .bmw-component-headline-text-small{color:var(--button__default__active__color)}.button:active.button--primary{background-color:var(--button__primary__active__background-color)}.button:active.button--secondary{background-color:var(--button__secondary__active__background-color)}.button:active,.button:hover{background-color:var(--button__default__hover__background-color);border:solid 1px var(--button__default__hover__border-color);color:var(--button__default__hover__color)}.button:active .bmw-component-headline-text,.button:active .bmw-component-headline-text-small,.button:hover .bmw-component-headline-text,.button:hover .bmw-component-headline-text-small{color:var(--button__default__hover__color)}.button:active.button--primary,.button:hover.button--primary{color:var(--button__primary__color);background-color:var(--button__primary__hover__background-color);border:solid 1px var(--button__primary__hover__background-color)}.button:active.button--primary .bmw-component-headline-text,.button:hover.button--primary .bmw-component-headline-text{color:var(--button__primary__hover__color)}.button:active.button--primary .bmw-component-headline-text-small,.button:hover.button--primary .bmw-component-headline-text-small{color:var(--button__primary__hover__color)}.button:active.button--secondary,.button:hover.button--secondary{color:var(--button__secondary__hover__color);background-color:var(--button__secondary__hover__background-color);border:solid 1px var(--button__secondary__border__color)}.button:active.button--secondary .bmw-component-headline-text,.button:hover.button--secondary .bmw-component-headline-text{color:var(--button__secondary__hover__color)}.button:active.button--secondary .bmw-component-headline-text-small,.button:hover.button--secondary .bmw-component-headline-text-small{color:var(--button__secondary__hover__color)}.button[disabled]{opacity:.7;pointer-events:none}.button.button--small{padding:var(--button__small__padding);padding-top:var(--button__small__padding-top);padding-bottom:var(--button__small__padding-bottom)}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.button.button--small{padding-top:calc(var(--button__small__padding-top) + 2px);padding-bottom:calc(var(--button__small__padding-bottom) - 2px)}}.button.button--small i{font-size:var(--typography__component-headline-text-small__font-size);line-height:var(--typography__component-headline-text-small__line-height);top:calc(50% - (var(--typography__component-headline-text-small__line-height)/ 2))}.button.button--small i.icon-left{left:var(--button__small__padding)}.button.button--small i.icon-right{right:var(--button__small__padding)}.button.button--small.icon-left{padding-left:calc(var(--typography__component-headline-text-small__font-size) + var(--button__small__padding) + var(--button__default__icon__padding))}.button.button--small.icon-right{padding-right:calc(var(--typography__component-headline-text-small__font-size) + var(--button__small__padding) + var(--button__default__icon__padding))}:host{max-width:100%}:host.disabled{cursor:no-drop;display:inline-block}"]
        })
    ], MenuButtonComponent);
    return MenuButtonComponent;
}());
export { MenuButtonComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS1idXR0b24uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGJtdy1kcy9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibWVudS1idXR0b24vbWVudS1idXR0b24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUNMLE1BQU0sRUFDTixVQUFVLEVBQ1YsZ0JBQWdCLEVBQ2hCLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQVE5RztJQXdCRSw2QkFBb0IsT0FBbUI7UUFBbkIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQVp2QyxpQkFBWSxHQUF3QyxTQUFTLENBQUM7UUFFOUQsZ0JBQVcsR0FBdUIsUUFBUSxDQUFDO1FBRTNDLGtCQUFhLEdBQUcsS0FBSyxDQUFDO0lBUW9CLENBQUM7SUFFM0Msc0NBQVEsR0FBUjtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ1osSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFO2lCQUNwQixRQUFRLENBQUMsRUFBRSxDQUFDO2lCQUNaLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqQjtRQUVELDBDQUEwQztRQUMxQyxJQUFJLElBQUksQ0FBQyxtQkFBbUIsS0FBSyxTQUFTLEVBQUU7WUFDMUMsSUFBSSxJQUFJLENBQUMsZUFBZSxLQUFLLFNBQVMsSUFBSSxTQUFTLEVBQUUsRUFBRTtnQkFDckQsT0FBTyxDQUFDLElBQUksQ0FDVixtR0FBbUcsQ0FDcEcsQ0FBQzthQUNIO1lBRUQsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxlQUFlLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJ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b25lbnQsXG4gIENvbnRlbnRDaGlsZCxcbiAgSG9zdEJpbmRpbmcsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIEVsZW1lbnRSZWYsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIGlzRGV2TW9kZVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbnRleHRNZW51Q29tcG9uZW50LCBDb250ZXh0TWVudUV2ZW50UHJvdmlkZXJEaXJlY3RpdmUgfSBmcm9tICcuLi9jb250ZXh0LW1lbnUvY29udGV4dC1tZW51Lm1vZHVsZSc7XG5pbXBvcnQgeyBTZWxlY3RlZEl0ZW1JbmZvIH0gZnJvbSAnLi4vY29udGV4dC1tZW51L2NvbnRleHQtbWVudS1ldmVudC1wcm92aWRlci5kaXJlY3RpdmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdibXctbWVudS1idXR0b24nLFxuICB0ZW1wbGF0ZVVybDogJy4vbWVudS1idXR0b24uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9tZW51LWJ1dHRvbi5jb21wb25lbnQubGVzcycsICcuLi9idXR0b24vYnV0dG9uLmNvbXBvbmVudC5sZXNzJ11cbn0pXG5leHBvcnQgY2xhc3MgTWVudUJ1dHRvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCB7XG4gIEBDb250ZW50Q2hpbGQoQ29udGV4dE1lbnVDb21wb25lbnQpXG4gIGNoaWxkQ29udGV4dE1lbnU6IENvbnRleHRNZW51Q29tcG9uZW50O1xuICBAQ29udGVudENoaWxkKENvbnRleHRNZW51RXZlbnRQcm92aWRlckRpcmVjdGl2ZSlcbiAgZXZlbnRQcm92aWRlcjogQ29udGV4dE1lbnVFdmVudFByb3ZpZGVyRGlyZWN0aXZlO1xuICBASW5wdXQoKVxuICBkaXNhYmxlZDogYm9vbGVhbjtcbiAgQElucHV0KClcbiAgY2xvc2VPbkZvY3Vzb3V0OiBib29sZWFuO1xuICBASW5wdXQoKVxuICBjbG9zZU9uQ2xpY2tPdXRzaWRlOiBib29sZWFuO1xuICBASW5wdXQoKVxuICBzdHlsZVZhcmlhbnQ6ICdkZWZhdWx0JyB8ICdwcmltYXJ5JyB8ICdzZWNvbmRhcnknID0gJ2RlZmF1bHQnO1xuICBASW5wdXQoKVxuICBzaXplVmFyaWFudDogJ25vcm1hbCcgfCAnc21hbGwnID0gJ25vcm1hbCc7XG4gIEBJbnB1dCgpXG4gIHByZXNlcnZlU3RhdGUgPSBmYWxzZTtcblxuICBASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKVxuICBASW5wdXQoKVxuICBpZDogc3RyaW5nO1xuXG4gIG91dHNpZGVDYWxsYmFjazogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbVJlZjogRWxlbWVudFJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgIHRoaXMuaWQgPSBNYXRoLnJhbmRvbSgpXG4gICAgICAgIC50b1N0cmluZygzNilcbiAgICAgICAgLnN1YnN0cmluZygyKTtcbiAgICB9XG5cbiAgICAvLyBrZWVwIHRoZSBsZWdhY3kgaW5wdXQgXCJjbG9zZU9uRm9jdXNvdXRcIlxuICAgIGlmICh0aGlzLmNsb3NlT25DbGlja091dHNpZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKHRoaXMuY2xvc2VPbkZvY3Vzb3V0ICE9PSB1bmRlZmluZWQgJiYgaXNEZXZNb2RlKCkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICc8Ym13LW1lbnUtYnV0dG9uPiBgY2xvc2VPbkZvY3Vzb3V0YCBpbnB1dCBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIGBjbG9zZU9uQ2xpY2tPdXRzaWRlYCBpbnN0ZWFkJ1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNsb3NlT25DbGlja091dHNpZGUgPSB0aGlzLmNsb3NlT25Gb2N1c291dCAhPT0gdW5kZWZpbmVkID8gdGhpcy5jbG9zZU9uRm9jdXNvdXQgOiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmV2ZW50UHJvdmlkZXI/Lml0ZW1TZWxlY3RlZC5zdWJzY3JpYmUoKGV2ZW50OiBTZWxlY3RlZEl0ZW1JbmZvKSA9PiB7XG4gICAgICBpZiAoZXZlbnQubGVhZkl0ZW0pIHtcbiAgICAgICAgdGhpcy50b2dnbGUoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5jaGlsZENvbnRleHRNZW51LmNsb3NlT25DbGlja091dHNpZGUgPSB0aGlzLmNsb3NlT25DbGlja091dHNpZGU7XG4gIH1cblxuICB0b2dnbGUoc3RhdGU/OiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLmNoaWxkQ29udGV4dE1lbnUgfHwgIXRoaXMuY2hpbGRDb250ZXh0TWVudS50b2dnbGUpIHJldHVybjtcbiAgICB0aGlzLmNoaWxkQ29udGV4dE1lbnUudG9nZ2xlKHN0YXRlKTtcbiAgICBpZiAoIXRoaXMucHJlc2VydmVTdGF0ZSAmJiAhdGhpcy5jaGlsZENvbnRleHRNZW51Lm9wZW5lZCkgdGhpcy5jaGlsZENvbnRleHRNZW51LnVuc2VsZWN0U3VicygpO1xuXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm91dHNpZGVDYWxsYmFjayk7XG4gICAgaWYgKHRoaXMub3BlbmVkKSB7XG4gICAgICB0aGlzLm91dHNpZGVDYWxsYmFjayA9IHRoaXMub25DbGlja091dHNpZGUuYmluZCh0aGlzKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vdXRzaWRlQ2FsbGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIG9uQ2xpY2tPdXRzaWRlKHsgdGFyZ2V0IH0pIHtcbiAgICBpZiAodGhpcy5jbG9zZU9uQ2xpY2tPdXRzaWRlICYmICF0aGlzLmVsZW1SZWYubmF0aXZlRWxlbWVudC5jb250YWlucyh0YXJnZXQpKSB7XG4gICAgICB0aGlzLnRvZ2dsZShmYWxzZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub3V0c2lkZUNhbGxiYWNrKTtcbiAgICB9XG4gIH1cblxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLm9wZW5lZCcpXG4gIGdldCBvcGVuZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hpbGRDb250ZXh0TWVudSA/IHRoaXMuY2hpbGRDb250ZXh0TWVudS5vcGVuZWQgOiBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBjbGljayhldmVudDogTW91c2VFdmVudCkge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMudG9nZ2xlKCk7XG4gIH1cbn1cbiJdfQ==