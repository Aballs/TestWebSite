import { __decorate } from "tslib";
import { AfterContentChecked, AfterContentInit, Component, ContentChildren, EventEmitter, HostBinding, Input, OnChanges, OnDestroy, OnInit, Output, QueryList, HostListener, ElementRef } from '@angular/core';
import { PanelComponent } from '../panel/panel.component';
var AccordionComponent = /** @class */ (function () {
    function AccordionComponent(elem) {
        this.elem = elem;
        this.activePanelId = null;
        this.activePanelIdChange = new EventEmitter();
        this.subscriptions = [];
    }
    AccordionComponent.prototype.onKeydown = function (event) {
        var key = event.code || event.keyCode;
        switch (key) {
            case 'Enter':
            case 'NumpadEnter':
            case 13:
            case 'Space':
            case 32:
                var targetedPanel_1 = Array.prototype.slice
                    .call(this.elem.nativeElement.querySelectorAll('.panel'))
                    .find(function (panel) { return panel === event.target; });
                if (targetedPanel_1) {
                    this.setActivePanel(this.panels.find(function (panel) { return panel.labelsDiv.nativeElement === targetedPanel_1; }).id, targetedPanel_1.classList.contains('opened'));
                }
                event.stopImmediatePropagation();
                break;
        }
    };
    AccordionComponent.prototype.ngOnInit = function () {
        if (typeof this.id === 'undefined') {
            this.id = this.createId();
        }
    };
    AccordionComponent.prototype.ngOnChanges = function () {
        if (!this.panels)
            return;
        this.setActivePanel(this.activePanelId);
    };
    AccordionComponent.prototype.ngAfterContentInit = function () {
        this.panels.changes.subscribe(this.setupPanels.bind(this));
        this.setupPanels();
    };
    AccordionComponent.prototype.ngOnDestroy = function () {
        this.subscriptions.forEach(function (subscription) { return subscription.unsubscribe(); });
    };
    AccordionComponent.prototype.setupPanels = function () {
        var _this = this;
        this.subscriptions.forEach(function (subscription) { return subscription.unsubscribe(); });
        this.subscriptions = this.panels.map(function (panel) {
            return panel.toggleEvent.subscribe(function (event) {
                _this.setActivePanel(panel.id, event.opened);
            });
        });
        if (this.activePanelId) {
            return this.setActivePanel(this.activePanelId);
        }
    };
    AccordionComponent.prototype.setActivePanel = function (activePanelId, opened) {
        var _this = this;
        if (opened === void 0) { opened = true; }
        this.panels.forEach(function (panel) {
            if (panel.id !== activePanelId && _this.canTogglePanel(panel)) {
                panel.opened = false;
            }
            if (panel.id === activePanelId) {
                panel.opened = opened;
                _this.activePanelId = opened ? activePanelId : null;
                _this.activePanelIdChange.emit(_this.activePanelId);
            }
        });
    };
    AccordionComponent.prototype.canTogglePanel = function (panel) {
        return !panel.disabled && !panel.nonCollapsible;
    };
    AccordionComponent.prototype.createId = function () {
        return Math.random()
            .toString(36)
            .substring(2);
    };
    AccordionComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        ContentChildren(PanelComponent)
    ], AccordionComponent.prototype, "panels", void 0);
    __decorate([
        Input()
    ], AccordionComponent.prototype, "activePanelId", void 0);
    __decorate([
        HostBinding('attr.id'),
        Input()
    ], AccordionComponent.prototype, "id", void 0);
    __decorate([
        Output()
    ], AccordionComponent.prototype, "activePanelIdChange", void 0);
    __decorate([
        HostListener('keydown', ['$event'])
    ], AccordionComponent.prototype, "onKeydown", null);
    AccordionComponent = __decorate([
        Component({
            selector: 'bmw-accordion',
            template: "<ng-content></ng-content>\n",
            styles: [":host{display:block}:host ::ng-deep bmw-panel{margin-bottom:var(--spacing-bmw-xs)}"]
        })
    ], AccordionComponent);
    return AccordionComponent;
}());
export { AccordionComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3JkaW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BibXctZHMvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbImFjY29yZGlvbi9hY2NvcmRpb24uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsbUJBQW1CLEVBQ25CLGdCQUFnQixFQUNoQixTQUFTLEVBQ1QsZUFBZSxFQUNmLFlBQVksRUFDWixXQUFXLEVBQ1gsS0FBSyxFQUNMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFRMUQ7SUFnQkUsNEJBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7UUFYcEMsa0JBQWEsR0FBVyxJQUFJLENBQUM7UUFPN0Isd0JBQW1CLEdBQXlCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFdkQsa0JBQWEsR0FBbUIsRUFBRSxDQUFDO0lBRUosQ0FBQztJQUd4QyxzQ0FBUyxHQUFULFVBQVUsS0FBb0I7UUFDNUIsSUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3hDLFFBQVEsR0FBRyxFQUFFO1lBQ1gsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLGFBQWEsQ0FBQztZQUNuQixLQUFLLEVBQUUsQ0FBQztZQUNSLEtBQUssT0FBTyxDQUFDO1lBQ2IsS0FBSyxFQUFFO2dCQUNMLElBQU0sZUFBYSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSztxQkFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO3FCQUN4RCxJQUFJLENBQUMsVUFBQyxLQUFrQixJQUFLLE9BQUEsS0FBSyxL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QztJQUVPLDJDQUFjLEdBQXRCLFVBQXVCLEtBQXFCO1FBQzFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQztJQUNsRCxDQUFDO0lBRU8scUNBQVEsR0FBaEI7UUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUU7YUFDakIsUUFBUSxDQUFDLEVBQUUsQ0FBQzthQUNaLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQixDQUFDOztnQkE5RXlCLFVBQVU7O0lBZHBDO1FBREMsZUFBZSxDQUFDLGNBQWMsQ0FBQztzREFDRTtJQUdsQztRQURDLEtBQUssRUFBRTs2REFDcUI7SUFJN0I7UUFGQyxXQUFXLENBQUMsU0FBUyxDQUFDO1FBQ3RCLEtBQUssRUFBRTtrREFDRztJQUdYO1FBREMsTUFBTSxFQUFFO21FQUNzRDtJQU8vRDtRQURDLFlBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzt1REFxQm5DO0lBdkNVLGtCQUFrQjtRQUw5QixTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsZUFBZTtZQUN6Qix1Q0FBeUM7O1NBRTFDLENBQUM7T0FDVyxrQkFBa0IsQ0ErRjlCO0lBQUQseUJBQUM7Q0FBQSxBQS9GRCxJQStGQztTQS9GWSxrQkFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRDaGVja2VkLFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBDb21wb25lbnQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBIb3N0TGlzdGVuZXIsXG4gIEVsZW1lbnRSZWZcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBQYW5lbENvbXBvbmVudCB9IGZyb20gJy4uL3BhbmVsL3BhbmVsLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYm13LWFjY29yZGlvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9hY2NvcmRpb24uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9hY2NvcmRpb24uY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBBY2NvcmRpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJDb250ZW50SW5pdCwgT25EZXN0cm95IHtcbiAgQENvbnRlbnRDaGlsZHJlbihQYW5lbENvbXBvbmVudClcbiAgcGFuZWxzOiBRdWVyeUxpc3Q8UGFuZWxDb21wb25lbnQ+O1xuXG4gIEBJbnB1dCgpXG4gIGFjdGl2ZVBhbmVsSWQ6IHN0cmluZyA9IG51bGw7XG5cbiAgQEhvc3RCaW5kaW5nKCdhdHRyLmlkJylcbiAgQElucHV0KClcbiAgaWQ6IHN0cmluZztcblxuICBAT3V0cHV0KClcbiAgYWN0aXZlUGFuZWxJZENoYW5nZTogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbTogRWxlbWVudFJlZikge31cblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgY29uc3Qga2V5ID0gZXZlbnQuY29kZSB8fCBldmVudC5rZXlDb2RlO1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlICdFbnRlcic6XG4gICAgICBjYXNlICdOdW1wYWRFbnRlcic6XG4gICAgICBjYXNlIDEzOlxuICAgICAgY2FzZSAnU3BhY2UnOlxuICAgICAgY2FzZSAzMjpcbiAgICAgICAgY29uc3QgdGFyZ2V0ZWRQYW5lbCA9IEFycmF5LnByb3RvdHlwZS5zbGljZVxuICAgICAgICAgIC5jYWxsKHRoaXMuZWxlbS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYW5lbCcpKVxuICAgICAgICAgIC5maW5kKChwYW5lbDogRXZlbnRUYXJnZXQpID0+IHBhbmVsID09PSBldmVudC50YXJnZXQpO1xuICAgICAgICBpZiAodGFyZ2V0ZWRQYW5lbCkge1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlUGFuZWwoXG4gICAgICAgICAgICB0aGlzLnBhbmVscy5maW5kKHBhbmVsID0+IHBhbmVsLmxhYmVsc0Rpdi5uYXRpdmVFbGVtZW50ID09PSB0YXJnZXRlZFBhbmVsKS5pZCxcbiAgICAgICAgICAgIHRhcmdldGVkUGFuZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcGVuZWQnKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICh0eXBlb2YgdGhpcy5pZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuaWQgPSB0aGlzLmNyZWF0ZUlkKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgaWYgKCF0aGlzLnBhbmVscykgcmV0dXJuO1xuICAgIHRoaXMuc2V0QWN0aXZlUGFuZWwodGhpcy5hY3RpdmVQYW5lbElkKTtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnBhbmVscy5jaGFuZ2VzLnN1YnNjcmliZSh0aGlzLnNldHVwUGFuZWxzLmJpbmQodGhpcykpO1xuICAgIHRoaXMuc2V0dXBQYW5lbHMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKHN1YnNjcmlwdGlvbiA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKSk7XG4gIH1cblxuICBwcml2YXRlIHNldHVwUGFuZWxzKCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKHN1YnNjcmlwdGlvbiA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKSk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gdGhpcy5wYW5lbHMubWFwKChwYW5lbDogUGFuZWxDb21wb25lbnQpID0+IHtcbiAgICAgIHJldHVybiBwYW5lbC50b2dnbGVFdmVudC5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgICB0aGlzLnNldEFjdGl2ZVBhbmVsKHBhbmVsLmlkLCBldmVudC5vcGVuZWQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgaWYgKHRoaXMuYWN0aXZlUGFuZWxJZCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0QWN0aXZlUGFuZWwodGhpcy5hY3RpdmVQYW5lbElkKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEFjdGl2ZVBhbmVsKGFjdGl2ZVBhbmVsSWQ6IHN0cmluZywgb3BlbmVkID0gdHJ1ZSkge1xuICAgIHRoaXMucGFuZWxzLmZvckVhY2goKHBhbmVsOiBQYW5lbENvbXBvbmVudCkgPT4ge1xuICAgICAgaWYgKHBhbmVsLmlkICE9PSBhY3RpdmVQYW5lbElkICYmIHRoaXMuY2FuVG9nZ2xlUGFuZWwocGFuZWwpKSB7XG4gICAgICAgIHBhbmVsLm9wZW5lZCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHBhbmVsLmlkID09PSBhY3RpdmVQYW5lbElkKSB7XG4gICAgICAgIHBhbmVsLm9wZW5lZCA9IG9wZW5lZDtcbiAgICAgICAgdGhpcy5hY3RpdmVQYW5lbElkID0gb3BlbmVkID8gYWN0aXZlUGFuZWxJZCA6IG51bGw7XG4gICAgICAgIHRoaXMuYWN0aXZlUGFuZWxJZENoYW5nZS5lbWl0KHRoaXMuYWN0aXZlUGFuZWxJZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNhblRvZ2dsZVBhbmVsKHBhbmVsOiBQYW5lbENvbXBvbmVudCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhcGFuZWwuZGlzYWJsZWQgJiYgIXBhbmVsLm5vbkNvbGxhcHNpYmxlO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpXG4gICAgICAudG9TdHJpbmcoMzYpXG4gICAgICAuc3Vic3RyaW5nKDIpO1xuICB9XG59XG4iXX0=